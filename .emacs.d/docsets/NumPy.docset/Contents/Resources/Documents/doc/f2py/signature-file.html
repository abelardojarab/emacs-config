<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8">
    
    <title>Signature file</title>
    
    <link rel="stylesheet" type="text/css" href="../_static/css/spc-bootstrap.css">
    <link rel="stylesheet" type="text/css" href="../_static/css/spc-extend.css">
    <link rel="stylesheet" href="../_static/scipy.css" type="text/css" >
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" >
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.10.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/copybutton.js"></script>
    <link rel="author" title="About these documents" href="../about.html" >
    <link rel="top" title="NumPy v1.10 Manual" href="../index.html" >
    <link rel="up" title="F2PY Users Guide and Reference Manual" href="index.html" >
    <link rel="next" title="Using F2PY bindings in Python" href="python-usage.html" >
    <link rel="prev" title="Three ways to wrap - getting started" href="getting-started.html" > 
  </head>
  <body>

  <div class="container">
    <div class="header">
    </div>
  </div>


    <div class="container">
      <div class="main">
        
	<div class="row-fluid">
	  <div class="span12">
	    <div class="spc-navbar">
              
    <ul class="nav nav-pills pull-left">
        
        <li class="active"><a href="../index.html">NumPy v1.10 Manual</a></li>
        

          <li class="active"><a href="index.html" accesskey="U">F2PY Users Guide and Reference Manual</a></li> 
    </ul>
              
              
    <ul class="nav nav-pills pull-right">
      <li class="active">
        <a href="../genindex.html" title="General Index"
           accesskey="I">index</a>
      </li>
      <li class="active">
        <a href="python-usage.html" title="Using F2PY bindings in Python"
           accesskey="N">next</a>
      </li>
      <li class="active">
        <a href="getting-started.html" title="Three ways to wrap - getting started"
           accesskey="P">previous</a>
      </li>
    </ul>
              
	    </div>
	  </div>
	</div>
        

	<div class="row-fluid">
      <div class="spc-rightsidebar span3">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../contents.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Signature file</a><ul>
<li><a class="reference internal" href="#python-module-block">Python module block</a></li>
<li><a class="reference internal" href="#fortran-c-routine-signatures">Fortran/C routine signatures</a><ul>
<li><a class="reference internal" href="#type-declarations">Type declarations</a></li>
<li><a class="reference internal" href="#statements">Statements</a></li>
<li><a class="reference internal" href="#attributes">Attributes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#extensions">Extensions</a><ul>
<li><a class="reference internal" href="#f2py-directives">F2PY directives</a></li>
<li><a class="reference internal" href="#c-expressions">C expressions</a></li>
<li><a class="reference internal" href="#multiline-blocks">Multiline blocks</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="getting-started.html"
                        title="previous chapter">Three ways to wrap - getting started</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="python-usage.html"
                        title="next chapter">Using F2PY bindings in Python</a></p>


        </div>
      </div>
          <div class="span9">
            
        <div class="bodywrapper">
          <div class="body" id="spc-section-body">
            
  <div class="section" id="signature-file">
<h1>Signature file<a class="headerlink" href="#signature-file" title="Permalink to this headline">¶</a></h1>
<p>The syntax specification for signature files (.pyf files) is borrowed
from the Fortran 90/95 language specification. Almost all Fortran
90/95 standard constructs are understood, both in free and fixed
format (recall that Fortran 77 is a subset of Fortran 90/95). F2PY
introduces also some extensions to Fortran 90/95 language
specification that help designing Fortran to Python interface, make it
more &#8220;Pythonic&#8221;.</p>
<p>Signature files may contain arbitrary Fortran code (so that Fortran
codes can be considered as signature files). F2PY silently ignores
Fortran constructs that are irrelevant for creating the interface.
However, this includes also syntax errors. So, be careful not making
ones;-).</p>
<p>In general, the contents of signature files is case-sensitive.  When
scanning Fortran codes and writing a signature file, F2PY lowers all
cases automatically except in multiline blocks or when <tt class="docutils literal"><span class="pre">--no-lower</span></tt>
option is used.</p>
<p>The syntax of signature files is overvied below.</p>
<div class="section" id="python-module-block">
<h2>Python module block<a class="headerlink" href="#python-module-block" title="Permalink to this headline">¶</a></h2>
<p>A signature file may contain one (recommended) or more <tt class="docutils literal"><span class="pre">python</span>
<span class="pre">module</span></tt> blocks.  <tt class="docutils literal"><span class="pre">python</span> <span class="pre">module</span></tt> block describes the contents of
a Python/C extension module <tt class="docutils literal"><span class="pre">&lt;modulename&gt;module.c</span></tt> that F2PY
generates.</p>
<p>Exception: if <tt class="docutils literal"><span class="pre">&lt;modulename&gt;</span></tt> contains a substring <tt class="docutils literal"><span class="pre">__user__</span></tt>, then
the corresponding <tt class="docutils literal"><span class="pre">python</span> <span class="pre">module</span></tt> block describes the signatures of
so-called call-back functions (see <a class="reference internal" href="python-usage.html#call-back-arguments"><em>Call-back arguments</em></a>).</p>
<p>A <tt class="docutils literal"><span class="pre">python</span> <span class="pre">module</span></tt> block has the following structure:</p>
<div class="highlight-python"><div class="highlight"><pre>python module &lt;modulename&gt;
  [&lt;usercode statement&gt;]...
  [
  interface
    &lt;usercode statement&gt;
    &lt;Fortran block data signatures&gt;
    &lt;Fortran/C routine signatures&gt;
  end [interface]
  ]...
  [
  interface
    module &lt;F90 modulename&gt;
      [&lt;F90 module data type declarations&gt;]
      [&lt;F90 module routine signatures&gt;]
    end [module [&lt;F90 modulename&gt;]]
  end [interface]
  ]...
end [python module [&lt;modulename&gt;]]
</pre></div>
</div>
<p>Here brackets <tt class="docutils literal"><span class="pre">[]</span></tt> indicate a optional part, dots <tt class="docutils literal"><span class="pre">...</span></tt> indicate
one or more of a previous part. So, <tt class="docutils literal"><span class="pre">[]...</span></tt> reads zero or more of a
previous part.</p>
</div>
<div class="section" id="fortran-c-routine-signatures">
<h2>Fortran/C routine signatures<a class="headerlink" href="#fortran-c-routine-signatures" title="Permalink to this headline">¶</a></h2>
<p>The signature of a Fortran routine has the following structure:</p>
<div class="highlight-python"><div class="highlight"><pre>[&lt;typespec&gt;] function | subroutine &lt;routine name&gt; \
              [ ( [&lt;arguments&gt;] ) ] [ result ( &lt;entityname&gt; ) ]
  [&lt;argument/variable type declarations&gt;]
  [&lt;argument/variable attribute statements&gt;]
  [&lt;use statements&gt;]
  [&lt;common block statements&gt;]
  [&lt;other statements&gt;]
end [ function | subroutine [&lt;routine name&gt;] ]
</pre></div>
</div>
<p>From a Fortran routine signature F2PY generates a Python/C extension
function that has the following signature:</p>
<div class="highlight-python"><div class="highlight"><pre>def &lt;routine name&gt;(&lt;required arguments&gt;[,&lt;optional arguments&gt;]):
     ...
     return &lt;return variables&gt;
</pre></div>
</div>
<p>The signature of a Fortran block data has the following structure:</p>
<div class="highlight-python"><div class="highlight"><pre>block data [ &lt;block data name&gt; ]
  [&lt;variable type declarations&gt;]
  [&lt;variable attribute statements&gt;]
  [&lt;use statements&gt;]
  [&lt;common block statements&gt;]
  [&lt;include statements&gt;]
end [ block data [&lt;block data name&gt;] ]
</pre></div>
</div>
<div class="section" id="type-declarations">
<h3>Type declarations<a class="headerlink" href="#type-declarations" title="Permalink to this headline">¶</a></h3>
<p>The definition of the <tt class="docutils literal"><span class="pre">&lt;argument/variable</span> <span class="pre">type</span> <span class="pre">declaration&gt;</span></tt> part
is</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;typespec&gt; [ [&lt;attrspec&gt;] :: ] &lt;entitydecl&gt;
</pre></div>
</div>
<p>where</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;typespec&gt; := byte | character [&lt;charselector&gt;]
           | complex [&lt;kindselector&gt;] | real [&lt;kindselector&gt;]
           | double complex | double precision
           | integer [&lt;kindselector&gt;] | logical [&lt;kindselector&gt;]

&lt;charselector&gt; := * &lt;charlen&gt;
               | ( [len=] &lt;len&gt; [ , [kind=] &lt;kind&gt;] )
               | ( kind= &lt;kind&gt; [ , len= &lt;len&gt; ] )
&lt;kindselector&gt; := * &lt;intlen&gt; | ( [kind=] &lt;kind&gt; )

&lt;entitydecl&gt; := &lt;name&gt; [ [ * &lt;charlen&gt; ] [ ( &lt;arrayspec&gt; ) ]
                      | [ ( &lt;arrayspec&gt; ) ] * &lt;charlen&gt; ]
                     | [ / &lt;init_expr&gt; / | = &lt;init_expr&gt; ] \
                       [ , &lt;entitydecl&gt; ]
</pre></div>
</div>
<p>and</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">&lt;attrspec&gt;</span></tt> is a comma separated list of <a class="reference internal" href="#attributes">attributes</a>;</li>
<li><tt class="docutils literal"><span class="pre">&lt;arrayspec&gt;</span></tt> is a comma separated list of dimension bounds;</li>
<li><tt class="docutils literal"><span class="pre">&lt;init_expr&gt;</span></tt> is a <a class="reference internal" href="#c-expressions">C expression</a>.</li>
<li><tt class="docutils literal"><span class="pre">&lt;intlen&gt;</span></tt> may be negative integer for <tt class="docutils literal"><span class="pre">integer</span></tt> type
specifications. In such cases <tt class="docutils literal"><span class="pre">integer*&lt;negintlen&gt;</span></tt> represents
unsigned C integers.</li>
</ul>
<p>If an argument has no <tt class="docutils literal"><span class="pre">&lt;argument</span> <span class="pre">type</span> <span class="pre">declaration&gt;</span></tt>, its type is
determined by applying <tt class="docutils literal"><span class="pre">implicit</span></tt> rules to its name.</p>
</div>
<div class="section" id="statements">
<h3>Statements<a class="headerlink" href="#statements" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>Attribute statements:</dt>
<dd>The <tt class="docutils literal"><span class="pre">&lt;argument/variable</span> <span class="pre">attribute</span> <span class="pre">statement&gt;</span></tt> is
<tt class="docutils literal"><span class="pre">&lt;argument/variable</span> <span class="pre">type</span> <span class="pre">declaration&gt;</span></tt> without <tt class="docutils literal"><span class="pre">&lt;typespec&gt;</span></tt>.
In addition, in an attribute statement one cannot use other
attributes, also <tt class="docutils literal"><span class="pre">&lt;entitydecl&gt;</span></tt> can be only a list of names.</dd>
<dt>Use statements:</dt>
<dd><p class="first">The definition of the <tt class="docutils literal"><span class="pre">&lt;use</span> <span class="pre">statement&gt;</span></tt> part is</p>
<div class="highlight-python"><div class="highlight"><pre>use &lt;modulename&gt; [ , &lt;rename_list&gt; | , ONLY : &lt;only_list&gt; ]
</pre></div>
</div>
<p>where</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;rename_list&gt; := &lt;local_name&gt; =&gt; &lt;use_name&gt; [ , &lt;rename_list&gt; ]
</pre></div>
</div>
<p class="last">Currently F2PY uses <tt class="docutils literal"><span class="pre">use</span></tt> statement only for linking call-back
modules and <tt class="docutils literal"><span class="pre">external</span></tt> arguments (call-back functions), see
<a class="reference internal" href="python-usage.html#call-back-arguments"><em>Call-back arguments</em></a>.</p>
</dd>
<dt>Common block statements:</dt>
<dd><p class="first">The definition of the <tt class="docutils literal"><span class="pre">&lt;common</span> <span class="pre">block</span> <span class="pre">statement&gt;</span></tt> part is</p>
<div class="highlight-python"><div class="highlight"><pre>common / &lt;common name&gt; / &lt;shortentitydecl&gt;
</pre></div>
</div>
<p>where</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;shortentitydecl&gt; := &lt;name&gt; [ ( &lt;arrayspec&gt; ) ] [ , &lt;shortentitydecl&gt; ]
</pre></div>
</div>
<p class="last">One <tt class="docutils literal"><span class="pre">python</span> <span class="pre">module</span></tt> block should not contain two or more
<tt class="docutils literal"><span class="pre">common</span></tt> blocks with the same name. Otherwise, the latter ones are
ignored. The types of variables in <tt class="docutils literal"><span class="pre">&lt;shortentitydecl&gt;</span></tt> are defined
using <tt class="docutils literal"><span class="pre">&lt;argument</span> <span class="pre">type</span> <span class="pre">declarations&gt;</span></tt>. Note that the corresponding
<tt class="docutils literal"><span class="pre">&lt;argument</span> <span class="pre">type</span> <span class="pre">declarations&gt;</span></tt> may contain array specifications;
then you don&#8217;t need to specify these in <tt class="docutils literal"><span class="pre">&lt;shortentitydecl&gt;</span></tt>.</p>
</dd>
<dt>Other statements:</dt>
<dd><p class="first">The <tt class="docutils literal"><span class="pre">&lt;other</span> <span class="pre">statement&gt;</span></tt> part refers to any other Fortran language
constructs that are not described above. F2PY ignores most of them
except</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">call</span></tt> statements and function calls of <tt class="docutils literal"><span class="pre">external</span></tt> arguments
(<a class="reference internal" href="#external">more details</a>?);</p>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">include</span></tt> statements</dt>
<dd><div class="first highlight-python"><div class="highlight"><pre>include &#39;&lt;filename&gt;&#39;
include &quot;&lt;filename&gt;&quot;
</pre></div>
</div>
<p class="last">If a file <tt class="docutils literal"><span class="pre">&lt;filename&gt;</span></tt> does not exist, the <tt class="docutils literal"><span class="pre">include</span></tt>
statement is ignored. Otherwise, the file <tt class="docutils literal"><span class="pre">&lt;filename&gt;</span></tt> is
included to a signature file.  <tt class="docutils literal"><span class="pre">include</span></tt> statements can be used
in any part of a signature file, also outside the Fortran/C
routine signature blocks.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">implicit</span></tt> statements</dt>
<dd><div class="first highlight-python"><div class="highlight"><pre>implicit none
implicit &lt;list of implicit maps&gt;
</pre></div>
</div>
<p>where</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;implicit map&gt; := &lt;typespec&gt; ( &lt;list of letters or range of letters&gt; )
</pre></div>
</div>
<p>Implicit rules are used to determine the type specification of
a variable (from the first-letter of its name) if the variable
is not defined using <tt class="docutils literal"><span class="pre">&lt;variable</span> <span class="pre">type</span> <span class="pre">declaration&gt;</span></tt>.  Default
implicit rule is given by</p>
<div class="last highlight-python"><div class="highlight"><pre>implicit real (a-h,o-z,$_), integer (i-m)
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">entry</span></tt> statements</dt>
<dd><div class="first highlight-python"><div class="highlight"><pre>entry &lt;entry name&gt; [([&lt;arguments&gt;])]
</pre></div>
</div>
<p>F2PY generates wrappers to all entry names using the signature
of the routine block.</p>
<p class="last">Tip: <tt class="docutils literal"><span class="pre">entry</span></tt> statement can be used to describe the signature
of an arbitrary routine allowing F2PY to generate a number of
wrappers from only one routine block signature. There are few
restrictions while doing this: <tt class="docutils literal"><span class="pre">fortranname</span></tt> cannot be used,
<tt class="docutils literal"><span class="pre">callstatement</span></tt> and <tt class="docutils literal"><span class="pre">callprotoargument</span></tt> can be used only if
they are valid for all entry routines, etc.</p>
</dd>
</dl>
</li>
</ul>
<p>In addition, F2PY introduces the following statements:</p>
<ul class="last">
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">threadsafe</span></tt></dt>
<dd><p class="first last">Use <tt class="docutils literal"><span class="pre">Py_BEGIN_ALLOW_THREADS</span> <span class="pre">..</span> <span class="pre">Py_END_ALLOW_THREADS</span></tt> block
around the call to Fortran/C function.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">callstatement</span> <span class="pre">&lt;C-expr|multi-line</span> <span class="pre">block&gt;</span></tt></dt>
<dd><p class="first last">Replace F2PY generated call statement to Fortran/C function with
<tt class="docutils literal"><span class="pre">&lt;C-expr|multi-line</span> <span class="pre">block&gt;</span></tt>. The wrapped Fortran/C function
is available as <tt class="docutils literal"><span class="pre">(*f2py_func)</span></tt>. To raise an exception, set
<tt class="docutils literal"><span class="pre">f2py_success</span> <span class="pre">=</span> <span class="pre">0</span></tt> in <tt class="docutils literal"><span class="pre">&lt;C-expr|multi-line</span> <span class="pre">block&gt;</span></tt>.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">callprotoargument</span> <span class="pre">&lt;C-typespecs&gt;</span></tt></dt>
<dd><p class="first">When <tt class="docutils literal"><span class="pre">callstatement</span></tt> statement is used then F2PY may not
generate proper prototypes for Fortran/C functions (because
<tt class="docutils literal"><span class="pre">&lt;C-expr&gt;</span></tt> may contain any function calls and F2PY has no way
to determine what should be the proper prototype). With this
statement you can explicitly specify the arguments of the
corresponding prototype:</p>
<div class="last highlight-python"><div class="highlight"><pre>extern &lt;return type&gt; FUNC_F(&lt;routine name&gt;,&lt;ROUTINE NAME&gt;)(&lt;callprotoargument&gt;);
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">fortranname</span> <span class="pre">[&lt;actual</span> <span class="pre">Fortran/C</span> <span class="pre">routine</span> <span class="pre">name&gt;]</span></tt></dt>
<dd><p class="first">You can use arbitrary <tt class="docutils literal"><span class="pre">&lt;routine</span> <span class="pre">name&gt;</span></tt> for a given Fortran/C
function. Then you have to specify
<tt class="docutils literal"><span class="pre">&lt;actual</span> <span class="pre">Fortran/C</span> <span class="pre">routine</span> <span class="pre">name&gt;</span></tt> with this statement.</p>
<p class="last">If <tt class="docutils literal"><span class="pre">fortranname</span></tt> statement is used without
<tt class="docutils literal"><span class="pre">&lt;actual</span> <span class="pre">Fortran/C</span> <span class="pre">routine</span> <span class="pre">name&gt;</span></tt> then a dummy wrapper is
generated.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">usercode</span> <span class="pre">&lt;multi-line</span> <span class="pre">block&gt;</span></tt></dt>
<dd><p class="first">When used inside <tt class="docutils literal"><span class="pre">python</span> <span class="pre">module</span></tt> block, then given C code
will be inserted to generated C/API source just before
wrapper function definitions. Here you can define arbitrary
C functions to be used in initialization of optional arguments,
for example. If <tt class="docutils literal"><span class="pre">usercode</span></tt> is used twice inside <tt class="docutils literal"><span class="pre">python</span>
<span class="pre">module</span></tt> block then the second multiline block is inserted
after the definition of external routines.</p>
<p>When used inside <tt class="docutils literal"><span class="pre">&lt;routine</span> <span class="pre">singature&gt;</span></tt>, then given C code will
be inserted to the corresponding wrapper function just after
declaring variables but before any C statements. So, <tt class="docutils literal"><span class="pre">usercode</span></tt>
follow-up can contain both declarations and C statements.</p>
<p class="last">When used inside the first <tt class="docutils literal"><span class="pre">interface</span></tt> block, then given C
code will be inserted at the end of the initialization
function of the extension module. Here you can modify extension
modules dictionary. For example, for defining additional
variables etc.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">pymethoddef</span> <span class="pre">&lt;multiline</span> <span class="pre">block&gt;</span></tt></dt>
<dd><p class="first last">Multiline block will be inserted to the definition of
module methods <tt class="docutils literal"><span class="pre">PyMethodDef</span></tt>-array. It must be a
comma-separated list of C arrays (see <a class="reference external" href="http://www.python.org/doc/current/ext/ext.html">Extending and Embedding</a>
Python documentation for details).
<tt class="docutils literal"><span class="pre">pymethoddef</span></tt> statement can be used only inside
<tt class="docutils literal"><span class="pre">python</span> <span class="pre">module</span></tt> block.</p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="attributes">
<h3>Attributes<a class="headerlink" href="#attributes" title="Permalink to this headline">¶</a></h3>
<p>The following attributes are used by F2PY:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">optional</span></tt></dt>
<dd><p class="first">The corresponding argument is moved to the end of <tt class="docutils literal"><span class="pre">&lt;optional</span>
<span class="pre">arguments&gt;</span></tt> list. A default value for an optional argument can be
specified <tt class="docutils literal"><span class="pre">&lt;init_expr&gt;</span></tt>, see <tt class="docutils literal"><span class="pre">entitydecl</span></tt> definition. Note that
the default value must be given as a valid C expression.</p>
<p>Note that whenever <tt class="docutils literal"><span class="pre">&lt;init_expr&gt;</span></tt> is used, <tt class="docutils literal"><span class="pre">optional</span></tt> attribute
is set automatically by F2PY.</p>
<p class="last">For an optional array argument, all its dimensions must be bounded.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">required</span></tt></dt>
<dd><p class="first">The corresponding argument is considered as a required one. This is
default. You need to specify <tt class="docutils literal"><span class="pre">required</span></tt> only if there is a need to
disable automatic <tt class="docutils literal"><span class="pre">optional</span></tt> setting when <tt class="docutils literal"><span class="pre">&lt;init_expr&gt;</span></tt> is used.</p>
<p class="last">If Python <tt class="docutils literal"><span class="pre">None</span></tt> object is used as an required argument, the
argument is treated as optional. That is, in the case of array
argument, the memory is allocated. And if <tt class="docutils literal"><span class="pre">&lt;init_expr&gt;</span></tt> is given,
the corresponding initialization is carried out.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">dimension(&lt;arrayspec&gt;)</span></tt></dt>
<dd>The corresponding variable is considered as an array with given
dimensions in <tt class="docutils literal"><span class="pre">&lt;arrayspec&gt;</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">intent(&lt;intentspec&gt;)</span></tt></dt>
<dd><p class="first">This specifies the &#8220;intention&#8221; of the corresponding
argument. <tt class="docutils literal"><span class="pre">&lt;intentspec&gt;</span></tt> is a comma separated list of the
following keys:</p>
<ul>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">in</span></tt></dt>
<dd><p class="first last">The argument is considered as an input-only argument. It means
that the value of the argument is passed to Fortran/C function and
that function is expected not to change the value of an argument.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">inout</span></tt></dt>
<dd><p class="first">The argument is considered as an input/output or <em>in situ</em>
output argument. <tt class="docutils literal"><span class="pre">intent(inout)</span></tt> arguments can be only
&#8220;contiguous&#8221; Numpy arrays with proper type and size.  Here
&#8220;contiguous&#8221; can be either in Fortran or C sense. The latter one
coincides with the contiguous concept used in Numpy and is
effective only if <tt class="docutils literal"><span class="pre">intent(c)</span></tt> is used. Fortran contiguity
is assumed by default.</p>
<p class="last">Using <tt class="docutils literal"><span class="pre">intent(inout)</span></tt> is generally not recommended, use
<tt class="docutils literal"><span class="pre">intent(in,out)</span></tt> instead. See also <tt class="docutils literal"><span class="pre">intent(inplace)</span></tt> attribute.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">inplace</span></tt></dt>
<dd><p class="first">The argument is considered as an input/output or <em>in situ</em>
output argument. <tt class="docutils literal"><span class="pre">intent(inplace)</span></tt> arguments must be
Numpy arrays with proper size. If the type of an array is
not &#8220;proper&#8221; or the array is non-contiguous then the array
will be changed in-place to fix the type and make it contiguous.</p>
<p class="last">Using <tt class="docutils literal"><span class="pre">intent(inplace)</span></tt> is generally not recommended either.
For example, when slices have been taken from an
<tt class="docutils literal"><span class="pre">intent(inplace)</span></tt> argument then after in-place changes,
slices data pointers may point to unallocated memory area.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">out</span></tt></dt>
<dd><p class="first">The argument is considered as an return variable. It is appended
to the <tt class="docutils literal"><span class="pre">&lt;returned</span> <span class="pre">variables&gt;</span></tt> list. Using <tt class="docutils literal"><span class="pre">intent(out)</span></tt>
sets <tt class="docutils literal"><span class="pre">intent(hide)</span></tt> automatically, unless also
<tt class="docutils literal"><span class="pre">intent(in)</span></tt> or <tt class="docutils literal"><span class="pre">intent(inout)</span></tt> were used.</p>
<p class="last">By default, returned multidimensional arrays are
Fortran-contiguous. If <tt class="docutils literal"><span class="pre">intent(c)</span></tt> is used, then returned
multidimensional arrays are C-contiguous.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">hide</span></tt></dt>
<dd><p class="first">The argument is removed from the list of required or optional
arguments. Typically <tt class="docutils literal"><span class="pre">intent(hide)</span></tt> is used with <tt class="docutils literal"><span class="pre">intent(out)</span></tt>
or when <tt class="docutils literal"><span class="pre">&lt;init_expr&gt;</span></tt> completely determines the value of the
argument like in the following example:</p>
<div class="last highlight-python"><div class="highlight"><pre>integer intent(hide),depend(a) :: n = len(a)
real intent(in),dimension(n) :: a
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">c</span></tt></dt>
<dd><p class="first">The argument is treated as a C scalar or C array argument.  In
the case of a scalar argument, its value is passed to C function
as a C scalar argument (recall that Fortran scalar arguments are
actually C pointer arguments).  In the case of an array
argument, the wrapper function is assumed to treat
multidimensional arrays as C-contiguous arrays.</p>
<p>There is no need to use <tt class="docutils literal"><span class="pre">intent(c)</span></tt> for one-dimensional
arrays, no matter if the wrapped function is either a Fortran or
a C function. This is because the concepts of Fortran- and
C contiguity overlap in one-dimensional cases.</p>
<p>If <tt class="docutils literal"><span class="pre">intent(c)</span></tt> is used as an statement but without entity
declaration list, then F2PY adds <tt class="docutils literal"><span class="pre">intent(c)</span></tt> attibute to all
arguments.</p>
<p class="last">Also, when wrapping C functions, one must use <tt class="docutils literal"><span class="pre">intent(c)</span></tt>
attribute for <tt class="docutils literal"><span class="pre">&lt;routine</span> <span class="pre">name&gt;</span></tt> in order to disable Fortran
specific <tt class="docutils literal"><span class="pre">F_FUNC(..,..)</span></tt> macros.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">cache</span></tt></dt>
<dd><p class="first last">The argument is treated as a junk of memory. No Fortran nor C
contiguity checks are carried out. Using <tt class="docutils literal"><span class="pre">intent(cache)</span></tt>
makes sense only for array arguments, also in connection with
<tt class="docutils literal"><span class="pre">intent(hide)</span></tt> or <tt class="docutils literal"><span class="pre">optional</span></tt> attributes.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">copy</span></tt></dt>
<dd><p class="first last">Ensure that the original contents of <tt class="docutils literal"><span class="pre">intent(in)</span></tt> argument is
preserved. Typically used in connection with <tt class="docutils literal"><span class="pre">intent(in,out)</span></tt>
attribute.  F2PY creates an optional argument
<tt class="docutils literal"><span class="pre">overwrite_&lt;argument</span> <span class="pre">name&gt;</span></tt> with the default value <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">overwrite</span></tt></dt>
<dd><p class="first last">The original contents of the <tt class="docutils literal"><span class="pre">intent(in)</span></tt> argument may be
altered by the Fortran/C function.  F2PY creates an optional
argument <tt class="docutils literal"><span class="pre">overwrite_&lt;argument</span> <span class="pre">name&gt;</span></tt> with the default value
<tt class="docutils literal"><span class="pre">1</span></tt>.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">out=&lt;new</span> <span class="pre">name&gt;</span></tt></dt>
<dd><p class="first last">Replace the return name with <tt class="docutils literal"><span class="pre">&lt;new</span> <span class="pre">name&gt;</span></tt> in the <tt class="docutils literal"><span class="pre">__doc__</span></tt>
string of a wrapper function.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">callback</span></tt></dt>
<dd><p class="first">Construct an external function suitable for calling Python function
from Fortran. <tt class="docutils literal"><span class="pre">intent(callback)</span></tt> must be specified before the
corresponding <tt class="docutils literal"><span class="pre">external</span></tt> statement. If &#8216;argument&#8217; is not in
argument list then it will be added to Python wrapper but only
initializing external function.</p>
<p>Use <tt class="docutils literal"><span class="pre">intent(callback)</span></tt> in situations where a Fortran/C code
assumes that a user implements a function with given prototype
and links it to an executable. Don&#8217;t use <tt class="docutils literal"><span class="pre">intent(callback)</span></tt>
if function appears in the argument list of a Fortran routine.</p>
<p class="last">With <tt class="docutils literal"><span class="pre">intent(hide)</span></tt> or <tt class="docutils literal"><span class="pre">optional</span></tt> attributes specified and
using a wrapper function without specifying the callback argument
in argument list then call-back function is looked in the
namespace of F2PY generated extension module where it can be
set as a module attribute by a user.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">aux</span></tt></dt>
<dd><p class="first last">Define auxiliary C variable in F2PY generated wrapper function.
Useful to save parameter values so that they can be accessed
in initialization expression of other variables. Note that
<tt class="docutils literal"><span class="pre">intent(aux)</span></tt> silently implies <tt class="docutils literal"><span class="pre">intent(c)</span></tt>.</p>
</dd>
</dl>
</li>
</ul>
<p>The following rules apply:</p>
<ul class="last simple">
<li>If no <tt class="docutils literal"><span class="pre">intent(in</span> <span class="pre">|</span> <span class="pre">inout</span> <span class="pre">|</span> <span class="pre">out</span> <span class="pre">|</span> <span class="pre">hide)</span></tt> is specified,
<tt class="docutils literal"><span class="pre">intent(in)</span></tt> is assumed.</li>
<li><tt class="docutils literal"><span class="pre">intent(in,inout)</span></tt> is <tt class="docutils literal"><span class="pre">intent(in)</span></tt>.</li>
<li><tt class="docutils literal"><span class="pre">intent(in,hide)</span></tt> or <tt class="docutils literal"><span class="pre">intent(inout,hide)</span></tt> is
<tt class="docutils literal"><span class="pre">intent(hide)</span></tt>.</li>
<li><tt class="docutils literal"><span class="pre">intent(out)</span></tt> is <tt class="docutils literal"><span class="pre">intent(out,hide)</span></tt> unless <tt class="docutils literal"><span class="pre">intent(in)</span></tt> or
<tt class="docutils literal"><span class="pre">intent(inout)</span></tt> is specified.</li>
<li>If <tt class="docutils literal"><span class="pre">intent(copy)</span></tt> or <tt class="docutils literal"><span class="pre">intent(overwrite)</span></tt> is used, then an
additional optional argument is introduced with a name
<tt class="docutils literal"><span class="pre">overwrite_&lt;argument</span> <span class="pre">name&gt;</span></tt> and a default value 0 or 1, respectively.</li>
<li><tt class="docutils literal"><span class="pre">intent(inout,inplace)</span></tt> is <tt class="docutils literal"><span class="pre">intent(inplace)</span></tt>.</li>
<li><tt class="docutils literal"><span class="pre">intent(in,inplace)</span></tt> is <tt class="docutils literal"><span class="pre">intent(inplace)</span></tt>.</li>
<li><tt class="docutils literal"><span class="pre">intent(hide)</span></tt> disables <tt class="docutils literal"><span class="pre">optional</span></tt> and <tt class="docutils literal"><span class="pre">required</span></tt>.</li>
</ul>
</dd>
<dt><tt class="docutils literal"><span class="pre">check([&lt;C-booleanexpr&gt;])</span></tt></dt>
<dd><p class="first">Perform consistency check of arguments by evaluating
<tt class="docutils literal"><span class="pre">&lt;C-booleanexpr&gt;</span></tt>; if <tt class="docutils literal"><span class="pre">&lt;C-booleanexpr&gt;</span></tt> returns 0, an exception
is raised.</p>
<p class="last">If <tt class="docutils literal"><span class="pre">check(..)</span></tt> is not used then F2PY generates few standard checks
(e.g. in a case of an array argument, check for the proper shape
and size) automatically. Use <tt class="docutils literal"><span class="pre">check()</span></tt> to disable checks generated
by F2PY.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">depend([&lt;names&gt;])</span></tt></dt>
<dd><p class="first">This declares that the corresponding argument depends on the values
of variables in the list <tt class="docutils literal"><span class="pre">&lt;names&gt;</span></tt>. For example, <tt class="docutils literal"><span class="pre">&lt;init_expr&gt;</span></tt>
may use the values of other arguments.  Using information given by
<tt class="docutils literal"><span class="pre">depend(..)</span></tt> attributes, F2PY ensures that arguments are
initialized in a proper order. If <tt class="docutils literal"><span class="pre">depend(..)</span></tt> attribute is not
used then F2PY determines dependence relations automatically. Use
<tt class="docutils literal"><span class="pre">depend()</span></tt> to disable dependence relations generated by F2PY.</p>
<p class="last">When you edit dependence relations that were initially generated by
F2PY, be careful not to break the dependence relations of other
relevant variables. Another thing to watch out is cyclic
dependencies. F2PY is able to detect cyclic dependencies
when constructing wrappers and it complains if any are found.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">allocatable</span></tt></dt>
<dd>The corresponding variable is Fortran 90 allocatable array defined
as Fortran 90 module data.</dd>
</dl>
<dl class="docutils" id="external">
<dt><tt class="docutils literal"><span class="pre">external</span></tt></dt>
<dd><p class="first">The corresponding argument is a function provided by user. The
signature of this so-called call-back function can be defined</p>
<ul class="simple">
<li>in <tt class="docutils literal"><span class="pre">__user__</span></tt> module block,</li>
<li>or by demonstrative (or real, if the signature file is a real Fortran
code) call in the <tt class="docutils literal"><span class="pre">&lt;other</span> <span class="pre">statements&gt;</span></tt> block.</li>
</ul>
<p>For example, F2PY generates from</p>
<div class="highlight-python"><div class="highlight"><pre>external cb_sub, cb_fun
integer n
real a(n),r
call cb_sub(a,n)
r = cb_fun(4)
</pre></div>
</div>
<p>the following call-back signatures:</p>
<div class="highlight-python"><div class="highlight"><pre>subroutine cb_sub(a,n)
    real dimension(n) :: a
    integer optional,check(len(a)&gt;=n),depend(a) :: n=len(a)
end subroutine cb_sub
function cb_fun(e_4_e) result (r)
    integer :: e_4_e
    real :: r
end function cb_fun
</pre></div>
</div>
<p>The corresponding user-provided Python function are then:</p>
<div class="highlight-python"><div class="highlight"><pre>def cb_sub(a,[n]):
    ...
    return
def cb_fun(e_4_e):
    ...
    return r
</pre></div>
</div>
<p class="last">See also <tt class="docutils literal"><span class="pre">intent(callback)</span></tt> attribute.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">parameter</span></tt></dt>
<dd>The corresponding variable is a parameter and it must have a fixed
value. F2PY replaces all parameter occurrences by their
corresponding values.</dd>
</dl>
</div>
</div>
<div class="section" id="extensions">
<h2>Extensions<a class="headerlink" href="#extensions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="f2py-directives">
<h3>F2PY directives<a class="headerlink" href="#f2py-directives" title="Permalink to this headline">¶</a></h3>
<p>The so-called F2PY directives allow using F2PY signature file
constructs also in Fortran 77/90 source codes. With this feature you
can skip (almost) completely intermediate signature file generations
and apply F2PY directly to Fortran source codes.</p>
<p>F2PY directive has the following form:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;comment char&gt;f2py ...
</pre></div>
</div>
<p>where allowed comment characters for fixed and free format Fortran
codes are <tt class="docutils literal"><span class="pre">cC*!#</span></tt> and <tt class="docutils literal"><span class="pre">!</span></tt>, respectively. Everything that follows
<tt class="docutils literal"><span class="pre">&lt;comment</span> <span class="pre">char&gt;f2py</span></tt> is ignored by a compiler but read by F2PY as a
normal Fortran, non-comment line:</p>
<blockquote>
<div>When F2PY finds a line with F2PY directive, the directive is first
replaced by 5 spaces and then the line is reread.</div></blockquote>
<p>For fixed format Fortran codes, <tt class="docutils literal"><span class="pre">&lt;comment</span> <span class="pre">char&gt;</span></tt> must be at the
first column of a file, of course. For free format Fortran codes,
F2PY directives can appear anywhere in a file.</p>
</div>
<div class="section" id="c-expressions">
<h3>C expressions<a class="headerlink" href="#c-expressions" title="Permalink to this headline">¶</a></h3>
<p>C expressions are used in the following parts of signature files:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">&lt;init_expr&gt;</span></tt> of variable initialization;</li>
<li><tt class="docutils literal"><span class="pre">&lt;C-booleanexpr&gt;</span></tt> of the <tt class="docutils literal"><span class="pre">check</span></tt> attribute;</li>
<li><tt class="docutils literal"><span class="pre">&lt;arrayspec&gt;</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">``dimension</span></tt> attribute;</li>
<li><tt class="docutils literal"><span class="pre">callstatement</span></tt> statement, here also a C multiline block can be used.</li>
</ul>
<p>A C expression may contain:</p>
<ul>
<li><p class="first">standard C constructs;</p>
</li>
<li><p class="first">functions from <tt class="docutils literal"><span class="pre">math.h</span></tt> and <tt class="docutils literal"><span class="pre">Python.h</span></tt>;</p>
</li>
<li><p class="first">variables from the argument list, presumably initialized before
according to given dependence relations;</p>
</li>
<li><p class="first">the following CPP macros:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">rank(&lt;name&gt;)</span></tt></dt>
<dd><p class="first last">Returns the rank of an array <tt class="docutils literal"><span class="pre">&lt;name&gt;</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">shape(&lt;name&gt;,&lt;n&gt;)</span></tt></dt>
<dd><p class="first last">Returns the <tt class="docutils literal"><span class="pre">&lt;n&gt;</span></tt>-th dimension of an array <tt class="docutils literal"><span class="pre">&lt;name&gt;</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">len(&lt;name&gt;)</span></tt></dt>
<dd><p class="first last">Returns the lenght of an array <tt class="docutils literal"><span class="pre">&lt;name&gt;</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">size(&lt;name&gt;)</span></tt></dt>
<dd><p class="first last">Returns the size of an array <tt class="docutils literal"><span class="pre">&lt;name&gt;</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">slen(&lt;name&gt;)</span></tt></dt>
<dd><p class="first last">Returns the length of a string <tt class="docutils literal"><span class="pre">&lt;name&gt;</span></tt>.</p>
</dd>
</dl>
</li>
</ul>
<p>For initializing an array <tt class="docutils literal"><span class="pre">&lt;array</span> <span class="pre">name&gt;</span></tt>, F2PY generates a loop over
all indices and dimensions that executes the following
pseudo-statement:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;array name&gt;(_i[0],_i[1],...) = &lt;init_expr&gt;;
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">_i[&lt;i&gt;]</span></tt> refers to the <tt class="docutils literal"><span class="pre">&lt;i&gt;</span></tt>-th index value and that runs
from <tt class="docutils literal"><span class="pre">0</span></tt> to <tt class="docutils literal"><span class="pre">shape(&lt;array</span> <span class="pre">name&gt;,&lt;i&gt;)-1</span></tt>.</p>
<p>For example, a function <tt class="docutils literal"><span class="pre">myrange(n)</span></tt> generated from the following
signature</p>
<div class="highlight-python"><div class="highlight"><pre>subroutine myrange(a,n)
  fortranname        ! myrange is a dummy wrapper
  integer intent(in) :: n
  real*8 intent(c,out),dimension(n),depend(n) :: a = _i[0]
end subroutine myrange
</pre></div>
</div>
<p>is equivalent to <tt class="docutils literal"><span class="pre">numpy.arange(n,dtype=float)</span></tt>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">F2PY may lower cases also in C expressions when scanning Fortran codes
(see <tt class="docutils literal"><span class="pre">--[no]-lower</span></tt> option).</p>
</div>
</div>
<div class="section" id="multiline-blocks">
<h3>Multiline blocks<a class="headerlink" href="#multiline-blocks" title="Permalink to this headline">¶</a></h3>
<p>A multiline block starts with <tt class="docutils literal"><span class="pre">'''</span></tt> (triple single-quotes) and ends
with <tt class="docutils literal"><span class="pre">'''</span></tt> in some <em>strictly</em> subsequent line.  Multiline blocks can
be used only within .pyf files. The contents of a multiline block can
be arbitrary (except that it cannot contain <tt class="docutils literal"><span class="pre">'''</span></tt>) and no
transformations (e.g. lowering cases) are applied to it.</p>
<p>Currently, multiline blocks can be used in the following constructs:</p>
<ul class="simple">
<li>as a C expression of the <tt class="docutils literal"><span class="pre">callstatement</span></tt> statement;</li>
<li>as a C type specification of the <tt class="docutils literal"><span class="pre">callprotoargument</span></tt> statement;</li>
<li>as a C code block of the <tt class="docutils literal"><span class="pre">usercode</span></tt> statement;</li>
<li>as a list of C arrays of the <tt class="docutils literal"><span class="pre">pymethoddef</span></tt> statement;</li>
<li>as documentation string.</li>
</ul>
</div>
</div>
</div>


          </div>
        </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container container-navbar-bottom">
      <div class="spc-navbar">
        
      </div>
    </div>
    <div class="container">
    <div class="footer">
    <div class="row-fluid">
    <ul class="inline pull-left">
      <li>
        &copy; Copyright 2008-2009, The Scipy community.
      </li>
      <li>
      Last updated on Oct 18, 2015.
      </li>
      <li>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.1.
      </li>
    </ul>
    </div>
    </div>
    </div>
  </body>
</html>