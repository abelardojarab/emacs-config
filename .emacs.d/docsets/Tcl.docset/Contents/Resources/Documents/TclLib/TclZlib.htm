<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD><TITLE>TclZlib manual page - Tcl Library Procedures</TITLE>
<link rel="stylesheet" href="../docs.css" type="text/css" media="all">
</HEAD>
<BODY><H2><a href="../contents.htm">Tcl8.6.0/Tk8.6.0 Documentation</a> <small>&gt;</small> <a href="contents.htm">Tcl C API, version 8.6.0</a> <small>&gt;</small> TclZlib</H2>
<H3><A HREF="../UserCmd/contents.htm">Tcl/Tk Applications</A> | <A HREF="../TclCmd/contents.htm">Tcl Commands</A> | <A HREF="../TkCmd/contents.htm">Tk Commands</A> | <A HREF="../ItclCmd/contents.htm">[incr Tcl] Package Commands</A> | <A HREF="../Sqlite3Cmd/contents.htm">SQLite Package Commands</A> | <A HREF="../TdbcCmd/contents.htm">TDBC Package Commands</A> | <A HREF="../TdbcmysqlCmd/contents.htm">tdbc::mysql Package Commands</A> | <A HREF="../TdbcodbcCmd/contents.htm">tdbc::odbc Package Commands</A> | <A HREF="../TdbcpostgresCmd/contents.htm">tdbc::postgres Package Commands</A> | <A HREF="../Tdbcsqlite3Cmd/contents.htm">tdbc::sqlite3 Package Commands</A> | <A HREF="../ThreadCmd/contents.htm">Thread Package Commands</A> | <A HREF="../TclLib/contents.htm">Tcl C API</A> | <A HREF="../TkLib/contents.htm">Tk C API</A> | <A HREF="../ItclLib/contents.htm">[incr Tcl] Package C API</A> | <A HREF="../TdbcLib/contents.htm">TDBC Package C API</A></H3>
<DL>
<DD><A HREF="TclZlib.htm#M2" NAME="L798">NAME</A>
<DL><DD>Tcl_ZlibAdler32, Tcl_ZlibCRC32, Tcl_ZlibDeflate, Tcl_ZlibInflate, Tcl_ZlibStreamChecksum, Tcl_ZlibStreamClose, Tcl_ZlibStreamEof, Tcl_ZlibStreamGet, Tcl_ZlibStreamGetCommandName, Tcl_ZlibStreamInit, Tcl_ZlibStreamPut &mdash; compression and decompression functions</DD></DL>
<DD><A HREF="TclZlib.htm#M3" NAME="L799">SYNOPSIS</A>
<DL>
<DD>#include &lt;tcl.h&gt;
<DD>int
<DD><B>Tcl_ZlibDeflate</B>(<I>interp, format, dataObj, level, dictObj</I>)
<DD>int
<DD><B>Tcl_ZlibInflate</B>(<I>interp, format, dataObj, dictObj</I>)
<DD>unsigned int
<DD><B>Tcl_ZlibCRC32</B>(<I>initValue, bytes, length</I>)
<DD>unsigned int
<DD><B>Tcl_ZlibAdler32</B>(<I>initValue, bytes, length</I>)
<DD>int
<DD><B>Tcl_ZlibStreamInit</B>(<I>interp, mode, format, level, dictObj, zshandlePtr</I>)
<DD>Tcl_Obj *
<DD><B>Tcl_ZlibStreamGetCommandName</B>(<I>zshandle</I>)
<DD>int
<DD><B>Tcl_ZlibStreamEof</B>(<I>zshandle</I>)
<DD>int
<DD><B>Tcl_ZlibStreamClose</B>(<I>zshandle</I>)
<DD>int
<DD><B>Tcl_ZlibStreamReset</B>(<I>zshandle</I>)
<DD>int
<DD><B>Tcl_ZlibStreamChecksum</B>(<I>zshandle</I>)
<DD>int
<DD><B>Tcl_ZlibStreamPut</B>(<I>zshandle, dataObj, flush</I>)
<DD>int
<DD><B>Tcl_ZlibStreamGet</B>(<I>zshandle, dataObj, count</I>)
<DD><B>Tcl_ZlibStreamSetCompressionDictionary</B>(<I>zshandle, compDict</I>)
</DL>
<DD><A HREF="TclZlib.htm#M4" NAME="L800">ARGUMENTS</A>
<DL class="arguments">
</DL>
<DD><A HREF="TclZlib.htm#M5" NAME="L801">DESCRIPTION</A>
<DD><A HREF="TclZlib.htm#M6" NAME="L802">ZLIB STREAMS</A>
<DD><A HREF="TclZlib.htm#M7" NAME="L803">GZIP OPTIONS DICTIONARY</A>
<DL class="gzip options dictionary">
<DD><A HREF="TclZlib.htm#M8" NAME="L804"><B>comment</B></A>
<DD><A HREF="TclZlib.htm#M9" NAME="L805"><B>crc</B></A>
<DD><A HREF="TclZlib.htm#M10" NAME="L806"><B>filename</B></A>
<DD><A HREF="TclZlib.htm#M11" NAME="L807"><B>os</B></A>
<DD><A HREF="TclZlib.htm#M12" NAME="L808"><B>size</B></A>
<DD><A HREF="TclZlib.htm#M13" NAME="L809"><B>time</B></A>
<DD><A HREF="TclZlib.htm#M14" NAME="L810"><B>type</B></A>
</DL>
<DD><A HREF="TclZlib.htm#M15" NAME="L811">PORTABILITY NOTES</A>
<DD><A HREF="TclZlib.htm#M16" NAME="L812">SEE ALSO</A>
<DD><A HREF="TclZlib.htm#M17" NAME="L813">KEYWORDS</A>
</DL>
<H3><A NAME="M2">NAME</A></H3>
Tcl_ZlibAdler32, Tcl_ZlibCRC32, Tcl_ZlibDeflate, Tcl_ZlibInflate, Tcl_ZlibStreamChecksum, Tcl_ZlibStreamClose, Tcl_ZlibStreamEof, Tcl_ZlibStreamGet, Tcl_ZlibStreamGetCommandName, Tcl_ZlibStreamInit, Tcl_ZlibStreamPut &mdash; compression and decompression functions
<H3><A NAME="M3">SYNOPSIS</A></H3>
#include &lt;tcl.h&gt;<BR>
int<BR>
<B>Tcl_ZlibDeflate</B>(<I>interp, format, dataObj, level, dictObj</I>)<BR>
int<BR>
<B>Tcl_ZlibInflate</B>(<I>interp, format, dataObj, dictObj</I>)<BR>
unsigned int<BR>
<B>Tcl_ZlibCRC32</B>(<I>initValue, bytes, length</I>)<BR>
unsigned int<BR>
<B>Tcl_ZlibAdler32</B>(<I>initValue, bytes, length</I>)<BR>
int<BR>
<B>Tcl_ZlibStreamInit</B>(<I>interp, mode, format, level, dictObj, zshandlePtr</I>)<BR>
<A HREF="../TclLib/Object.htm">Tcl_Obj</A> *<BR>
<B>Tcl_ZlibStreamGetCommandName</B>(<I>zshandle</I>)<BR>
int<BR>
<B>Tcl_ZlibStreamEof</B>(<I>zshandle</I>)<BR>
int<BR>
<B>Tcl_ZlibStreamClose</B>(<I>zshandle</I>)<BR>
int<BR>
<B>Tcl_ZlibStreamReset</B>(<I>zshandle</I>)<BR>
int<BR>
<B>Tcl_ZlibStreamChecksum</B>(<I>zshandle</I>)<BR>
int<BR>
<B>Tcl_ZlibStreamPut</B>(<I>zshandle, dataObj, flush</I>)<BR>
int<BR>
<B>Tcl_ZlibStreamGet</B>(<I>zshandle, dataObj, count</I>)<BR>
<B>Tcl_ZlibStreamSetCompressionDictionary</B>(<I>zshandle, compDict</I>)<BR>
<H3><A NAME="M4">ARGUMENTS</A></H3>
<DL class="arguments">
<DT><A HREF="../TclLib/Interp.htm">Tcl_Interp</A> <B>*interp</B> (in)<DD>
The interpreter to store resulting compressed or uncompressed data in. Also
where any error messages are written. For <B>Tcl_ZlibStreamInit</B>, this can
be NULL to create a stream that is not bound to a command.
<P><DT>int <B><A HREF="../TclCmd/format.htm">format</A></B> (in)<DD>
What format of compressed data to work with. Must be one of
<B>TCL_ZLIB_FORMAT_ZLIB</B> for zlib-format data, <B>TCL_ZLIB_FORMAT_GZIP</B>
for gzip-format data, or <B>TCL_ZLIB_FORMAT_RAW</B> for raw compressed data. In
addition, for decompression only, <B>TCL_ZLIB_FORMAT_AUTO</B> may also be
chosen which can automatically detect whether the compressed data was in zlib
or gzip format.
<P><DT><A HREF="../TclLib/Object.htm">Tcl_Obj</A> <B>*dataObj</B> (in/out)<DD>
A byte-array value containing the data to be compressed or decompressed, or
to which the data extracted from the stream is appended when passed to
<B>Tcl_ZlibStreamGet</B>.
<P><DT>int <B>level</B> (in)<DD>
What level of compression to use. Should be a number from 0 to 9 or one of the
following: <B>TCL_ZLIB_COMPRESS_NONE</B> for no compression,
<B>TCL_ZLIB_COMPRESS_FAST</B> for fast but inefficient compression,
<B>TCL_ZLIB_COMPRESS_BEST</B> for slow but maximal compression, or
<B>TCL_ZLIB_COMPRESS_DEFAULT</B> for the level recommended by the zlib library.
<P><DT><A HREF="../TclLib/Object.htm">Tcl_Obj</A> <B>*dictObj</B> (in/out)<DD>
A dictionary that contains, or which will be updated to contain, a description
of the gzip header associated with the compressed data. Only useful when the
<I>format</I> is <B>TCL_ZLIB_FORMAT_GZIP</B> or <B>TCL_ZLIB_FORMAT_AUTO</B>. If
a NULL is passed, a default header will be used on compression and the header
will be ignored (apart from integrity checks) on decompression. See the
section <B><A HREF="#M7">GZIP OPTIONS DICTIONARY</A></B> for details about the contents of this
dictionary.
<P><DT>unsigned int <B>initValue</B> (in)<DD>
The initial value for the checksum algorithm.
<P><DT>unsigned char <B>*bytes</B> (in)<DD>
An array of bytes to run the checksum algorithm over, or NULL to get the
recommended initial value for the checksum algorithm.
<P><DT>int <B>length</B> (in)<DD>
The number of bytes in the array.
<P><DT>int <B>mode</B> (in)<DD>
What mode to operate the stream in. Should be either
<B>TCL_ZLIB_STREAM_DEFLATE</B> for a compressing stream or
<B>TCL_ZLIB_STREAM_INFLATE</B> for a decompressing stream.
<P><DT>Tcl_ZlibStream <B>*zshandlePtr</B> (out)<DD>
A pointer to a variable in which to write the abstract token for the stream
upon successful creation.
<P><DT>Tcl_ZlibStream <B>zshandle</B> (in)<DD>
The abstract token for the stream to operate on.
<P><DT>int <B>flush</B> (in)<DD>
Whether and how to flush the stream after writing the data to it. Must be one
of: <B>TCL_ZLIB_NO_FLUSH</B> if no flushing is to be done, <B>TCL_ZLIB_FLUSH</B>
if the currently compressed data must be made available for access using
<B>Tcl_ZlibStreamGet</B>, <B>TCL_ZLIB_FULLFLUSH</B> if the stream must be put
into a state where the decompressor can recover from on corruption, or
<B>TCL_ZLIB_FINALIZE</B> to ensure that the stream is finished and that any
trailer demanded by the format is written.
<P><DT>int <B>count</B> (in)<DD>
The maximum number of bytes to get from the stream, or -1 to get all remaining
bytes from the stream's buffers.
<P><DT><A HREF="../TclLib/Object.htm">Tcl_Obj</A> <B>*compDict</B> (in)<DD>
A byte array value that is the compression dictionary to use with the stream.
Note that this is <I>not a Tcl dictionary</I>, and it is recommended that this
only ever be used with streams that were created with their <I>format</I> set
to <B>TCL_ZLIB_FORMAT_ZLIB</B> because the other formats have no mechanism to
indicate whether a compression dictionary was present other than to fail on
decompression.
<P></DL>
<H3><A NAME="M5">DESCRIPTION</A></H3>
These functions form the interface from the Tcl library to the Zlib
library by Jean-loup Gailly and Mark Adler.
<P>
<B>Tcl_ZlibDeflate</B> and <B>Tcl_ZlibInflate</B> respectively compress and
decompress the data contained in the <I>dataObj</I> argument, according to the
<I>format</I> and, for compression, <I>level</I> arguments. The dictionary in
the <I>dictObj</I> parameter is used to convey additional header information
about the compressed data when the compression format supports it; currently,
the dictionary is only used when the <I>format</I> parameter is
<B>TCL_ZLIB_FORMAT_GZIP</B> or <B>TCL_ZLIB_FORMAT_AUTO</B>. For details of the
contents of the dictionary, see the <B><A HREF="#M7">GZIP OPTIONS DICTIONARY</A></B> section
below. Upon success, both functions leave the resulting compressed or
decompressed data in a byte-array value that is the Tcl interpreter's result;
the returned value is a standard Tcl result code.
<P>
<B>Tcl_ZlibAdler32</B> and <B>Tcl_ZlibCRC32</B> compute checksums on arrays of
bytes, returning the computed checksum. Checksums are computed incrementally,
allowing data to be processed one block at a time, but this requires the
caller to maintain the current checksum and pass it in as the <I>initValue</I>
parameter; the initial value to use for this can be obtained by using NULL for
the <I>bytes</I> parameter instead of a pointer to the array of bytes to
compute the checksum over. Thus, typical usage in the single data block case
is like this:
<P>
<PRE>checksum = <B>Tcl_ZlibCRC32</B>(<B>Tcl_ZlibCRC32</B>(0,NULL,0), data, length);</PRE>
<P>
Note that the Adler-32 algorithm is not a real checksum, but instead is a
related type of hash that works best on longer data.
<H4><A NAME="M6">ZLIB STREAMS</A></H4>
<B>Tcl_ZlibStreamInit</B> creates a compressing or decompressing stream that is
linked to a Tcl command, according to its arguments, and provides an abstract
token for the stream and returns a normal Tcl result code;
<B>Tcl_ZlibStreamGetCommandName</B> returns the name of that command given the
stream token, or NULL if the stream has no command. Streams are not designed
to be thread-safe; each stream should only ever be used from the thread that
created it. When working with gzip streams, a dictionary (fields as given in
the <B><A HREF="#M7">GZIP OPTIONS DICTIONARY</A></B> section below) can be given via the
<I>dictObj</I> parameter that on compression allows control over the generated
headers, and on decompression allows discovery of the existing headers. Note
that the dictionary will be written to on decompression once sufficient data
has been read to have a complete header. This means that the dictionary must
be an unshared value in that case; a blank value created with
<B><A HREF="../TclLib/Object.htm">Tcl_NewObj</A></B> is suggested.
<P>
Once a stream has been constructed, <B>Tcl_ZlibStreamPut</B> is used to add
data to the stream and <B>Tcl_ZlibStreamGet</B> is used to retrieve data from
the stream after processing. Both return normal Tcl result codes and leave an
error message in the result of the interpreter that the stream is registered
with in the error case (if such a registration has been performed). With
<B>Tcl_ZlibStreamPut</B>, the data buffer value passed to it should not be
modified afterwards. With <B>Tcl_ZlibStreamGet</B>, the data buffer value
passed to it will have the data bytes appended to it. Internally to the
stream, data is kept compressed so as to minimize the cost of buffer space.
<P>
<B>Tcl_ZlibStreamChecksum</B> returns the checksum computed over the
uncompressed data according to the format, and <B>Tcl_ZlibStreamEof</B> returns
a boolean value indicating whether the end of the uncompressed data has been
reached.
<P>
<B>Tcl_ZlibStreamSetCompressionDictionary</B> is used to control the
compression dictionary used with the stream, a compression dictionary being an
array of bytes (such as might be created with <B><A HREF="../TclLib/ByteArrObj.htm">Tcl_NewByteArrayObj</A></B>) that
is used to initialize the compression engine rather than leaving it to create
it on the fly from the data being compressed. Setting a compression dictionary
allows for more efficient compression in the case where the start of the data
is highly regular, but it does require both the compressor and the
decompressor to agreee on the value to use. Compression dictionaries are only
fully supported for zlib-format data; on compression, they must be set before
any data is sent in with <B>Tcl_ZlibStreamPut</B>, and on decompression they
should be set when <B>Tcl_ZlibStreamGet</B> produces an <B><A HREF="../TclCmd/error.htm">error</A></B> with its
<B>-errorcode</B> set to
&#8220;<B>ZLIB NEED_DICT</B><I> code</I>&#8221;;
the <I>code</I> will be the Adler-32 checksum (see <B>Tcl_ZlibAdler32</B>) of
the compression dictionary sought. (Note that this is only true for
zlib-format streams; gzip streams ignore compression dictionaries as the
format specification doesn't permit them, and raw streams just produce a data
error if the compression dictionary is missing or incorrect.)
<P>
If you wish to clear a stream and reuse it for a new compression or
decompression action, <B>Tcl_ZlibStreamReset</B> will do this and return a
normal Tcl result code to indicate whether it was successful; if the stream is
registered with an interpreter, an error message will be left in the
interpreter result when this function returns TCL_ERROR.
Finally, <B>Tcl_ZlibStreamClose</B> will clean up the stream and delete the
associated command: using <B><A HREF="../TclLib/CrtObjCmd.htm">Tcl_DeleteCommand</A></B> on the stream's command is
equivalent (when such a command exists).
<H3><A NAME="M7">GZIP OPTIONS DICTIONARY</A></H3>
The <I>dictObj</I> parameter to <B>Tcl_ZlibDeflate</B>, <B>Tcl_ZlibInflate</B>
and <B>Tcl_ZlibStreamInit</B> is used to pass a dictionary of options about
that is used to describe the gzip header in the compressed data. When creating
compressed data, the dictionary is read and when unpacking compressed data the
dictionary is written (in which case the <I>dictObj</I> parameter must refer to
an unshared dictionary value).
<P>
The following fields in the dictionary value are understood. All other fields
are ignored. No field is required when creating a gzip-format stream.
<P>
<DL class="gzip options dictionary">
<DT><A NAME="M8"><B>comment</B></A><DD>
This holds the comment field of the header, if present. If absent, no comment
was supplied (on decompression) or will be created (on compression).
<P><DT><A NAME="M9"><B>crc</B></A><DD>
A boolean value describing whether a CRC of the header is computed. Note that
the <B>gzip</B> program does <I>not</I> use or allow a CRC on the header.
<P><DT><A NAME="M10"><B>filename</B></A><DD>
The name of the file that held the uncompressed data. This should not contain
any directory separators, and should be sanitized before use on decompression
with <B><A HREF="../TclCmd/file.htm">file tail</A></B>.
<P><DT><A NAME="M11"><B>os</B></A><DD>
The operating system type code field from the header (if not the
&#8220;unknown&#8221;
value). See RFC 1952 for the meaning of these codes. On compression, if this
is absent then the field will be set to the
&#8220;unknown&#8221;
value.
<P><DT><A NAME="M12"><B>size</B></A><DD>
The size of the uncompressed data. This is ignored on compression; the size
of the data compressed depends on how much data is supplied to the
compression engine.
<P><DT><A NAME="M13"><B>time</B></A><DD>
The time field from the header if non-zero, expected to be the time that the
file named by the <B>filename</B> field was modified. Suitable for use with
<B><A HREF="../TclCmd/clock.htm">clock format</A></B>. On creation, the right value to use is that from
<B><A HREF="../TclCmd/clock.htm">clock seconds</A></B> or <B><A HREF="../TclCmd/file.htm">file mtime</A></B>.
<P><DT><A NAME="M14"><B>type</B></A><DD>
The type of the uncompressed data (either <B>binary</B> or <B>text</B>) if
known.
<P></DL>
<H3><A NAME="M15">PORTABILITY NOTES</A></H3>
These functions will fail gracefully if Tcl is not linked with the zlib
library.
<H3><A NAME="M16">SEE ALSO</A></H3>
<B><A HREF="../TclLib/ByteArrObj.htm">Tcl_NewByteArrayObj</A></B>, <B><A HREF="../TclCmd/zlib.htm">zlib</A></B>
<H3><A NAME="M17">KEYWORDS</A></H3>
<A href="../Keywords/C.htm#compress">compress</A>, <A href="../Keywords/D.htm#decompress">decompress</A>, <A href="../Keywords/D.htm#deflate">deflate</A>, <A href="../Keywords/G.htm#gzip">gzip</A>, <A href="../Keywords/I.htm#inflate">inflate</A>
<div class="copy">Copyright &copy; 2008 Donal K. Fellows
</div>
</BODY></HTML>
