<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <title>Benchmark</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta http-equiv="Content-Language" content="en-gb">
  <link rel="search" type="application/opensearchdescription+xml" title="Search perldoc.perl.org" href="/static/search.xml"/>
  <link href="static/css-20100830.css" rel="stylesheet" rev="stylesheet" type="text/css" media="screen">
  <link href="static/exploreperl.css" rel="stylesheet" rev="stylesheet" type="text/css">
</head>

<body onLoad="perldoc.startup();" onPageShow="if (event.persisted) perldoc.startup();">
    <div id="page">
      
      <div id="header">
	<div id="homepage_link">
	  <a href="index.html"></a>
	</div>
	<div id="strapline">
	  Perl Programming Documentation
	</div>
	<div id="download_link" class="download">
	  <a href="http://www.perl.org/get.html">Download Perl</a>
	</div>
	<div id="explore_link" class="download">
	  <a id="explore_anchor" href="#">Explore</a>
	</div>
      </div>
      
      <div id="body">
        <div id="left_column">
          <div class="side_group">
            
	    <div class="side_panel doc_panel">
              <p>Manual</p>
              <ul>
                <li><a href="index-overview.html">Overview</a>
                <li><a href="index-tutorials.html">Tutorials</a>
                <li><a href="index-faq.html">FAQs</a>
                <li><a href="index-history.html">History / Changes</a>
                <li><a href="index-licence.html">License</a>
              </ul>
            </div>
            <div class="side_panel doc_panel">
              <p>Reference</p>
              <ul>
                <li><a href="index-language.html">Language</a>
                <li><a href="index-functions.html">Functions</a>
                <li><a href="perlop.html">Operators</a>
                <li><a href="perlvar.html">Special Variables</a>
                <li><a href="index-pragmas.html">Pragmas</a>
                <li><a href="index-utilities.html">Utilities</a>
                <li><a href="index-internals.html">Internals</a>
                <li><a href="index-platforms.html">Platform Specific</a>
              </ul>
            </div>
            <div class="side_panel doc_panel">
              <p>Modules</p>
              <ul>
		<li>
		
                
                  
		    
		  
		
                  
		    
		  
		
                  
		    
		  
		
                  
		    
		  
		
                  
		    
		  
		
                  
		    
		  
		
                  
		    
		  
		
                  
		    
		  
		
                  
		    
		  
		
                  
		
                  
		
                  
		    
		  
		
                  
		    
		  
		
                  
		    
		  
		
                  
		    
		  
		
                  
		    
		  
		
                  
		
                  
		
                  
		    
		  
		
                  
		    
		  
		
                  
		    
		  
		
                  
		
                  
		
                  
		    
		  
		
                  
		
                  
		
		
                    <a href="index-modules-A.html">A</a>
                    
                      
                        &bull;
                      
                    
                
                    <a href="index-modules-B.html">B</a>
                    
                      
                        &bull;
                      
                    
                
                    <a href="index-modules-C.html">C</a>
                    
                      
                        &bull;
                      
                    
                
                    <a href="index-modules-D.html">D</a>
                    
                      
                        &bull;
                      
                    
                
                    <a href="index-modules-E.html">E</a>
                    
                      
                        <li>
                      
                    
                
                    <a href="index-modules-F.html">F</a>
                    
                      
                        &bull;
                      
                    
                
                    <a href="index-modules-G.html">G</a>
                    
                      
                        &bull;
                      
                    
                
                    <a href="index-modules-H.html">H</a>
                    
                      
                        &bull;
                      
                    
                
                    <a href="index-modules-I.html">I</a>
                    
                      
                        &bull;
                      
                    
                
                    <a href="index-modules-L.html">L</a>
                    
                      
                        <li>
                      
                    
                
                    <a href="index-modules-M.html">M</a>
                    
                      
                        &bull;
                      
                    
                
                    <a href="index-modules-N.html">N</a>
                    
                      
                        &bull;
                      
                    
                
                    <a href="index-modules-O.html">O</a>
                    
                      
                        &bull;
                      
                    
                
                    <a href="index-modules-P.html">P</a>
                    
                      
                        &bull;
                      
                    
                
                    <a href="index-modules-S.html">S</a>
                    
                      
                        <li>
                      
                    
                
                    <a href="index-modules-T.html">T</a>
                    
                      
                        &bull;
                      
                    
                
                    <a href="index-modules-U.html">U</a>
                    
                      
                        &bull;
                      
                    
                
                    <a href="index-modules-X.html">X</a>
                    
                
              </ul>
            </div>
            
	      <div class="side_panel doc_panel">
		<p>Tools</p>
		<ul>
		  <li><a href="preferences.html">Preferences</a>
		</ul>
	      </div>
            
          </div>
        </div>
        <div id="centre_column">
          <div id="content_header">
            <div id="title_bar">
              <div id="page_name">
                <h1>Benchmark</h1>
              </div>
              <div id="perl_version">
                Perl 5 version 22.0 documentation
              </div>
              <div class="page_links" id="page_links_top">
                <a href="#" onClick="toolbar.goToTop();return false;">Go to top</a>
		
              </div>
	      <div class="page_links" id="page_links_bottom">
		
                  <a href="#" id="page_index_toggle">Show page index</a> &bull;
		
                <a href="#" id="recent_pages_toggle">Show recent pages</a>		
	      </div>
	      <div id="search_form">
		<form action="search.html" method="GET" id="search">
		  <input type="text" name="q" id="search_box" alt="Search">
		</form>
	      </div>
            </div>
            <div id="breadcrumbs">
                
    <a href="index.html">Home</a> &gt;
    
      
        <a href="index-modules-B.html">Core modules (B)</a> &gt;
      
    
    Benchmark
  

            </div>
          </div>
          <div id="content_body">
	    <!--[if lt IE 7]>
 <div class="noscript">
   <p>
     <strong>It looks like you're using Internet Explorer 6. This is a very old
     browser which does not offer full support for modern websites.</strong>
   </p>
   <p>
     Unfortunately this means that this website will not work on
     your computer.
   </p>
   <p>
     Don't miss out though! To view the site (and get a better experience from
     many other websites), simply upgrade to
     <a href="http://www.microsoft.com/windows/Internet-explorer/default.aspx">Internet
Explorer 8</a>
     or download an alternative browser such as
     <a href="http://www.mozilla.com/en-US/firefox/firefox.html">Firefox</a>,
     <a href="http://www.apple.com/safari/download/">Safari</a>, or
     <a href="http://www.google.co.uk/chrome">Google Chrome</a>.
   </p>
   <p>
     All of these browsers are free. If you're using a PC at work, you may
     need to contact your IT administrator.
   </p>
 </div>
<![endif]-->
	    <noscript>
	      <div class="noscript">
	      <p>
                <strong>Please note: Many features of this site require JavaScript. You appear to have JavaScript disabled,
	        or are running a non-JavaScript capable web browser.</strong>
	      </p>
	      <p>
		To get the best experience, please enable JavaScript or download a modern web browser such as <a href="http://www.microsoft.com/windows/Internet-explorer/default.aspx">Internet Explorer 8</a>, <a href="http://www.mozilla.com/en-US/firefox/firefox.html">Firefox</a>, <a href="http://www.apple.com/safari/download/">Safari</a>, or <a href="http://www.google.co.uk/chrome">Google Chrome</a>.
              </p>
	      </div>
	    </noscript>

	    <div id="recent_pages" class="hud_container">
	      <div id="recent_pages_header" class="hud_header">
		<div id="recent_pages_close" class="hud_close"><a href="#" onClick="recentPages.hide();return false;"></a></div>
		<div id="recent_pages_title" class="hud_title"><span class="hud_span_top">Recently read</span></div>
		<div id="recent_pages_topright" class="hud_topright"></div>
	      </div>
	      <div id="recent_pages_content" class="hud_content">
	      </div>
	      <div id="recent_pages_footer" class="hud_footer">
		<div id="recent_pages_bottomleft" class="hud_bottomleft"></div>
		<div id="recent_pages_bottom" class="hud_bottom"><span class="hud_span_bottom"></span></div>
		<div id="recent_pages_resize" class="hud_resize"></div>
	      </div>
	    </div>
  
	    <div id="from_search"></div>
            <h1>Benchmark</h1>


  <!--    -->
<ul><li><a href="#NAME">NAME</a><li><a href="#SYNOPSIS">SYNOPSIS</a><li><a href="#DESCRIPTION">DESCRIPTION</a><ul><li><a href="#Methods">Methods</a><li><a href="#Standard-Exports">Standard Exports</a><li><a href="#Optional-Exports">Optional Exports</a><li><a href="#%3ahireswallclock">:hireswallclock</a></ul><li><a href="#Benchmark-Object">Benchmark Object</a><li><a href="#NOTES">NOTES</a><li><a href="#EXAMPLES">EXAMPLES</a><li><a href="#INHERITANCE">INHERITANCE</a><li><a href="#CAVEATS">CAVEATS</a><li><a href="#SEE-ALSO">SEE ALSO</a><li><a href="#AUTHORS">AUTHORS</a><li><a href="#MODIFICATION-HISTORY">MODIFICATION HISTORY</a></ul><a name="NAME"></a><h1>NAME</h1>
<p>Benchmark - benchmark running times of Perl code</p>
<a name="SYNOPSIS"></a><h1>SYNOPSIS</h1>
<pre class="verbatim"><ol><li>    <a class="l_k" href="functions/use.html">use</a> <span class="w">Benchmark</span> <span class="q">qw(:all)</span> <span class="sc">;</span></li><li></li><li>    <span class="w">timethis</span> <span class="s">(</span><span class="i">$count</span><span class="cm">,</span> <span class="q">&quot;code&quot;</span><span class="s">)</span><span class="sc">;</span></li><li></li><li>    <span class="c"># Use Perl code in strings...</span></li><li>    <span class="i">timethese</span><span class="s">(</span><span class="i">$count</span><span class="cm">,</span> <span class="s">{</span></li><li>	<span class="q">&#39;Name1&#39;</span> <span class="cm">=&gt;</span> <span class="q">&#39;...code1...&#39;</span><span class="cm">,</span></li><li>	<span class="q">&#39;Name2&#39;</span> <span class="cm">=&gt;</span> <span class="q">&#39;...code2...&#39;</span><span class="cm">,</span></li><li>    <span class="s">}</span><span class="s">)</span><span class="sc">;</span></li><li></li><li>    <span class="c"># ... or use subroutine references.</span></li><li>    <span class="i">timethese</span><span class="s">(</span><span class="i">$count</span><span class="cm">,</span> <span class="s">{</span></li><li>	<span class="q">&#39;Name1&#39;</span> <span class="cm">=&gt;</span> <a class="l_k" href="functions/sub.html">sub</a> <span class="s">{</span> ...<span class="w">code1</span>... <span class="s">}</span><span class="cm">,</span></li><li>	<span class="q">&#39;Name2&#39;</span> <span class="cm">=&gt;</span> <a class="l_k" href="functions/sub.html">sub</a> <span class="s">{</span> ...<span class="w">code2</span>... <span class="s">}</span><span class="cm">,</span></li><li>    <span class="s">}</span><span class="s">)</span><span class="sc">;</span></li><li></li><li>    <span class="c"># cmpthese can be used both ways as well</span></li><li>    <span class="i">cmpthese</span><span class="s">(</span><span class="i">$count</span><span class="cm">,</span> <span class="s">{</span></li><li>	<span class="q">&#39;Name1&#39;</span> <span class="cm">=&gt;</span> <span class="q">&#39;...code1...&#39;</span><span class="cm">,</span></li><li>	<span class="q">&#39;Name2&#39;</span> <span class="cm">=&gt;</span> <span class="q">&#39;...code2...&#39;</span><span class="cm">,</span></li><li>    <span class="s">}</span><span class="s">)</span><span class="sc">;</span></li><li></li><li>    <span class="i">cmpthese</span><span class="s">(</span><span class="i">$count</span><span class="cm">,</span> <span class="s">{</span></li><li>	<span class="q">&#39;Name1&#39;</span> <span class="cm">=&gt;</span> <a class="l_k" href="functions/sub.html">sub</a> <span class="s">{</span> ...<span class="w">code1</span>... <span class="s">}</span><span class="cm">,</span></li><li>	<span class="q">&#39;Name2&#39;</span> <span class="cm">=&gt;</span> <a class="l_k" href="functions/sub.html">sub</a> <span class="s">{</span> ...<span class="w">code2</span>... <span class="s">}</span><span class="cm">,</span></li><li>    <span class="s">}</span><span class="s">)</span><span class="sc">;</span></li><li></li><li>    <span class="c"># ...or in two stages</span></li><li>    <span class="i">$results</span> = <span class="i">timethese</span><span class="s">(</span><span class="i">$count</span><span class="cm">,</span></li><li>        <span class="s">{</span></li><li>	    <span class="q">&#39;Name1&#39;</span> <span class="cm">=&gt;</span> <a class="l_k" href="functions/sub.html">sub</a> <span class="s">{</span> ...<span class="w">code1</span>... <span class="s">}</span><span class="cm">,</span></li><li>	    <span class="q">&#39;Name2&#39;</span> <span class="cm">=&gt;</span> <a class="l_k" href="functions/sub.html">sub</a> <span class="s">{</span> ...<span class="w">code2</span>... <span class="s">}</span><span class="cm">,</span></li><li>        <span class="s">}</span><span class="cm">,</span></li><li>	<span class="q">&#39;none&#39;</span></li><li>    <span class="s">)</span><span class="sc">;</span></li><li>    <span class="i">cmpthese</span><span class="s">(</span> <span class="i">$results</span> <span class="s">)</span> <span class="sc">;</span></li><li></li><li>    <span class="i">$t</span> = <span class="i">timeit</span><span class="s">(</span><span class="i">$count</span><span class="cm">,</span> <span class="q">&#39;...other code...&#39;</span><span class="s">)</span></li><li>    <a class="l_k" href="functions/print.html">print</a> <span class="q">&quot;$count loops of other code took:&quot;</span><span class="cm">,</span><span class="i">timestr</span><span class="s">(</span><span class="i">$t</span><span class="s">)</span><span class="cm">,</span><span class="q">&quot;\n&quot;</span><span class="sc">;</span></li><li></li><li>    <span class="i">$t</span> = <span class="i">countit</span><span class="s">(</span><span class="i">$time</span><span class="cm">,</span> <span class="q">&#39;...other code...&#39;</span><span class="s">)</span></li><li>    <span class="i">$count</span> = <span class="i">$t</span><span class="i">-&gt;iters</span> <span class="sc">;</span></li><li>    <a class="l_k" href="functions/print.html">print</a> <span class="q">&quot;$count loops of other code took:&quot;</span><span class="cm">,</span><span class="i">timestr</span><span class="s">(</span><span class="i">$t</span><span class="s">)</span><span class="cm">,</span><span class="q">&quot;\n&quot;</span><span class="sc">;</span></li><li></li><li>    <span class="c"># enable hires wallclock timing if possible</span></li><li>    <a class="l_k" href="functions/use.html">use</a> <span class="w">Benchmark</span> <span class="q">&#39;:hireswallclock&#39;</span><span class="sc">;</span></li></ol></pre><a name="DESCRIPTION"></a><h1>DESCRIPTION</h1>
<p>The Benchmark module encapsulates a number of routines to help you
figure out how long it takes to execute some code.</p>
<p>timethis - run a chunk of code several times</p>
<p>timethese - run several chunks of code several times</p>
<p>cmpthese - print results of timethese as a comparison chart</p>
<p>timeit - run a chunk of code and see how long it goes</p>
<p>countit - see how many times a chunk of code runs in a given time</p>
<a name="Methods"></a><h2>Methods</h2>
<ul>
<li><a name="new"></a><b>new</b>
<p>Returns the current time.   Example:</p>
<pre class="verbatim"><ol><li>    <a class="l_k" href="functions/use.html">use</a> <span class="w">Benchmark</span><span class="sc">;</span></li><li>    <span class="i">$t0</span> = <span class="w">Benchmark</span><span class="w">-&gt;new</span><span class="sc">;</span></li><li>    <span class="c"># ... your code here ...</span></li><li>    <span class="i">$t1</span> = <span class="w">Benchmark</span><span class="w">-&gt;new</span><span class="sc">;</span></li><li>    <span class="i">$td</span> = <span class="i">timediff</span><span class="s">(</span><span class="i">$t1</span><span class="cm">,</span> <span class="i">$t0</span><span class="s">)</span><span class="sc">;</span></li><li>    <a class="l_k" href="functions/print.html">print</a> <span class="q">&quot;the code took:&quot;</span><span class="cm">,</span><span class="i">timestr</span><span class="s">(</span><span class="i">$td</span><span class="s">)</span><span class="cm">,</span><span class="q">&quot;\n&quot;</span><span class="sc">;</span></li></ol></pre></li>
<li><a name="debug"></a><b>debug</b>
<p>Enables or disable debugging by setting the <code class="inline"><span class="i">$Benchmark::Debug</span></code>
 flag:</p>
<pre class="verbatim"><ol><li>    <span class="w">Benchmark</span><span class="w">-&gt;debug</span><span class="s">(</span><span class="n">1</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="i">$t</span> = <span class="i">timeit</span><span class="s">(</span><span class="n">10</span><span class="cm">,</span> <span class="q">&#39; 5 ** $Global &#39;</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="w">Benchmark</span><span class="w">-&gt;debug</span><span class="s">(</span><span class="n">0</span><span class="s">)</span><span class="sc">;</span></li></ol></pre></li>
<li><a name="iters"></a><b>iters</b>
<p>Returns the number of iterations.</p>
</li>
</ul>
<a name="Standard-Exports"></a><h2>Standard Exports</h2>
<p>The following routines will be exported into your namespace
if you use the Benchmark module:</p>
<ul>
<li><a name="timeit(COUNT%2c-CODE)"></a><b>timeit(COUNT, CODE)</b>
<p>Arguments: COUNT is the number of times to run the loop, and CODE is
the code to run.  CODE may be either a code reference or a string to
be eval'd; either way it will be run in the caller's package.</p>
<p>Returns: a Benchmark object.</p>
</li>
<li><a name="timethis-(-COUNT%2c-CODE%2c-%5b-TITLE%2c-%5b-STYLE-%5d%5d-)"></a><b>timethis ( COUNT, CODE, [ TITLE, [ STYLE ]] )</b>
<p>Time COUNT iterations of CODE. CODE may be a string to eval or a
code reference; either way the CODE will run in the caller's package.
Results will be printed to STDOUT as TITLE followed by the times.
TITLE defaults to "timethis COUNT" if none is provided. STYLE
determines the format of the output, as described for timestr() below.</p>
<p>The COUNT can be zero or negative: this means the <i>minimum number of
CPU seconds</i> to run.  A zero signifies the default of 3 seconds.  For
example to run at least for 10 seconds:</p>
<pre class="verbatim"><ol><li>	<span class="i">timethis</span><span class="s">(</span><span class="n">-10</span><span class="cm">,</span> <span class="i">$code</span><span class="s">)</span></li></ol></pre><p>or to run two pieces of code tests for at least 3 seconds:</p>
<pre class="verbatim"><ol><li>	<span class="i">timethese</span><span class="s">(</span><span class="n">0</span><span class="cm">,</span> <span class="s">{</span> <span class="w">test1</span> <span class="cm">=&gt;</span> <span class="q">&#39;...&#39;</span><span class="cm">,</span> <span class="w">test2</span> <span class="cm">=&gt;</span> <span class="q">&#39;...&#39;</span><span class="s">}</span><span class="s">)</span></li></ol></pre><p>CPU seconds is, in UNIX terms, the user time plus the system time of
the process itself, as opposed to the real (wallclock) time and the
time spent by the child processes.  Less than 0.1 seconds is not
accepted (-0.01 as the count, for example, will cause a fatal runtime
exception).</p>
<p>Note that the CPU seconds is the <b>minimum</b> time: CPU scheduling and
other operating system factors may complicate the attempt so that a
little bit more time is spent.  The benchmark output will, however,
also tell the number of <code class="inline"><span class="i">$code</span></code>
 runs/second, which should be a more
interesting number than the actually spent seconds.</p>
<p>Returns a Benchmark object.</p>
</li>
<li><a name="timethese-(-COUNT%2c-CODEHASHREF%2c-%5b-STYLE-%5d-)"></a><b>timethese ( COUNT, CODEHASHREF, [ STYLE ] )</b>
<p>The CODEHASHREF is a reference to a hash containing names as keys
and either a string to eval or a code reference for each value.
For each (KEY, VALUE) pair in the CODEHASHREF, this routine will
call</p>
<pre class="verbatim"><ol><li>	<span class="i">timethis</span><span class="s">(</span><span class="w">COUNT</span><span class="cm">,</span> <span class="w">VALUE</span><span class="cm">,</span> <span class="w">KEY</span><span class="cm">,</span> <span class="w">STYLE</span><span class="s">)</span></li></ol></pre><p>The routines are called in string comparison order of KEY.</p>
<p>The COUNT can be zero or negative, see timethis().</p>
<p>Returns a hash reference of Benchmark objects, keyed by name.</p>
</li>
<li><a name="timediff-(-T1%2c-T2-)"></a><b>timediff ( T1, T2 )</b>
<p>Returns the difference between two Benchmark times as a Benchmark
object suitable for passing to timestr().</p>
</li>
<li><a name="timestr-(-TIMEDIFF%2c-%5b-STYLE%2c-%5b-FORMAT-%5d-%5d-)"></a><b>timestr ( TIMEDIFF, [ STYLE, [ FORMAT ] ] )</b>
<p>Returns a string that formats the times in the TIMEDIFF object in
the requested STYLE. TIMEDIFF is expected to be a Benchmark object
similar to that returned by timediff().</p>
<p>STYLE can be any of 'all', 'none', 'noc', 'nop' or 'auto'. 'all' shows
each of the 5 times available ('wallclock' time, user time, system time,
user time of children, and system time of children). 'noc' shows all
except the two children times. 'nop' shows only wallclock and the
two children times. 'auto' (the default) will act as 'all' unless
the children times are both zero, in which case it acts as 'noc'.
'none' prevents output.</p>
<p>FORMAT is the <i>printf(3)</i>-style format specifier (without the
leading '%') to use to print the times. It defaults to '5.2f'.</p>
</li>
</ul>
<a name="Optional-Exports"></a><h2>Optional Exports</h2>
<p>The following routines will be exported into your namespace
if you specifically ask that they be imported:</p>
<ul>
<li><a name="clearcache-(-COUNT-)"></a><b>clearcache ( COUNT )</b>
<p>Clear the cached time for COUNT rounds of the null loop.</p>
</li>
<li><a name="clearallcache-(-)"></a><b>clearallcache ( )</b>
<p>Clear all cached times.</p>
</li>
<li><a name="cmpthese-(-COUNT%2c-CODEHASHREF%2c-%5b-STYLE-%5d-)"></a><b>cmpthese ( COUNT, CODEHASHREF, [ STYLE ] )</b>
</li>
<li><a name="cmpthese-(-RESULTSHASHREF%2c-%5b-STYLE-%5d-)"></a><b>cmpthese ( RESULTSHASHREF, [ STYLE ] )</b>
<p>Optionally calls timethese(), then outputs comparison chart.  This:</p>
<pre class="verbatim"><ol><li>    <span class="i">cmpthese</span><span class="s">(</span> <span class="n">-1</span><span class="cm">,</span> <span class="s">{</span> <span class="w">a</span> <span class="cm">=&gt;</span> <span class="q">&quot;++\$i&quot;</span><span class="cm">,</span> <span class="w">b</span> <span class="cm">=&gt;</span> <span class="q">&quot;\$i *= 2&quot;</span> <span class="s">}</span> <span class="s">)</span> <span class="sc">;</span></li></ol></pre><p>outputs a chart like:</p>
<pre class="verbatim"><ol><li>           Rate    b    a</li><li>    b 2831802/s   -- -61%</li><li>    a 7208959/s 155%   --</li></ol></pre><p>This chart is sorted from slowest to fastest, and shows the percent speed
difference between each pair of tests.</p>
<p><code class="inline"><span class="w">cmpthese</span></code>
 can also be passed the data structure that timethese() returns:</p>
<pre class="verbatim"><ol><li>    <span class="i">$results</span> = <span class="i">timethese</span><span class="s">(</span> <span class="n">-1</span><span class="cm">,</span></li><li>        <span class="s">{</span> <span class="w">a</span> <span class="cm">=&gt;</span> <span class="q">&quot;++\$i&quot;</span><span class="cm">,</span> <span class="w">b</span> <span class="cm">=&gt;</span> <span class="q">&quot;\$i *= 2&quot;</span> <span class="s">}</span> <span class="s">)</span> <span class="sc">;</span></li><li>    <span class="i">cmpthese</span><span class="s">(</span> <span class="i">$results</span> <span class="s">)</span><span class="sc">;</span></li></ol></pre><p>in case you want to see both sets of results.
If the first argument is an unblessed hash reference,
that is RESULTSHASHREF; otherwise that is COUNT.</p>
<p>Returns a reference to an ARRAY of rows, each row is an ARRAY of cells from the
above chart, including labels. This:</p>
<pre class="verbatim"><ol><li>    <a class="l_k" href="functions/my.html">my</a> <span class="i">$rows</span> = <span class="i">cmpthese</span><span class="s">(</span> <span class="n">-1</span><span class="cm">,</span></li><li>        <span class="s">{</span> <span class="w">a</span> <span class="cm">=&gt;</span> <span class="q">&#39;++$i&#39;</span><span class="cm">,</span> <span class="w">b</span> <span class="cm">=&gt;</span> <span class="q">&#39;$i *= 2&#39;</span> <span class="s">}</span><span class="cm">,</span> <span class="q">&quot;none&quot;</span> <span class="s">)</span><span class="sc">;</span></li></ol></pre><p>returns a data structure like:</p>
<pre class="verbatim"><ol><li>    <span class="s">[</span></li><li>        <span class="s">[</span> <span class="q">&#39;&#39;</span><span class="cm">,</span>       <span class="q">&#39;Rate&#39;</span><span class="cm">,</span>   <span class="q">&#39;b&#39;</span><span class="cm">,</span>    <span class="q">&#39;a&#39;</span> <span class="s">]</span><span class="cm">,</span></li><li>        <span class="s">[</span> <span class="q">&#39;b&#39;</span><span class="cm">,</span> <span class="q">&#39;2885232/s&#39;</span><span class="cm">,</span>  <span class="q">&#39;--&#39;</span><span class="cm">,</span> <span class="q">&#39;-59%&#39;</span> <span class="s">]</span><span class="cm">,</span></li><li>        <span class="s">[</span> <span class="q">&#39;a&#39;</span><span class="cm">,</span> <span class="q">&#39;7099126/s&#39;</span><span class="cm">,</span> <span class="q">&#39;146%&#39;</span><span class="cm">,</span>  <span class="q">&#39;--&#39;</span> <span class="s">]</span><span class="cm">,</span></li><li>    <span class="s">]</span></li></ol></pre><p><b>NOTE</b>: This result value differs from previous versions, which returned
the <code class="inline"><span class="i">timethese</span><span class="s">(</span><span class="s">)</span></code>
 result structure.  If you want that, just use the two
statement <code class="inline"><span class="w">timethese</span></code>
...<code class="inline"><span class="w">cmpthese</span></code>
 idiom shown above.</p>
<p>Incidentally, note the variance in the result values between the two examples;
this is typical of benchmarking.  If this were a real benchmark, you would
probably want to run a lot more iterations.</p>
</li>
<li><a name="countit(TIME%2c-CODE)"></a><b>countit(TIME, CODE)</b>
<p>Arguments: TIME is the minimum length of time to run CODE for, and CODE is
the code to run.  CODE may be either a code reference or a string to
be eval'd; either way it will be run in the caller's package.</p>
<p>TIME is <i>not</i> negative.  countit() will run the loop many times to
calculate the speed of CODE before running it for TIME.  The actual
time run for will usually be greater than TIME due to system clock
resolution, so it's best to look at the number of iterations divided
by the times that you are concerned with, not just the iterations.</p>
<p>Returns: a Benchmark object.</p>
</li>
<li><a name="disablecache-(-)"></a><b>disablecache ( )</b>
<p>Disable caching of timings for the null loop. This will force Benchmark
to recalculate these timings for each new piece of code timed.</p>
</li>
<li><a name="enablecache-(-)"></a><b>enablecache ( )</b>
<p>Enable caching of timings for the null loop. The time taken for COUNT
rounds of the null loop will be calculated only once for each
different COUNT used.</p>
</li>
<li><a name="timesum-(-T1%2c-T2-)"></a><b>timesum ( T1, T2 )</b>
<p>Returns the sum of two Benchmark times as a Benchmark object suitable
for passing to timestr().</p>
</li>
</ul>
<a name="%3ahireswallclock"></a><h2>:hireswallclock</h2>
<p>If the Time::HiRes module has been installed, you can specify the
special tag <code class="inline"><span class="j">:</span><span class="w">hireswallclock</span></code>
 for Benchmark (if Time::HiRes is not
available, the tag will be silently ignored).  This tag will cause the
wallclock time to be measured in microseconds, instead of integer
seconds.  Note though that the speed computations are still conducted
in CPU time, not wallclock time.</p>
<a name="Benchmark-Object"></a><h1>Benchmark Object</h1>
<p>Many of the functions in this module return a Benchmark object,
or in the case of <code class="inline"><span class="i">timethese</span><span class="s">(</span><span class="s">)</span></code>
, a reference to a hash, the values of
which are Benchmark objects.  This is useful if you want to store or
further process results from Benchmark functions.</p>
<p>Internally the Benchmark object holds timing values,
described in <a href="#NOTES">NOTES</a> below.
The following methods can be used to access them:</p>
<ul>
<li><a name="cpu_p"></a><b>cpu_p</b>
<p>Total CPU (User + System) of the main (parent) process.</p>
</li>
<li><a name="cpu_c"></a><b>cpu_c</b>
<p>Total CPU (User + System) of any children processes.</p>
</li>
<li><a name="cpu_a"></a><b>cpu_a</b>
<p>Total CPU of parent and any children processes.</p>
</li>
<li><a name="real"></a><b>real</b>
<p>Real elapsed time "wallclock seconds".</p>
</li>
<li><a name="iters"></a><b>iters</b>
<p>Number of iterations run.</p>
</li>
</ul>
<p>The following illustrates use of the Benchmark object:</p>
<pre class="verbatim"><ol><li>    <span class="i">$result</span> = <span class="i">timethis</span><span class="s">(</span><span class="n">100000</span><span class="cm">,</span> <a class="l_k" href="functions/sub.html">sub</a> <span class="s">{</span> ... <span class="s">}</span><span class="s">)</span><span class="sc">;</span></li><li>    <a class="l_k" href="functions/print.html">print</a> <span class="q">&quot;total CPU = &quot;</span><span class="cm">,</span> <span class="i">$result</span><span class="i">-&gt;cpu_a</span><span class="cm">,</span> <span class="q">&quot;\n&quot;</span><span class="sc">;</span></li></ol></pre><a name="NOTES"></a><h1>NOTES</h1>
<p>The data is stored as a list of values from the time and times
functions:</p>
<pre class="verbatim"><ol><li>      <span class="s">(</span><span class="i">$real</span><span class="cm">,</span> <span class="i">$user</span><span class="cm">,</span> <span class="i">$system</span><span class="cm">,</span> <span class="i">$children_user</span><span class="cm">,</span> <span class="i">$children_system</span><span class="cm">,</span> <span class="i">$iters</span><span class="s">)</span></li></ol></pre><p>in seconds for the whole loop (not divided by the number of rounds).</p>
<p>The timing is done using time(3) and times(3).</p>
<p>Code is executed in the caller's package.</p>
<p>The time of the null loop (a loop with the same
number of rounds but empty loop body) is subtracted
from the time of the real loop.</p>
<p>The null loop times can be cached, the key being the
number of rounds. The caching can be controlled using
calls like these:</p>
<pre class="verbatim"><ol><li>    <span class="i">clearcache</span><span class="s">(</span><span class="i">$key</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="i">clearallcache</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span></li><li></li><li>    <span class="i">disablecache</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="i">enablecache</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Caching is off by default, as it can (usually slightly) decrease
accuracy and does not usually noticeably affect runtimes.</p>
<a name="EXAMPLES"></a><h1>EXAMPLES</h1>
<p>For example,</p>
<pre class="verbatim"><ol><li>    <a class="l_k" href="functions/use.html">use</a> <span class="w">Benchmark</span> <span class="q">qw( cmpthese )</span> <span class="sc">;</span></li><li>    <span class="i">$x</span> = <span class="n">3</span><span class="sc">;</span></li><li>    <span class="i">cmpthese</span><span class="s">(</span> <span class="n">-5</span><span class="cm">,</span> <span class="s">{</span></li><li>        <span class="w">a</span> <span class="cm">=&gt;</span> <a class="l_k" href="functions/sub.html">sub</a><span class="s">{</span><span class="i">$x</span>*<span class="i">$x</span><span class="s">}</span><span class="cm">,</span></li><li>        <span class="w">b</span> <span class="cm">=&gt;</span> <a class="l_k" href="functions/sub.html">sub</a><span class="s">{</span><span class="i">$x</span>**<span class="n">2</span><span class="s">}</span><span class="cm">,</span></li><li>    <span class="s">}</span> <span class="s">)</span><span class="sc">;</span></li></ol></pre><p>outputs something like this:</p>
<pre class="verbatim"><ol><li>   Benchmark: running a, b, each for at least 5 CPU seconds...</li><li>          Rate    b    a</li><li>   b 1559428/s   -- -62%</li><li>   a 4152037/s 166%   --</li></ol></pre><p>while</p>
<pre class="verbatim"><ol><li>    <a class="l_k" href="functions/use.html">use</a> <span class="w">Benchmark</span> <span class="q">qw( timethese cmpthese )</span> <span class="sc">;</span></li><li>    <span class="i">$x</span> = <span class="n">3</span><span class="sc">;</span></li><li>    <span class="i">$r</span> = <span class="i">timethese</span><span class="s">(</span> <span class="n">-5</span><span class="cm">,</span> <span class="s">{</span></li><li>        <span class="w">a</span> <span class="cm">=&gt;</span> <a class="l_k" href="functions/sub.html">sub</a><span class="s">{</span><span class="i">$x</span>*<span class="i">$x</span><span class="s">}</span><span class="cm">,</span></li><li>        <span class="w">b</span> <span class="cm">=&gt;</span> <a class="l_k" href="functions/sub.html">sub</a><span class="s">{</span><span class="i">$x</span>**<span class="n">2</span><span class="s">}</span><span class="cm">,</span></li><li>    <span class="s">}</span> <span class="s">)</span><span class="sc">;</span></li><li>    <span class="w">cmpthese</span> <span class="i">$r</span><span class="sc">;</span></li></ol></pre><p>outputs something like this:</p>
<pre class="verbatim"><ol><li>    Benchmark: running a, b, each for at least 5 CPU seconds...</li><li>             a: 10 wallclock secs ( 5.14 usr +  0.13 sys =  5.27 CPU) @ 3835055.60/s (n=20210743)</li><li>             b:  5 wallclock secs ( 5.41 usr +  0.00 sys =  5.41 CPU) @ 1574944.92/s (n=8520452)</li><li>           Rate    b    a</li><li>    b 1574945/s   -- -59%</li><li>    a 3835056/s 144%   --</li></ol></pre><a name="INHERITANCE"></a><h1>INHERITANCE</h1>
<p>Benchmark inherits from no other class, except of course
from Exporter.</p>
<a name="CAVEATS"></a><h1>CAVEATS</h1>
<p>Comparing eval'd strings with code references will give you
inaccurate results: a code reference will show a slightly slower
execution time than the equivalent eval'd string.</p>
<p>The real time timing is done using time(2) and
the granularity is therefore only one second.</p>
<p>Short tests may produce negative figures because perl
can appear to take longer to execute the empty loop
than a short test; try:</p>
<pre class="verbatim"><ol><li>    <span class="i">timethis</span><span class="s">(</span><span class="n">100</span><span class="cm">,</span><span class="q">&#39;1&#39;</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>The system time of the null loop might be slightly
more than the system time of the loop with the actual
code and therefore the difference might end up being &lt; 0.</p>
<a name="SEE-ALSO"></a><h1>SEE ALSO</h1>
<p><a href="http://search.cpan.org/perldoc/Devel::NYTProf">Devel::NYTProf</a> - a Perl code profiler</p>
<a name="AUTHORS"></a><h1>AUTHORS</h1>
<p>Jarkko Hietaniemi &lt;<i>jhi@iki.fi</i>&gt;, Tim Bunce &lt;<i>Tim.Bunce@ig.co.uk</i>&gt;</p>
<a name="MODIFICATION-HISTORY"></a><h1>MODIFICATION HISTORY</h1>
<p>September 8th, 1994; by Tim Bunce.</p>
<p>March 28th, 1997; by Hugo van der Sanden: added support for code
references and the already documented 'debug' method; revamped
documentation.</p>
<p>April 04-07th, 1997: by Jarkko Hietaniemi, added the run-for-some-time
functionality.</p>
<p>September, 1999; by Barrie Slaymaker: math fixes and accuracy and
efficiency tweaks.  Added cmpthese().  A result is now returned from
timethese().  Exposed countit() (was runfor()).</p>
<p>December, 2001; by Nicholas Clark: make timestr() recognise the style 'none'
and return an empty string. If cmpthese is calling timethese, make it pass the
style in. (so that 'none' will suppress output). Make sub new dump its
debugging output to STDERR, to be consistent with everything else.
All bugs found while writing a regression test.</p>
<p>September, 2002; by Jarkko Hietaniemi: add ':hireswallclock' special tag.</p>
<p>February, 2004; by Chia-liang Kao: make cmpthese and timestr use time
statistics for children instead of parent when the style is 'nop'.</p>
<p>November, 2007; by Christophe Grosjean: make cmpthese and timestr compute
time consistently with style argument, default is 'all' not 'noc' any more.</p>




  <div id="page_index" class="hud_container">
    <div id="page_index_header" class="hud_header">
      <div id="page_index_close" class="hud_close"><a href="#" onClick="pageIndex.hide();return false;"></a></div>
      <div id="page_index_title" class="hud_title"><span class="hud_span_top">Page index</span></div>
      <div id="page_index_topright" class="hud_topright"></div>
    </div>
    <div id="page_index_content" class="hud_content">
      <ul><li><a href="#NAME">NAME</a><li><a href="#SYNOPSIS">SYNOPSIS</a><li><a href="#DESCRIPTION">DESCRIPTION</a><ul><li><a href="#Methods">Methods</a><li><a href="#Standard-Exports">Standard Exports</a><li><a href="#Optional-Exports">Optional Exports</a><li><a href="#%3ahireswallclock">:hireswallclock</a></ul><li><a href="#Benchmark-Object">Benchmark Object</a><li><a href="#NOTES">NOTES</a><li><a href="#EXAMPLES">EXAMPLES</a><li><a href="#INHERITANCE">INHERITANCE</a><li><a href="#CAVEATS">CAVEATS</a><li><a href="#SEE-ALSO">SEE ALSO</a><li><a href="#AUTHORS">AUTHORS</a><li><a href="#MODIFICATION-HISTORY">MODIFICATION HISTORY</a></ul>
    </div>
    <div id="page_index_footer" class="hud_footer">
      <div id="page_index_bottomleft" class="hud_bottomleft"></div>
      <div id="page_index_bottom" class="hud_bottom"><span class="hud_span_bottom"></span></div>
      <div id="page_index_resize" class="hud_resize"></div>
    </div>
  </div>


	    &nbsp;
          </div>
          <div id="content_footer">
          </div>
        </div>
        <div class="clear"></div>
      </div>
      
    <div id="footer">
      <div id="footer_content">
        <div id="footer_strapline">
          perldoc.perl.org - Official documentation for the Perl programming language
        </div>
        <div id="footer_links">
          <div id="address">
            <p class="name">Contact details</p>
            <p class="address">
	      Site maintained by <a href="mailto:jj@jonallen.info">Jon Allen (JJ)</a><br>
	    </p>
            <p class="contact">
              Documentation maintained by the <a href="http://lists.cpan.org/showlist.cgi?name=perl5-porters">Perl 5 Porters</a>
            </p>
          </div>
          <ul class="f1">
            <li>Manual
              <ul class="f2">
                <li><a href="index-overview.html">Overview</a>
                <li><a href="index-tutorials.html">Tutorials</a>
                <li><a href="index-faq.html">FAQs</a>
                <li><a href="index-history.html">Changes</a>
              </ul>
            <li>Reference
              <ul class="f2">
                <li><a href="index-language.html">Language</a>
                <li><a href="index-functions.html">Functions</a>
                <li><a href="perlop.html">Operators</a>
                <li><a href="perlvar.html">Variables</a>
              </ul>
            <li>Modules
              <ul class="f2">
                <li><a href="index-modules-A.html">Modules</a>
                <li><a href="index-pragmas.html">Pragmas</a>
                <li><a href="index-utilities.html">Utilities</a>
              </ul>
            <li>Misc
              <ul class="f2">
                <li><a href="index-licence.html">License</a>
                <li><a href="index-internals.html">Internals</a>
                <li><a href="index-platforms.html">Platforms</a>
              </ul>          </ul>
          <div class="clear"></div>
        </div>
      </div>
      <div id="footer_end">
      </div>
    </div>
      
    </div>
      <script language="JavaScript" type="text/javascript" src="static/exploreperl.js"></script>
      <script language="JavaScript" src="static/combined-20100403.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
  perldoc.setPath(0);
  perldoc.pageName    = 'Benchmark';
  perldoc.pageAddress = 'Benchmark.html';
  perldoc.contentPage = 1;
  explorePerl.render();
  explorePerl.addEvents('explore_anchor');
</script>
    
  </body>
</html>
