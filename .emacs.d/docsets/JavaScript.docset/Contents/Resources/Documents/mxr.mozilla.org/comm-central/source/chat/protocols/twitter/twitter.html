<!DOCTYPE html>
<html>

<!-- Mirrored from mxr.mozilla.org/comm-central/source/chat/protocols/twitter/twitter.js by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 01 May 2016 19:39:34 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta name="GENERATOR" content="lxr-1998-06-10: http://lxr.linux.no">
<link rel="icon" href="../../../../../mxr.png" type="image/png">
<title>comm-central comm-central/chat/protocols/twitter/twitter.js</title>
<link rel='stylesheet' title='' href='../../../../style/style.css' type='text/css'>
<link rel='alternate stylesheet' title='Alt-1' href='../../../../style/alt1-js.css' type='text/css'>

<script src='../../../../../coloration.js'></script>
<script src='../../../../../script.js'></script>
</head>

<body   bgcolor="#FFFFFF" text="#000000"
	link="#0000EE" vlink="#551A8B" alink="#FF0000">

<table class=banner bgcolor="#000000" width="100%" border=0 cellpadding=0 cellspacing=0>
<tr><td><a class="logo" href="http://www.mozilla.org/"><img
 src="../../../../../../www.mozilla.org/images/mozilla-banner.gif" alt=""
 border=0 width=600 height=58></a></td></tr></table>

<table class=header border=0 cellpadding=12 cellspacing=0 width="100%">
 <tr>
  <td align=left valign=middle>
   <nobr><font size="+2"><b><a href="http://mxr.mozilla.org/">Mozilla Cross-Reference</a></b>
</nobr><i><a href="http://mxr.mozilla.org/comm-central">comm-central</a></i>
</font>
   <br><b><a href="http://mxr.mozilla.org/comm-central/source/">comm-central</a>/ <a href="http://mxr.mozilla.org/comm-central/source/chat/">chat</a>/ <a href="http://mxr.mozilla.org/comm-central/source/chat/protocols/">protocols</a>/ <a href="http://mxr.mozilla.org/comm-central/source/chat/protocols/twitter/">twitter</a>/ <a href="twitter.html">twitter.js</a> </b>
  </TD>

  <td align=right valign=top width="1%">
   <table border cellpadding=12 cellspacing=0>
    <tr>
     <td nowrap bgcolor="#FAFAFA">

<script>
function updateHgBlameHash(node, event) {
  if (!document.location.hash)
    return;
  var anchor = document.location.hash;
  anchor = anchor.replace("#", "#l");
  node.href =
    node.href.replace(/#.*|$/, anchor);
}
</script>
<a href="http://hg.mozilla.org/comm-central/filelog/5cb34881d913/chat/protocols/twitter/twitter.js">Hg Log</a><br>
<a href="http://hg.mozilla.org/comm-central/annotate/5cb34881d913/chat/protocols/twitter/twitter.js"
onfocus='updateHgBlameHash(this, event)'
onmouseover='updateHgBlameHash(this, event)'
>Hg Blame</a><br>

      <a href="../../../../diffcf9e.html?file=/chat/protocols/twitter/twitter.js">Diff file</a><br>
      <a href="twitter2af1.js?raw=1">Raw file</a><br>
     </TD>
    </TR>
   </table>
  </TD>

 </TR>
</table>

<form name='source' id='source' class='beforecontent'
>view using tree:
<select name='tree' id='tree' onchange='changetarget("http://mxr.mozilla.org/comm-central/", "http://mxr.mozilla.org/comm-central/source/chat/protocols/twitter/comm-central/")'>
<option value="comm-aurora">comm-aurora</option>
<option value="comm-beta">comm-beta</option>
<option value="comm-central" selected=1>comm-central</option>
<option value="comm-esr17">comm-esr17</option>
<option value="comm-esr24">comm-esr24</option>
<option value="comm-esr31">comm-esr31</option>
<option value="comm-esr38">comm-esr38</option>
<option value="comm-esr45">comm-esr45</option>
<option value="comm-release">comm-release</option>

</select></form>

<pre lang='en'><style>.d3:before{content:' '} .d2:before{content:'  '} .d1:before{content:'   '} .d0:before{content:'    '} </style><span id='the-code'><a class='l d0' name=1 href="#1">1</a> <span class='c'>/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a class='l d0' name=2 href="#2">2</a> <span class='c'> * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a class='l d0' name=3 href="#3">3</a> <span class='c'> * file, You can obtain one at <a href="http://mozilla.org/MPL/2.0/.">http://mozilla.org/MPL/2.0/.</a> */</span>
<a class='l d0' name=4 href="#4">4</a> 
<a class='l d0' name=5 href="#5">5</a> <span class='v'>var </span>{<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=classes">classes</a>: <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Cc">Cc</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=interfaces">interfaces</a>: <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Ci">Ci</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=results">results</a>: <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Cr">Cr</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=utils">utils</a>: <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Cu">Cu</a>} = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Components">Components</a>;
<a class='l d0' name=6 href="#6">6</a> 
<a class='l d0' name=7 href="#7">7</a> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Cu">Cu</a>.<span class='v'>import("resource://gre/modules/Http.jsm");
<a class='l d0' name=8 href="#8">8</a> </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Cu">Cu</a>.<span class='v'>import("resource:///modules/imServices.jsm");
<a class='l d0' name=9 href="#9">9</a> </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Cu">Cu</a>.<span class='v'>import("resource:///modules/imXPCOMUtils.jsm");
<a class='l d1' name=10 href="#10">10</a> </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Cu">Cu</a>.<span class='v'>import("resource:///modules/jsProtoHelper.jsm");
<a class='l d1' name=11 href="#11">11</a> </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Cu">Cu</a>.<span class='v'>import("resource:///modules/twitter-text.jsm");
<a class='l d1' name=12 href="#12">12</a> </span>
<a class='l d1' name=13 href="#13">13</a> <span class='v'>var </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=NS_PREFBRANCH_PREFCHANGE_TOPIC_ID">NS_PREFBRANCH_PREFCHANGE_TOPIC_ID</a> = <span class='s'>"nsPref:changed"</span>;
<a class='l d1' name=14 href="#14">14</a> <span class='v'>var </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=kMaxMessageLength">kMaxMessageLength</a> = 140;
<a class='l d1' name=15 href="#15">15</a> 
<a class='l d1' name=16 href="#16">16</a> <span class='a'>XPCOMUtils</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=defineLazyGetter">defineLazyGetter</a>(<span class='v'>this,</span> <span class='s'>"_"</span>, () =&gt;
<a class='l d1' name=17 href="#17">17</a>   <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=l10nHelper">l10nHelper</a>(<span class='s'>"chrome://chat/locale/twitter.properties"</span>)
<a class='l d1' name=18 href="#18">18</a> );
<a class='l d1' name=19 href="#19">19</a> <span class='a'>XPCOMUtils</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=defineLazyGetter">defineLazyGetter</a>(<span class='v'>this,</span> <span class='s'>"_lang"</span>, () =&gt;
<a class='l d1' name=20 href="#20">20</a>   <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=l10nHelper">l10nHelper</a>(<span class='s'>"chrome://global/locale/languageNames.properties"</span>)
<a class='l d1' name=21 href="#21">21</a> );
<a class='l d1' name=22 href="#22">22</a> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=initLogModule">initLogModule</a>(<span class='s'>"twitter"</span>, <span class='v'>this)</span>;
<a class='l d1' name=23 href="#23">23</a> 
<a class='l d1' name=24 href="#24">24</a> <span class='v'>function </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=ChatBuddy">ChatBuddy</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aName">aName</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aAccount">aAccount</a>) {
<a class='l d1' name=25 href="#25">25</a>   <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=_name">_name</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aName">aName</a>;
<a class='l d1' name=26 href="#26">26</a>   <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=_account">_account</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aAccount">aAccount</a>;
<a class='l d1' name=27 href="#27">27</a> }
<a class='l d1' name=28 href="#28">28</a> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=ChatBuddy">ChatBuddy</a>.<span class='v'>prototype </span>= {
<a class='l d1' name=29 href="#29">29</a>   <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=__proto__">__proto__</a>: <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=GenericConvChatBuddyPrototype">GenericConvChatBuddyPrototype</a>,
<a class='l d1' name=30 href="#30">30</a>   <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=buddyIconFilename">buddyIconFilename</a>() {
<a class='l d1' name=31 href="#31">31</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=userInfo">userInfo</a> = <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=_account">_account</a>.<span class='a'>_userInfo</span>.<span class='v'>get(</span><span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=name">name</a>);
<a class='l d1' name=32 href="#32">32</a>     <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=userInfo">userInfo</a>)
<a class='l d1' name=33 href="#33">33</a>       <span class='v'>return </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=userInfo">userInfo</a>.<span class='a'>profile_image_url</span>;
<a class='l d1' name=34 href="#34">34</a>     <span class='v'>return </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=undefined">undefined</a>;
<a class='l d1' name=35 href="#35">35</a>   },
<a class='l d1' name=36 href="#36">36</a>   <span class='v'>set </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=buddyIconFilename">buddyIconFilename</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aName">aName</a>) {
<a class='l d1' name=37 href="#37">37</a>     <span class='c'>// Prevent accidental removal of the getter.</span>
<a class='l d1' name=38 href="#38">38</a> <span class='c'></span>    <span class='v'>throw(</span><span class='s'>"Don't set chatBuddy.buddyIconFilename directly for Twitter."</span>);
<a class='l d1' name=39 href="#39">39</a>   }
<a class='l d1' name=40 href="#40">40</a> }
<a class='l d1' name=41 href="#41">41</a> 
<a class='l d1' name=42 href="#42">42</a> <span class='v'>function </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Tweet">Tweet</a>(<span class='a'>aTweet</span>, <span class='a'>aWho</span>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aMessage">aMessage</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aObject">aObject</a>)
<a class='l d1' name=43 href="#43">43</a> {
<a class='l d1' name=44 href="#44">44</a>   <span class='v'>this.</span><span class='a'>_tweet</span> = <span class='a'>aTweet</span>;
<a class='l d1' name=45 href="#45">45</a>   <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=_init">_init</a>(<span class='a'>aWho</span>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aMessage">aMessage</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aObject">aObject</a>);
<a class='l d1' name=46 href="#46">46</a> }
<a class='l d1' name=47 href="#47">47</a> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Tweet">Tweet</a>.<span class='v'>prototype </span>= {
<a class='l d1' name=48 href="#48">48</a>   <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=__proto__">__proto__</a>: <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=GenericMessagePrototype">GenericMessagePrototype</a>,
<a class='l d1' name=49 href="#49">49</a>   <span class='a'>_deleted</span>: <span class='v'>false,
<a class='l d1' name=50 href="#50">50</a> </span>  <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=getActions">getActions</a>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aCount">aCount</a>) {
<a class='l d1' name=51 href="#51">51</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=account">account</a> = <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=conversation">conversation</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=_account">_account</a>;
<a class='l d1' name=52 href="#52">52</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=actions">actions</a> = [];
<a class='l d1' name=53 href="#53">53</a> 
<a class='l d1' name=54 href="#54">54</a>     <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=account">account</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=connected">connected</a>) {
<a class='l d1' name=55 href="#55">55</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=actions">actions</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=push">push</a>(
<a class='l d1' name=56 href="#56">56</a>         <span class='v'>new </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Action">Action</a>(<span class='a'>_</span>(<span class='s'>"action.reply"</span>), <span class='v'>function(</span>) {
<a class='l d1' name=57 href="#57">57</a>           <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=conversation">conversation</a>.<span class='a'>startReply</span>(<span class='v'>this.</span><span class='a'>_tweet</span>);
<a class='l d1' name=58 href="#58">58</a>         }, <span class='v'>this)</span>
<a class='l d1' name=59 href="#59">59</a>       );
<a class='l d1' name=60 href="#60">60</a>       <span class='v'>if </span>(<span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=incoming">incoming</a>) {
<a class='l d1' name=61 href="#61">61</a>         <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=actions">actions</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=push">push</a>(
<a class='l d1' name=62 href="#62">62</a>           <span class='v'>new </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Action">Action</a>(<span class='a'>_</span>(<span class='s'>"action.retweet"</span>), <span class='v'>function(</span>) {
<a class='l d1' name=63 href="#63">63</a>             <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=conversation">conversation</a>.<span class='a'>reTweet</span>(<span class='v'>this.</span><span class='a'>_tweet</span>);
<a class='l d1' name=64 href="#64">64</a>           }, <span class='v'>this)</span>
<a class='l d1' name=65 href="#65">65</a>         );
<a class='l d1' name=66 href="#66">66</a>         <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=isFriend">isFriend</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=account">account</a>.<span class='a'>_friends</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=has">has</a>(<span class='v'>this.</span><span class='a'>_tweet</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=user">user</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=id_str">id_str</a>);
<a class='l d1' name=67 href="#67">67</a>         <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=action">action</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=isFriend">isFriend</a> ? <span class='s'>"stopFollowing"</span> : <span class='s'>"follow"</span>;
<a class='l d1' name=68 href="#68">68</a>         <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=screenName">screenName</a> = <span class='v'>this.</span><span class='a'>_tweet</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=user">user</a>.<span class='a'>screen_name</span>;
<a class='l d1' name=69 href="#69">69</a>         <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=actions">actions</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=push">push</a>(<span class='v'>new </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Action">Action</a>(<span class='a'>_</span>(<span class='s'>"action."</span> + <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=action">action</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=screenName">screenName</a>),
<a class='l d1' name=70 href="#70">70</a>                                 <span class='v'>function(</span>) { <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=account">account</a>[<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=action">action</a>](<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=screenName">screenName</a>); }));
<a class='l d1' name=71 href="#71">71</a>       }
<a class='l d1' name=72 href="#72">72</a>       <span class='v'>else </span><span class='v'>if </span>(<span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=outgoing">outgoing</a> &amp;&amp; !<span class='v'>this.</span><span class='a'>_deleted</span>) {
<a class='l d1' name=73 href="#73">73</a>         <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=actions">actions</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=push">push</a>(
<a class='l d1' name=74 href="#74">74</a>           <span class='v'>new </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Action">Action</a>(<span class='a'>_</span>(<span class='s'>"action.delete"</span>), <span class='v'>function(</span>) {
<a class='l d1' name=75 href="#75">75</a>             <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=destroy">destroy</a>();
<a class='l d1' name=76 href="#76">76</a>           }, <span class='v'>this)</span>
<a class='l d1' name=77 href="#77">77</a>         );
<a class='l d1' name=78 href="#78">78</a>       }
<a class='l d1' name=79 href="#79">79</a>     }
<a class='l d1' name=80 href="#80">80</a>     <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=actions">actions</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=push">push</a>(<span class='v'>new </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Action">Action</a>(<span class='a'>_</span>(<span class='s'>"action.copyLink"</span>), <span class='v'>function(</span>) {
<a class='l d1' name=81 href="#81">81</a>       <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=href">href</a> = <span class='s'>"https://twitter.com/"</span> + <span class='v'>this.</span><span class='a'>_tweet</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=user">user</a>.<span class='a'>screen_name</span> +
<a class='l d1' name=82 href="#82">82</a>                  <span class='s'>"/status/"</span> + <span class='v'>this.</span><span class='a'>_tweet</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=id_str">id_str</a>;
<a class='l d1' name=83 href="#83">83</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Cc">Cc</a>[<span class='s'>"@mozilla.org/widget/clipboardhelper;1"</span>]
<a class='l d1' name=84 href="#84">84</a>         .<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=getService">getService</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Ci">Ci</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=nsIClipboardHelper">nsIClipboardHelper</a>).<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=copyString">copyString</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=href">href</a>);
<a class='l d1' name=85 href="#85">85</a>     }, <span class='v'>this)</span>);
<a class='l d1' name=86 href="#86">86</a>     <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aCount">aCount</a>)
<a class='l d1' name=87 href="#87">87</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aCount">aCount</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=value">value</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=actions">actions</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=length">length</a>;
<a class='l d1' name=88 href="#88">88</a>     <span class='v'>return </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=actions">actions</a>;
<a class='l d1' name=89 href="#89">89</a>   },
<a class='l d1' name=90 href="#90">90</a>   <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=destroy">destroy</a>: <span class='v'>function(</span>) {
<a class='l d1' name=91 href="#91">91</a>     <span class='c'>// Mark the tweet as deleted until we receive a response.</span>
<a class='l d1' name=92 href="#92">92</a> <span class='c'></span>    <span class='v'>this.</span><span class='a'>_deleted</span> = <span class='v'>true;</span>
<a class='l d1' name=93 href="#93">93</a> 
<a class='l d1' name=94 href="#94">94</a>     <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=conversation">conversation</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=_account">_account</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=destroy">destroy</a>(<span class='v'>this.</span><span class='a'>_tweet</span>, <span class='v'>this.</span><span class='a'>onDestroyCallback</span>,
<a class='l d1' name=95 href="#95">95</a>                                        <span class='v'>this.</span><span class='a'>onDestroyErrorCallback</span>, <span class='v'>this)</span>;
<a class='l d1' name=96 href="#96">96</a>   },
<a class='l d1' name=97 href="#97">97</a>   <span class='a'>onDestroyErrorCallback</span>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aException">aException</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aData">aData</a>) {
<a class='l d1' name=98 href="#98">98</a>     <span class='c'>// The tweet was not successfully deleted.</span>
<a class='l d1' name=99 href="#99">99</a> <span class='c'></span>    <span class='v'>delete </span><span class='v'>this.</span><span class='a'>_deleted</span>;
<a class='l d2' name=100 href="#100">100</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=error">error</a> = <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=conversation">conversation</a>.<span class='a'>_parseError</span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aData">aData</a>);
<a class='l d2' name=101 href="#101">101</a>     <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=conversation">conversation</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=systemMessage">systemMessage</a>(<span class='a'>_</span>(<span class='s'>"error.delete"</span>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=error">error</a>,
<a class='l d2' name=102 href="#102">102</a>                                       <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=originalMessage">originalMessage</a>), <span class='v'>true)</span>;
<a class='l d2' name=103 href="#103">103</a>   },
<a class='l d2' name=104 href="#104">104</a>   <span class='a'>onDestroyCallback</span>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aData">aData</a>) {
<a class='l d2' name=105 href="#105">105</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=tweet">tweet</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=JSON">JSON</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=parse">parse</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aData">aData</a>);
<a class='l d2' name=106 href="#106">106</a>     <span class='c'>// If Twitter responds with an error, throw to call the error callback.</span>
<a class='l d2' name=107 href="#107">107</a> <span class='c'></span>    <span class='v'>if </span>(<span class='s'>"error"</span> <span class='a'>in</span> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=tweet">tweet</a>)
<a class='l d2' name=108 href="#108">108</a>       <span class='v'>throw </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=tweet">tweet</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=error">error</a>;
<a class='l d2' name=109 href="#109">109</a> 
<a class='l d2' name=110 href="#110">110</a>     <span class='c'>// Create a new system message saying the tweet has been deleted.</span>
<a class='l d2' name=111 href="#111">111</a> <span class='c'></span>    <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=conversation">conversation</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=systemMessage">systemMessage</a>(<span class='a'>_</span>(<span class='s'>"event.deleted"</span>, <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=originalMessage">originalMessage</a>));
<a class='l d2' name=112 href="#112">112</a>   }
<a class='l d2' name=113 href="#113">113</a> };
<a class='l d2' name=114 href="#114">114</a> 
<a class='l d2' name=115 href="#115">115</a> <span class='v'>function </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Action">Action</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aLabel">aLabel</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aAction">aAction</a>, <span class='a'>aTweet</span>)
<a class='l d2' name=116 href="#116">116</a> {
<a class='l d2' name=117 href="#117">117</a>   <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=label">label</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aLabel">aLabel</a>;
<a class='l d2' name=118 href="#118">118</a>   <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=_action">_action</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aAction">aAction</a>;
<a class='l d2' name=119 href="#119">119</a>   <span class='v'>this.</span><span class='a'>_tweet</span> = <span class='a'>aTweet</span>;
<a class='l d2' name=120 href="#120">120</a> }
<a class='l d2' name=121 href="#121">121</a> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Action">Action</a>.<span class='v'>prototype </span>= {
<a class='l d2' name=122 href="#122">122</a>   <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=__proto__">__proto__</a>: <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=ClassInfo">ClassInfo</a>(<span class='s'>"prplIMessageAction"</span>, <span class='s'>"generic message action object"</span>),
<a class='l d2' name=123 href="#123">123</a>   <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=run">run</a>() { <span class='v'>return </span><span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=_action">_action</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=bind">bind</a>(<span class='v'>this.</span><span class='a'>_tweet</span>); }
<a class='l d2' name=124 href="#124">124</a> };
<a class='l d2' name=125 href="#125">125</a> 
<a class='l d2' name=126 href="#126">126</a> <span class='v'>function </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Conversation">Conversation</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aAccount">aAccount</a>)
<a class='l d2' name=127 href="#127">127</a> {
<a class='l d2' name=128 href="#128">128</a>   <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=_init">_init</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aAccount">aAccount</a>);
<a class='l d2' name=129 href="#129">129</a>   <span class='v'>this.</span><span class='a'>_ensureParticipantExists</span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aAccount">aAccount</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=name">name</a>);
<a class='l d2' name=130 href="#130">130</a>   <span class='c'>// We need the screen names for the IDs in _friends, but _userInfo is</span>
<a class='l d2' name=131 href="#131">131</a> <span class='c'></span>  <span class='c'>// indexed by name, so we build an ID -&gt; name map.</span>
<a class='l d2' name=132 href="#132">132</a> <span class='c'></span>  <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entries">entries</a> = [];
<a class='l d2' name=133 href="#133">133</a>   <span class='v'>for </span>(<span class='v'>let </span>[<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=name">name</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=userInfo">userInfo</a>] <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=of">of</a> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aAccount">aAccount</a>.<span class='a'>_userInfo</span>) {
<a class='l d2' name=134 href="#134">134</a>     <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entries">entries</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=push">push</a>([<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=userInfo">userInfo</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=id_str">id_str</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=name">name</a>]);
<a class='l d2' name=135 href="#135">135</a>   }
<a class='l d2' name=136 href="#136">136</a>   <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=names">names</a> = <span class='v'>new </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Map">Map</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entries">entries</a>);
<a class='l d2' name=137 href="#137">137</a>   <span class='v'>for </span>(<span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=id_str">id_str</a> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=of">of</a> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aAccount">aAccount</a>.<span class='a'>_friends</span>)
<a class='l d2' name=138 href="#138">138</a>     <span class='v'>this.</span><span class='a'>_ensureParticipantExists</span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=names">names</a>.<span class='v'>get(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=id_str">id_str</a>));
<a class='l d2' name=139 href="#139">139</a> 
<a class='l d2' name=140 href="#140">140</a>   <span class='c'>// If the user's info has already been received, update the timeline topic.</span>
<a class='l d2' name=141 href="#141">141</a> <span class='c'></span>  <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aAccount">aAccount</a>.<span class='a'>_userInfo</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=has">has</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aAccount">aAccount</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=name">name</a>)) {
<a class='l d2' name=142 href="#142">142</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=userInfo">userInfo</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aAccount">aAccount</a>.<span class='a'>_userInfo</span>.<span class='v'>get(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aAccount">aAccount</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=name">name</a>);
<a class='l d2' name=143 href="#143">143</a>     <span class='v'>if </span>(<span class='s'>"description"</span> <span class='a'>in</span> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=userInfo">userInfo</a>)
<a class='l d2' name=144 href="#144">144</a>       <span class='v'>this.</span><span class='a'>setTopic</span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=userInfo">userInfo</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=description">description</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aAccount">aAccount</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=name">name</a>, <span class='v'>true)</span>;
<a class='l d2' name=145 href="#145">145</a>   }
<a class='l d2' name=146 href="#146">146</a> }
<a class='l d2' name=147 href="#147">147</a> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Conversation">Conversation</a>.<span class='v'>prototype </span>= {
<a class='l d2' name=148 href="#148">148</a>   <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=__proto__">__proto__</a>: <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=GenericConvChatPrototype">GenericConvChatPrototype</a>,
<a class='l d2' name=149 href="#149">149</a>   <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=unInit">unInit</a>: <span class='v'>function(</span>) {
<a class='l d2' name=150 href="#150">150</a>     <span class='v'>delete </span><span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=_account">_account</a>.<span class='a'>_timeline</span>;
<a class='l d2' name=151 href="#151">151</a>     <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=GenericConvChatPrototype">GenericConvChatPrototype</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=unInit">unInit</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=call">call</a>(<span class='v'>this)</span>;
<a class='l d2' name=152 href="#152">152</a>   },
<a class='l d2' name=153 href="#153">153</a>   <span class='a'>inReplyToStatusId</span>: <span class='v'>null,</span>
<a class='l d2' name=154 href="#154">154</a>   <span class='a'>startReply</span>: <span class='v'>function(</span><span class='a'>aTweet</span>) {
<a class='l d2' name=155 href="#155">155</a>     <span class='v'>this.</span><span class='a'>inReplyToStatusId</span> = <span class='a'>aTweet</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=id_str">id_str</a>;
<a class='l d2' name=156 href="#156">156</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entities">entities</a> = <span class='a'>aTweet</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entities">entities</a>;
<a class='l d2' name=157 href="#157">157</a> 
<a class='l d2' name=158 href="#158">158</a>     <span class='c'>// Twitter replies go to all the users mentioned in the tweet.</span>
<a class='l d2' name=159 href="#159">159</a> <span class='c'></span>    <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=nicks">nicks</a> = [<span class='a'>aTweet</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=user">user</a>.<span class='a'>screen_name</span>];
<a class='l d2' name=160 href="#160">160</a>     <span class='v'>if </span>(<span class='s'>"user_mentions"</span> <span class='a'>in</span> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entities">entities</a> &amp;&amp; <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Array">Array</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=isArray">isArray</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entities">entities</a>.<span class='a'>user_mentions</span>)) {
<a class='l d2' name=161 href="#161">161</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=nicks">nicks</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=nicks">nicks</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=concat">concat</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entities">entities</a>.<span class='a'>user_mentions</span>
<a class='l d2' name=162 href="#162">162</a>                                    .<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=map">map</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=um">um</a> =&gt; <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=um">um</a>.<span class='a'>screen_name</span>));
<a class='l d2' name=163 href="#163">163</a>     }
<a class='l d2' name=164 href="#164">164</a>     <span class='c'>// Ignore duplicates and the user's nick.</span>
<a class='l d2' name=165 href="#165">165</a> <span class='c'></span>    <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=prompt">prompt</a> =
<a class='l d2' name=166 href="#166">166</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=nicks">nicks</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=filter">filter</a>(<span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aNick">aNick</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aPos">aPos</a>) {
<a class='l d2' name=167 href="#167">167</a>              <span class='v'>return </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=nicks">nicks</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=indexOf">indexOf</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aNick">aNick</a>) == <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aPos">aPos</a> &amp;&amp; <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aNick">aNick</a> != <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=_account">_account</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=name">name</a>;
<a class='l d2' name=168 href="#168">168</a>            }, <span class='v'>this)</span>
<a class='l d2' name=169 href="#169">169</a>            .<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=map">map</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aNick">aNick</a> =&gt; <span class='s'>"@"</span> + <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aNick">aNick</a>)
<a class='l d2' name=170 href="#170">170</a>            .<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=join">join</a>(<span class='s'>" "</span>) + <span class='s'>" "</span>;
<a class='l d2' name=171 href="#171">171</a> 
<a class='l d2' name=172 href="#172">172</a>     <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=notifyObservers">notifyObservers</a>(<span class='v'>null,</span> <span class='s'>"replying-to-prompt"</span>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=prompt">prompt</a>);
<a class='l d2' name=173 href="#173">173</a>     <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=notifyObservers">notifyObservers</a>(<span class='v'>null,</span> <span class='s'>"status-text-changed"</span>,
<a class='l d2' name=174 href="#174">174</a>                          <span class='a'>_</span>(<span class='s'>"replyingToStatusText"</span>, <span class='a'>aTweet</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=text">text</a>));
<a class='l d2' name=175 href="#175">175</a>   },
<a class='l d2' name=176 href="#176">176</a>   <span class='a'>reTweet</span>: <span class='v'>function(</span><span class='a'>aTweet</span>) {
<a class='l d2' name=177 href="#177">177</a>     <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=_account">_account</a>.<span class='a'>reTweet</span>(<span class='a'>aTweet</span>, <span class='v'>this.</span><span class='a'>onSentCallback</span>,
<a class='l d2' name=178 href="#178">178</a>                           <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aException">aException</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aData">aData</a>) {
<a class='l d2' name=179 href="#179">179</a>       <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=systemMessage">systemMessage</a>(<span class='a'>_</span>(<span class='s'>"error.retweet"</span>, <span class='v'>this.</span><span class='a'>_parseError</span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aData">aData</a>),
<a class='l d2' name=180 href="#180">180</a>                            <span class='a'>aTweet</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=text">text</a>), <span class='v'>true)</span>;
<a class='l d2' name=181 href="#181">181</a>     }, <span class='v'>this)</span>;
<a class='l d2' name=182 href="#182">182</a>   },
<a class='l d2' name=183 href="#183">183</a>   <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=getTweetLength">getTweetLength</a>: <span class='v'>function </span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aString">aString</a>) {
<a class='l d2' name=184 href="#184">184</a>     <span class='c'>// Use the Twitter library to calculate the length.</span>
<a class='l d2' name=185 href="#185">185</a> <span class='c'></span>    <span class='v'>return </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=twttr">twttr</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=txt">txt</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=getTweetLength">getTweetLength</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aString">aString</a>, <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=_account">_account</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=config">config</a>);
<a class='l d2' name=186 href="#186">186</a>   },
<a class='l d2' name=187 href="#187">187</a>   <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=sendMsg">sendMsg</a>: <span class='v'>function </span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aMsg">aMsg</a>) {
<a class='l d2' name=188 href="#188">188</a>     <span class='v'>if </span>(<span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=getTweetLength">getTweetLength</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aMsg">aMsg</a>) &gt; <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=kMaxMessageLength">kMaxMessageLength</a>) {
<a class='l d2' name=189 href="#189">189</a>       <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=systemMessage">systemMessage</a>(<span class='a'>_</span>(<span class='s'>"error.tooLong"</span>), <span class='v'>true)</span>;
<a class='l d2' name=190 href="#190">190</a>       <span class='v'>throw </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Cr">Cr</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=NS_ERROR_INVALID_ARG">NS_ERROR_INVALID_ARG</a>;
<a class='l d2' name=191 href="#191">191</a>     }
<a class='l d2' name=192 href="#192">192</a>     <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=_account">_account</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=tweet">tweet</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aMsg">aMsg</a>, <span class='v'>this.</span><span class='a'>inReplyToStatusId</span>, <span class='v'>this.</span><span class='a'>onSentCallback</span>,
<a class='l d2' name=193 href="#193">193</a>                         <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aException">aException</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aData">aData</a>) {
<a class='l d2' name=194 href="#194">194</a>       <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=error">error</a> = <span class='v'>this.</span><span class='a'>_parseError</span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aData">aData</a>);
<a class='l d2' name=195 href="#195">195</a>       <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=systemMessage">systemMessage</a>(<span class='a'>_</span>(<span class='s'>"error.general"</span>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=error">error</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aMsg">aMsg</a>), <span class='v'>true)</span>;
<a class='l d2' name=196 href="#196">196</a>     }, <span class='v'>this)</span>;
<a class='l d2' name=197 href="#197">197</a>     <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=sendTyping">sendTyping</a>(<span class='s'>""</span>);
<a class='l d2' name=198 href="#198">198</a>   },
<a class='l d2' name=199 href="#199">199</a>   <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=sendTyping">sendTyping</a>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aString">aString</a>) {
<a class='l d2' name=200 href="#200">200</a>     <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aString">aString</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=length">length</a> == 0 &amp;&amp; <span class='v'>this.</span><span class='a'>inReplyToStatusId</span>) {
<a class='l d2' name=201 href="#201">201</a>       <span class='v'>delete </span><span class='v'>this.</span><span class='a'>inReplyToStatusId</span>;
<a class='l d2' name=202 href="#202">202</a>       <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=notifyObservers">notifyObservers</a>(<span class='v'>null,</span> <span class='s'>"status-text-changed"</span>, <span class='s'>""</span>);
<a class='l d2' name=203 href="#203">203</a>       <span class='v'>return </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=kMaxMessageLength">kMaxMessageLength</a>;
<a class='l d2' name=204 href="#204">204</a>     }
<a class='l d2' name=205 href="#205">205</a>     <span class='v'>return </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=kMaxMessageLength">kMaxMessageLength</a> - <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=getTweetLength">getTweetLength</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aString">aString</a>);
<a class='l d2' name=206 href="#206">206</a>   },
<a class='l d2' name=207 href="#207">207</a>   <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=systemMessage">systemMessage</a>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aMessage">aMessage</a>, <span class='a'>aIsError</span>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aDate">aDate</a>) {
<a class='l d2' name=208 href="#208">208</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=flags">flags</a> = {<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=system">system</a>: <span class='v'>true};</span>
<a class='l d2' name=209 href="#209">209</a>     <span class='v'>if </span>(<span class='a'>aIsError</span>)
<a class='l d2' name=210 href="#210">210</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=flags">flags</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=error">error</a> = <span class='v'>true;</span>
<a class='l d2' name=211 href="#211">211</a>     <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aDate">aDate</a>)
<a class='l d2' name=212 href="#212">212</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=flags">flags</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=time">time</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aDate">aDate</a>;
<a class='l d2' name=213 href="#213">213</a>     <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=writeMessage">writeMessage</a>(<span class='s'>"twitter.com"</span>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aMessage">aMessage</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=flags">flags</a>);
<a class='l d2' name=214 href="#214">214</a>   },
<a class='l d2' name=215 href="#215">215</a>   <span class='a'>onSentCallback</span>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aData">aData</a>) {
<a class='l d2' name=216 href="#216">216</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=tweet">tweet</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=JSON">JSON</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=parse">parse</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aData">aData</a>);
<a class='l d2' name=217 href="#217">217</a>     <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=tweet">tweet</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=user">user</a>.<span class='a'>screen_name</span> != <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=_account">_account</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=name">name</a>)
<a class='l d2' name=218 href="#218">218</a>       <span class='v'>throw </span><span class='s'>"Wrong screen_name... Uh?"</span>;
<a class='l d2' name=219 href="#219">219</a>     <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=_account">_account</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=displayMessages">displayMessages</a>([<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=tweet">tweet</a>]);
<a class='l d2' name=220 href="#220">220</a>   },
<a class='l d2' name=221 href="#221">221</a>   <span class='a'>_parseError</span>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aData">aData</a>) {
<a class='l d2' name=222 href="#222">222</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=error">error</a> = <span class='s'>""</span>;
<a class='l d2' name=223 href="#223">223</a>     <span class='v'>try </span>{
<a class='l d2' name=224 href="#224">224</a>       <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=data">data</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=JSON">JSON</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=parse">parse</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aData">aData</a>);
<a class='l d2' name=225 href="#225">225</a>       <span class='v'>if </span>(<span class='s'>"error"</span> <span class='a'>in</span> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=data">data</a>)
<a class='l d2' name=226 href="#226">226</a>         <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=error">error</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=data">data</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=error">error</a>;
<a class='l d2' name=227 href="#227">227</a>       <span class='v'>else </span><span class='v'>if </span>(<span class='s'>"errors"</span> <span class='a'>in</span> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=data">data</a>)
<a class='l d2' name=228 href="#228">228</a>         <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=error">error</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=data">data</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=errors">errors</a>[0].<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=message">message</a>;
<a class='l d2' name=229 href="#229">229</a>       <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=error">error</a>)
<a class='l d2' name=230 href="#230">230</a>         <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=error">error</a> = <span class='s'>"("</span> + <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=error">error</a> + <span class='s'>")"</span>;
<a class='l d2' name=231 href="#231">231</a>     } <span class='v'>catch(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=e">e</a>) {}
<a class='l d2' name=232 href="#232">232</a>     <span class='v'>return </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=error">error</a>;
<a class='l d2' name=233 href="#233">233</a>   },
<a class='l d2' name=234 href="#234">234</a>   <span class='a'>parseTweet</span>: <span class='v'>function(</span><span class='a'>aTweet</span>) {
<a class='l d2' name=235 href="#235">235</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=text">text</a> = <span class='a'>aTweet</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=text">text</a>;
<a class='l d2' name=236 href="#236">236</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entities">entities</a> = {};
<a class='l d2' name=237 href="#237">237</a>     <span class='c'>// Handle retweets: retweeted_status contains the object for the original</span>
<a class='l d2' name=238 href="#238">238</a> <span class='c'></span>    <span class='c'>// tweet that is being retweeted.</span>
<a class='l d2' name=239 href="#239">239</a> <span class='c'></span>    <span class='c'>// If the retweet prefix ("RT @&lt;username&gt;: ") causes the tweet to be over</span>
<a class='l d2' name=240 href="#240">240</a> <span class='c'></span>    <span class='c'>// 140 characters, ellipses will be added. In this case, we want to get</span>
<a class='l d2' name=241 href="#241">241</a> <span class='c'></span>    <span class='c'>// the FULL text from the original tweet and update the entities to match.</span>
<a class='l d2' name=242 href="#242">242</a> <span class='c'></span>    <span class='c'>// Note: the truncated flag is not always set correctly by twitter, so we</span>
<a class='l d2' name=243 href="#243">243</a> <span class='c'></span>    <span class='c'>// always make use of the original tweet.</span>
<a class='l d2' name=244 href="#244">244</a> <span class='c'></span>    <span class='v'>if </span>(<span class='s'>"retweeted_status"</span> <span class='a'>in</span> <span class='a'>aTweet</span>) {
<a class='l d2' name=245 href="#245">245</a>       <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=retweet">retweet</a> = <span class='a'>aTweet</span>[<span class='s'>"retweeted_status"</span>];
<a class='l d2' name=246 href="#246">246</a>       <span class='c'>// We're going to take portions of the retweeted status and replace parts</span>
<a class='l d2' name=247 href="#247">247</a> <span class='c'></span>      <span class='c'>// of the original tweet, the retweeted status prepends the original</span>
<a class='l d2' name=248 href="#248">248</a> <span class='c'></span>      <span class='c'>// status with "RT @&lt;username&gt;: ", we need to keep the prefix.</span>
<a class='l d2' name=249 href="#249">249</a> <span class='c'></span>      <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=offset">offset</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=text">text</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=indexOf">indexOf</a>(<span class='s'>": "</span>) + 2;
<a class='l d2' name=250 href="#250">250</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=text">text</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=text">text</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=slice">slice</a>(0, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=offset">offset</a>) + <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=retweet">retweet</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=text">text</a>;
<a class='l d2' name=251 href="#251">251</a> 
<a class='l d2' name=252 href="#252">252</a>       <span class='c'>// Keep any entities that refer to the prefix (we can refer directly to</span>
<a class='l d2' name=253 href="#253">253</a> <span class='c'></span>      <span class='c'>// aTweet for these since they are not edited).</span>
<a class='l d2' name=254 href="#254">254</a> <span class='c'></span>      <span class='v'>if </span>(<span class='s'>"entities"</span> <span class='a'>in</span> <span class='a'>aTweet</span>) {
<a class='l d2' name=255 href="#255">255</a>         <span class='v'>for </span>(<span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=type">type</a> <span class='a'>in</span> <span class='a'>aTweet</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entities">entities</a>) {
<a class='l d2' name=256 href="#256">256</a>           <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=filteredEntities">filteredEntities</a> =
<a class='l d2' name=257 href="#257">257</a>             <span class='a'>aTweet</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entities">entities</a>[<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=type">type</a>].<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=filter">filter</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=e">e</a> =&gt; <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=e">e</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=indices">indices</a>[0] &lt; <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=offset">offset</a>);
<a class='l d2' name=258 href="#258">258</a>           <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=filteredEntities">filteredEntities</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=length">length</a>)
<a class='l d2' name=259 href="#259">259</a>             <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entities">entities</a>[<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=type">type</a>] = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=filteredEntities">filteredEntities</a>;
<a class='l d2' name=260 href="#260">260</a>         }
<a class='l d2' name=261 href="#261">261</a>       }
<a class='l d2' name=262 href="#262">262</a> 
<a class='l d2' name=263 href="#263">263</a>       <span class='c'>// Add the entities from the retweet (a copy of these must be made since</span>
<a class='l d2' name=264 href="#264">264</a> <span class='c'></span>      <span class='c'>// they will be edited and we do not wish to change aTweet).</span>
<a class='l d2' name=265 href="#265">265</a> <span class='c'></span>      <span class='v'>if </span>(<span class='s'>"entities"</span> <span class='a'>in</span> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=retweet">retweet</a>) {
<a class='l d2' name=266 href="#266">266</a>         <span class='v'>for </span>(<span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=type">type</a> <span class='a'>in</span> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=retweet">retweet</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entities">entities</a>) {
<a class='l d2' name=267 href="#267">267</a>           <span class='v'>if </span>(!(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=type">type</a> <span class='a'>in</span> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entities">entities</a>))
<a class='l d2' name=268 href="#268">268</a>             <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entities">entities</a>[<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=type">type</a>] = [];
<a class='l d2' name=269 href="#269">269</a> 
<a class='l d2' name=270 href="#270">270</a>           <span class='c'>// Append the entities from the original status.</span>
<a class='l d2' name=271 href="#271">271</a> <span class='c'></span>          <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entities">entities</a>[<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=type">type</a>] = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entities">entities</a>[<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=type">type</a>].<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=concat">concat</a>(
<a class='l d2' name=272 href="#272">272</a>             <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=retweet">retweet</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entities">entities</a>[<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=type">type</a>].<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=map">map</a>(<span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aEntity">aEntity</a>) {
<a class='l d2' name=273 href="#273">273</a>               <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entity">entity</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Object">Object</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=create">create</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aEntity">aEntity</a>);
<a class='l d2' name=274 href="#274">274</a>               <span class='c'>// Add the offset to the indices to account for the prefix.</span>
<a class='l d2' name=275 href="#275">275</a> <span class='c'></span>              <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entity">entity</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=indices">indices</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entity">entity</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=indices">indices</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=map">map</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=i">i</a> =&gt; <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=i">i</a> + <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=offset">offset</a>);
<a class='l d2' name=276 href="#276">276</a>               <span class='v'>return </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entity">entity</a>;
<a class='l d2' name=277 href="#277">277</a>             })
<a class='l d2' name=278 href="#278">278</a>           );
<a class='l d2' name=279 href="#279">279</a>         }
<a class='l d2' name=280 href="#280">280</a>       }
<a class='l d2' name=281 href="#281">281</a>     } <span class='v'>else </span>{
<a class='l d2' name=282 href="#282">282</a>       <span class='c'>// For non-retweets, we just want to use the entities that are given.</span>
<a class='l d2' name=283 href="#283">283</a> <span class='c'></span>      <span class='v'>if </span>(<span class='s'>"entities"</span> <span class='a'>in</span> <span class='a'>aTweet</span>)
<a class='l d2' name=284 href="#284">284</a>         <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entities">entities</a> = <span class='a'>aTweet</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entities">entities</a>;
<a class='l d2' name=285 href="#285">285</a>     }
<a class='l d2' name=286 href="#286">286</a> 
<a class='l d2' name=287 href="#287">287</a>     <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Object">Object</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=keys">keys</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entities">entities</a>).<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=length">length</a>) {
<a class='l d2' name=288 href="#288">288</a>       <span class='c'>/* entArray is an array of entities ready to be replaced in the tweet,</span>
<a class='l d2' name=289 href="#289">289</a> <span class='c'>       * each entity contains:</span>
<a class='l d2' name=290 href="#290">290</a> <span class='c'>       *  - start: the start index of the entity inside the tweet,</span>
<a class='l d2' name=291 href="#291">291</a> <span class='c'>       *  - end: the end index of the entity inside the tweet,</span>
<a class='l d2' name=292 href="#292">292</a> <span class='c'>       *  - str: the string that should be replaced inside the tweet,</span>
<a class='l d2' name=293 href="#293">293</a> <span class='c'>       *  - href: the url (href attribute) of the created link tag,</span>
<a class='l d2' name=294 href="#294">294</a> <span class='c'>       *  - [optional] text: the text to display for the link,</span>
<a class='l d2' name=295 href="#295">295</a> <span class='c'>       *     The original string (str) will be used if this is not set.</span>
<a class='l d2' name=296 href="#296">296</a> <span class='c'>       *  - [optional] title: the title attribute for the link.</span>
<a class='l d2' name=297 href="#297">297</a> <span class='c'>       */</span>
<a class='l d2' name=298 href="#298">298</a>       <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entArray">entArray</a> = [];
<a class='l d2' name=299 href="#299">299</a>       <span class='v'>if </span>(<span class='s'>"hashtags"</span> <span class='a'>in</span> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entities">entities</a> &amp;&amp; <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Array">Array</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=isArray">isArray</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entities">entities</a>.<span class='a'>hashtags</span>)) {
<a class='l d2' name=300 href="#300">300</a>         <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entArray">entArray</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entArray">entArray</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=concat">concat</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entities">entities</a>.<span class='a'>hashtags</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=map">map</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=h">h</a> =&gt; ({
<a class='l d2' name=301 href="#301">301</a>           <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=start">start</a>: <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=h">h</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=indices">indices</a>[0],
<a class='l d2' name=302 href="#302">302</a>           <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=end">end</a>: <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=h">h</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=indices">indices</a>[1],
<a class='l d2' name=303 href="#303">303</a>           <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=str">str</a>: <span class='s'>"#"</span> + <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=h">h</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=text">text</a>,
<a class='l d2' name=304 href="#304">304</a>           <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=href">href</a>: <span class='s'>"https://twitter.com/#!/search?q=%23"</span> + <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=h">h</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=text">text</a>})));
<a class='l d2' name=305 href="#305">305</a>       }
<a class='l d2' name=306 href="#306">306</a>       <span class='v'>if </span>(<span class='s'>"urls"</span> <span class='a'>in</span> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entities">entities</a> &amp;&amp; <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Array">Array</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=isArray">isArray</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entities">entities</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=urls">urls</a>)) {
<a class='l d2' name=307 href="#307">307</a>         <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entArray">entArray</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entArray">entArray</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=concat">concat</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entities">entities</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=urls">urls</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=map">map</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=u">u</a> =&gt; ({
<a class='l d2' name=308 href="#308">308</a>           <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=start">start</a>: <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=u">u</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=indices">indices</a>[0],
<a class='l d2' name=309 href="#309">309</a>           <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=end">end</a>: <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=u">u</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=indices">indices</a>[1],
<a class='l d2' name=310 href="#310">310</a>           <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=str">str</a>: <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=u">u</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=url">url</a>,
<a class='l d2' name=311 href="#311">311</a>           <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=text">text</a>: <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=u">u</a>.<span class='a'>display_url</span> || <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=u">u</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=url">url</a>,
<a class='l d2' name=312 href="#312">312</a>           <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=href">href</a>: <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=u">u</a>.<span class='a'>expanded_url</span> || <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=u">u</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=url">url</a>})));
<a class='l d2' name=313 href="#313">313</a>       }
<a class='l d2' name=314 href="#314">314</a>       <span class='v'>if </span>(<span class='s'>"user_mentions"</span> <span class='a'>in</span> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entities">entities</a> &amp;&amp;
<a class='l d2' name=315 href="#315">315</a>           <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Array">Array</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=isArray">isArray</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entities">entities</a>.<span class='a'>user_mentions</span>)) {
<a class='l d2' name=316 href="#316">316</a>         <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entArray">entArray</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entArray">entArray</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=concat">concat</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entities">entities</a>.<span class='a'>user_mentions</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=map">map</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=um">um</a> =&gt; ({
<a class='l d2' name=317 href="#317">317</a>           <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=start">start</a>: <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=um">um</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=indices">indices</a>[0],
<a class='l d2' name=318 href="#318">318</a>           <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=end">end</a>: <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=um">um</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=indices">indices</a>[1],
<a class='l d2' name=319 href="#319">319</a>           <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=str">str</a>: <span class='s'>"@"</span> + <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=um">um</a>.<span class='a'>screen_name</span>,
<a class='l d2' name=320 href="#320">320</a>           <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=text">text</a>: <span class='s'>'@&lt;span class="ib-person"&gt;'</span> + <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=um">um</a>.<span class='a'>screen_name</span> + <span class='s'>"&lt;/span&gt;"</span>,
<a class='l d2' name=321 href="#321">321</a>           <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=title">title</a>: <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=um">um</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=name">name</a>,
<a class='l d2' name=322 href="#322">322</a>           <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=href">href</a>: <span class='s'>"https://twitter.com/"</span> + <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=um">um</a>.<span class='a'>screen_name</span>})));
<a class='l d2' name=323 href="#323">323</a>       }
<a class='l d2' name=324 href="#324">324</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entArray">entArray</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=sort">sort</a>((<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=a">a</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=b">b</a>) =&gt; <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=a">a</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=start">start</a> - <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=b">b</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=start">start</a>);
<a class='l d2' name=325 href="#325">325</a>       <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=offset">offset</a> = 0;
<a class='l d2' name=326 href="#326">326</a>       <span class='v'>for </span>(<span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entity">entity</a> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=of">of</a> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entArray">entArray</a>) {
<a class='l d2' name=327 href="#327">327</a>         <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=str">str</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=text">text</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=substring">substring</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=offset">offset</a> + <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entity">entity</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=start">start</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=offset">offset</a> + <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entity">entity</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=end">end</a>);
<a class='l d2' name=328 href="#328">328</a>         <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=str">str</a>[0] == <span class='s'>"\uFF20"</span>) <span class='c'>//  - unicode character similar to @</span>
<a class='l d2' name=329 href="#329">329</a> <span class='c'></span>          <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=str">str</a> = <span class='s'>"@"</span> + <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=str">str</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=substring">substring</a>(1);
<a class='l d2' name=330 href="#330">330</a>         <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=str">str</a>[0] == <span class='s'>"\uFF03"</span>) <span class='c'>//  - unicode character similar to #</span>
<a class='l d2' name=331 href="#331">331</a> <span class='c'></span>          <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=str">str</a> = <span class='s'>"#"</span> + <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=str">str</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=substring">substring</a>(1);
<a class='l d2' name=332 href="#332">332</a>         <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=str">str</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=toLowerCase">toLowerCase</a>() != <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entity">entity</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=str">str</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=toLowerCase">toLowerCase</a>())
<a class='l d2' name=333 href="#333">333</a>           <span class='v'>continue;
<a class='l d2' name=334 href="#334">334</a> </span>
<a class='l d2' name=335 href="#335">335</a>         <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=html">html</a> = <span class='s'>"&lt;a href=\""</span> + <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entity">entity</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=href">href</a> + <span class='s'>"\""</span>;
<a class='l d2' name=336 href="#336">336</a>         <span class='v'>if </span>(<span class='s'>"title"</span> <span class='a'>in</span> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entity">entity</a>)
<a class='l d2' name=337 href="#337">337</a>           <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=html">html</a> += <span class='s'>" title=\""</span> + <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entity">entity</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=title">title</a> + <span class='s'>"\""</span>;
<a class='l d2' name=338 href="#338">338</a>         <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=html">html</a> += <span class='s'>"&gt;"</span> + (<span class='s'>"text"</span> <span class='a'>in</span> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entity">entity</a> ? <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entity">entity</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=text">text</a> : <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entity">entity</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=str">str</a>) + <span class='s'>"&lt;/a&gt;"</span>;
<a class='l d2' name=339 href="#339">339</a>         <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=text">text</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=text">text</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=slice">slice</a>(0, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=offset">offset</a> + <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entity">entity</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=start">start</a>) + <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=html">html</a> +
<a class='l d2' name=340 href="#340">340</a>                <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=text">text</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=slice">slice</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=offset">offset</a> + <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entity">entity</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=end">end</a>);
<a class='l d2' name=341 href="#341">341</a>         <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=offset">offset</a> += <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=html">html</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=length">length</a> - (<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entity">entity</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=end">end</a> - <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entity">entity</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=start">start</a>);
<a class='l d2' name=342 href="#342">342</a>       }
<a class='l d2' name=343 href="#343">343</a>     }
<a class='l d2' name=344 href="#344">344</a> 
<a class='l d2' name=345 href="#345">345</a>     <span class='v'>return </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=text">text</a>;
<a class='l d2' name=346 href="#346">346</a>   },
<a class='l d2' name=347 href="#347">347</a>   <span class='a'>displayTweet</span>: <span class='v'>function(</span><span class='a'>aTweet</span>) {
<a class='l d2' name=348 href="#348">348</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=name">name</a> = <span class='a'>aTweet</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=user">user</a>.<span class='a'>screen_name</span>;
<a class='l d2' name=349 href="#349">349</a>     <span class='v'>this.</span><span class='a'>_ensureParticipantExists</span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=name">name</a>);
<a class='l d2' name=350 href="#350">350</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=text">text</a> = <span class='v'>this.</span><span class='a'>parseTweet</span>(<span class='a'>aTweet</span>);
<a class='l d2' name=351 href="#351">351</a> 
<a class='l d2' name=352 href="#352">352</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=flags">flags</a> =
<a class='l d2' name=353 href="#353">353</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=name">name</a> == <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=_account">_account</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=name">name</a> ? {<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=outgoing">outgoing</a>: <span class='v'>true} </span>: {<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=incoming">incoming</a>: <span class='v'>true};</span>
<a class='l d2' name=354 href="#354">354</a>     <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=flags">flags</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=time">time</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Math">Math</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=round">round</a>(<span class='v'>new </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Date">Date</a>(<span class='a'>aTweet</span>.<span class='a'>created_at</span>) / 1000);
<a class='l d2' name=355 href="#355">355</a>     <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=flags">flags</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=_iconURL">_iconURL</a> = <span class='a'>aTweet</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=user">user</a>.<span class='a'>profile_image_url</span>;
<a class='l d2' name=356 href="#356">356</a>     <span class='v'>if </span>(<span class='a'>aTweet</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=delayed">delayed</a>)
<a class='l d2' name=357 href="#357">357</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=flags">flags</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=delayed">delayed</a> = <span class='v'>true;</span>
<a class='l d2' name=358 href="#358">358</a>     <span class='v'>if </span>(<span class='a'>aTweet</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entities">entities</a> &amp;&amp; <span class='a'>aTweet</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entities">entities</a>.<span class='a'>user_mentions</span> &amp;&amp;
<a class='l d2' name=359 href="#359">359</a>         <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Array">Array</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=isArray">isArray</a>(<span class='a'>aTweet</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entities">entities</a>.<span class='a'>user_mentions</span>) &amp;&amp;
<a class='l d2' name=360 href="#360">360</a>         <span class='a'>aTweet</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=entities">entities</a>.<span class='a'>user_mentions</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=some">some</a>(<span class='a'>mention</span> =&gt; <span class='a'>mention</span>.<span class='a'>screen_name</span> == <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=nick">nick</a>))
<a class='l d2' name=361 href="#361">361</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=flags">flags</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=containsNick">containsNick</a> = <span class='v'>true;</span>
<a class='l d2' name=362 href="#362">362</a> 
<a class='l d2' name=363 href="#363">363</a>     (<span class='v'>new </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Tweet">Tweet</a>(<span class='a'>aTweet</span>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=name">name</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=text">text</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=flags">flags</a>)).<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=conversation">conversation</a> = <span class='v'>this;</span>
<a class='l d2' name=364 href="#364">364</a>   },
<a class='l d2' name=365 href="#365">365</a>   <span class='a'>_ensureParticipantExists</span>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aNick">aNick</a>) {
<a class='l d2' name=366 href="#366">366</a>     <span class='v'>if </span>(<span class='v'>this.</span><span class='a'>_participants</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=has">has</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aNick">aNick</a>))
<a class='l d2' name=367 href="#367">367</a>       <span class='v'>return;</span>
<a class='l d2' name=368 href="#368">368</a> 
<a class='l d2' name=369 href="#369">369</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=chatBuddy">chatBuddy</a> = <span class='v'>new </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=ChatBuddy">ChatBuddy</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aNick">aNick</a>, <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=_account">_account</a>);
<a class='l d2' name=370 href="#370">370</a>     <span class='v'>this.</span><span class='a'>_participants</span>.<span class='v'>set(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aNick">aNick</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=chatBuddy">chatBuddy</a>);
<a class='l d2' name=371 href="#371">371</a>     <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=notifyObservers">notifyObservers</a>(<span class='v'>new </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=nsSimpleEnumerator">nsSimpleEnumerator</a>([<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=chatBuddy">chatBuddy</a>]),
<a class='l d2' name=372 href="#372">372</a>                          <span class='s'>"chat-buddy-add"</span>);
<a class='l d2' name=373 href="#373">373</a>   },
<a class='l d2' name=374 href="#374">374</a>   <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=name">name</a>() { <span class='v'>return </span><span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=nick">nick</a> + <span class='s'>" timeline"</span>; },
<a class='l d2' name=375 href="#375">375</a>   <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=title">title</a>() { <span class='v'>return </span><span class='a'>_</span>(<span class='s'>"timeline"</span>, <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=nick">nick</a>); },
<a class='l d2' name=376 href="#376">376</a>   <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=nick">nick</a>() { <span class='v'>return </span><span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=_account">_account</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=name">name</a>; },
<a class='l d2' name=377 href="#377">377</a>   <span class='v'>set </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=nick">nick</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aNick">aNick</a>) {},
<a class='l d2' name=378 href="#378">378</a>   <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=topicSettable">topicSettable</a>() { <span class='v'>return </span><span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=nick">nick</a> == <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=_account">_account</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=name">name</a>; },
<a class='l d2' name=379 href="#379">379</a>   <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=topic">topic</a>() { <span class='v'>return </span><span class='v'>this.</span><span class='a'>_topic</span>; }, <span class='c'>// can't add a setter without redefining the getter</span>
<a class='l d2' name=380 href="#380">380</a> <span class='c'></span>  <span class='v'>set </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=topic">topic</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aTopic">aTopic</a>) {
<a class='l d2' name=381 href="#381">381</a>     <span class='v'>if </span>(<span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=topicSettable">topicSettable</a>)
<a class='l d2' name=382 href="#382">382</a>       <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=_account">_account</a>.<span class='a'>setUserDescription</span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aTopic">aTopic</a>);
<a class='l d2' name=383 href="#383">383</a>   }
<a class='l d2' name=384 href="#384">384</a> };
<a class='l d2' name=385 href="#385">385</a> 
<a class='l d2' name=386 href="#386">386</a> <span class='v'>function </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Account">Account</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aProtocol">aProtocol</a>, <span class='a'>aImAccount</span>)
<a class='l d2' name=387 href="#387">387</a> {
<a class='l d2' name=388 href="#388">388</a>   <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=_init">_init</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aProtocol">aProtocol</a>, <span class='a'>aImAccount</span>);
<a class='l d2' name=389 href="#389">389</a>   <span class='v'>this.</span><span class='a'>_knownMessageIds</span> = <span class='v'>new </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Set">Set</a>();
<a class='l d2' name=390 href="#390">390</a>   <span class='v'>this.</span><span class='a'>_userInfo</span> = <span class='v'>new </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Map">Map</a>();
<a class='l d2' name=391 href="#391">391</a>   <span class='v'>this.</span><span class='a'>_friends</span> = <span class='v'>new </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Set">Set</a>();
<a class='l d2' name=392 href="#392">392</a> }
<a class='l d2' name=393 href="#393">393</a> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Account">Account</a>.<span class='v'>prototype </span>= {
<a class='l d2' name=394 href="#394">394</a>   <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=__proto__">__proto__</a>: <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=GenericAccountPrototype">GenericAccountPrototype</a>,
<a class='l d2' name=395 href="#395">395</a> 
<a class='l d2' name=396 href="#396">396</a>   <span class='c'>// The correct normalization for twitter would be just toLowerCase().</span>
<a class='l d2' name=397 href="#397">397</a> <span class='c'></span>  <span class='c'>// Unfortunately, for backwards compatibility we retain this normalization,</span>
<a class='l d2' name=398 href="#398">398</a> <span class='c'></span>  <span class='c'>// which can cause edge cases for usernames with underscores.</span>
<a class='l d2' name=399 href="#399">399</a> <span class='c'></span>  <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=normalize">normalize</a>: <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aString">aString</a> =&gt; <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aString">aString</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=replace">replace</a>(/[^<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=a">a</a>-<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=z0">z0</a>-9]/<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=gi">gi</a>, <span class='s'>""</span>).<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=toLowerCase">toLowerCase</a>(),
<a class='l d2' name=400 href="#400">400</a> 
<a class='l d2' name=401 href="#401">401</a>   <span class='a'>consumerKey</span>: <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Services">Services</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=prefs">prefs</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=getCharPref">getCharPref</a>(<span class='s'>"chat.twitter.consumerKey"</span>),
<a class='l d2' name=402 href="#402">402</a>   <span class='a'>consumerSecret</span>: <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Services">Services</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=prefs">prefs</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=getCharPref">getCharPref</a>(<span class='s'>"chat.twitter.consumerSecret"</span>),
<a class='l d2' name=403 href="#403">403</a>   <span class='a'>completionURI</span>: <span class='s'>"http://oauthcallback.local/"</span>,
<a class='l d2' name=404 href="#404">404</a>   <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=baseURI">baseURI</a>: <span class='s'>"https://api.twitter.com/"</span>,
<a class='l d2' name=405 href="#405">405</a>   <span class='a'>_lastMsgId</span>: <span class='s'>""</span>,
<a class='l d2' name=406 href="#406">406</a> 
<a class='l d2' name=407 href="#407">407</a>   <span class='c'>// Use this to keep track of the pending timeline requests. We attempt to fetch</span>
<a class='l d2' name=408 href="#408">408</a> <span class='c'></span>  <span class='c'>// home_timeline, @ mentions and tracked keywords (i.e. 3 timelines)</span>
<a class='l d2' name=409 href="#409">409</a> <span class='c'></span>  <span class='a'>_pendingRequests</span>: [],
<a class='l d2' name=410 href="#410">410</a>   <span class='a'>_timelineBuffer</span>: [],
<a class='l d2' name=411 href="#411">411</a>   <span class='a'>_timelineAuthError</span>: 0,
<a class='l d2' name=412 href="#412">412</a> 
<a class='l d2' name=413 href="#413">413</a>   <span class='c'>// Twitter's current internal configuration, received in response to an API</span>
<a class='l d2' name=414 href="#414">414</a> <span class='c'></span>  <span class='c'>// call, see <a href="https://dev.twitter.com/docs/api/1.1/get/help/configuration.">https://dev.twitter.com/docs/api/1.1/get/help/configuration.</a></span>
<a class='l d2' name=415 href="#415">415</a> <span class='c'></span>  <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=config">config</a>: {
<a class='l d2' name=416 href="#416">416</a>     <span class='s'>"short_url_length_https"</span>: 23,
<a class='l d2' name=417 href="#417">417</a>     <span class='s'>"short_url_length"</span>: 22
<a class='l d2' name=418 href="#418">418</a>   },
<a class='l d2' name=419 href="#419">419</a> 
<a class='l d2' name=420 href="#420">420</a>   <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=token">token</a>: <span class='s'>""</span>,
<a class='l d2' name=421 href="#421">421</a>   <span class='a'>tokenSecret</span>: <span class='s'>""</span>,
<a class='l d2' name=422 href="#422">422</a>   <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=connect">connect</a>: <span class='v'>function(</span>) {
<a class='l d2' name=423 href="#423">423</a>     <span class='v'>if </span>(<span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=connected">connected</a> || <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=connecting">connecting</a>)
<a class='l d2' name=424 href="#424">424</a>       <span class='v'>return;</span>
<a class='l d2' name=425 href="#425">425</a> 
<a class='l d2' name=426 href="#426">426</a>     <span class='v'>this.</span><span class='a'>reportConnecting</span>();
<a class='l d2' name=427 href="#427">427</a> 
<a class='l d2' name=428 href="#428">428</a>     <span class='c'>// Read the OAuth token from the prefs</span>
<a class='l d2' name=429 href="#429">429</a> <span class='c'></span>    <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=prefValue">prefValue</a> = {};
<a class='l d2' name=430 href="#430">430</a>     <span class='v'>try </span>{
<a class='l d2' name=431 href="#431">431</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=prefValue">prefValue</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=JSON">JSON</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=parse">parse</a>(<span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=prefs">prefs</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=getCharPref">getCharPref</a>(<span class='s'>"oauth"</span>));
<a class='l d2' name=432 href="#432">432</a>     } <span class='v'>catch(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=e">e</a>) { }
<a class='l d2' name=433 href="#433">433</a>     <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=prefValue">prefValue</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=hasOwnProperty">hasOwnProperty</a>(<span class='v'>this.</span><span class='a'>consumerKey</span>)) {
<a class='l d2' name=434 href="#434">434</a>       <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=result">result</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=prefValue">prefValue</a>[<span class='v'>this.</span><span class='a'>consumerKey</span>];
<a class='l d2' name=435 href="#435">435</a>       <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=token">token</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=result">result</a>.<span class='a'>oauth_token</span>;
<a class='l d2' name=436 href="#436">436</a>       <span class='v'>this.</span><span class='a'>tokenSecret</span> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=result">result</a>.<span class='a'>oauth_token_secret</span>;
<a class='l d2' name=437 href="#437">437</a>       <span class='v'>if </span>(!<span class='v'>this.</span><span class='a'>fixAccountName</span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=result">result</a>))
<a class='l d2' name=438 href="#438">438</a>         <span class='v'>return;</span>
<a class='l d2' name=439 href="#439">439</a>     }
<a class='l d2' name=440 href="#440">440</a> 
<a class='l d2' name=441 href="#441">441</a>     <span class='c'>// Get a new token if needed...</span>
<a class='l d2' name=442 href="#442">442</a> <span class='c'></span>    <span class='v'>if </span>(!<span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=token">token</a> || !<span class='v'>this.</span><span class='a'>tokenSecret</span>) {
<a class='l d2' name=443 href="#443">443</a>       <span class='v'>this.</span><span class='a'>requestToken</span>();
<a class='l d2' name=444 href="#444">444</a>       <span class='v'>return;</span>
<a class='l d2' name=445 href="#445">445</a>     }
<a class='l d2' name=446 href="#446">446</a> 
<a class='l d2' name=447 href="#447">447</a>     <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=LOG">LOG</a>(<span class='s'>"Connecting using existing token"</span>);
<a class='l d2' name=448 href="#448">448</a>     <span class='v'>this.</span><span class='a'>getTimelines</span>();
<a class='l d2' name=449 href="#449">449</a> 
<a class='l d2' name=450 href="#450">450</a>     <span class='c'>// Request the Twitter API configuration.</span>
<a class='l d2' name=451 href="#451">451</a> <span class='c'></span>    <span class='v'>this.</span><span class='a'>signAndSend</span>(<span class='s'>"1.1/help/configuration.json"</span>, <span class='v'>null,</span> <span class='v'>null,</span>
<a class='l d2' name=452 href="#452">452</a>                      <span class='v'>this.</span><span class='a'>onConfigReceived</span>, <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=onError">onError</a>, <span class='v'>this)</span>;
<a class='l d2' name=453 href="#453">453</a>   },
<a class='l d2' name=454 href="#454">454</a> 
<a class='l d2' name=455 href="#455">455</a>   <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=observe">observe</a>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aSubject">aSubject</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aTopic">aTopic</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aMsg">aMsg</a>) {
<a class='l d2' name=456 href="#456">456</a>     <span class='c'>// Twitter doesn't broadcast the user's availability, so we can ignore</span>
<a class='l d2' name=457 href="#457">457</a> <span class='c'></span>    <span class='c'>// imIUserStatusInfo's status notifications.</span>
<a class='l d2' name=458 href="#458">458</a> <span class='c'></span>    <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aTopic">aTopic</a> != <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=NS_PREFBRANCH_PREFCHANGE_TOPIC_ID">NS_PREFBRANCH_PREFCHANGE_TOPIC_ID</a>)
<a class='l d2' name=459 href="#459">459</a>       <span class='v'>return;</span>
<a class='l d2' name=460 href="#460">460</a> 
<a class='l d2' name=461 href="#461">461</a>     <span class='c'>// Reopen the stream with the new tracked keywords.</span>
<a class='l d2' name=462 href="#462">462</a> <span class='c'></span>    <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=DEBUG">DEBUG</a>(<span class='s'>"Twitter tracked keywords modified: "</span> + <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=getString">getString</a>(<span class='s'>"track"</span>));
<a class='l d2' name=463 href="#463">463</a> 
<a class='l d2' name=464 href="#464">464</a>     <span class='c'>// Close the stream and reopen it.</span>
<a class='l d2' name=465 href="#465">465</a> <span class='c'></span>    <span class='v'>this.</span><span class='a'>_streamingRequest</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=abort">abort</a>();
<a class='l d2' name=466 href="#466">466</a>     <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=openStream">openStream</a>();
<a class='l d2' name=467 href="#467">467</a>   },
<a class='l d2' name=468 href="#468">468</a> 
<a class='l d2' name=469 href="#469">469</a>   <span class='a'>signAndSend</span>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aUrl">aUrl</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aHeaders">aHeaders</a>, <span class='a'>aPOSTData</span>, <span class='a'>aOnLoad</span>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aOnError">aOnError</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aThis">aThis</a>,
<a class='l d2' name=470 href="#470">470</a>                         <span class='a'>aOAuthParams</span>) {
<a class='l d2' name=471 href="#471">471</a>     <span class='a'>const</span> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=kChars">kChars</a> =
<a class='l d2' name=472 href="#472">472</a>       <span class='s'>"0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz"</span>;
<a class='l d2' name=473 href="#473">473</a>     <span class='a'>const</span> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=kNonceLength">kNonceLength</a> = 6;
<a class='l d2' name=474 href="#474">474</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=nonce">nonce</a> = <span class='s'>""</span>;
<a class='l d2' name=475 href="#475">475</a>     <span class='v'>for </span>(<span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=i">i</a> = 0; <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=i">i</a> &lt; <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=kNonceLength">kNonceLength</a>; ++<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=i">i</a>)
<a class='l d2' name=476 href="#476">476</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=nonce">nonce</a> += <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=kChars">kChars</a>[<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Math">Math</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=floor">floor</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Math">Math</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=random">random</a>() * <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=kChars">kChars</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=length">length</a>)];
<a class='l d2' name=477 href="#477">477</a> 
<a class='l d2' name=478 href="#478">478</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=params">params</a> = (<span class='a'>aOAuthParams</span> || []).<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=concat">concat</a>([
<a class='l d2' name=479 href="#479">479</a>       [<span class='s'>"oauth_consumer_key"</span>, <span class='v'>this.</span><span class='a'>consumerKey</span>],
<a class='l d2' name=480 href="#480">480</a>       [<span class='s'>"oauth_nonce"</span>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=nonce">nonce</a>],
<a class='l d2' name=481 href="#481">481</a>       [<span class='s'>"oauth_signature_method"</span>, <span class='s'>"HMAC-SHA1"</span>],
<a class='l d2' name=482 href="#482">482</a>       [<span class='s'>"oauth_token"</span>, <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=token">token</a>],
<a class='l d2' name=483 href="#483">483</a>       [<span class='s'>"oauth_timestamp"</span>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Math">Math</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=floor">floor</a>(((<span class='v'>new </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Date">Date</a>()).<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=getTime">getTime</a>()) / 1000)],
<a class='l d2' name=484 href="#484">484</a>       [<span class='s'>"oauth_version"</span>, <span class='s'>"1.0"</span>]
<a class='l d2' name=485 href="#485">485</a>     ]);
<a class='l d2' name=486 href="#486">486</a> 
<a class='l d2' name=487 href="#487">487</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=dataParams">dataParams</a> = [];
<a class='l d2' name=488 href="#488">488</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=url">url</a> = /^<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=https">https</a>?:/.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=test">test</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aUrl">aUrl</a>) ? <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aUrl">aUrl</a> : <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=baseURI">baseURI</a> + <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aUrl">aUrl</a>;
<a class='l d2' name=489 href="#489">489</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=urlSpec">urlSpec</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=url">url</a>;
<a class='l d2' name=490 href="#490">490</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=queryIndex">queryIndex</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=url">url</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=indexOf">indexOf</a>(<span class='s'>"?"</span>);
<a class='l d2' name=491 href="#491">491</a>     <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=queryIndex">queryIndex</a> != -1) {
<a class='l d2' name=492 href="#492">492</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=urlSpec">urlSpec</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=url">url</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=slice">slice</a>(0, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=queryIndex">queryIndex</a>);
<a class='l d2' name=493 href="#493">493</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=dataParams">dataParams</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=url">url</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=slice">slice</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=queryIndex">queryIndex</a> + 1).<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=split">split</a>(<span class='s'>"&amp;"</span>)
<a class='l d2' name=494 href="#494">494</a>                       .<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=map">map</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=p">p</a> =&gt; <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=p">p</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=split">split</a>(<span class='s'>"="</span>).<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=map">map</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=percentEncode">percentEncode</a>));
<a class='l d2' name=495 href="#495">495</a>     }
<a class='l d2' name=496 href="#496">496</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=method">method</a> = <span class='s'>"GET"</span>;
<a class='l d2' name=497 href="#497">497</a>     <span class='v'>if </span>(<span class='a'>aPOSTData</span>) {
<a class='l d2' name=498 href="#498">498</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=method">method</a> = <span class='s'>"POST"</span>;
<a class='l d2' name=499 href="#499">499</a>       <span class='a'>aPOSTData</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=forEach">forEach</a>(<span class='v'>function </span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=p">p</a>) {
<a class='l d2' name=500 href="#500">500</a>         <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=dataParams">dataParams</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=push">push</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=p">p</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=map">map</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=percentEncode">percentEncode</a>));
<a class='l d2' name=501 href="#501">501</a>       });
<a class='l d2' name=502 href="#502">502</a>     }
<a class='l d2' name=503 href="#503">503</a> 
<a class='l d2' name=504 href="#504">504</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=signatureKey">signatureKey</a> = <span class='v'>this.</span><span class='a'>consumerSecret</span> + <span class='s'>"&amp;"</span> + <span class='v'>this.</span><span class='a'>tokenSecret</span>;
<a class='l d2' name=505 href="#505">505</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=signatureBase">signatureBase</a> =
<a class='l d2' name=506 href="#506">506</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=method">method</a> + <span class='s'>"&amp;"</span> + <span class='a'>encodeURIComponent</span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=urlSpec">urlSpec</a>) + <span class='s'>"&amp;"</span> +
<a class='l d2' name=507 href="#507">507</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=params">params</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=concat">concat</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=dataParams">dataParams</a>)
<a class='l d2' name=508 href="#508">508</a>             .<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=sort">sort</a>((<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=a">a</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=b">b</a>) =&gt; (<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=a">a</a>[0] &lt; <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=b">b</a>[0]) ? -1 : (<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=a">a</a>[0] &gt; <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=b">b</a>[0]) ? 1 : 0)
<a class='l d2' name=509 href="#509">509</a>             .<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=map">map</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=p">p</a> =&gt; <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=p">p</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=map">map</a>(<span class='a'>encodeURIComponent</span>).<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=join">join</a>(<span class='s'>"%3D"</span>))
<a class='l d2' name=510 href="#510">510</a>             .<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=join">join</a>(<span class='s'>"%26"</span>);
<a class='l d2' name=511 href="#511">511</a> 
<a class='l d2' name=512 href="#512">512</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=keyFactory">keyFactory</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Cc">Cc</a>[<span class='s'>"@mozilla.org/security/keyobjectfactory;1"</span>]
<a class='l d2' name=513 href="#513">513</a>                      .<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=getService">getService</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Ci">Ci</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=nsIKeyObjectFactory">nsIKeyObjectFactory</a>);
<a class='l d2' name=514 href="#514">514</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=hmac">hmac</a> =
<a class='l d2' name=515 href="#515">515</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Cc">Cc</a>[<span class='s'>"@mozilla.org/security/hmac;1"</span>].<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=createInstance">createInstance</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Ci">Ci</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=nsICryptoHMAC">nsICryptoHMAC</a>);
<a class='l d2' name=516 href="#516">516</a>     <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=hmac">hmac</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=init">init</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=hmac">hmac</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=SHA1">SHA1</a>,
<a class='l d2' name=517 href="#517">517</a>               <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=keyFactory">keyFactory</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=keyFromString">keyFromString</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Ci">Ci</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=nsIKeyObject">nsIKeyObject</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=HMAC">HMAC</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=signatureKey">signatureKey</a>));
<a class='l d2' name=518 href="#518">518</a>     <span class='c'>// No UTF-8 encoding, special chars are already escaped.</span>
<a class='l d2' name=519 href="#519">519</a> <span class='c'></span>    <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=bytes">bytes</a> = [...<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=signatureBase">signatureBase</a>].<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=map">map</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=b">b</a> =&gt; <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=b">b</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=charCodeAt">charCodeAt</a>());
<a class='l d2' name=520 href="#520">520</a>     <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=hmac">hmac</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=update">update</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=bytes">bytes</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=bytes">bytes</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=length">length</a>);
<a class='l d2' name=521 href="#521">521</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=signature">signature</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=hmac">hmac</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=finish">finish</a>(<span class='v'>true)</span>;
<a class='l d2' name=522 href="#522">522</a> 
<a class='l d2' name=523 href="#523">523</a>     <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=params">params</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=push">push</a>([<span class='s'>"oauth_signature"</span>, <span class='a'>encodeURIComponent</span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=signature">signature</a>)]);
<a class='l d2' name=524 href="#524">524</a> 
<a class='l d2' name=525 href="#525">525</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=authorization">authorization</a> =
<a class='l d2' name=526 href="#526">526</a>       <span class='s'>"OAuth "</span> + <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=params">params</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=map">map</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=p">p</a> =&gt; <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=p">p</a>[0] + <span class='s'>"=\""</span> + <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=p">p</a>[1] + <span class='s'>"\""</span>).<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=join">join</a>(<span class='s'>", "</span>);
<a class='l d2' name=527 href="#527">527</a> 
<a class='l d2' name=528 href="#528">528</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=options">options</a> = {
<a class='l d2' name=529 href="#529">529</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=headers">headers</a>: (<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aHeaders">aHeaders</a> || []).<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=concat">concat</a>([[<span class='s'>"Authorization"</span>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=authorization">authorization</a>]]),
<a class='l d2' name=530 href="#530">530</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=postData">postData</a>: <span class='a'>aPOSTData</span>,
<a class='l d2' name=531 href="#531">531</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=onLoad">onLoad</a>: <span class='a'>aOnLoad</span> ? <span class='a'>aOnLoad</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=bind">bind</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aThis">aThis</a>) : <span class='v'>null,</span>
<a class='l d2' name=532 href="#532">532</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=onError">onError</a>: <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aOnError">aOnError</a> ? <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aOnError">aOnError</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=bind">bind</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aThis">aThis</a>) : <span class='v'>null,</span>
<a class='l d2' name=533 href="#533">533</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=logger">logger</a>: {<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=log">log</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=LOG">LOG</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=bind">bind</a>(<span class='v'>this)</span>,
<a class='l d2' name=534 href="#534">534</a>                <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=debug">debug</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=DEBUG">DEBUG</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=bind">bind</a>(<span class='v'>this)</span>}
<a class='l d2' name=535 href="#535">535</a>     }
<a class='l d2' name=536 href="#536">536</a>     <span class='v'>return </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=httpRequest">httpRequest</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=url">url</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=options">options</a>);
<a class='l d2' name=537 href="#537">537</a>   },
<a class='l d2' name=538 href="#538">538</a>   <span class='a'>_parseURLData</span>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aData">aData</a>) {
<a class='l d2' name=539 href="#539">539</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=result">result</a> = {};
<a class='l d2' name=540 href="#540">540</a>     <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aData">aData</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=split">split</a>(<span class='s'>"&amp;"</span>).<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=forEach">forEach</a>(<span class='v'>function </span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aParam">aParam</a>) {
<a class='l d2' name=541 href="#541">541</a>       <span class='v'>let </span>[<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=key">key</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=value">value</a>] = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aParam">aParam</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=split">split</a>(<span class='s'>"="</span>);
<a class='l d2' name=542 href="#542">542</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=result">result</a>[<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=key">key</a>] = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=value">value</a>;
<a class='l d2' name=543 href="#543">543</a>     });
<a class='l d2' name=544 href="#544">544</a>     <span class='v'>return </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=result">result</a>;
<a class='l d2' name=545 href="#545">545</a>   },
<a class='l d2' name=546 href="#546">546</a> 
<a class='l d2' name=547 href="#547">547</a>   <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=tweet">tweet</a>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aMsg">aMsg</a>, <span class='a'>aInReplyToId</span>, <span class='a'>aOnSent</span>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aOnError">aOnError</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aThis">aThis</a>) {
<a class='l d2' name=548 href="#548">548</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=POSTData">POSTData</a> = [[<span class='s'>"status"</span>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aMsg">aMsg</a>]];
<a class='l d2' name=549 href="#549">549</a>     <span class='v'>if </span>(<span class='a'>aInReplyToId</span>)
<a class='l d2' name=550 href="#550">550</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=POSTData">POSTData</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=push">push</a>([<span class='s'>"in_reply_to_status_id"</span>, <span class='a'>aInReplyToId</span>]);
<a class='l d2' name=551 href="#551">551</a>     <span class='v'>this.</span><span class='a'>signAndSend</span>(<span class='s'>"1.1/statuses/update.json"</span>, <span class='v'>null,</span> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=POSTData">POSTData</a>, <span class='a'>aOnSent</span>,
<a class='l d2' name=552 href="#552">552</a>                      <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aOnError">aOnError</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aThis">aThis</a>);
<a class='l d2' name=553 href="#553">553</a>   },
<a class='l d2' name=554 href="#554">554</a>   <span class='a'>reTweet</span>: <span class='v'>function(</span><span class='a'>aTweet</span>, <span class='a'>aOnSent</span>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aOnError">aOnError</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aThis">aThis</a>) {
<a class='l d2' name=555 href="#555">555</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=url">url</a> = <span class='s'>"1.1/statuses/retweet/"</span> + <span class='a'>aTweet</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=id_str">id_str</a> + <span class='s'>".json"</span>;
<a class='l d2' name=556 href="#556">556</a>     <span class='v'>this.</span><span class='a'>signAndSend</span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=url">url</a>, <span class='v'>null,</span> [], <span class='a'>aOnSent</span>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aOnError">aOnError</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aThis">aThis</a>);
<a class='l d2' name=557 href="#557">557</a>   },
<a class='l d2' name=558 href="#558">558</a>   <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=destroy">destroy</a>: <span class='v'>function(</span><span class='a'>aTweet</span>, <span class='a'>aOnSent</span>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aOnError">aOnError</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aThis">aThis</a>) {
<a class='l d2' name=559 href="#559">559</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=url">url</a> = <span class='s'>"1.1/statuses/destroy/"</span> + <span class='a'>aTweet</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=id_str">id_str</a> + <span class='s'>".json"</span>;
<a class='l d2' name=560 href="#560">560</a>     <span class='v'>this.</span><span class='a'>signAndSend</span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=url">url</a>, <span class='v'>null,</span> [], <span class='a'>aOnSent</span>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aOnError">aOnError</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aThis">aThis</a>);
<a class='l d2' name=561 href="#561">561</a>   },
<a class='l d2' name=562 href="#562">562</a> 
<a class='l d2' name=563 href="#563">563</a>   <span class='a'>_friends</span>: <span class='v'>null,</span>
<a class='l d2' name=564 href="#564">564</a>   <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=follow">follow</a>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aUserName">aUserName</a>) {
<a class='l d2' name=565 href="#565">565</a>     <span class='v'>this.</span><span class='a'>signAndSend</span>(<span class='s'>"1.1/friendships/create.json"</span>, <span class='v'>null,</span>
<a class='l d2' name=566 href="#566">566</a>                      [[<span class='s'>"screen_name"</span>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aUserName">aUserName</a>]]);
<a class='l d2' name=567 href="#567">567</a>   },
<a class='l d2' name=568 href="#568">568</a>   <span class='a'>stopFollowing</span>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aUserName">aUserName</a>) {
<a class='l d2' name=569 href="#569">569</a>     <span class='c'>// friendships/destroy will return the user in case of success.</span>
<a class='l d2' name=570 href="#570">570</a> <span class='c'></span>    <span class='c'>// Error cases would return a non 200 HTTP code and not call our callback.</span>
<a class='l d2' name=571 href="#571">571</a> <span class='c'></span>    <span class='v'>this.</span><span class='a'>signAndSend</span>(<span class='s'>"1.1/friendships/destroy.json"</span>, <span class='v'>null,</span>
<a class='l d2' name=572 href="#572">572</a>                      [[<span class='s'>"screen_name"</span>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aUserName">aUserName</a>]], <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aData">aData</a>, <span class='a'>aXHR</span>) {
<a class='l d2' name=573 href="#573">573</a>       <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=user">user</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=JSON">JSON</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=parse">parse</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aData">aData</a>);
<a class='l d2' name=574 href="#574">574</a>       <span class='v'>if </span>(!(<span class='s'>"id_str"</span> <span class='a'>in</span> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=user">user</a>))
<a class='l d2' name=575 href="#575">575</a>         <span class='v'>return;</span> <span class='c'>// Unexpected response...</span>
<a class='l d2' name=576 href="#576">576</a> <span class='c'></span>      <span class='v'>this.</span><span class='a'>_friends</span>.<span class='v'>delete(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=user">user</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=id_str">id_str</a>);
<a class='l d2' name=577 href="#577">577</a>       <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=timeline">timeline</a>.<span class='a'>removeParticipant</span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=user">user</a>.<span class='a'>screen_name</span>);
<a class='l d2' name=578 href="#578">578</a>       <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=date">date</a> = <span class='a'>aXHR</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=getResponseHeader">getResponseHeader</a>(<span class='s'>"Date"</span>);
<a class='l d2' name=579 href="#579">579</a>       <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=timeline">timeline</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=systemMessage">systemMessage</a>(<span class='a'>_</span>(<span class='s'>"event.unfollow"</span>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=user">user</a>.<span class='a'>screen_name</span>), <span class='v'>false,
<a class='l d2' name=580 href="#580">580</a> </span>                                  <span class='v'>new </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Date">Date</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=date">date</a>) / 1000);
<a class='l d2' name=581 href="#581">581</a>     }, <span class='v'>null,</span> <span class='v'>this)</span>;
<a class='l d2' name=582 href="#582">582</a>   },
<a class='l d2' name=583 href="#583">583</a>   <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=addBuddy">addBuddy</a>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aTag">aTag</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aName">aName</a>) {
<a class='l d2' name=584 href="#584">584</a>     <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=follow">follow</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aName">aName</a>);
<a class='l d2' name=585 href="#585">585</a>   },
<a class='l d2' name=586 href="#586">586</a> 
<a class='l d2' name=587 href="#587">587</a>   <span class='a'>getTimelines</span>: <span class='v'>function(</span>) {
<a class='l d2' name=588 href="#588">588</a>     <span class='v'>this.</span><span class='a'>reportConnecting</span>(<span class='a'>_</span>(<span class='s'>"connection.requestTimelines"</span>));
<a class='l d2' name=589 href="#589">589</a> 
<a class='l d2' name=590 href="#590">590</a>     <span class='c'>// If we have a last known message ID, append it as a get parameter.</span>
<a class='l d2' name=591 href="#591">591</a> <span class='c'></span>    <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=lastMsgParam">lastMsgParam</a> = <span class='s'>""</span>;
<a class='l d2' name=592 href="#592">592</a>     <span class='v'>if </span>(<span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=prefs">prefs</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=prefHasUserValue">prefHasUserValue</a>(<span class='s'>"lastMessageId"</span>)) {
<a class='l d2' name=593 href="#593">593</a>       <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=lastMsgId">lastMsgId</a> = <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=prefs">prefs</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=getCharPref">getCharPref</a>(<span class='s'>"lastMessageId"</span>);
<a class='l d2' name=594 href="#594">594</a>       <span class='c'>// Check that the ID is made up of all digits, otherwise the server will</span>
<a class='l d2' name=595 href="#595">595</a> <span class='c'></span>      <span class='c'>// croak on our request.</span>
<a class='l d2' name=596 href="#596">596</a> <span class='c'></span>      <span class='v'>if </span>(/^\<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=d">d</a>+$/.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=test">test</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=lastMsgId">lastMsgId</a>)) {
<a class='l d2' name=597 href="#597">597</a>         <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=lastMsgParam">lastMsgParam</a> = <span class='s'>"&amp;since_id="</span> + <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=lastMsgId">lastMsgId</a>;
<a class='l d2' name=598 href="#598">598</a>         <span class='v'>this.</span><span class='a'>_lastMsgId</span> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=lastMsgId">lastMsgId</a>;
<a class='l d2' name=599 href="#599">599</a>       }
<a class='l d2' name=600 href="#600">600</a>       <span class='v'>else
<a class='l d2' name=601 href="#601">601</a> </span>        <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=WARN">WARN</a>(<span class='s'>"invalid value for the lastMessageId preference: "</span> + <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=lastMsgId">lastMsgId</a>);
<a class='l d2' name=602 href="#602">602</a>     }
<a class='l d2' name=603 href="#603">603</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=getParams">getParams</a> = <span class='s'>"?count=200"</span> + <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=lastMsgParam">lastMsgParam</a>;
<a class='l d2' name=604 href="#604">604</a>     <span class='v'>this.</span><span class='a'>_pendingRequests</span> = [
<a class='l d2' name=605 href="#605">605</a>       <span class='v'>this.</span><span class='a'>signAndSend</span>(<span class='s'>"1.1/statuses/home_timeline.json"</span> + <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=getParams">getParams</a>, <span class='v'>null,</span>
<a class='l d2' name=606 href="#606">606</a>                        <span class='v'>null,</span> <span class='v'>this.</span><span class='a'>onTimelineReceived</span>, <span class='v'>this.</span><span class='a'>onTimelineError</span>,
<a class='l d2' name=607 href="#607">607</a>                        <span class='v'>this)</span>,
<a class='l d2' name=608 href="#608">608</a>       <span class='v'>this.</span><span class='a'>signAndSend</span>(<span class='s'>"1.1/statuses/mentions_timeline.json"</span> + <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=getParams">getParams</a>, <span class='v'>null,</span>
<a class='l d2' name=609 href="#609">609</a>                        <span class='v'>null,</span> <span class='v'>this.</span><span class='a'>onTimelineReceived</span>, <span class='v'>this.</span><span class='a'>onTimelineError</span>,
<a class='l d2' name=610 href="#610">610</a>                        <span class='v'>this)</span>
<a class='l d2' name=611 href="#611">611</a>     ];
<a class='l d2' name=612 href="#612">612</a> 
<a class='l d2' name=613 href="#613">613</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=track">track</a> = <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=getString">getString</a>(<span class='s'>"track"</span>);
<a class='l d2' name=614 href="#614">614</a>     <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=track">track</a>) {
<a class='l d2' name=615 href="#615">615</a>       <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=trackQuery">trackQuery</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=track">track</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=split">split</a>(<span class='s'>","</span>).<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=map">map</a>(<span class='a'>encodeURIComponent</span>).<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=join">join</a>(<span class='s'>" OR "</span>);
<a class='l d2' name=616 href="#616">616</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=getParams">getParams</a> = <span class='s'>"?q="</span> + <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=trackQuery">trackQuery</a> + <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=lastMsgParam">lastMsgParam</a> + <span class='s'>"&amp;count=100"</span>;
<a class='l d2' name=617 href="#617">617</a>       <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=url">url</a> = <span class='s'>"1.1/search/tweets.json"</span> + <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=getParams">getParams</a>;
<a class='l d2' name=618 href="#618">618</a>       <span class='v'>this.</span><span class='a'>_pendingRequests</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=push">push</a>(
<a class='l d2' name=619 href="#619">619</a>         <span class='v'>this.</span><span class='a'>signAndSend</span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=url">url</a>, <span class='v'>null,</span> <span class='v'>null,</span> <span class='v'>this.</span><span class='a'>onTimelineReceived</span>,
<a class='l d2' name=620 href="#620">620</a>                          <span class='v'>this.</span><span class='a'>onTimelineError</span>, <span class='v'>this,</span> <span class='v'>null)</span>);
<a class='l d2' name=621 href="#621">621</a>     }
<a class='l d2' name=622 href="#622">622</a>   },
<a class='l d2' name=623 href="#623">623</a> 
<a class='l d2' name=624 href="#624">624</a>   <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=timeline">timeline</a>() { <span class='v'>return </span><span class='v'>this.</span><span class='a'>_timeline</span> || (<span class='v'>this.</span><span class='a'>_timeline</span> = <span class='v'>new </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Conversation">Conversation</a>(<span class='v'>this)</span>); },
<a class='l d2' name=625 href="#625">625</a>   <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=displayMessages">displayMessages</a>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aMessages">aMessages</a>) {
<a class='l d2' name=626 href="#626">626</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=lastMsgId">lastMsgId</a> = <span class='v'>this.</span><span class='a'>_lastMsgId</span>;
<a class='l d2' name=627 href="#627">627</a>     <span class='v'>for </span>(<span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=tweet">tweet</a> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=of">of</a> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aMessages">aMessages</a>) {
<a class='l d2' name=628 href="#628">628</a>       <span class='v'>if </span>(!(<span class='s'>"user"</span> <span class='a'>in</span> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=tweet">tweet</a>) || !(<span class='s'>"text"</span> <span class='a'>in</span> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=tweet">tweet</a>) || !(<span class='s'>"id_str"</span> <span class='a'>in</span> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=tweet">tweet</a>) ||
<a class='l d2' name=629 href="#629">629</a>           <span class='v'>this.</span><span class='a'>_knownMessageIds</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=has">has</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=tweet">tweet</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=id_str">id_str</a>))
<a class='l d2' name=630 href="#630">630</a>         <span class='v'>continue;
<a class='l d2' name=631 href="#631">631</a> </span>      <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=id">id</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=tweet">tweet</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=id_str">id_str</a>;
<a class='l d2' name=632 href="#632">632</a>       <span class='c'>// Update the last known message.</span>
<a class='l d2' name=633 href="#633">633</a> <span class='c'></span>      <span class='c'>// Compare the length of the ids first, and then the text.</span>
<a class='l d2' name=634 href="#634">634</a> <span class='c'></span>      <span class='c'>// This avoids converting tweet ids into rounded numbers.</span>
<a class='l d2' name=635 href="#635">635</a> <span class='c'></span>      <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=id">id</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=length">length</a> &gt; <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=lastMsgId">lastMsgId</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=length">length</a> ||
<a class='l d2' name=636 href="#636">636</a>           (<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=id">id</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=length">length</a> == <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=lastMsgId">lastMsgId</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=length">length</a> &amp;&amp; <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=id">id</a> &gt; <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=lastMsgId">lastMsgId</a>))
<a class='l d2' name=637 href="#637">637</a>         <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=lastMsgId">lastMsgId</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=id">id</a>;
<a class='l d2' name=638 href="#638">638</a>       <span class='v'>this.</span><span class='a'>_knownMessageIds</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=add">add</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=id">id</a>);
<a class='l d2' name=639 href="#639">639</a>       <span class='v'>this.</span><span class='a'>setUserInfo</span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=tweet">tweet</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=user">user</a>);
<a class='l d2' name=640 href="#640">640</a>       <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=timeline">timeline</a>.<span class='a'>displayTweet</span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=tweet">tweet</a>);
<a class='l d2' name=641 href="#641">641</a>     }
<a class='l d2' name=642 href="#642">642</a>     <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=lastMsgId">lastMsgId</a> != <span class='v'>this.</span><span class='a'>_lastMsgId</span>) {
<a class='l d2' name=643 href="#643">643</a>       <span class='v'>this.</span><span class='a'>_lastMsgId</span> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=lastMsgId">lastMsgId</a>;
<a class='l d2' name=644 href="#644">644</a>       <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=prefs">prefs</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=setCharPref">setCharPref</a>(<span class='s'>"lastMessageId"</span>, <span class='v'>this.</span><span class='a'>_lastMsgId</span>);
<a class='l d2' name=645 href="#645">645</a>     }
<a class='l d2' name=646 href="#646">646</a>   },
<a class='l d2' name=647 href="#647">647</a> 
<a class='l d2' name=648 href="#648">648</a>   <span class='a'>onTimelineError</span>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aError">aError</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aResponseText">aResponseText</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aRequest">aRequest</a>) {
<a class='l d2' name=649 href="#649">649</a>     <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=ERROR">ERROR</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aError">aError</a>);
<a class='l d2' name=650 href="#650">650</a>     <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aRequest">aRequest</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=status">status</a> == 401)
<a class='l d2' name=651 href="#651">651</a>       ++<span class='v'>this.</span><span class='a'>_timelineAuthError</span>;
<a class='l d2' name=652 href="#652">652</a>     <span class='v'>this.</span><span class='a'>_doneWithTimelineRequest</span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aRequest">aRequest</a>);
<a class='l d2' name=653 href="#653">653</a>   },
<a class='l d2' name=654 href="#654">654</a> 
<a class='l d2' name=655 href="#655">655</a>   <span class='a'>onTimelineReceived</span>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aData">aData</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aRequest">aRequest</a>) {
<a class='l d2' name=656 href="#656">656</a>     <span class='v'>this.</span><span class='a'>_timelineBuffer</span> = <span class='v'>this.</span><span class='a'>_timelineBuffer</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=concat">concat</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=JSON">JSON</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=parse">parse</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aData">aData</a>));
<a class='l d2' name=657 href="#657">657</a>     <span class='v'>this.</span><span class='a'>_doneWithTimelineRequest</span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aRequest">aRequest</a>);
<a class='l d2' name=658 href="#658">658</a>   },
<a class='l d2' name=659 href="#659">659</a> 
<a class='l d2' name=660 href="#660">660</a>   <span class='a'>_doneWithTimelineRequest</span>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aRequest">aRequest</a>) {
<a class='l d2' name=661 href="#661">661</a>     <span class='v'>this.</span><span class='a'>_pendingRequests</span> =
<a class='l d2' name=662 href="#662">662</a>       <span class='v'>this.</span><span class='a'>_pendingRequests</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=filter">filter</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=r">r</a> =&gt; <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=r">r</a> !== <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aRequest">aRequest</a>);
<a class='l d2' name=663 href="#663">663</a> 
<a class='l d2' name=664 href="#664">664</a>     <span class='c'>// If we are still waiting for more data, return early</span>
<a class='l d2' name=665 href="#665">665</a> <span class='c'></span>    <span class='v'>if </span>(<span class='v'>this.</span><span class='a'>_pendingRequests</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=length">length</a> != 0)
<a class='l d2' name=666 href="#666">666</a>       <span class='v'>return;</span>
<a class='l d2' name=667 href="#667">667</a> 
<a class='l d2' name=668 href="#668">668</a>     <span class='v'>if </span>(<span class='v'>this.</span><span class='a'>_timelineAuthError</span> &gt;= 2) {
<a class='l d2' name=669 href="#669">669</a>       <span class='c'>// 2 out of the 3 timeline requests are authenticated.</span>
<a class='l d2' name=670 href="#670">670</a> <span class='c'></span>      <span class='c'>// With at least 2 '401 - Unauthorized' errors, we are sure</span>
<a class='l d2' name=671 href="#671">671</a> <span class='c'></span>      <span class='c'>// that our OAuth token is consistently rejected.</span>
<a class='l d2' name=672 href="#672">672</a> <span class='c'></span>      <span class='v'>delete </span><span class='v'>this.</span><span class='a'>_timelineAuthError</span>;
<a class='l d2' name=673 href="#673">673</a>       <span class='v'>delete </span><span class='v'>this.</span><span class='a'>_timelineBuffer</span>;
<a class='l d2' name=674 href="#674">674</a>       <span class='v'>delete </span><span class='v'>this.</span><span class='a'>_pendingRequests</span>;
<a class='l d2' name=675 href="#675">675</a>       <span class='v'>delete </span><span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=token">token</a>;
<a class='l d2' name=676 href="#676">676</a>       <span class='v'>delete </span><span class='v'>this.</span><span class='a'>tokenSecret</span>;
<a class='l d2' name=677 href="#677">677</a>       <span class='v'>this.</span><span class='a'>requestToken</span>();
<a class='l d2' name=678 href="#678">678</a>       <span class='v'>return;</span>
<a class='l d2' name=679 href="#679">679</a>     }
<a class='l d2' name=680 href="#680">680</a> 
<a class='l d2' name=681 href="#681">681</a>     <span class='c'>// Less than 2 auth errors is probably just some flakiness of the</span>
<a class='l d2' name=682 href="#682">682</a> <span class='c'></span>    <span class='c'>// twitter servers, ignore and reset this._timelineAuthError.</span>
<a class='l d2' name=683 href="#683">683</a> <span class='c'></span>    <span class='v'>if </span>(<span class='v'>this.</span><span class='a'>_timelineAuthError</span>)
<a class='l d2' name=684 href="#684">684</a>       <span class='v'>delete </span><span class='v'>this.</span><span class='a'>_timelineAuthError</span>;
<a class='l d2' name=685 href="#685">685</a> 
<a class='l d2' name=686 href="#686">686</a>     <span class='v'>this.</span><span class='a'>reportConnected</span>();
<a class='l d2' name=687 href="#687">687</a> 
<a class='l d2' name=688 href="#688">688</a>     <span class='c'>// If the conversation already exists, notify it we are back online.</span>
<a class='l d2' name=689 href="#689">689</a> <span class='c'></span>    <span class='v'>if </span>(<span class='v'>this.</span><span class='a'>_timeline</span>)
<a class='l d2' name=690 href="#690">690</a>       <span class='v'>this.</span><span class='a'>_timeline</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=notifyObservers">notifyObservers</a>(<span class='v'>this.</span><span class='a'>_timeline</span>, <span class='s'>"update-buddy-status"</span>);
<a class='l d2' name=691 href="#691">691</a> 
<a class='l d2' name=692 href="#692">692</a>     <span class='v'>this.</span><span class='a'>_timelineBuffer</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=sort">sort</a>(<span class='v'>this.</span><span class='a'>sortByDate</span>);
<a class='l d2' name=693 href="#693">693</a>     <span class='v'>this.</span><span class='a'>_timelineBuffer</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=forEach">forEach</a>(<span class='a'>aTweet</span> =&gt; <span class='a'>aTweet</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=delayed">delayed</a> = <span class='v'>true)</span>;
<a class='l d2' name=694 href="#694">694</a>     <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=displayMessages">displayMessages</a>(<span class='v'>this.</span><span class='a'>_timelineBuffer</span>);
<a class='l d2' name=695 href="#695">695</a> 
<a class='l d2' name=696 href="#696">696</a>     <span class='c'>// Fetch userInfo for the user if we don't already have it.</span>
<a class='l d2' name=697 href="#697">697</a> <span class='c'></span>    <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=requestBuddyInfo">requestBuddyInfo</a>(<span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=name">name</a>);
<a class='l d2' name=698 href="#698">698</a> 
<a class='l d2' name=699 href="#699">699</a>     <span class='c'>// Reset in case we get disconnected</span>
<a class='l d2' name=700 href="#700">700</a> <span class='c'></span>    <span class='v'>delete </span><span class='v'>this.</span><span class='a'>_timelineBuffer</span>;
<a class='l d2' name=701 href="#701">701</a>     <span class='v'>delete </span><span class='v'>this.</span><span class='a'>_pendingRequests</span>;
<a class='l d2' name=702 href="#702">702</a> 
<a class='l d2' name=703 href="#703">703</a>     <span class='c'>// Open the streams to get the live data.</span>
<a class='l d2' name=704 href="#704">704</a> <span class='c'></span>    <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=openStream">openStream</a>();
<a class='l d2' name=705 href="#705">705</a>   },
<a class='l d2' name=706 href="#706">706</a> 
<a class='l d2' name=707 href="#707">707</a>   <span class='a'>sortByDate</span>: (<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=a">a</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=b">b</a>) =&gt;
<a class='l d2' name=708 href="#708">708</a>     (<span class='v'>new </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Date">Date</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=a">a</a>[<span class='s'>"created_at"</span>])) - (<span class='v'>new </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Date">Date</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=b">b</a>[<span class='s'>"created_at"</span>])),
<a class='l d2' name=709 href="#709">709</a> 
<a class='l d2' name=710 href="#710">710</a>   <span class='a'>_streamingRequest</span>: <span class='v'>null,</span>
<a class='l d2' name=711 href="#711">711</a>   <span class='a'>_pendingData</span>: <span class='s'>""</span>,
<a class='l d2' name=712 href="#712">712</a>   <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=openStream">openStream</a>: <span class='v'>function(</span>) {
<a class='l d2' name=713 href="#713">713</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=track">track</a> = <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=getString">getString</a>(<span class='s'>"track"</span>);
<a class='l d2' name=714 href="#714">714</a>     <span class='v'>this.</span><span class='a'>_streamingRequest</span> =
<a class='l d2' name=715 href="#715">715</a>       <span class='v'>this.</span><span class='a'>signAndSend</span>(<span class='s'>"https://userstream.twitter.com/1.1/user.json"</span>, <span class='v'>null,</span>
<a class='l d2' name=716 href="#716">716</a>                        <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=track">track</a> ? [[<span class='s'>"track"</span>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=track">track</a>]] : [], <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=openStream">openStream</a>,
<a class='l d2' name=717 href="#717">717</a>                        <span class='v'>this.</span><span class='a'>onStreamError</span>, <span class='v'>this)</span>;
<a class='l d2' name=718 href="#718">718</a>     <span class='v'>this.</span><span class='a'>_streamingRequest</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=responseType">responseType</a> = <span class='s'>"moz-chunked-text"</span>;
<a class='l d2' name=719 href="#719">719</a>     <span class='v'>this.</span><span class='a'>_streamingRequest</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=onprogress">onprogress</a> = <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=onDataAvailable">onDataAvailable</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=bind">bind</a>(<span class='v'>this)</span>;
<a class='l d2' name=720 href="#720">720</a>     <span class='v'>this.</span><span class='a'>resetStreamTimeout</span>();
<a class='l d2' name=721 href="#721">721</a>     <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=prefs">prefs</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=addObserver">addObserver</a>(<span class='s'>"track"</span>, <span class='v'>this,</span> <span class='v'>false)</span>;
<a class='l d2' name=722 href="#722">722</a>   },
<a class='l d2' name=723 href="#723">723</a>   <span class='a'>_streamTimeout</span>: <span class='v'>null,</span>
<a class='l d2' name=724 href="#724">724</a>   <span class='a'>resetStreamTimeout</span>: <span class='v'>function(</span>) {
<a class='l d2' name=725 href="#725">725</a>     <span class='v'>if </span>(<span class='v'>this.</span><span class='a'>_streamTimeout</span>)
<a class='l d2' name=726 href="#726">726</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=clearTimeout">clearTimeout</a>(<span class='v'>this.</span><span class='a'>_streamTimeout</span>);
<a class='l d2' name=727 href="#727">727</a>     <span class='c'>// The twitter Streaming API sends a keep-alive newline every 30 seconds</span>
<a class='l d2' name=728 href="#728">728</a> <span class='c'></span>    <span class='c'>// so if we haven't received anything for 90s, we should disconnect and try</span>
<a class='l d2' name=729 href="#729">729</a> <span class='c'></span>    <span class='c'>// to reconnect.</span>
<a class='l d2' name=730 href="#730">730</a> <span class='c'></span>    <span class='v'>this.</span><span class='a'>_streamTimeout</span> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=setTimeout">setTimeout</a>(<span class='v'>this.</span><span class='a'>onStreamTimeout</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=bind">bind</a>(<span class='v'>this)</span>, 90000);
<a class='l d2' name=731 href="#731">731</a>   },
<a class='l d2' name=732 href="#732">732</a>   <span class='a'>onStreamError</span>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aError">aError</a>) {
<a class='l d2' name=733 href="#733">733</a>     <span class='v'>delete </span><span class='v'>this.</span><span class='a'>_streamingRequest</span>;
<a class='l d2' name=734 href="#734">734</a>     <span class='c'>// _streamTimeout is cleared by cleanUp called by gotDisconnected.</span>
<a class='l d2' name=735 href="#735">735</a> <span class='c'></span>    <span class='v'>this.</span><span class='a'>gotDisconnected</span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Ci">Ci</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=prplIAccount">prplIAccount</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=ERROR_NETWORK_ERROR">ERROR_NETWORK_ERROR</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aError">aError</a>);
<a class='l d2' name=736 href="#736">736</a>   },
<a class='l d2' name=737 href="#737">737</a>   <span class='a'>onStreamTimeout</span>: <span class='v'>function(</span>) {
<a class='l d2' name=738 href="#738">738</a>     <span class='v'>this.</span><span class='a'>gotDisconnected</span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Ci">Ci</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=prplIAccount">prplIAccount</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=ERROR_NETWORK_ERROR">ERROR_NETWORK_ERROR</a>, <span class='s'>"timeout"</span>);
<a class='l d2' name=739 href="#739">739</a>   },
<a class='l d2' name=740 href="#740">740</a>   <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=onDataAvailable">onDataAvailable</a>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aRequest">aRequest</a>) {
<a class='l d2' name=741 href="#741">741</a>     <span class='v'>this.</span><span class='a'>resetStreamTimeout</span>();
<a class='l d2' name=742 href="#742">742</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=newText">newText</a> = <span class='v'>this.</span><span class='a'>_pendingData</span> + <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aRequest">aRequest</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=target">target</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=response">response</a>;
<a class='l d2' name=743 href="#743">743</a>     <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=DEBUG">DEBUG</a>(<span class='s'>"Received data: "</span> + <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=newText">newText</a>);
<a class='l d2' name=744 href="#744">744</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=messages">messages</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=newText">newText</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=split">split</a>(/\<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=r">r</a>\<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=n">n</a>?/);
<a class='l d2' name=745 href="#745">745</a>     <span class='v'>this.</span><span class='a'>_pendingData</span> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=messages">messages</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=pop">pop</a>();
<a class='l d2' name=746 href="#746">746</a>     <span class='v'>for </span>(<span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=message">message</a> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=of">of</a> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=messages">messages</a>) {
<a class='l d2' name=747 href="#747">747</a>       <span class='v'>if </span>(!<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=message">message</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=trim">trim</a>())
<a class='l d2' name=748 href="#748">748</a>         <span class='v'>continue;
<a class='l d2' name=749 href="#749">749</a> </span>      <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=msg">msg</a>;
<a class='l d2' name=750 href="#750">750</a>       <span class='v'>try </span>{
<a class='l d2' name=751 href="#751">751</a>         <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=msg">msg</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=JSON">JSON</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=parse">parse</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=message">message</a>);
<a class='l d2' name=752 href="#752">752</a>       } <span class='v'>catch </span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=e">e</a>) {
<a class='l d2' name=753 href="#753">753</a>         <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=ERROR">ERROR</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=e">e</a> + <span class='s'>" while parsing "</span> + <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=message">message</a>);
<a class='l d2' name=754 href="#754">754</a>         <span class='v'>continue;
<a class='l d2' name=755 href="#755">755</a> </span>      }
<a class='l d2' name=756 href="#756">756</a>       <span class='v'>if </span>(<span class='s'>"text"</span> <span class='a'>in</span> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=msg">msg</a>)
<a class='l d2' name=757 href="#757">757</a>         <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=displayMessages">displayMessages</a>([<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=msg">msg</a>]);
<a class='l d2' name=758 href="#758">758</a>       <span class='v'>else </span><span class='v'>if </span>(<span class='s'>"friends"</span> <span class='a'>in</span> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=msg">msg</a>) {
<a class='l d2' name=759 href="#759">759</a>         <span class='c'>// Filter out the IDs that info has already been received from (e.g. a</span>
<a class='l d2' name=760 href="#760">760</a> <span class='c'></span>        <span class='c'>// tweet has been received as part of the timeline request).</span>
<a class='l d2' name=761 href="#761">761</a> <span class='c'></span>        <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=userInfoIds">userInfoIds</a> = <span class='v'>new </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Set">Set</a>();
<a class='l d2' name=762 href="#762">762</a>         <span class='v'>for </span>(<span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=userInfo">userInfo</a> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=of">of</a> <span class='v'>this.</span><span class='a'>_userInfo</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=values">values</a>())
<a class='l d2' name=763 href="#763">763</a>           <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=userInfoIds">userInfoIds</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=add">add</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=userInfo">userInfo</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=id_str">id_str</a>);
<a class='l d2' name=764 href="#764">764</a>         <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=ids">ids</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=msg">msg</a>.<span class='a'>friends</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=filter">filter</a>(
<a class='l d2' name=765 href="#765">765</a>           <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aId">aId</a> =&gt; !<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=userInfoIds">userInfoIds</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=has">has</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aId">aId</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=toString">toString</a>()));
<a class='l d2' name=766 href="#766">766</a> 
<a class='l d2' name=767 href="#767">767</a>         <span class='v'>while </span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=ids">ids</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=length">length</a>) {
<a class='l d2' name=768 href="#768">768</a>           <span class='c'>// Take the first 100 elements, turn them into a comma separated list.</span>
<a class='l d2' name=769 href="#769">769</a> <span class='c'></span>          <span class='v'>this.</span><span class='a'>signAndSend</span>(<span class='s'>"1.1/users/lookup.json"</span>, <span class='v'>null,</span>
<a class='l d2' name=770 href="#770">770</a>                            [[<span class='s'>"user_id"</span>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=ids">ids</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=slice">slice</a>(0, 99).<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=join">join</a>(<span class='s'>","</span>)]],
<a class='l d2' name=771 href="#771">771</a>                            <span class='v'>this.</span><span class='a'>onLookupReceived</span>, <span class='v'>null,</span> <span class='v'>this)</span>;
<a class='l d2' name=772 href="#772">772</a>           <span class='c'>// Remove the first 100 elements.</span>
<a class='l d2' name=773 href="#773">773</a> <span class='c'></span>          <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=ids">ids</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=ids">ids</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=slice">slice</a>(100);
<a class='l d2' name=774 href="#774">774</a>         }
<a class='l d2' name=775 href="#775">775</a> 
<a class='l d2' name=776 href="#776">776</a>         <span class='c'>// Overwrite the existing _friends list (if any).</span>
<a class='l d2' name=777 href="#777">777</a> <span class='c'></span>        <span class='v'>this.</span><span class='a'>_friends</span> = <span class='v'>new </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Set">Set</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=msg">msg</a>.<span class='a'>friends</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=map">map</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aId">aId</a> =&gt; <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aId">aId</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=toString">toString</a>()));
<a class='l d2' name=778 href="#778">778</a>       }
<a class='l d2' name=779 href="#779">779</a>       <span class='v'>else </span><span class='v'>if </span>(<span class='s'>"event"</span> <span class='a'>in</span> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=msg">msg</a>) {
<a class='l d2' name=780 href="#780">780</a>         <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=user">user</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=event">event</a>;
<a class='l d2' name=781 href="#781">781</a>         <span class='v'>switch(msg.event) </span>{
<a class='l d2' name=782 href="#782">782</a>           <span class='v'>case </span><span class='s'>"follow"</span>:
<a class='l d2' name=783 href="#783">783</a>             <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=source">source</a>.<span class='a'>screen_name</span> == <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=name">name</a>) {
<a class='l d2' name=784 href="#784">784</a>               <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=user">user</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=target">target</a>;
<a class='l d2' name=785 href="#785">785</a>               <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=event">event</a> = <span class='s'>"follow"</span>;
<a class='l d2' name=786 href="#786">786</a>               <span class='v'>this.</span><span class='a'>setUserInfo</span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=user">user</a>);
<a class='l d2' name=787 href="#787">787</a>               <span class='v'>this.</span><span class='a'>_friends</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=add">add</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=user">user</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=id_str">id_str</a>);
<a class='l d2' name=788 href="#788">788</a>               <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=timeline">timeline</a>.<span class='a'>_ensureParticipantExists</span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=user">user</a>.<span class='a'>screen_name</span>);
<a class='l d2' name=789 href="#789">789</a>             }
<a class='l d2' name=790 href="#790">790</a>             <span class='v'>else </span><span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=target">target</a>.<span class='a'>screen_name</span> == <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=name">name</a>) {
<a class='l d2' name=791 href="#791">791</a>               <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=user">user</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=source">source</a>;
<a class='l d2' name=792 href="#792">792</a>               <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=event">event</a> = <span class='s'>"followed"</span>;
<a class='l d2' name=793 href="#793">793</a>             }
<a class='l d2' name=794 href="#794">794</a>             <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=user">user</a>) {
<a class='l d2' name=795 href="#795">795</a>               <span class='v'>this.</span><span class='a'>setUserInfo</span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=user">user</a>);
<a class='l d2' name=796 href="#796">796</a>               <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=timeline">timeline</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=systemMessage">systemMessage</a>(<span class='a'>_</span>(<span class='s'>"event."</span> + <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=event">event</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=user">user</a>.<span class='a'>screen_name</span>),
<a class='l d2' name=797 href="#797">797</a>                                           <span class='v'>false, </span><span class='v'>new </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Date">Date</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=msg">msg</a>.<span class='a'>created_at</span>) / 1000);
<a class='l d2' name=798 href="#798">798</a>             }
<a class='l d2' name=799 href="#799">799</a>             <span class='v'>break;
<a class='l d2' name=800 href="#800">800</a> </span>          <span class='v'>case </span><span class='s'>"user_update"</span>:
<a class='l d2' name=801 href="#801">801</a>             <span class='v'>this.</span><span class='a'>setUserInfo</span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=target">target</a>);
<a class='l d2' name=802 href="#802">802</a>             <span class='v'>break;
<a class='l d2' name=803 href="#803">803</a> </span>        }
<a class='l d2' name=804 href="#804">804</a>       }
<a class='l d2' name=805 href="#805">805</a>     }
<a class='l d2' name=806 href="#806">806</a>   },
<a class='l d2' name=807 href="#807">807</a> 
<a class='l d2' name=808 href="#808">808</a>   <span class='a'>requestToken</span>: <span class='v'>function(</span>) {
<a class='l d2' name=809 href="#809">809</a>     <span class='v'>this.</span><span class='a'>reportConnecting</span>(<span class='a'>_</span>(<span class='s'>"connection.initAuth"</span>));
<a class='l d2' name=810 href="#810">810</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=oauthParams">oauthParams</a> =
<a class='l d2' name=811 href="#811">811</a>       [[<span class='s'>"oauth_callback"</span>, <span class='a'>encodeURIComponent</span>(<span class='v'>this.</span><span class='a'>completionURI</span>)]];
<a class='l d2' name=812 href="#812">812</a>     <span class='v'>this.</span><span class='a'>signAndSend</span>(<span class='s'>"oauth/request_token"</span>, <span class='v'>null,</span> [],
<a class='l d2' name=813 href="#813">813</a>                      <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=onRequestTokenReceived">onRequestTokenReceived</a>, <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=onError">onError</a>, <span class='v'>this,</span>
<a class='l d2' name=814 href="#814">814</a>                      <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=oauthParams">oauthParams</a>);
<a class='l d2' name=815 href="#815">815</a>   },
<a class='l d2' name=816 href="#816">816</a>   <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=onRequestTokenReceived">onRequestTokenReceived</a>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aData">aData</a>) {
<a class='l d2' name=817 href="#817">817</a>     <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=LOG">LOG</a>(<span class='s'>"Received request token."</span>);
<a class='l d2' name=818 href="#818">818</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=data">data</a> = <span class='v'>this.</span><span class='a'>_parseURLData</span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aData">aData</a>);
<a class='l d2' name=819 href="#819">819</a>     <span class='v'>if </span>(!<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=data">data</a>.<span class='a'>oauth_callback_confirmed</span> ||
<a class='l d2' name=820 href="#820">820</a>         !<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=data">data</a>.<span class='a'>oauth_token</span> || !<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=data">data</a>.<span class='a'>oauth_token_secret</span>) {
<a class='l d2' name=821 href="#821">821</a>       <span class='v'>this.</span><span class='a'>gotDisconnected</span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Ci">Ci</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=prplIAccount">prplIAccount</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=ERROR_OTHER_ERROR">ERROR_OTHER_ERROR</a>,
<a class='l d2' name=822 href="#822">822</a>                            <span class='a'>_</span>(<span class='s'>"connection.failedToken"</span>));
<a class='l d2' name=823 href="#823">823</a>       <span class='v'>return;</span>
<a class='l d2' name=824 href="#824">824</a>     }
<a class='l d2' name=825 href="#825">825</a>     <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=token">token</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=data">data</a>.<span class='a'>oauth_token</span>;
<a class='l d2' name=826 href="#826">826</a>     <span class='v'>this.</span><span class='a'>tokenSecret</span> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=data">data</a>.<span class='a'>oauth_token_secret</span>;
<a class='l d2' name=827 href="#827">827</a> 
<a class='l d2' name=828 href="#828">828</a>     <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=requestAuthorization">requestAuthorization</a>();
<a class='l d2' name=829 href="#829">829</a>   },
<a class='l d2' name=830 href="#830">830</a>   <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=requestAuthorization">requestAuthorization</a>: <span class='v'>function(</span>) {
<a class='l d2' name=831 href="#831">831</a>     <span class='v'>this.</span><span class='a'>reportConnecting</span>(<span class='a'>_</span>(<span class='s'>"connection.requestAuth"</span>));
<a class='l d2' name=832 href="#832">832</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=url">url</a> = <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=baseURI">baseURI</a> + <span class='s'>"oauth/authorize?"</span> +
<a class='l d2' name=833 href="#833">833</a>       <span class='s'>"force_login=true&amp;"</span> + <span class='c'>// ignore cookies</span>
<a class='l d2' name=834 href="#834">834</a> <span class='c'></span>      <span class='s'>"screen_name="</span> + <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=name">name</a> + <span class='s'>"&amp;"</span> + <span class='c'>// prefill the user name input box</span>
<a class='l d2' name=835 href="#835">835</a> <span class='c'></span>      <span class='s'>"oauth_token="</span> + <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=token">token</a>;
<a class='l d2' name=836 href="#836">836</a>     <span class='v'>this.</span><span class='a'>_browserRequest</span> = {
<a class='l d2' name=837 href="#837">837</a>       <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=promptText">promptText</a>() { <span class='v'>return </span><span class='a'>_</span>(<span class='s'>"authPrompt"</span>); },
<a class='l d2' name=838 href="#838">838</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=account">account</a>: <span class='v'>this,</span>
<a class='l d2' name=839 href="#839">839</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=url">url</a>: <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=url">url</a>,
<a class='l d2' name=840 href="#840">840</a>       <span class='a'>_active</span>: <span class='v'>true,
<a class='l d2' name=841 href="#841">841</a> </span>      <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=cancelled">cancelled</a>: <span class='v'>function(</span>) {
<a class='l d2' name=842 href="#842">842</a>         <span class='v'>if </span>(!<span class='v'>this.</span><span class='a'>_active</span>)
<a class='l d2' name=843 href="#843">843</a>           <span class='v'>return;</span>
<a class='l d2' name=844 href="#844">844</a> 
<a class='l d2' name=845 href="#845">845</a>         <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=account">account</a>
<a class='l d2' name=846 href="#846">846</a>             .<span class='a'>gotDisconnected</span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Ci">Ci</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=prplIAccount">prplIAccount</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=ERROR_AUTHENTICATION_FAILED">ERROR_AUTHENTICATION_FAILED</a>,
<a class='l d2' name=847 href="#847">847</a>                              <span class='a'>_</span>(<span class='s'>"connection.error.authCancelled"</span>));
<a class='l d2' name=848 href="#848">848</a>       },
<a class='l d2' name=849 href="#849">849</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=loaded">loaded</a>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aWindow">aWindow</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aWebProgress">aWebProgress</a>) {
<a class='l d2' name=850 href="#850">850</a>         <span class='v'>if </span>(!<span class='v'>this.</span><span class='a'>_active</span>)
<a class='l d2' name=851 href="#851">851</a>           <span class='v'>return;</span>
<a class='l d2' name=852 href="#852">852</a> 
<a class='l d2' name=853 href="#853">853</a>         <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=_listener">_listener</a> = {
<a class='l d2' name=854 href="#854">854</a>           <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=QueryInterface">QueryInterface</a>: <span class='a'>XPCOMUtils</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=generateQI">generateQI</a>([<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Ci">Ci</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=nsIWebProgressListener">nsIWebProgressListener</a>,
<a class='l d2' name=855 href="#855">855</a>                                                  <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Ci">Ci</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=nsISupportsWeakReference">nsISupportsWeakReference</a>]),
<a class='l d2' name=856 href="#856">856</a>           <span class='a'>_cleanUp</span>: <span class='v'>function(</span>) {
<a class='l d2' name=857 href="#857">857</a>             <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=webProgress">webProgress</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=removeProgressListener">removeProgressListener</a>(<span class='v'>this)</span>;
<a class='l d2' name=858 href="#858">858</a>             <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=window">window</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=close">close</a>();
<a class='l d2' name=859 href="#859">859</a>             <span class='v'>delete </span><span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=window">window</a>;
<a class='l d2' name=860 href="#860">860</a>           },
<a class='l d2' name=861 href="#861">861</a>           <span class='a'>_checkForRedirect</span>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aURL">aURL</a>) {
<a class='l d2' name=862 href="#862">862</a>             <span class='v'>if </span>(!<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aURL">aURL</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=startsWith">startsWith</a>(<span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=_parent">_parent</a>.<span class='a'>completionURI</span>))
<a class='l d2' name=863 href="#863">863</a>               <span class='v'>return;</span>
<a class='l d2' name=864 href="#864">864</a> 
<a class='l d2' name=865 href="#865">865</a>             <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=_parent">_parent</a>.<span class='a'>finishAuthorizationRequest</span>();
<a class='l d2' name=866 href="#866">866</a>             <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=_parent">_parent</a>.<span class='a'>onAuthorizationReceived</span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aURL">aURL</a>);
<a class='l d2' name=867 href="#867">867</a>           },
<a class='l d2' name=868 href="#868">868</a>           <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=onStateChange">onStateChange</a>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aWebProgress">aWebProgress</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aRequest">aRequest</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aStateFlags">aStateFlags</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aStatus">aStatus</a>) {
<a class='l d2' name=869 href="#869">869</a>             <span class='a'>const</span> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=wpl">wpl</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Ci">Ci</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=nsIWebProgressListener">nsIWebProgressListener</a>;
<a class='l d2' name=870 href="#870">870</a>             <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aStateFlags">aStateFlags</a> &amp; (<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=wpl">wpl</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=STATE_START">STATE_START</a> | <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=wpl">wpl</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=STATE_IS_NETWORK">STATE_IS_NETWORK</a>))
<a class='l d2' name=871 href="#871">871</a>               <span class='v'>this.</span><span class='a'>_checkForRedirect</span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aRequest">aRequest</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=name">name</a>);
<a class='l d2' name=872 href="#872">872</a>           },
<a class='l d2' name=873 href="#873">873</a>           <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=onLocationChange">onLocationChange</a>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aWebProgress">aWebProgress</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aRequest">aRequest</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aLocation">aLocation</a>) {
<a class='l d2' name=874 href="#874">874</a>             <span class='v'>this.</span><span class='a'>_checkForRedirect</span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aLocation">aLocation</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=spec">spec</a>);
<a class='l d2' name=875 href="#875">875</a>           },
<a class='l d2' name=876 href="#876">876</a>           <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=onProgressChange">onProgressChange</a>: <span class='v'>function(</span>) {},
<a class='l d2' name=877 href="#877">877</a>           <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=onStatusChange">onStatusChange</a>: <span class='v'>function(</span>) {},
<a class='l d2' name=878 href="#878">878</a>           <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=onSecurityChange">onSecurityChange</a>: <span class='v'>function(</span>) {},
<a class='l d2' name=879 href="#879">879</a> 
<a class='l d2' name=880 href="#880">880</a>           <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=window">window</a>: <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aWindow">aWindow</a>,
<a class='l d2' name=881 href="#881">881</a>           <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=webProgress">webProgress</a>: <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aWebProgress">aWebProgress</a>,
<a class='l d2' name=882 href="#882">882</a>           <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=_parent">_parent</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=account">account</a>
<a class='l d2' name=883 href="#883">883</a>         };
<a class='l d2' name=884 href="#884">884</a>         <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aWebProgress">aWebProgress</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=addProgressListener">addProgressListener</a>(<span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=_listener">_listener</a>,
<a class='l d2' name=885 href="#885">885</a>                                          <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Ci">Ci</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=nsIWebProgress">nsIWebProgress</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=NOTIFY_ALL">NOTIFY_ALL</a>);
<a class='l d2' name=886 href="#886">886</a>       },
<a class='l d2' name=887 href="#887">887</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=QueryInterface">QueryInterface</a>: <span class='a'>XPCOMUtils</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=generateQI">generateQI</a>([<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Ci">Ci</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=prplIRequestBrowser">prplIRequestBrowser</a>])
<a class='l d2' name=888 href="#888">888</a>     };
<a class='l d2' name=889 href="#889">889</a>     <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Services">Services</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=obs">obs</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=notifyObservers">notifyObservers</a>(<span class='v'>this.</span><span class='a'>_browserRequest</span>, <span class='s'>"browser-request"</span>, <span class='v'>null)</span>;
<a class='l d2' name=890 href="#890">890</a>   },
<a class='l d2' name=891 href="#891">891</a>   <span class='a'>finishAuthorizationRequest</span>: <span class='v'>function(</span>) {
<a class='l d2' name=892 href="#892">892</a>     <span class='c'>// Clean up the cookies, so that several twitter OAuth dialogs can work</span>
<a class='l d2' name=893 href="#893">893</a> <span class='c'></span>    <span class='c'>// during the same session (bug 954308).</span>
<a class='l d2' name=894 href="#894">894</a> <span class='c'></span>    <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=cookies">cookies</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Services">Services</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=cookies">cookies</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=getCookiesFromHost">getCookiesFromHost</a>(<span class='s'>"twitter.com"</span>);
<a class='l d2' name=895 href="#895">895</a>     <span class='v'>while </span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=cookies">cookies</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=hasMoreElements">hasMoreElements</a>()) {
<a class='l d2' name=896 href="#896">896</a>       <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=cookie">cookie</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=cookies">cookies</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=getNext">getNext</a>().<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=QueryInterface">QueryInterface</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Ci">Ci</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=nsICookie2">nsICookie2</a>);
<a class='l d2' name=897 href="#897">897</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Services">Services</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=cookies">cookies</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=remove">remove</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=cookie">cookie</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=host">host</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=cookie">cookie</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=name">name</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=cookie">cookie</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=path">path</a>,
<a class='l d2' name=898 href="#898">898</a>                               <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=cookie">cookie</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=originAttributes">originAttributes</a>, <span class='v'>false)</span>;
<a class='l d2' name=899 href="#899">899</a>     }
<a class='l d2' name=900 href="#900">900</a> 
<a class='l d2' name=901 href="#901">901</a>     <span class='v'>if </span>(!(<span class='s'>"_browserRequest"</span> <span class='a'>in</span> <span class='v'>this)</span>)
<a class='l d2' name=902 href="#902">902</a>       <span class='v'>return;</span>
<a class='l d2' name=903 href="#903">903</a>     <span class='v'>this.</span><span class='a'>_browserRequest</span>.<span class='a'>_active</span> = <span class='v'>false;</span>
<a class='l d2' name=904 href="#904">904</a>     <span class='v'>if </span>(<span class='s'>"_listener"</span> <span class='a'>in</span> <span class='v'>this.</span><span class='a'>_browserRequest</span>)
<a class='l d2' name=905 href="#905">905</a>       <span class='v'>this.</span><span class='a'>_browserRequest</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=_listener">_listener</a>.<span class='a'>_cleanUp</span>();
<a class='l d2' name=906 href="#906">906</a>     <span class='v'>delete </span><span class='v'>this.</span><span class='a'>_browserRequest</span>;
<a class='l d2' name=907 href="#907">907</a>   },
<a class='l d2' name=908 href="#908">908</a>   <span class='a'>onAuthorizationReceived</span>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aData">aData</a>) {
<a class='l d2' name=909 href="#909">909</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=data">data</a> = <span class='v'>this.</span><span class='a'>_parseURLData</span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aData">aData</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=split">split</a>(<span class='s'>"?"</span>)[1]);
<a class='l d2' name=910 href="#910">910</a>     <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=data">data</a>.<span class='a'>oauth_token</span> != <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=token">token</a> || !<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=data">data</a>.<span class='a'>oauth_verifier</span>) {
<a class='l d2' name=911 href="#911">911</a>       <span class='v'>this.</span><span class='a'>gotDisconnected</span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Ci">Ci</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=prplIAccount">prplIAccount</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=ERROR_OTHER_ERROR">ERROR_OTHER_ERROR</a>,
<a class='l d2' name=912 href="#912">912</a>                            <span class='a'>_</span>(<span class='s'>"connection.error.authFailed"</span>));
<a class='l d2' name=913 href="#913">913</a>       <span class='v'>return;</span>
<a class='l d2' name=914 href="#914">914</a>     }
<a class='l d2' name=915 href="#915">915</a>     <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=requestAccessToken">requestAccessToken</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=data">data</a>.<span class='a'>oauth_verifier</span>);
<a class='l d2' name=916 href="#916">916</a>   },
<a class='l d2' name=917 href="#917">917</a>   <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=requestAccessToken">requestAccessToken</a>: <span class='v'>function(</span><span class='a'>aTokenVerifier</span>) {
<a class='l d2' name=918 href="#918">918</a>     <span class='v'>this.</span><span class='a'>reportConnecting</span>(<span class='a'>_</span>(<span class='s'>"connection.requestAccess"</span>));
<a class='l d2' name=919 href="#919">919</a>     <span class='v'>this.</span><span class='a'>signAndSend</span>(<span class='s'>"oauth/access_token"</span>, <span class='v'>null,</span> [],
<a class='l d2' name=920 href="#920">920</a>                      <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=onAccessTokenReceived">onAccessTokenReceived</a>, <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=onError">onError</a>, <span class='v'>this,</span>
<a class='l d2' name=921 href="#921">921</a>                      [[<span class='s'>"oauth_verifier"</span>, <span class='a'>aTokenVerifier</span>]]);
<a class='l d2' name=922 href="#922">922</a>   },
<a class='l d2' name=923 href="#923">923</a>   <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=onAccessTokenReceived">onAccessTokenReceived</a>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aData">aData</a>) {
<a class='l d2' name=924 href="#924">924</a>     <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=LOG">LOG</a>(<span class='s'>"Received access token."</span>);
<a class='l d2' name=925 href="#925">925</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=result">result</a> = <span class='v'>this.</span><span class='a'>_parseURLData</span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aData">aData</a>);
<a class='l d2' name=926 href="#926">926</a>     <span class='v'>if </span>(!<span class='v'>this.</span><span class='a'>fixAccountName</span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=result">result</a>))
<a class='l d2' name=927 href="#927">927</a>       <span class='v'>return;</span>
<a class='l d2' name=928 href="#928">928</a> 
<a class='l d2' name=929 href="#929">929</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=prefValue">prefValue</a> = {};
<a class='l d2' name=930 href="#930">930</a>     <span class='v'>try </span>{
<a class='l d2' name=931 href="#931">931</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=JSON">JSON</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=parse">parse</a>(<span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=prefs">prefs</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=getCharPref">getCharPref</a>(<span class='s'>"oauth"</span>));
<a class='l d2' name=932 href="#932">932</a>     } <span class='v'>catch(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=e">e</a>) { }
<a class='l d2' name=933 href="#933">933</a>     <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=prefValue">prefValue</a>[<span class='v'>this.</span><span class='a'>consumerKey</span>] = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=result">result</a>;
<a class='l d2' name=934 href="#934">934</a>     <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=prefs">prefs</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=setCharPref">setCharPref</a>(<span class='s'>"oauth"</span>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=JSON">JSON</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=stringify">stringify</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=prefValue">prefValue</a>));
<a class='l d2' name=935 href="#935">935</a> 
<a class='l d2' name=936 href="#936">936</a>     <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=token">token</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=result">result</a>.<span class='a'>oauth_token</span>;
<a class='l d2' name=937 href="#937">937</a>     <span class='v'>this.</span><span class='a'>tokenSecret</span> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=result">result</a>.<span class='a'>oauth_token_secret</span>;
<a class='l d2' name=938 href="#938">938</a> 
<a class='l d2' name=939 href="#939">939</a>     <span class='v'>this.</span><span class='a'>getTimelines</span>();
<a class='l d2' name=940 href="#940">940</a>   },
<a class='l d2' name=941 href="#941">941</a>   <span class='a'>fixAccountName</span>: <span class='v'>function(</span><span class='a'>aAuthResult</span>) {
<a class='l d2' name=942 href="#942">942</a>     <span class='v'>if </span>(!<span class='a'>aAuthResult</span>.<span class='a'>screen_name</span> || <span class='a'>aAuthResult</span>.<span class='a'>screen_name</span> == <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=name">name</a>)
<a class='l d2' name=943 href="#943">943</a>       <span class='v'>return </span><span class='v'>true;</span>
<a class='l d2' name=944 href="#944">944</a> 
<a class='l d2' name=945 href="#945">945</a>     <span class='v'>if </span>(<span class='a'>aAuthResult</span>.<span class='a'>screen_name</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=toLowerCase">toLowerCase</a>() != <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=name">name</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=toLowerCase">toLowerCase</a>()) {
<a class='l d2' name=946 href="#946">946</a>       <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=onError">onError</a>(<span class='a'>_</span>(<span class='s'>"connection.error.userMismatch"</span>));
<a class='l d2' name=947 href="#947">947</a>       <span class='v'>return </span><span class='v'>false;</span>
<a class='l d2' name=948 href="#948">948</a>     }
<a class='l d2' name=949 href="#949">949</a> 
<a class='l d2' name=950 href="#950">950</a>     <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=LOG">LOG</a>(<span class='s'>"Fixing the case of the account name: "</span> +
<a class='l d2' name=951 href="#951">951</a>              <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=name">name</a> + <span class='s'>" -&gt; "</span> + <span class='a'>aAuthResult</span>.<span class='a'>screen_name</span>);
<a class='l d2' name=952 href="#952">952</a>     <span class='v'>this.</span><span class='a'>__defineGetter__</span>(<span class='s'>"name"</span>, () =&gt; <span class='a'>aAuthResult</span>.<span class='a'>screen_name</span>);
<a class='l d2' name=953 href="#953">953</a>     <span class='v'>return </span><span class='v'>true;</span>
<a class='l d2' name=954 href="#954">954</a>   },
<a class='l d2' name=955 href="#955">955</a> 
<a class='l d2' name=956 href="#956">956</a>   <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=cleanUp">cleanUp</a>: <span class='v'>function(</span>) {
<a class='l d2' name=957 href="#957">957</a>     <span class='v'>this.</span><span class='a'>finishAuthorizationRequest</span>();
<a class='l d2' name=958 href="#958">958</a>     <span class='v'>if </span>(<span class='v'>this.</span><span class='a'>_pendingRequests</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=length">length</a> != 0) {
<a class='l d2' name=959 href="#959">959</a>       <span class='v'>for </span>(<span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=request">request</a> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=of">of</a> <span class='v'>this.</span><span class='a'>_pendingRequests</span>)
<a class='l d2' name=960 href="#960">960</a>         <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=request">request</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=abort">abort</a>();
<a class='l d2' name=961 href="#961">961</a>       <span class='v'>delete </span><span class='v'>this.</span><span class='a'>_pendingRequests</span>;
<a class='l d2' name=962 href="#962">962</a>     }
<a class='l d2' name=963 href="#963">963</a>     <span class='v'>if </span>(<span class='v'>this.</span><span class='a'>_streamTimeout</span>) {
<a class='l d2' name=964 href="#964">964</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=clearTimeout">clearTimeout</a>(<span class='v'>this.</span><span class='a'>_streamTimeout</span>);
<a class='l d2' name=965 href="#965">965</a>       <span class='v'>delete </span><span class='v'>this.</span><span class='a'>_streamTimeout</span>;
<a class='l d2' name=966 href="#966">966</a>       <span class='c'>// Remove the preference observer that is added when the user stream is</span>
<a class='l d2' name=967 href="#967">967</a> <span class='c'></span>      <span class='c'>// opened. (This needs to be removed even if an error occurs, in which</span>
<a class='l d2' name=968 href="#968">968</a> <span class='c'></span>      <span class='c'>// case _streamingRequest is immediately deleted.)</span>
<a class='l d2' name=969 href="#969">969</a> <span class='c'></span>      <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=prefs">prefs</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=removeObserver">removeObserver</a>(<span class='s'>"track"</span>, <span class='v'>this)</span>;
<a class='l d2' name=970 href="#970">970</a>     }
<a class='l d2' name=971 href="#971">971</a>     <span class='v'>if </span>(<span class='v'>this.</span><span class='a'>_streamingRequest</span>) {
<a class='l d2' name=972 href="#972">972</a>       <span class='v'>this.</span><span class='a'>_streamingRequest</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=abort">abort</a>();
<a class='l d2' name=973 href="#973">973</a>       <span class='v'>delete </span><span class='v'>this.</span><span class='a'>_streamingRequest</span>;
<a class='l d2' name=974 href="#974">974</a>     }
<a class='l d2' name=975 href="#975">975</a>     <span class='v'>delete </span><span class='v'>this.</span><span class='a'>_pendingData</span>;
<a class='l d2' name=976 href="#976">976</a>     <span class='v'>delete </span><span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=token">token</a>;
<a class='l d2' name=977 href="#977">977</a>     <span class='v'>delete </span><span class='v'>this.</span><span class='a'>tokenSecret</span>;
<a class='l d2' name=978 href="#978">978</a>   },
<a class='l d2' name=979 href="#979">979</a>   <span class='a'>gotDisconnected</span>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aError">aError</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aErrorMessage">aErrorMessage</a>) {
<a class='l d2' name=980 href="#980">980</a>     <span class='v'>if </span>(<span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=disconnected">disconnected</a> || <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=disconnecting">disconnecting</a>)
<a class='l d2' name=981 href="#981">981</a>       <span class='v'>return;</span>
<a class='l d2' name=982 href="#982">982</a> 
<a class='l d2' name=983 href="#983">983</a>     <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aError">aError</a> === <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=undefined">undefined</a>)
<a class='l d2' name=984 href="#984">984</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aError">aError</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Ci">Ci</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=prplIAccount">prplIAccount</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=NO_ERROR">NO_ERROR</a>;
<a class='l d2' name=985 href="#985">985</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=connected">connected</a> = <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=connected">connected</a>;
<a class='l d2' name=986 href="#986">986</a>     <span class='v'>this.</span><span class='a'>reportDisconnecting</span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aError">aError</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aErrorMessage">aErrorMessage</a>);
<a class='l d2' name=987 href="#987">987</a>     <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=cleanUp">cleanUp</a>();
<a class='l d2' name=988 href="#988">988</a>     <span class='v'>if </span>(<span class='v'>this.</span><span class='a'>_timeline</span> &amp;&amp; <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=connected">connected</a>)
<a class='l d2' name=989 href="#989">989</a>       <span class='v'>this.</span><span class='a'>_timeline</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=notifyObservers">notifyObservers</a>(<span class='v'>this.</span><span class='a'>_timeline</span>, <span class='s'>"update-conv-chatleft"</span>);
<a class='l d2' name=990 href="#990">990</a>     <span class='v'>this.</span><span class='a'>reportDisconnected</span>();
<a class='l d2' name=991 href="#991">991</a>   },
<a class='l d2' name=992 href="#992">992</a>   <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=remove">remove</a>: <span class='v'>function(</span>) {
<a class='l d2' name=993 href="#993">993</a>     <span class='v'>if </span>(!<span class='v'>this.</span><span class='a'>_timeline</span>)
<a class='l d2' name=994 href="#994">994</a>       <span class='v'>return;</span>
<a class='l d2' name=995 href="#995">995</a>     <span class='v'>this.</span><span class='a'>_timeline</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=close">close</a>();
<a class='l d2' name=996 href="#996">996</a>     <span class='v'>delete </span><span class='v'>this.</span><span class='a'>_timeline</span>;
<a class='l d2' name=997 href="#997">997</a>   },
<a class='l d2' name=998 href="#998">998</a>   <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=unInit">unInit</a>: <span class='v'>function(</span>) {
<a class='l d2' name=999 href="#999">999</a>     <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=cleanUp">cleanUp</a>();
<a class='l d3' name=1000 href="#1000">1000</a>   },
<a class='l d3' name=1001 href="#1001">1001</a>   <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=disconnect">disconnect</a>: <span class='v'>function(</span>) {
<a class='l d3' name=1002 href="#1002">1002</a>     <span class='v'>this.</span><span class='a'>gotDisconnected</span>();
<a class='l d3' name=1003 href="#1003">1003</a>   },
<a class='l d3' name=1004 href="#1004">1004</a> 
<a class='l d3' name=1005 href="#1005">1005</a>   <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=onError">onError</a>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aException">aException</a>) {
<a class='l d3' name=1006 href="#1006">1006</a>     <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aException">aException</a> == <span class='s'>"offline"</span>) {
<a class='l d3' name=1007 href="#1007">1007</a>       <span class='v'>this.</span><span class='a'>gotDisconnected</span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Ci">Ci</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=prplIAccount">prplIAccount</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=ERROR_NETWORK_ERROR">ERROR_NETWORK_ERROR</a>,
<a class='l d3' name=1008 href="#1008">1008</a>                            <span class='a'>_</span>(<span class='s'>"connection.error.noNetwork"</span>));
<a class='l d3' name=1009 href="#1009">1009</a>     }
<a class='l d3' name=1010 href="#1010">1010</a>     <span class='v'>else
<a class='l d3' name=1011 href="#1011">1011</a> </span>      <span class='v'>this.</span><span class='a'>gotDisconnected</span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Ci">Ci</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=prplIAccount">prplIAccount</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=ERROR_OTHER_ERROR">ERROR_OTHER_ERROR</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aException">aException</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=toString">toString</a>());
<a class='l d3' name=1012 href="#1012">1012</a>   },
<a class='l d3' name=1013 href="#1013">1013</a> 
<a class='l d3' name=1014 href="#1014">1014</a>   <span class='a'>setUserDescription</span>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aDescription">aDescription</a>) {
<a class='l d3' name=1015 href="#1015">1015</a>     <span class='a'>const</span> <span class='a'>kMaxUserDescriptionLength</span> = 160;
<a class='l d3' name=1016 href="#1016">1016</a>     <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aDescription">aDescription</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=length">length</a> &gt; <span class='a'>kMaxUserDescriptionLength</span>) {
<a class='l d3' name=1017 href="#1017">1017</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aDescription">aDescription</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aDescription">aDescription</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=substr">substr</a>(0, <span class='a'>kMaxUserDescriptionLength</span>);
<a class='l d3' name=1018 href="#1018">1018</a>       <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=WARN">WARN</a>(<span class='s'>"Description too long (over "</span> + <span class='a'>kMaxUserDescriptionLength</span> +
<a class='l d3' name=1019 href="#1019">1019</a>                 <span class='s'>" characters):\n"</span> + <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aDescription">aDescription</a> + <span class='s'>"."</span>);
<a class='l d3' name=1020 href="#1020">1020</a>       <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=timeline">timeline</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=systemMessage">systemMessage</a>(<span class='a'>_</span>(<span class='s'>"error.descriptionTooLong"</span>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aDescription">aDescription</a>));
<a class='l d3' name=1021 href="#1021">1021</a>     }
<a class='l d3' name=1022 href="#1022">1022</a>     <span class='c'>// Don't need to catch the reply since the stream receives user_update.</span>
<a class='l d3' name=1023 href="#1023">1023</a> <span class='c'></span>    <span class='v'>this.</span><span class='a'>signAndSend</span>(<span class='s'>"1.1/account/update_profile.json"</span>, <span class='v'>null,</span>
<a class='l d3' name=1024 href="#1024">1024</a>                      [[<span class='s'>"description"</span>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aDescription">aDescription</a>]]);
<a class='l d3' name=1025 href="#1025">1025</a>   },
<a class='l d3' name=1026 href="#1026">1026</a> 
<a class='l d3' name=1027 href="#1027">1027</a>   <span class='a'>setUserInfo</span>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aUser">aUser</a>) {
<a class='l d3' name=1028 href="#1028">1028</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=nick">nick</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aUser">aUser</a>.<span class='a'>screen_name</span>;
<a class='l d3' name=1029 href="#1029">1029</a>     <span class='v'>this.</span><span class='a'>_userInfo</span>.<span class='v'>set(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=nick">nick</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aUser">aUser</a>);
<a class='l d3' name=1030 href="#1030">1030</a> 
<a class='l d3' name=1031 href="#1031">1031</a>     <span class='c'>// If it's the user's userInfo, update the timeline topic.</span>
<a class='l d3' name=1032 href="#1032">1032</a> <span class='c'></span>    <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=nick">nick</a> == <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=name">name</a> &amp;&amp; <span class='s'>"description"</span> <span class='a'>in</span> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aUser">aUser</a>)
<a class='l d3' name=1033 href="#1033">1033</a>       <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=timeline">timeline</a>.<span class='a'>setTopic</span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aUser">aUser</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=description">description</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=nick">nick</a>, <span class='v'>true)</span>;
<a class='l d3' name=1034 href="#1034">1034</a>   },
<a class='l d3' name=1035 href="#1035">1035</a>   <span class='a'>onRequestedInfoReceived</span>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aData">aData</a>) {
<a class='l d3' name=1036 href="#1036">1036</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=user">user</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=JSON">JSON</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=parse">parse</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aData">aData</a>);
<a class='l d3' name=1037 href="#1037">1037</a>     <span class='v'>this.</span><span class='a'>setUserInfo</span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=user">user</a>);
<a class='l d3' name=1038 href="#1038">1038</a>     <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=requestBuddyInfo">requestBuddyInfo</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=user">user</a>.<span class='a'>screen_name</span>);
<a class='l d3' name=1039 href="#1039">1039</a>   },
<a class='l d3' name=1040 href="#1040">1040</a>   <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=requestBuddyInfo">requestBuddyInfo</a>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aBuddyName">aBuddyName</a>) {
<a class='l d3' name=1041 href="#1041">1041</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=userInfo">userInfo</a> = <span class='v'>this.</span><span class='a'>_userInfo</span>.<span class='v'>get(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aBuddyName">aBuddyName</a>);
<a class='l d3' name=1042 href="#1042">1042</a>     <span class='v'>if </span>(!<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=userInfo">userInfo</a>) {
<a class='l d3' name=1043 href="#1043">1043</a>       <span class='v'>this.</span><span class='a'>signAndSend</span>(<span class='s'>"1.1/users/show.json?screen_name="</span> + <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aBuddyName">aBuddyName</a>, <span class='v'>null,</span>
<a class='l d3' name=1044 href="#1044">1044</a>                        <span class='v'>null,</span> <span class='v'>this.</span><span class='a'>onRequestedInfoReceived</span>, <span class='v'>null,</span> <span class='v'>this)</span>;
<a class='l d3' name=1045 href="#1045">1045</a>       <span class='v'>return;</span>
<a class='l d3' name=1046 href="#1046">1046</a>     }
<a class='l d3' name=1047 href="#1047">1047</a> 
<a class='l d3' name=1048 href="#1048">1048</a>     <span class='c'>// List of the names of the info to actually show in the tooltip and</span>
<a class='l d3' name=1049 href="#1049">1049</a> <span class='c'></span>    <span class='c'>// optionally a transform function to apply to the value.</span>
<a class='l d3' name=1050 href="#1050">1050</a> <span class='c'></span>    <span class='c'>// See <a href="https://dev.twitter.com/docs/api/1/get/users/show">https://dev.twitter.com/docs/api/1/get/users/show</a> for the options.</span>
<a class='l d3' name=1051 href="#1051">1051</a> <span class='c'></span>    <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=normalizeBool">normalizeBool</a> = <span class='a'>isFollowing</span> =&gt; <span class='a'>_</span>(<span class='a'>isFollowing</span> ? <span class='s'>"yes"</span> : <span class='s'>"no"</span>);
<a class='l d3' name=1052 href="#1052">1052</a>     <span class='a'>const</span> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=kFields">kFields</a> = {
<a class='l d3' name=1053 href="#1053">1053</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=name">name</a>: <span class='v'>null,</span>
<a class='l d3' name=1054 href="#1054">1054</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=following">following</a>: <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=normalizeBool">normalizeBool</a>,
<a class='l d3' name=1055 href="#1055">1055</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=description">description</a>: <span class='v'>null,</span>
<a class='l d3' name=1056 href="#1056">1056</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=url">url</a>: <span class='v'>null,</span>
<a class='l d3' name=1057 href="#1057">1057</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=location">location</a>: <span class='v'>null,</span>
<a class='l d3' name=1058 href="#1058">1058</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=lang">lang</a>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aLang">aLang</a>) {
<a class='l d3' name=1059 href="#1059">1059</a>         <span class='v'>try </span>{
<a class='l d3' name=1060 href="#1060">1060</a>           <span class='v'>return </span><span class='a'>_lang</span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aLang">aLang</a>);
<a class='l d3' name=1061 href="#1061">1061</a>         }
<a class='l d3' name=1062 href="#1062">1062</a>         <span class='v'>catch(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=e">e</a>) {
<a class='l d3' name=1063 href="#1063">1063</a>           <span class='v'>return </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aLang">aLang</a>;
<a class='l d3' name=1064 href="#1064">1064</a>         }
<a class='l d3' name=1065 href="#1065">1065</a>       },
<a class='l d3' name=1066 href="#1066">1066</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=time_zone">time_zone</a>: <span class='v'>null,</span>
<a class='l d3' name=1067 href="#1067">1067</a>       <span class='v'>protected: </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=normalizeBool">normalizeBool</a>,
<a class='l d3' name=1068 href="#1068">1068</a>       <span class='a'>created_at</span>: <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aDate">aDate</a> =&gt; (<span class='v'>new </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Date">Date</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aDate">aDate</a>)).<span class='a'>toLocaleDateString</span>(),
<a class='l d3' name=1069 href="#1069">1069</a>       <span class='a'>statuses_count</span>: <span class='v'>null,</span>
<a class='l d3' name=1070 href="#1070">1070</a>       <span class='a'>friends_count</span>: <span class='v'>null,</span>
<a class='l d3' name=1071 href="#1071">1071</a>       <span class='a'>followers_count</span>: <span class='v'>null,</span>
<a class='l d3' name=1072 href="#1072">1072</a>       <span class='a'>listed_count</span>: <span class='v'>null
<a class='l d3' name=1073 href="#1073">1073</a> </span>    };
<a class='l d3' name=1074 href="#1074">1074</a> 
<a class='l d3' name=1075 href="#1075">1075</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=tooltipInfo">tooltipInfo</a> = [];
<a class='l d3' name=1076 href="#1076">1076</a>     <span class='v'>for </span>(<span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=field">field</a> <span class='a'>in</span> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=kFields">kFields</a>) {
<a class='l d3' name=1077 href="#1077">1077</a>       <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Object">Object</a>.<span class='v'>prototype.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=hasOwnProperty">hasOwnProperty</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=call">call</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=userInfo">userInfo</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=field">field</a>) &amp;&amp;
<a class='l d3' name=1078 href="#1078">1078</a>           <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=userInfo">userInfo</a>[<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=field">field</a>]) {
<a class='l d3' name=1079 href="#1079">1079</a>         <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=value">value</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=userInfo">userInfo</a>[<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=field">field</a>];
<a class='l d3' name=1080 href="#1080">1080</a>         <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=kFields">kFields</a>[<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=field">field</a>])
<a class='l d3' name=1081 href="#1081">1081</a>           <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=value">value</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=kFields">kFields</a>[<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=field">field</a>](<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=value">value</a>);
<a class='l d3' name=1082 href="#1082">1082</a>         <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=tooltipInfo">tooltipInfo</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=push">push</a>(<span class='v'>new </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=TooltipInfo">TooltipInfo</a>(<span class='a'>_</span>(<span class='s'>"tooltip."</span> + <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=field">field</a>), <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=value">value</a>));
<a class='l d3' name=1083 href="#1083">1083</a>       }
<a class='l d3' name=1084 href="#1084">1084</a>     }
<a class='l d3' name=1085 href="#1085">1085</a>     <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=tooltipInfo">tooltipInfo</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=push">push</a>(<span class='v'>new </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=TooltipInfo">TooltipInfo</a>(<span class='v'>null,</span> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=userInfo">userInfo</a>.<span class='a'>profile_image_url</span>,
<a class='l d3' name=1086 href="#1086">1086</a>                                      <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Ci">Ci</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=prplITooltipInfo">prplITooltipInfo</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=icon">icon</a>));
<a class='l d3' name=1087 href="#1087">1087</a> 
<a class='l d3' name=1088 href="#1088">1088</a>     <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Services">Services</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=obs">obs</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=notifyObservers">notifyObservers</a>(<span class='v'>new </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=nsSimpleEnumerator">nsSimpleEnumerator</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=tooltipInfo">tooltipInfo</a>),
<a class='l d3' name=1089 href="#1089">1089</a>                                  <span class='s'>"user-info-received"</span>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aBuddyName">aBuddyName</a>);
<a class='l d3' name=1090 href="#1090">1090</a>   },
<a class='l d3' name=1091 href="#1091">1091</a> 
<a class='l d3' name=1092 href="#1092">1092</a>   <span class='c'>// Handle the full user info for each received friend. Set the user info and</span>
<a class='l d3' name=1093 href="#1093">1093</a> <span class='c'></span>  <span class='c'>// create the participant.</span>
<a class='l d3' name=1094 href="#1094">1094</a> <span class='c'></span>  <span class='a'>onLookupReceived</span>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aData">aData</a>) {
<a class='l d3' name=1095 href="#1095">1095</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=users">users</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=JSON">JSON</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=parse">parse</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aData">aData</a>);
<a class='l d3' name=1096 href="#1096">1096</a>     <span class='v'>for </span>(<span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=user">user</a> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=of">of</a> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=users">users</a>) {
<a class='l d3' name=1097 href="#1097">1097</a>       <span class='v'>this.</span><span class='a'>setUserInfo</span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=user">user</a>);
<a class='l d3' name=1098 href="#1098">1098</a>       <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=timeline">timeline</a>.<span class='a'>_ensureParticipantExists</span>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=user">user</a>.<span class='a'>screen_name</span>);
<a class='l d3' name=1099 href="#1099">1099</a>     }
<a class='l d3' name=1100 href="#1100">1100</a>   },
<a class='l d3' name=1101 href="#1101">1101</a> 
<a class='l d3' name=1102 href="#1102">1102</a>   <span class='a'>onConfigReceived</span>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aData">aData</a>) {
<a class='l d3' name=1103 href="#1103">1103</a>     <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=config">config</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=JSON">JSON</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=parse">parse</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aData">aData</a>);
<a class='l d3' name=1104 href="#1104">1104</a>   },
<a class='l d3' name=1105 href="#1105">1105</a> 
<a class='l d3' name=1106 href="#1106">1106</a>   <span class='c'>// Allow us to reopen the timeline via the join chat menu.</span>
<a class='l d3' name=1107 href="#1107">1107</a> <span class='c'></span>  <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=canJoinChat">canJoinChat</a>() { <span class='v'>return </span><span class='v'>true;</span> },
<a class='l d3' name=1108 href="#1108">1108</a>   <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=joinChat">joinChat</a>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aComponents">aComponents</a>) {
<a class='l d3' name=1109 href="#1109">1109</a>     <span class='c'>// The 'timeline' getter opens a timeline conversation if none exists.</span>
<a class='l d3' name=1110 href="#1110">1110</a> <span class='c'></span>    <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=timeline">timeline</a>;
<a class='l d3' name=1111 href="#1111">1111</a>   }
<a class='l d3' name=1112 href="#1112">1112</a> };
<a class='l d3' name=1113 href="#1113">1113</a> 
<a class='l d3' name=1114 href="#1114">1114</a> <span class='c'>// Shortcut to get the JavaScript account object.</span>
<a class='l d3' name=1115 href="#1115">1115</a> <span class='c'></span><span class='v'>function </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=getAccount">getAccount</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aConv">aConv</a>) { <span class='v'>return </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aConv">aConv</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=wrappedJSObject">wrappedJSObject</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=_account">_account</a>; }
<a class='l d3' name=1116 href="#1116">1116</a> 
<a class='l d3' name=1117 href="#1117">1117</a> <span class='v'>function </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=TwitterProtocol">TwitterProtocol</a>() {
<a class='l d3' name=1118 href="#1118">1118</a>   <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=registerCommands">registerCommands</a>();
<a class='l d3' name=1119 href="#1119">1119</a> }
<a class='l d3' name=1120 href="#1120">1120</a> <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=TwitterProtocol">TwitterProtocol</a>.<span class='v'>prototype </span>= {
<a class='l d3' name=1121 href="#1121">1121</a>   <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=__proto__">__proto__</a>: <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=GenericProtocolPrototype">GenericProtocolPrototype</a>,
<a class='l d3' name=1122 href="#1122">1122</a>   <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=normalizedName">normalizedName</a>() { <span class='v'>return </span><span class='s'>"twitter"</span>; },
<a class='l d3' name=1123 href="#1123">1123</a>   <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=name">name</a>() { <span class='v'>return </span><span class='a'>_</span>(<span class='s'>"twitter.protocolName"</span>); },
<a class='l d3' name=1124 href="#1124">1124</a>   <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=iconBaseURI">iconBaseURI</a>() { <span class='v'>return </span><span class='s'>"chrome://prpl-twitter/skin/"</span>; },
<a class='l d3' name=1125 href="#1125">1125</a>   <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=noPassword">noPassword</a>() { <span class='v'>return </span><span class='v'>true;</span> },
<a class='l d3' name=1126 href="#1126">1126</a>   <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=options">options</a>: {
<a class='l d3' name=1127 href="#1127">1127</a>     <span class='s'>"track"</span>: {<span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=label">label</a>() { <span class='v'>return </span><span class='a'>_</span>(<span class='s'>"options.track"</span>); }, <span class='v'>default: </span><span class='s'>""</span>}
<a class='l d3' name=1128 href="#1128">1128</a>   },
<a class='l d3' name=1129 href="#1129">1129</a>   <span class='c'>// Replace the command name in the help string so translators do not attempt</span>
<a class='l d3' name=1130 href="#1130">1130</a> <span class='c'></span>  <span class='c'>// to translate it.</span>
<a class='l d3' name=1131 href="#1131">1131</a> <span class='c'></span>  <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=commands">commands</a>: [
<a class='l d3' name=1132 href="#1132">1132</a>     {
<a class='l d3' name=1133 href="#1133">1133</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=name">name</a>: <span class='s'>"follow"</span>,
<a class='l d3' name=1134 href="#1134">1134</a>       <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=helpString">helpString</a>() { <span class='v'>return </span><span class='a'>_</span>(<span class='s'>"command.follow"</span>, <span class='s'>"follow"</span>); },
<a class='l d3' name=1135 href="#1135">1135</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=run">run</a>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aMsg">aMsg</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aConv">aConv</a>) {
<a class='l d3' name=1136 href="#1136">1136</a>         <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aMsg">aMsg</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aMsg">aMsg</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=trim">trim</a>();
<a class='l d3' name=1137 href="#1137">1137</a>         <span class='v'>if </span>(!<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aMsg">aMsg</a>)
<a class='l d3' name=1138 href="#1138">1138</a>           <span class='v'>return </span><span class='v'>false;</span>
<a class='l d3' name=1139 href="#1139">1139</a>         <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=account">account</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=getAccount">getAccount</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aConv">aConv</a>);
<a class='l d3' name=1140 href="#1140">1140</a>         <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aMsg">aMsg</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=split">split</a>(<span class='s'>" "</span>).<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=forEach">forEach</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=account">account</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=follow">follow</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=account">account</a>);
<a class='l d3' name=1141 href="#1141">1141</a>         <span class='v'>return </span><span class='v'>true;</span>
<a class='l d3' name=1142 href="#1142">1142</a>       }
<a class='l d3' name=1143 href="#1143">1143</a>     },
<a class='l d3' name=1144 href="#1144">1144</a>     {
<a class='l d3' name=1145 href="#1145">1145</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=name">name</a>: <span class='s'>"unfollow"</span>,
<a class='l d3' name=1146 href="#1146">1146</a>       <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=helpString">helpString</a>() { <span class='v'>return </span><span class='a'>_</span>(<span class='s'>"command.unfollow"</span>, <span class='s'>"unfollow"</span>); },
<a class='l d3' name=1147 href="#1147">1147</a>       <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=run">run</a>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aMsg">aMsg</a>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aConv">aConv</a>) {
<a class='l d3' name=1148 href="#1148">1148</a>         <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aMsg">aMsg</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aMsg">aMsg</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=trim">trim</a>();
<a class='l d3' name=1149 href="#1149">1149</a>         <span class='v'>if </span>(!<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aMsg">aMsg</a>)
<a class='l d3' name=1150 href="#1150">1150</a>           <span class='v'>return </span><span class='v'>false;</span>
<a class='l d3' name=1151 href="#1151">1151</a>         <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=account">account</a> = <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=getAccount">getAccount</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aConv">aConv</a>);
<a class='l d3' name=1152 href="#1152">1152</a>         <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=aMsg">aMsg</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=split">split</a>(<span class='s'>" "</span>).<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=forEach">forEach</a>(<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=account">account</a>.<span class='a'>stopFollowing</span>, <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=account">account</a>);
<a class='l d3' name=1153 href="#1153">1153</a>         <span class='v'>return </span><span class='v'>true;</span>
<a class='l d3' name=1154 href="#1154">1154</a>       }
<a class='l d3' name=1155 href="#1155">1155</a>     }
<a class='l d3' name=1156 href="#1156">1156</a>   ],
<a class='l d3' name=1157 href="#1157">1157</a>   <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=getAccount">getAccount</a>: <span class='v'>function(</span><span class='a'>aImAccount</span>) { <span class='v'>return </span><span class='v'>new </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Account">Account</a>(<span class='v'>this,</span> <span class='a'>aImAccount</span>); },
<a class='l d3' name=1158 href="#1158">1158</a>   <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=classID">classID</a>: <a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=Components">Components</a>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=ID">ID</a>(<span class='s'>"{31082ff6-1de8-422b-ab60-ca0ac0b2af13}"</span>)
<a class='l d3' name=1159 href="#1159">1159</a> };
<a class='l d3' name=1160 href="#1160">1160</a> 
<a class='l d3' name=1161 href="#1161">1161</a> <span class='v'>var </span><a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=NSGetFactory">NSGetFactory</a> = <span class='a'>XPCOMUtils</span>.<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=generateNSGetFactory">generateNSGetFactory</a>([<a class="d" href="http://mxr.mozilla.org/comm-central/ident?i=TwitterProtocol">TwitterProtocol</a>]);
<a class='l d3' name=1162 href="#1162">1162</a> </span></pre><form name='revs' id='revs' class='aftercontent'
>view http://hg.mozilla.org/comm-central/rev/
<select name='rev' id='rev' onchange='changerev()'>
<option value="330bcc2089a8" selected="1">330bcc2089a8 (2016-03-29 21:05 +0200) Sourab Reddy (current version)</option>
<option value="a98dbd50cf2a">a98dbd50cf2a (2016-03-08 20:20 -0500) Arlo Breault</option>
<option value="be910446f19a">be910446f19a (2016-01-23 15:53 +0900) Tooru Fujisawa</option>
<option value="17e3470d8d8d">17e3470d8d8d (2016-01-12 00:27 +0100) Sebastian Hengst</option>
<option value="a69b34c19f9a">a69b34c19f9a (2015-11-20 11:34 +0100) aleth</option>
<option value="ced21c95ce61">ced21c95ce61 (2015-10-30 00:18 +0100) aleth</option>
<option value="29fdfd7d6ee1">29fdfd7d6ee1 (2015-10-30 00:11 +0100) aleth</option>
<option value="78ab64eb195b">78ab64eb195b (2015-10-11 00:23 +0300) Magnus Melin</option>
<option value="19a8584b53b8">19a8584b53b8 (2015-08-14 05:43 +0900) Tooru Fujisawa</option>
<option value="578db539d403">578db539d403 (2014-07-08 03:20 +0530) Nihanth Subramanya</option>
<option value="037c8b33c0fa">037c8b33c0fa (2015-05-01 21:53 +0200) Sebastian Hengst</option>
<option value="2c13ad27779f">2c13ad27779f (2015-04-23 19:12 +0200) aleth</option>
<option value="2608fae8b13b">2608fae8b13b (2014-06-04 13:15 -0400) Patrick Cloke</option>
<option value="1023b47fd0ff">1023b47fd0ff (2014-05-29 21:46 -0400) Patrick Cloke</option>
<option value="ffcaadc29781">ffcaadc29781 (2014-05-07 20:19 -0400) Patrick Cloke</option>
<option value="b63aa9c26ecf">b63aa9c26ecf (2014-03-12 09:27 -0400) Patrick Cloke</option>
<option value="f81a23bfefcd">f81a23bfefcd (2014-01-12 19:15 +0100) Florian Qu?ze</option>
<option value="f64f0684d462">f64f0684d462 (2013-11-27 13:08 -0500) Patrick Cloke</option>
<option value="667a503cf3a1">667a503cf3a1 (2013-11-09 22:16 -0500) aleth</option>
<option value="f82ee7dc794e">f82ee7dc794e (2013-07-29 21:41 -0400) Patrick Cloke</option>
<option value="85591ce42460">85591ce42460 (2013-06-20 16:05 -0400) Patrick Cloke</option>
<option value="e3f7e6924f84">e3f7e6924f84 (2013-06-28 00:56 +0200) Alexander L. Slovesnik</option>
<option value="60ce74aa689d">60ce74aa689d (2013-04-27 23:49 +0200) aleth</option>
<option value="4dc14a57dc7f">4dc14a57dc7f (2013-03-24 14:57 -0400) Patrick Cloke</option>
<option value="e0e7773c67b2">e0e7773c67b2 (2013-04-05 23:35 +0200) Benedikt Pfeifer</option>
<option value="458a2b9a5ccb">458a2b9a5ccb (2013-04-05 23:14 +0200) aleth</option>
<option value="41e9bec14f02">41e9bec14f02 (2013-03-16 14:11 -0400) Patrick Cloke</option>
<option value="087a5a71c065">087a5a71c065 (2013-03-13 18:47 -0400) Patrick Cloke</option>
<option value="a5a72fcd15dc">a5a72fcd15dc (2013-03-15 22:38 +0100) Patrick Cloke</option>
<option value="2d2a35cbf777">2d2a35cbf777 (2013-03-06 11:33 +0100) Florian Qu?ze</option>
<option value="a77059d5477c">a77059d5477c (2013-03-03 16:38 -0500) Patrick Cloke</option>
<option value="1cdbef7c7380">1cdbef7c7380 (2013-03-04 06:22 -0500) Patrick Cloke</option>
<option value="ae97345ea550">ae97345ea550 (2013-02-10 22:33 +0100) Sebastian Hengst</option>
<option value="79e8c91ebfb4">79e8c91ebfb4 (2013-01-29 23:00 +0100) Florian Qu?ze</option>
<option value="fb608ad5ec65">fb608ad5ec65 (2012-11-28 23:40 +0100) aleth</option>
<option value="0bb47f36a170">0bb47f36a170 (2012-11-28 01:18 +0100) Florian Qu?ze</option>
<option value="5ed1ff1cf18e">5ed1ff1cf18e (2012-11-10 23:47 +0100) Florian Qu?ze</option>
<option value="1f95b1a0578a">1f95b1a0578a (2012-10-26 06:40 +0200) aleth</option>
<option value="f169ceb3b6a2">f169ceb3b6a2 (2012-09-13 12:49 +0200) aleth</option>
<option value="5515fabb40c1">5515fabb40c1 (2012-09-04 19:17 +0200) aleth</option>
<option value="8b71247e6e7e">8b71247e6e7e (2012-08-28 02:38 +0200) aleth</option>
<option value="5d2b6860298c">5d2b6860298c (2012-08-28 01:56 +0200) aleth</option>
<option value="36dbb85f2399">36dbb85f2399 (2012-07-24 14:41 +0200) Florian Qu?ze</option>
<option value="71f2f9886b5c">71f2f9886b5c (2012-07-23 15:15 -0400) Florian Qu?ze</option>
<option value="e166e46c689d">e166e46c689d (2012-06-21 02:21 +0200) aleth</option>
<option value="a715092dccf1">a715092dccf1 (2012-06-13 00:14 +0200) Florian Qu?ze</option>
<option value="94b3f94cc0ba">94b3f94cc0ba (2012-06-10 22:42 +0200) Patrick Cloke</option>
<option value="5dbf497e11cf">5dbf497e11cf (2012-06-10 22:20 +0200) Florian Qu?ze</option>
<option value="23c9ab502000">23c9ab502000 (2012-06-06 00:19 +0200) aleth</option>
<option value="0f8f4f44f250">0f8f4f44f250 (2012-06-02 23:01 +0200) aleth</option>
<option value="e2835df49f17">e2835df49f17 (2012-05-31 13:00 +0200) Gervase Markham</option>
<option value="cc3f19e73451">cc3f19e73451 (2012-03-30 20:11 -0400) OHZEKI Tetsuharu</option>
<option value="dfe5c66c382e">dfe5c66c382e (2012-03-27 18:23 +0200) Florian Qu?ze</option>
<option value="198c9ae2f845">198c9ae2f845 (2012-01-30 12:46 +0100) Florian Qu?ze</option>
<option value="798d0f7e6171">798d0f7e6171 (2012-01-15 17:04 +0100) Patrick Cloke</option>
<option value="d95278adf5fe">d95278adf5fe (2011-12-23 11:46 +0100) Florian Qu?ze</option>
<option value="8ca2ad889faf">8ca2ad889faf (2011-12-22 00:34 +0100) Florian Qu?ze</option>
<option value="4a7b8c84cfe6">4a7b8c84cfe6 (2011-12-21 14:15 +0100) Patrick Cloke</option>
<option value="b9f20f642eb2">b9f20f642eb2 (2011-12-12 15:32 +0100) Florian Qu?ze</option>
<option value="d90e1667cecc">d90e1667cecc (2011-12-12 00:11 +0100) Florian Qu?ze</option>
<option value="1d9d3e80fd8c">1d9d3e80fd8c (2011-12-07 16:53 +0100) Florian Qu?ze</option>
<option value="b3f560c1484b">b3f560c1484b (2011-12-06 19:02 +0100) Florian Qu?ze</option>
<option value="11a3ae8c5691">11a3ae8c5691 (2011-11-20 23:18 +0100) Florian Qu?ze</option>
<option value="e6e9b2de7898">e6e9b2de7898 (2011-11-18 02:09 +0100) Florian Qu?ze</option>
<option value="93660b39fdf1">93660b39fdf1 (2011-11-09 23:19 +0100) Florian Qu?ze</option>
<option value="fa5c8041ed00">fa5c8041ed00 (2011-11-09 23:13 +0100) Patrick Cloke</option>
<option value="c2abdd4a9b37">c2abdd4a9b37 (2011-11-09 14:47 +0100) Florian Qu?ze</option>
<option value="466e354185cf">466e354185cf (2011-11-09 01:16 +0100) Florian Qu?ze</option>
<option value="9d0c3d6cdf63">9d0c3d6cdf63 (2011-10-29 02:17 +0200) Florian Qu?ze</option>
<option value="61c749cdb7ee">61c749cdb7ee (2013-11-27 13:08 -0500) Patrick Cloke</option>
<option value="5761c271a566">5761c271a566 (2013-11-09 22:16 -0500) aleth</option>
<option value="a375d55b4148">a375d55b4148 (2013-06-28 00:56 +0200) Alexander L. Slovesnik</option>
<option value="06cdc5f8ea07">06cdc5f8ea07 (2013-04-27 23:49 +0200) aleth</option>
<option value="1bfad1b005f0">1bfad1b005f0 (2013-03-24 14:57 -0400) Patrick Cloke</option>
<option value="133082203440">133082203440 (2013-04-05 23:35 +0200) Benedikt Pfeifer</option>
<option value="72567e4d363a">72567e4d363a (2013-04-05 23:14 +0200) aleth</option>
<option value="ce66b3977e6e">ce66b3977e6e (2013-03-13 18:47 -0400) Patrick Cloke</option>
<option value="174e953530d4">174e953530d4 (2013-03-15 22:38 +0100) Patrick Cloke</option>
<option value="aa5fbdd584dc">aa5fbdd584dc (2013-03-03 16:38 -0500) Patrick Cloke</option>
<option value="5387ac2aed9d">5387ac2aed9d (2013-03-04 06:22 -0500) Patrick Cloke</option>
<option value="4c2345e03ee4">4c2345e03ee4 (2013-07-29 21:41 -0400) Patrick Cloke</option>
<option value="c29c9f0c7405">c29c9f0c7405 (2013-06-20 16:05 -0400) Patrick Cloke</option>
<option value="d39a8d280ac3">d39a8d280ac3 (2013-03-16 14:11 -0400) Patrick Cloke</option>
<option value="361ace8a7590">361ace8a7590 (2013-03-06 11:33 +0100) Florian Qu?ze</option>
<option value="015b96371ec6">015b96371ec6 (2013-01-29 23:00 +0100) Florian Qu?ze</option>
<option value="d5ed81e22f0c">d5ed81e22f0c (2012-11-28 23:40 +0100) aleth</option>
<option value="b174788a4aa9">b174788a4aa9 (2012-11-28 01:18 +0100) Florian Qu?ze</option>
<option value="61c46ff57276">61c46ff57276 (2013-02-10 22:33 +0100) Sebastian Hengst</option>
<option value="57b74bac41df">57b74bac41df (2012-11-10 23:47 +0100) Florian Qu?ze</option>
<option value="f22906afbdd3">f22906afbdd3 (2012-10-26 06:40 +0200) aleth</option>
<option value="10ed7ec08076">10ed7ec08076 (2012-09-13 12:49 +0200) aleth</option>
<option value="3e0437d26144">3e0437d26144 (2012-09-04 19:17 +0200) aleth</option>
<option value="b552545180b7">b552545180b7 (2012-08-28 02:38 +0200) aleth</option>
<option value="c828b03dc54f">c828b03dc54f (2012-08-28 01:56 +0200) aleth</option>
<option value="99fa53a669b4">99fa53a669b4 (2012-07-27 14:11 -0400) Florian Qu?ze</option>
<option value="8bdaa2fe9854">8bdaa2fe9854 (2012-06-21 02:21 +0200) aleth</option>
<option value="da7005079cd4">da7005079cd4 (2012-06-10 22:42 +0200) Patrick Cloke</option>
<option value="4c45c0375031">4c45c0375031 (2012-06-10 22:20 +0200) Florian Qu?ze</option>
<option value="3a0c9339357c">3a0c9339357c (2012-06-06 00:19 +0200) aleth</option>
<option value="e9cc69e37805">e9cc69e37805 (2012-06-02 23:01 +0200) aleth</option>
<option value="62a941631475">62a941631475 (2012-07-23 15:15 -0400) Florian Qu?ze</option>
<option value="f00ab2e3c12d">f00ab2e3c12d (2012-06-14 16:03 +0200) Florian Qu?ze</option>
<option value="84ac3c711098">84ac3c711098 (2012-05-30 17:48 +0100) Gervase Markham</option>
<option value="c8c6cea29b05">c8c6cea29b05 (2012-03-27 18:23 +0200) Florian Qu?ze</option>
<option value="381736b3d3b9">381736b3d3b9 (2012-03-30 20:11 -0400) OHZEKI Tetsuharu</option>
<option value="8cdfed92867f">8cdfed92867f (2012-03-13 02:14 +0100) Florian Qu?ze</option>

</select>/chat/protocols/twitter/twitter.js
</form>
</p>

<!-- Mirrored from mxr.mozilla.org/comm-central/source/chat/protocols/twitter/twitter.js by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 01 May 2016 19:39:35 GMT -->
</html>
