<!DOCTYPE html>
<html>

<!-- Mirrored from mxr.mozilla.org/mozilla-central/source/dom/apps/Webapps.js by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 01 Oct 2015 18:59:21 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta name="GENERATOR" content="lxr-1998-06-10: http://lxr.linux.no">
<link rel="icon" href="../../../../mxr.png" type="image/png">
<title>mozilla-central mozilla/dom/apps/Webapps.js</title>
<link rel='stylesheet' title='' href='../../../style/style.css' type='text/css'>
<link rel='alternate stylesheet' title='Alt-1' href='../../../style/alt1-js.css' type='text/css'>

<script src='../../../../coloration.js'></script>
<script src='../../../../script.js'></script>
</head>

<body   bgcolor="#FFFFFF" text="#000000"
	link="#0000EE" vlink="#551A8B" alink="#FF0000">

<table class=banner bgcolor="#000000" width="100%" border=0 cellpadding=0 cellspacing=0>
<tr><td><a class="logo" href="http://www.mozilla.org/"><img
 src="../../../../../www.mozilla.org/images/mozilla-banner.gif" alt=""
 border=0 width=600 height=58></a></td></tr></table>

<table class=header border=0 cellpadding=12 cellspacing=0 width="100%">
 <tr>
  <td align=left valign=middle>
   <nobr><font size="+2"><b><a href="http://mxr.mozilla.org/">Mozilla Cross-Reference</a></b>
</nobr><i><a href="http://mxr.mozilla.org/mozilla-central">mozilla-central</a></i>
</font>
   <br><b><a href="http://mxr.mozilla.org/mozilla-central/source/">mozilla</a>/ <a href="http://mxr.mozilla.org/mozilla-central/source/dom/">dom</a>/ <a href="http://mxr.mozilla.org/mozilla-central/source/dom/apps/">apps</a>/ <a href="Webapps.html">Webapps.js</a> </b>
  </TD>

  <td align=right valign=top width="1%">
   <table border cellpadding=12 cellspacing=0>
    <tr>
     <td nowrap bgcolor="#FAFAFA">








<script>
function updateHgBlameHash(node, event) {
  if (!document.location.hash)
    return;
  var anchor = document.location.hash;
  anchor = anchor.replace("#", "#l");
  node.href =
    node.href.replace(/#.*|$/, anchor);
}
</script>
<a href="http://hg.mozilla.org/mozilla-central/filelog/2c1fb007137d/dom/apps/Webapps.js">Hg Log</a><br>
<a href="http://hg.mozilla.org/mozilla-central/annotate/2c1fb007137d/dom/apps/Webapps.js"
onfocus='updateHgBlameHash(this, event)'
onmouseover='updateHgBlameHash(this, event)'
>Hg Blame</a><br>



      <a href="../../../diff5e8e.html?file=/dom/apps/Webapps.js">Diff file</a><br>
      <a href="Webapps2af1.js?raw=1">Raw file</a><br>
     </TD>
    </TR>
   </table>
  </TD>



 </TR>
</table>

<form name='source' id='source' class='beforecontent'
>view using tree:
<select name='tree' id='tree' onchange='changetarget("http://mxr.mozilla.org/mozilla-central/", "http://mxr.mozilla.org/mozilla-central/source/dom/apps/mozilla-central/")'>
<option value="mozilla-aurora">mozilla-aurora</option>
<option value="mozilla-b2g34_v2_1">mozilla-b2g34_v2_1</option>
<option value="mozilla-b2g37_v2_2">mozilla-b2g37_v2_2</option>
<option value="mozilla-beta">mozilla-beta</option>
<option value="mozilla-central" selected=1>mozilla-central</option>
<option value="mozilla-esr38">mozilla-esr38</option>
<option value="mozilla-release">mozilla-release</option>

</select></form>



<pre lang='en'><style>.d2:before{content:' '} .d1:before{content:'  '} .d0:before{content:'   '} </style><span id='the-code'><a class='l d0' name=1 href="#1">1</a> <span class='c'>/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a class='l d0' name=2 href="#2">2</a> <span class='c'> * License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a class='l d0' name=3 href="#3">3</a> <span class='c'> * You can obtain one at <a href="http://mozilla.org/MPL/2.0/.">http://mozilla.org/MPL/2.0/.</a> */</span>
<a class='l d0' name=4 href="#4">4</a> 
<a class='l d0' name=5 href="#5">5</a> <span class='v'>const </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Cc">Cc</a> = <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Components">Components</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=classes">classes</a>;
<a class='l d0' name=6 href="#6">6</a> <span class='v'>const </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Ci">Ci</a> = <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Components">Components</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=interfaces">interfaces</a>;
<a class='l d0' name=7 href="#7">7</a> <span class='v'>const </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Cu">Cu</a> = <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Components">Components</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=utils">utils</a>;
<a class='l d0' name=8 href="#8">8</a> <span class='v'>const </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Cr">Cr</a> = <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Components">Components</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=results">results</a>;
<a class='l d0' name=9 href="#9">9</a> 
<a class='l d1' name=10 href="#10">10</a> <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Cu">Cu</a>.<span class='v'>import("resource://gre/modules/XPCOMUtils.jsm");
<a class='l d1' name=11 href="#11">11</a> </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Cu">Cu</a>.<span class='v'>import("resource://gre/modules/Services.jsm");
<a class='l d1' name=12 href="#12">12</a> </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Cu">Cu</a>.<span class='v'>import("resource://gre/modules/DOMRequestHelper.jsm");
<a class='l d1' name=13 href="#13">13</a> </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Cu">Cu</a>.<span class='v'>import("resource://gre/modules/AppsUtils.jsm");
<a class='l d1' name=14 href="#14">14</a> </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Cu">Cu</a>.<span class='v'>import("resource://gre/modules/BrowserElementPromptService.jsm");
<a class='l d1' name=15 href="#15">15</a> </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Cu">Cu</a>.<span class='v'>import("resource://gre/modules/AppsServiceChild.jsm");
<a class='l d1' name=16 href="#16">16</a> </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Cu">Cu</a>.<span class='v'>import("resource://gre/modules/Preferences.jsm");
<a class='l d1' name=17 href="#17">17</a> </span>
<a class='l d1' name=18 href="#18">18</a> <span class='a'>XPCOMUtils</span>.<span class='a'>defineLazyServiceGetter</span>(<span class='v'>this,</span> <span class='s'>"appsService"</span>,
<a class='l d1' name=19 href="#19">19</a>                                    <span class='s'>"@mozilla.org/AppsService;1"</span>,
<a class='l d1' name=20 href="#20">20</a>                                    <span class='s'>"nsIAppsService"</span>);
<a class='l d1' name=21 href="#21">21</a> 
<a class='l d1' name=22 href="#22">22</a> <span class='a'>XPCOMUtils</span>.<span class='a'>defineLazyServiceGetter</span>(<span class='v'>this,</span> <span class='s'>"cpmm"</span>,
<a class='l d1' name=23 href="#23">23</a>                                    <span class='s'>"@mozilla.org/childprocessmessagemanager;1"</span>,
<a class='l d1' name=24 href="#24">24</a>                                    <span class='s'>"nsIMessageSender"</span>);
<a class='l d1' name=25 href="#25">25</a> 
<a class='l d1' name=26 href="#26">26</a> <span class='v'>function </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=debug">debug</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aMsg">aMsg</a>) {
<a class='l d1' name=27 href="#27">27</a>   <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=dump">dump</a>(<span class='s'>"-*- Webapps.js "</span> + <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aMsg">aMsg</a> + <span class='s'>"\n"</span>);
<a class='l d1' name=28 href="#28">28</a> }
<a class='l d1' name=29 href="#29">29</a> 
<a class='l d1' name=30 href="#30">30</a> <span class='v'>function </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=convertAppsArray">convertAppsArray</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aApps">aApps</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aWindow">aWindow</a>) {
<a class='l d1' name=31 href="#31">31</a>   <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=apps">apps</a> = <span class='v'>new </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aWindow">aWindow</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Array">Array</a>();
<a class='l d1' name=32 href="#32">32</a>   <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aApps">aApps</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=forEach">forEach</a>((<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aApp">aApp</a>) =&gt; {
<a class='l d1' name=33 href="#33">33</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=obj">obj</a> = <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=createContentApplicationObject">createContentApplicationObject</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aWindow">aWindow</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aApp">aApp</a>);
<a class='l d1' name=34 href="#34">34</a>     <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=apps">apps</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=push">push</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=obj">obj</a>);
<a class='l d1' name=35 href="#35">35</a>   });
<a class='l d1' name=36 href="#36">36</a>   <span class='v'>return </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=apps">apps</a>;
<a class='l d1' name=37 href="#37">37</a> }
<a class='l d1' name=38 href="#38">38</a> 
<a class='l d1' name=39 href="#39">39</a> <span class='v'>function </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=WebappsRegistry">WebappsRegistry</a>() {
<a class='l d1' name=40 href="#40">40</a> }
<a class='l d1' name=41 href="#41">41</a> 
<a class='l d1' name=42 href="#42">42</a> <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=WebappsRegistry">WebappsRegistry</a>.<span class='v'>prototype </span>= {
<a class='l d1' name=43 href="#43">43</a>   <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=__proto__">__proto__</a>: <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=DOMRequestIpcHelper">DOMRequestIpcHelper</a>.<span class='v'>prototype,</span>
<a class='l d1' name=44 href="#44">44</a> 
<a class='l d1' name=45 href="#45">45</a>   <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=receiveMessage">receiveMessage</a>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aMessage">aMessage</a>) {
<a class='l d1' name=46 href="#46">46</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a> = <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aMessage">aMessage</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=json">json</a>;
<a class='l d1' name=47 href="#47">47</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>;
<a class='l d1' name=48 href="#48">48</a>     <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aMessage">aMessage</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=name">name</a> != <span class='s'>"Webapps:AdditionalLanguageChange"</span>) {
<a class='l d1' name=49 href="#49">49</a>       <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=oid">oid</a> != <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_id">_id</a>) {
<a class='l d1' name=50 href="#50">50</a>         <span class='v'>return
<a class='l d1' name=51 href="#51">51</a> </span>      }
<a class='l d1' name=52 href="#52">52</a> 
<a class='l d1' name=53 href="#53">53</a>       <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aMessage">aMessage</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=name">name</a> == <span class='s'>"Webapps:GetAdditionalLanguages:Return"</span> ||
<a class='l d1' name=54 href="#54">54</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aMessage">aMessage</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=name">name</a> == <span class='s'>"Webapps:GetLocalizationResource:Return"</span>) {
<a class='l d1' name=55 href="#55">55</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a> = <span class='v'>this.</span><span class='a'>takePromiseResolver</span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=requestID">requestID</a>);
<a class='l d1' name=56 href="#56">56</a>       } <span class='v'>else </span>{
<a class='l d1' name=57 href="#57">57</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a> = <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=getRequest">getRequest</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=requestID">requestID</a>);
<a class='l d1' name=58 href="#58">58</a>       }
<a class='l d1' name=59 href="#59">59</a>       <span class='v'>if </span>(!<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>) {
<a class='l d1' name=60 href="#60">60</a>         <span class='v'>return;</span>
<a class='l d1' name=61 href="#61">61</a>       }
<a class='l d1' name=62 href="#62">62</a>     }
<a class='l d1' name=63 href="#63">63</a> 
<a class='l d1' name=64 href="#64">64</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=app">app</a> = <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=app">app</a>;
<a class='l d1' name=65 href="#65">65</a>     <span class='v'>switch </span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aMessage">aMessage</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=name">name</a>) {
<a class='l d1' name=66 href="#66">66</a>       <span class='v'>case </span><span class='s'>"Webapps:Install:Return:OK"</span>:
<a class='l d1' name=67 href="#67">67</a>         <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=removeMessageListeners">removeMessageListeners</a>(<span class='s'>"Webapps:Install:Return:KO"</span>);
<a class='l d1' name=68 href="#68">68</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Services">Services</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=DOMRequest">DOMRequest</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=fireSuccess">fireSuccess</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=createContentApplicationObject">createContentApplicationObject</a>(<span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=app">app</a>));
<a class='l d1' name=69 href="#69">69</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=cpmm">cpmm</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=sendAsyncMessage">sendAsyncMessage</a>(<span class='s'>"Webapps:Install:Return:Ack"</span>,
<a class='l d1' name=70 href="#70">70</a>                               { <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a> : <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=app">app</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a> });
<a class='l d1' name=71 href="#71">71</a>         <span class='v'>break;
<a class='l d1' name=72 href="#72">72</a> </span>      <span class='v'>case </span><span class='s'>"Webapps:Install:Return:KO"</span>:
<a class='l d1' name=73 href="#73">73</a>         <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=removeMessageListeners">removeMessageListeners</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aMessage">aMessage</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=name">name</a>);
<a class='l d1' name=74 href="#74">74</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Services">Services</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=DOMRequest">DOMRequest</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=fireError">fireError</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=error">error</a> || <span class='s'>"DENIED"</span>);
<a class='l d1' name=75 href="#75">75</a>         <span class='v'>break;
<a class='l d1' name=76 href="#76">76</a> </span>      <span class='v'>case </span><span class='s'>"Webapps:GetSelf:Return:OK"</span>:
<a class='l d1' name=77 href="#77">77</a>         <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=removeMessageListeners">removeMessageListeners</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aMessage">aMessage</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=name">name</a>);
<a class='l d1' name=78 href="#78">78</a>         <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=apps">apps</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=length">length</a>) {
<a class='l d1' name=79 href="#79">79</a>           <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=app">app</a> = <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=apps">apps</a>[0];
<a class='l d1' name=80 href="#80">80</a>           <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Services">Services</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=DOMRequest">DOMRequest</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=fireSuccess">fireSuccess</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=createContentApplicationObject">createContentApplicationObject</a>(<span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=app">app</a>));
<a class='l d1' name=81 href="#81">81</a>         } <span class='v'>else </span>{
<a class='l d1' name=82 href="#82">82</a>           <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Services">Services</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=DOMRequest">DOMRequest</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=fireSuccess">fireSuccess</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>, <span class='v'>null)</span>;
<a class='l d1' name=83 href="#83">83</a>         }
<a class='l d1' name=84 href="#84">84</a>         <span class='v'>break;
<a class='l d1' name=85 href="#85">85</a> </span>      <span class='v'>case </span><span class='s'>"Webapps:CheckInstalled:Return:OK"</span>:
<a class='l d1' name=86 href="#86">86</a>         <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=removeMessageListeners">removeMessageListeners</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aMessage">aMessage</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=name">name</a>);
<a class='l d1' name=87 href="#87">87</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Services">Services</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=DOMRequest">DOMRequest</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=fireSuccess">fireSuccess</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=createContentApplicationObject">createContentApplicationObject</a>(<span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=app">app</a>));
<a class='l d1' name=88 href="#88">88</a>         <span class='v'>break;
<a class='l d1' name=89 href="#89">89</a> </span>      <span class='v'>case </span><span class='s'>"Webapps:GetInstalled:Return:OK"</span>:
<a class='l d1' name=90 href="#90">90</a>         <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=removeMessageListeners">removeMessageListeners</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aMessage">aMessage</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=name">name</a>);
<a class='l d1' name=91 href="#91">91</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Services">Services</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=DOMRequest">DOMRequest</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=fireSuccess">fireSuccess</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=convertAppsArray">convertAppsArray</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=apps">apps</a>, <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>));
<a class='l d1' name=92 href="#92">92</a>         <span class='v'>break;
<a class='l d1' name=93 href="#93">93</a> </span>      <span class='v'>case </span><span class='s'>"Webapps:AdditionalLanguageChange"</span>:
<a class='l d1' name=94 href="#94">94</a>         <span class='c'>// Check if the current page is from the app receiving the event.</span>
<a class='l d1' name=95 href="#95">95</a> <span class='c'></span>        <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a> = <span class='a'>AppsUtils</span>.<span class='a'>getAppManifestURLFromWindow</span>(<span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>);
<a class='l d1' name=96 href="#96">96</a>         <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a> &amp;&amp; <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a> == <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>) {
<a class='l d1' name=97 href="#97">97</a>           <span class='c'>// Let's dispatch an "additionallanguageschange" event on the document.</span>
<a class='l d1' name=98 href="#98">98</a> <span class='c'></span>          <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=doc">doc</a> = <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=document">document</a>;
<a class='l d1' name=99 href="#99">99</a>           <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=event">event</a> = <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=doc">doc</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=createEvent">createEvent</a>(<span class='s'>"CustomEvent"</span>);
<a class='l d2' name=100 href="#100">100</a>           <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=event">event</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=initCustomEvent">initCustomEvent</a>(<span class='s'>"additionallanguageschange"</span>, <span class='v'>true, </span><span class='v'>true,
<a class='l d2' name=101 href="#101">101</a> </span>                                <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Cu">Cu</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=cloneInto">cloneInto</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=languages">languages</a>, <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>));
<a class='l d2' name=102 href="#102">102</a>           <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=doc">doc</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=dispatchEvent">dispatchEvent</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=event">event</a>);
<a class='l d2' name=103 href="#103">103</a>         }
<a class='l d2' name=104 href="#104">104</a>         <span class='v'>break;
<a class='l d2' name=105 href="#105">105</a> </span>      <span class='v'>case </span><span class='s'>"Webapps:GetLocalizationResource:Return"</span>:
<a class='l d2' name=106 href="#106">106</a>         <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=removeMessageListeners">removeMessageListeners</a>([<span class='s'>"Webapps:GetLocalizationResource:Return"</span>]);
<a class='l d2' name=107 href="#107">107</a>         <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=error">error</a>) {
<a class='l d2' name=108 href="#108">108</a>           <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=reject">reject</a>(<span class='v'>new </span><span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=DOMError">DOMError</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=error">error</a>));
<a class='l d2' name=109 href="#109">109</a>         } <span class='v'>else </span>{
<a class='l d2' name=110 href="#110">110</a>           <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=resolve">resolve</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Cu">Cu</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=cloneInto">cloneInto</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=data">data</a>, <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>));
<a class='l d2' name=111 href="#111">111</a>         }
<a class='l d2' name=112 href="#112">112</a>         <span class='v'>break;
<a class='l d2' name=113 href="#113">113</a> </span>    }
<a class='l d2' name=114 href="#114">114</a>     <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=removeRequest">removeRequest</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=requestID">requestID</a>);
<a class='l d2' name=115 href="#115">115</a>   },
<a class='l d2' name=116 href="#116">116</a> 
<a class='l d2' name=117 href="#117">117</a>   <span class='a'>_getOrigin</span>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aURL">aURL</a>) {
<a class='l d2' name=118 href="#118">118</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=uri">uri</a> = <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Services">Services</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=io">io</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=newURI">newURI</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aURL">aURL</a>, <span class='v'>null,</span> <span class='v'>null)</span>;
<a class='l d2' name=119 href="#119">119</a>     <span class='v'>return </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=uri">uri</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=prePath">prePath</a>;
<a class='l d2' name=120 href="#120">120</a>   },
<a class='l d2' name=121 href="#121">121</a> 
<a class='l d2' name=122 href="#122">122</a>   <span class='c'>// Checks that the URL scheme is appropriate (http or https) and</span>
<a class='l d2' name=123 href="#123">123</a> <span class='c'></span>  <span class='c'>// asynchronously fire an error on the DOM Request if it isn't.</span>
<a class='l d2' name=124 href="#124">124</a> <span class='c'></span>  <span class='a'>_validateURL</span>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aURL">aURL</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aRequest">aRequest</a>) {
<a class='l d2' name=125 href="#125">125</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=uri">uri</a>;
<a class='l d2' name=126 href="#126">126</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=res">res</a>;
<a class='l d2' name=127 href="#127">127</a> 
<a class='l d2' name=128 href="#128">128</a>     <span class='v'>try </span>{
<a class='l d2' name=129 href="#129">129</a>       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=uri">uri</a> = <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Services">Services</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=io">io</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=newURI">newURI</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aURL">aURL</a>, <span class='v'>null,</span> <span class='v'>null)</span>;
<a class='l d2' name=130 href="#130">130</a>       <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=uri">uri</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=schemeIs">schemeIs</a>(<span class='s'>"http"</span>) || <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=uri">uri</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=schemeIs">schemeIs</a>(<span class='s'>"https"</span>)) {
<a class='l d2' name=131 href="#131">131</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=res">res</a> = <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=uri">uri</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=spec">spec</a>;
<a class='l d2' name=132 href="#132">132</a>       }
<a class='l d2' name=133 href="#133">133</a>     } <span class='v'>catch(</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=e">e</a>) {
<a class='l d2' name=134 href="#134">134</a>       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Services">Services</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=DOMRequest">DOMRequest</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=fireErrorAsync">fireErrorAsync</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aRequest">aRequest</a>, <span class='s'>"INVALID_URL"</span>);
<a class='l d2' name=135 href="#135">135</a>       <span class='v'>return </span><span class='v'>false;</span>
<a class='l d2' name=136 href="#136">136</a>     }
<a class='l d2' name=137 href="#137">137</a> 
<a class='l d2' name=138 href="#138">138</a>     <span class='c'>// The scheme is incorrect, fire DOMRequest error.</span>
<a class='l d2' name=139 href="#139">139</a> <span class='c'></span>    <span class='v'>if </span>(!<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=res">res</a>) {
<a class='l d2' name=140 href="#140">140</a>       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Services">Services</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=DOMRequest">DOMRequest</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=fireErrorAsync">fireErrorAsync</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aRequest">aRequest</a>, <span class='s'>"INVALID_URL"</span>);
<a class='l d2' name=141 href="#141">141</a>       <span class='v'>return </span><span class='v'>false;</span>
<a class='l d2' name=142 href="#142">142</a>     }
<a class='l d2' name=143 href="#143">143</a> 
<a class='l d2' name=144 href="#144">144</a>     <span class='v'>return </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=uri">uri</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=spec">spec</a>;
<a class='l d2' name=145 href="#145">145</a>   },
<a class='l d2' name=146 href="#146">146</a> 
<a class='l d2' name=147 href="#147">147</a>   <span class='c'>// Checks that we run as a foreground page, and fire an error on the</span>
<a class='l d2' name=148 href="#148">148</a> <span class='c'></span>  <span class='c'>// DOM Request if we aren't.</span>
<a class='l d2' name=149 href="#149">149</a> <span class='c'></span>  <span class='a'>_ensureForeground</span>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aRequest">aRequest</a>) {
<a class='l d2' name=150 href="#150">150</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=docShell">docShell</a> = <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=QueryInterface">QueryInterface</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Ci">Ci</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=nsIInterfaceRequestor">nsIInterfaceRequestor</a>)
<a class='l d2' name=151 href="#151">151</a>                                .<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=getInterface">getInterface</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Ci">Ci</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=nsIWebNavigation">nsIWebNavigation</a>)
<a class='l d2' name=152 href="#152">152</a>                                .<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=QueryInterface">QueryInterface</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Ci">Ci</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=nsIDocShell">nsIDocShell</a>);
<a class='l d2' name=153 href="#153">153</a>     <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=docShell">docShell</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=isActive">isActive</a>) {
<a class='l d2' name=154 href="#154">154</a>       <span class='v'>return </span><span class='v'>true;</span>
<a class='l d2' name=155 href="#155">155</a>     }
<a class='l d2' name=156 href="#156">156</a> 
<a class='l d2' name=157 href="#157">157</a>     <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Services">Services</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=DOMRequest">DOMRequest</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=fireErrorAsync">fireErrorAsync</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aRequest">aRequest</a>, <span class='s'>"BACKGROUND_APP"</span>);
<a class='l d2' name=158 href="#158">158</a>     <span class='v'>return </span><span class='v'>false;</span>
<a class='l d2' name=159 href="#159">159</a>   },
<a class='l d2' name=160 href="#160">160</a> 
<a class='l d2' name=161 href="#161">161</a>   <span class='a'>_prepareInstall</span>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aURL">aURL</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aRequest">aRequest</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aParams">aParams</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=isPackage">isPackage</a>) {
<a class='l d2' name=162 href="#162">162</a>     <span class='v'>let </span><span class='a'>installURL</span> = <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=location">location</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=href">href</a>;
<a class='l d2' name=163 href="#163">163</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=requestID">requestID</a> = <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=getRequestId">getRequestId</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aRequest">aRequest</a>);
<a class='l d2' name=164 href="#164">164</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=receipts">receipts</a> = (<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aParams">aParams</a> &amp;&amp; <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aParams">aParams</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=receipts">receipts</a> &amp;&amp;
<a class='l d2' name=165 href="#165">165</a>                     <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Array">Array</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=isArray">isArray</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aParams">aParams</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=receipts">receipts</a>)) ? <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aParams">aParams</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=receipts">receipts</a>
<a class='l d2' name=166 href="#166">166</a>                                                      : [];
<a class='l d2' name=167 href="#167">167</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=categories">categories</a> = (<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aParams">aParams</a> &amp;&amp; <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aParams">aParams</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=categories">categories</a> &amp;&amp;
<a class='l d2' name=168 href="#168">168</a>                       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Array">Array</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=isArray">isArray</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aParams">aParams</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=categories">categories</a>)) ? <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aParams">aParams</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=categories">categories</a>
<a class='l d2' name=169 href="#169">169</a>                                                          : [];
<a class='l d2' name=170 href="#170">170</a> 
<a class='l d2' name=171 href="#171">171</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=principal">principal</a> = <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=document">document</a>.<span class='a'>nodePrincipal</span>;
<a class='l d2' name=172 href="#172">172</a> 
<a class='l d2' name=173 href="#173">173</a>     <span class='v'>return </span>{ <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=app">app</a>: {
<a class='l d2' name=174 href="#174">174</a>                     <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=installOrigin">installOrigin</a>: <span class='v'>this.</span><span class='a'>_getOrigin</span>(<span class='a'>installURL</span>),
<a class='l d2' name=175 href="#175">175</a>                     <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=origin">origin</a>: <span class='v'>this.</span><span class='a'>_getOrigin</span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aURL">aURL</a>),
<a class='l d2' name=176 href="#176">176</a>                     <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>: <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aURL">aURL</a>,
<a class='l d2' name=177 href="#177">177</a>                     <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=receipts">receipts</a>: <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=receipts">receipts</a>,
<a class='l d2' name=178 href="#178">178</a>                     <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=categories">categories</a>: <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=categories">categories</a>
<a class='l d2' name=179 href="#179">179</a>                   },
<a class='l d2' name=180 href="#180">180</a> 
<a class='l d2' name=181 href="#181">181</a>              <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=from">from</a>: <span class='a'>installURL</span>,
<a class='l d2' name=182 href="#182">182</a>              <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=oid">oid</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_id">_id</a>,
<a class='l d2' name=183 href="#183">183</a>              <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=topId">topId</a>: <span class='v'>this.</span><span class='a'>_topId</span>,
<a class='l d2' name=184 href="#184">184</a>              <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=requestID">requestID</a>: <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=requestID">requestID</a>,
<a class='l d2' name=185 href="#185">185</a>              <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=appId">appId</a>: <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=principal">principal</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=appId">appId</a>,
<a class='l d2' name=186 href="#186">186</a>              <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=isBrowser">isBrowser</a>: <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=principal">principal</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=isInBrowserElement">isInBrowserElement</a>,
<a class='l d2' name=187 href="#187">187</a>              <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=isPackage">isPackage</a>: <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=isPackage">isPackage</a>
<a class='l d2' name=188 href="#188">188</a>            };
<a class='l d2' name=189 href="#189">189</a>   },
<a class='l d2' name=190 href="#190">190</a> 
<a class='l d2' name=191 href="#191">191</a>   <span class='c'>// mozIDOMApplicationRegistry implementation</span>
<a class='l d2' name=192 href="#192">192</a> <span class='c'></span>
<a class='l d2' name=193 href="#193">193</a>   <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=install">install</a>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aURL">aURL</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aParams">aParams</a>) {
<a class='l d2' name=194 href="#194">194</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a> = <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=createRequest">createRequest</a>();
<a class='l d2' name=195 href="#195">195</a> 
<a class='l d2' name=196 href="#196">196</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=uri">uri</a> = <span class='v'>this.</span><span class='a'>_validateURL</span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aURL">aURL</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a>);
<a class='l d2' name=197 href="#197">197</a> 
<a class='l d2' name=198 href="#198">198</a>     <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=uri">uri</a> &amp;&amp; <span class='v'>this.</span><span class='a'>_ensureForeground</span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a>)) {
<a class='l d2' name=199 href="#199">199</a>       <span class='v'>this.</span><span class='a'>addMessageListeners</span>(<span class='s'>"Webapps:Install:Return:KO"</span>);
<a class='l d2' name=200 href="#200">200</a>       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=cpmm">cpmm</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=sendAsyncMessage">sendAsyncMessage</a>(<span class='s'>"Webapps:Install"</span>,
<a class='l d2' name=201 href="#201">201</a>                             <span class='v'>this.</span><span class='a'>_prepareInstall</span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=uri">uri</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aParams">aParams</a>, <span class='v'>false)</span>);
<a class='l d2' name=202 href="#202">202</a>     }
<a class='l d2' name=203 href="#203">203</a> 
<a class='l d2' name=204 href="#204">204</a>     <span class='v'>return </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a>;
<a class='l d2' name=205 href="#205">205</a>   },
<a class='l d2' name=206 href="#206">206</a> 
<a class='l d2' name=207 href="#207">207</a>   <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=getSelf">getSelf</a>: <span class='v'>function(</span>) {
<a class='l d2' name=208 href="#208">208</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a> = <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=createRequest">createRequest</a>();
<a class='l d2' name=209 href="#209">209</a>     <span class='v'>this.</span><span class='a'>addMessageListeners</span>(<span class='s'>"Webapps:GetSelf:Return:OK"</span>);
<a class='l d2' name=210 href="#210">210</a>     <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=cpmm">cpmm</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=sendAsyncMessage">sendAsyncMessage</a>(<span class='s'>"Webapps:GetSelf"</span>, { <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=origin">origin</a>: <span class='v'>this.</span><span class='a'>_getOrigin</span>(<span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=location">location</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=href">href</a>),
<a class='l d2' name=211 href="#211">211</a>                                                <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=appId">appId</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=document">document</a>.<span class='a'>nodePrincipal</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=appId">appId</a>,
<a class='l d2' name=212 href="#212">212</a>                                                <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=oid">oid</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_id">_id</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=topId">topId</a>: <span class='v'>this.</span><span class='a'>_topId</span>,
<a class='l d2' name=213 href="#213">213</a>                                                <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=requestID">requestID</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=getRequestId">getRequestId</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a>) });
<a class='l d2' name=214 href="#214">214</a>     <span class='v'>return </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a>;
<a class='l d2' name=215 href="#215">215</a>   },
<a class='l d2' name=216 href="#216">216</a> 
<a class='l d2' name=217 href="#217">217</a>   <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=checkInstalled">checkInstalled</a>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aManifestURL">aManifestURL</a>) {
<a class='l d2' name=218 href="#218">218</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a> = <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Services">Services</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=io">io</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=newURI">newURI</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aManifestURL">aManifestURL</a>, <span class='v'>null,</span> <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=document">document</a>.<span class='a'>baseURIObject</span>);
<a class='l d2' name=219 href="#219">219</a> 
<a class='l d2' name=220 href="#220">220</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a> = <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=createRequest">createRequest</a>();
<a class='l d2' name=221 href="#221">221</a> 
<a class='l d2' name=222 href="#222">222</a>     <span class='v'>try </span>{
<a class='l d2' name=223 href="#223">223</a>       <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=document">document</a>.<span class='a'>nodePrincipal</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=checkMayLoad">checkMayLoad</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>, <span class='v'>true,
<a class='l d2' name=224 href="#224">224</a> </span>                                                       <span class='v'>false)</span>;
<a class='l d2' name=225 href="#225">225</a>     } <span class='v'>catch </span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=ex">ex</a>) {
<a class='l d2' name=226 href="#226">226</a>       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Services">Services</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=DOMRequest">DOMRequest</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=fireErrorAsync">fireErrorAsync</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a>, <span class='s'>"CROSS_ORIGIN_CHECK_NOT_ALLOWED"</span>);
<a class='l d2' name=227 href="#227">227</a>       <span class='v'>return </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a>;
<a class='l d2' name=228 href="#228">228</a>     }
<a class='l d2' name=229 href="#229">229</a> 
<a class='l d2' name=230 href="#230">230</a>     <span class='v'>this.</span><span class='a'>addMessageListeners</span>(<span class='s'>"Webapps:CheckInstalled:Return:OK"</span>);
<a class='l d2' name=231 href="#231">231</a>     <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=cpmm">cpmm</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=sendAsyncMessage">sendAsyncMessage</a>(<span class='s'>"Webapps:CheckInstalled"</span>, { <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=origin">origin</a>: <span class='v'>this.</span><span class='a'>_getOrigin</span>(<span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=location">location</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=href">href</a>),
<a class='l d2' name=232 href="#232">232</a>                                                       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>: <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=spec">spec</a>,
<a class='l d2' name=233 href="#233">233</a>                                                       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=oid">oid</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_id">_id</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=topId">topId</a>: <span class='v'>this.</span><span class='a'>_topId</span>,
<a class='l d2' name=234 href="#234">234</a>                                                       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=requestID">requestID</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=getRequestId">getRequestId</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a>) });
<a class='l d2' name=235 href="#235">235</a>     <span class='v'>return </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a>;
<a class='l d2' name=236 href="#236">236</a>   },
<a class='l d2' name=237 href="#237">237</a> 
<a class='l d2' name=238 href="#238">238</a>   <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=getInstalled">getInstalled</a>: <span class='v'>function(</span>) {
<a class='l d2' name=239 href="#239">239</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a> = <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=createRequest">createRequest</a>();
<a class='l d2' name=240 href="#240">240</a>     <span class='v'>this.</span><span class='a'>addMessageListeners</span>(<span class='s'>"Webapps:GetInstalled:Return:OK"</span>);
<a class='l d2' name=241 href="#241">241</a>     <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=cpmm">cpmm</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=sendAsyncMessage">sendAsyncMessage</a>(<span class='s'>"Webapps:GetInstalled"</span>, { <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=origin">origin</a>: <span class='v'>this.</span><span class='a'>_getOrigin</span>(<span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=location">location</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=href">href</a>),
<a class='l d2' name=242 href="#242">242</a>                                                     <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=oid">oid</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_id">_id</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=topId">topId</a>: <span class='v'>this.</span><span class='a'>_topId</span>,
<a class='l d2' name=243 href="#243">243</a>                                                     <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=requestID">requestID</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=getRequestId">getRequestId</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a>) });
<a class='l d2' name=244 href="#244">244</a>     <span class='v'>return </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a>;
<a class='l d2' name=245 href="#245">245</a>   },
<a class='l d2' name=246 href="#246">246</a> 
<a class='l d2' name=247 href="#247">247</a>   <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=mgmt">mgmt</a>() {
<a class='l d2' name=248 href="#248">248</a>     <span class='v'>if </span>(!<span class='v'>this.</span><span class='a'>hasMgmtPrivilege</span>) {
<a class='l d2' name=249 href="#249">249</a>       <span class='v'>return </span><span class='v'>null;
<a class='l d2' name=250 href="#250">250</a> </span>    }
<a class='l d2' name=251 href="#251">251</a> 
<a class='l d2' name=252 href="#252">252</a>     <span class='v'>if </span>(!<span class='v'>this.</span><span class='a'>_mgmt</span>) {
<a class='l d2' name=253 href="#253">253</a>       <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=mgmt">mgmt</a> = <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Cc">Cc</a>[<span class='s'>"@mozilla.org/webapps/manager;1"</span>]
<a class='l d2' name=254 href="#254">254</a>                    .<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=createInstance">createInstance</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Ci">Ci</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=nsISupports">nsISupports</a>);
<a class='l d2' name=255 href="#255">255</a>       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=mgmt">mgmt</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=wrappedJSObject">wrappedJSObject</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=init">init</a>(<span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>, <span class='v'>this.</span><span class='a'>hasFullMgmtPrivilege</span>);
<a class='l d2' name=256 href="#256">256</a>       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=mgmt">mgmt</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=wrappedJSObject">wrappedJSObject</a>.<span class='a'>_windowId</span> = <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_id">_id</a>;
<a class='l d2' name=257 href="#257">257</a>       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=mgmt">mgmt</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=wrappedJSObject">wrappedJSObject</a>.<span class='a'>_topId</span> = <span class='v'>this.</span><span class='a'>_topId</span>;
<a class='l d2' name=258 href="#258">258</a>       <span class='v'>this.</span><span class='a'>_mgmt</span> = <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=mgmt">mgmt</a>.<span class='a'>__DOM_IMPL__</span>
<a class='l d2' name=259 href="#259">259</a>         ? <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=mgmt">mgmt</a>.<span class='a'>__DOM_IMPL__</span>
<a class='l d2' name=260 href="#260">260</a>         : <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<span class='a'>DOMApplicationsManager</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_create">_create</a>(<span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=mgmt">mgmt</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=wrappedJSObject">wrappedJSObject</a>);
<a class='l d2' name=261 href="#261">261</a>     }
<a class='l d2' name=262 href="#262">262</a>     <span class='v'>return </span><span class='v'>this.</span><span class='a'>_mgmt</span>;
<a class='l d2' name=263 href="#263">263</a>   },
<a class='l d2' name=264 href="#264">264</a> 
<a class='l d2' name=265 href="#265">265</a>   <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=uninit">uninit</a>: <span class='v'>function(</span>) {
<a class='l d2' name=266 href="#266">266</a>     <span class='v'>this.</span><span class='a'>_mgmt</span> = <span class='v'>null;
<a class='l d2' name=267 href="#267">267</a> </span>    <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=cpmm">cpmm</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=sendAsyncMessage">sendAsyncMessage</a>(<span class='s'>"Webapps:UnregisterForMessages"</span>,
<a class='l d2' name=268 href="#268">268</a>                           [<span class='s'>"Webapps:Install:Return:OK"</span>,
<a class='l d2' name=269 href="#269">269</a>                            <span class='s'>"Webapps:AdditionalLanguageChange"</span>]);
<a class='l d2' name=270 href="#270">270</a>     <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=removeEventListener">removeEventListener</a>(<span class='s'>"pagehide"</span>, <span class='v'>this)</span>;
<a class='l d2' name=271 href="#271">271</a>   },
<a class='l d2' name=272 href="#272">272</a> 
<a class='l d2' name=273 href="#273">273</a>   <span class='a'>installPackage</span>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aURL">aURL</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aParams">aParams</a>) {
<a class='l d2' name=274 href="#274">274</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a> = <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=createRequest">createRequest</a>();
<a class='l d2' name=275 href="#275">275</a> 
<a class='l d2' name=276 href="#276">276</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=uri">uri</a> = <span class='v'>this.</span><span class='a'>_validateURL</span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aURL">aURL</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a>);
<a class='l d2' name=277 href="#277">277</a> 
<a class='l d2' name=278 href="#278">278</a>     <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=uri">uri</a> &amp;&amp; <span class='v'>this.</span><span class='a'>_ensureForeground</span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a>)) {
<a class='l d2' name=279 href="#279">279</a>       <span class='v'>this.</span><span class='a'>addMessageListeners</span>(<span class='s'>"Webapps:Install:Return:KO"</span>);
<a class='l d2' name=280 href="#280">280</a>       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=cpmm">cpmm</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=sendAsyncMessage">sendAsyncMessage</a>(<span class='s'>"Webapps:InstallPackage"</span>,
<a class='l d2' name=281 href="#281">281</a>                             <span class='v'>this.</span><span class='a'>_prepareInstall</span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=uri">uri</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aParams">aParams</a>, <span class='v'>true)</span>);
<a class='l d2' name=282 href="#282">282</a>     }
<a class='l d2' name=283 href="#283">283</a> 
<a class='l d2' name=284 href="#284">284</a>     <span class='v'>return </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a>;
<a class='l d2' name=285 href="#285">285</a>   },
<a class='l d2' name=286 href="#286">286</a> 
<a class='l d2' name=287 href="#287">287</a>   <span class='a'>_getCurrentAppManifestURL</span>: <span class='v'>function(</span>) {
<a class='l d2' name=288 href="#288">288</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=appId">appId</a> = <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=document">document</a>.<span class='a'>nodePrincipal</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=appId">appId</a>;
<a class='l d2' name=289 href="#289">289</a>     <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=appId">appId</a> === <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Ci">Ci</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=nsIScriptSecurityManager">nsIScriptSecurityManager</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=NO_APP_ID">NO_APP_ID</a>) {
<a class='l d2' name=290 href="#290">290</a>       <span class='v'>return </span><span class='v'>null;
<a class='l d2' name=291 href="#291">291</a> </span>    }
<a class='l d2' name=292 href="#292">292</a> 
<a class='l d2' name=293 href="#293">293</a>     <span class='v'>return </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=appsService">appsService</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=getManifestURLByLocalId">getManifestURLByLocalId</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=appId">appId</a>);
<a class='l d2' name=294 href="#294">294</a>   },
<a class='l d2' name=295 href="#295">295</a> 
<a class='l d2' name=296 href="#296">296</a>   <span class='a'>getAdditionalLanguages</span>: <span class='v'>function(</span>) {
<a class='l d2' name=297 href="#297">297</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a> = <span class='a'>AppsUtils</span>.<span class='a'>getAppManifestURLFromWindow</span>(<span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>);
<a class='l d2' name=298 href="#298">298</a> 
<a class='l d2' name=299 href="#299">299</a>     <span class='v'>return </span><span class='v'>new </span><span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Promise">Promise</a>((<span class='a'>aResolve</span>, <span class='a'>aReject</span>) =&gt; {
<a class='l d2' name=300 href="#300">300</a>       <span class='v'>if </span>(!<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>) {
<a class='l d2' name=301 href="#301">301</a>         <span class='a'>aReject</span>(<span class='s'>"NotInApp"</span>);
<a class='l d2' name=302 href="#302">302</a>       } <span class='v'>else </span>{
<a class='l d2' name=303 href="#303">303</a>         <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=langs">langs</a> = <span class='a'>DOMApplicationRegistry</span>.<span class='a'>getAdditionalLanguages</span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>);
<a class='l d2' name=304 href="#304">304</a>         <span class='a'>aResolve</span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Cu">Cu</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=cloneInto">cloneInto</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=langs">langs</a>, <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>));
<a class='l d2' name=305 href="#305">305</a>       }
<a class='l d2' name=306 href="#306">306</a>     });
<a class='l d2' name=307 href="#307">307</a>   },
<a class='l d2' name=308 href="#308">308</a> 
<a class='l d2' name=309 href="#309">309</a>   <span class='a'>getLocalizationResource</span>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aLanguage">aLanguage</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aVersion">aVersion</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aPath">aPath</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aType">aType</a>) {
<a class='l d2' name=310 href="#310">310</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a> = <span class='a'>AppsUtils</span>.<span class='a'>getAppManifestURLFromWindow</span>(<span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>);
<a class='l d2' name=311 href="#311">311</a> 
<a class='l d2' name=312 href="#312">312</a>     <span class='v'>if </span>(!<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>) {
<a class='l d2' name=313 href="#313">313</a>       <span class='v'>return </span><span class='v'>new </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Promise">Promise</a>((<span class='a'>aResolve</span>, <span class='a'>aReject</span>) =&gt; {
<a class='l d2' name=314 href="#314">314</a>         <span class='a'>aReject</span>(<span class='s'>"NotInApp"</span>);
<a class='l d2' name=315 href="#315">315</a>       });
<a class='l d2' name=316 href="#316">316</a>     }
<a class='l d2' name=317 href="#317">317</a> 
<a class='l d2' name=318 href="#318">318</a>     <span class='v'>this.</span><span class='a'>addMessageListeners</span>([<span class='s'>"Webapps:GetLocalizationResource:Return"</span>]);
<a class='l d2' name=319 href="#319">319</a>     <span class='v'>return </span><span class='v'>this.</span><span class='a'>createPromiseWithId</span>((<span class='a'>aResolverId</span>) =&gt; {
<a class='l d2' name=320 href="#320">320</a>       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=cpmm">cpmm</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=sendAsyncMessage">sendAsyncMessage</a>(<span class='s'>"Webapps:GetLocalizationResource"</span>, {
<a class='l d2' name=321 href="#321">321</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>: <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>,
<a class='l d2' name=322 href="#322">322</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=lang">lang</a>: <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aLanguage">aLanguage</a>,
<a class='l d2' name=323 href="#323">323</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=version">version</a>: <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aVersion">aVersion</a>,
<a class='l d2' name=324 href="#324">324</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=path">path</a>: <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aPath">aPath</a>,
<a class='l d2' name=325 href="#325">325</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=dataType">dataType</a>: <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aType">aType</a>,
<a class='l d2' name=326 href="#326">326</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=oid">oid</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_id">_id</a>,
<a class='l d2' name=327 href="#327">327</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=topId">topId</a>: <span class='v'>this.</span><span class='a'>_topId</span>,
<a class='l d2' name=328 href="#328">328</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=requestID">requestID</a>: <span class='a'>aResolverId</span>
<a class='l d2' name=329 href="#329">329</a>       });
<a class='l d2' name=330 href="#330">330</a>     });
<a class='l d2' name=331 href="#331">331</a>   },
<a class='l d2' name=332 href="#332">332</a> 
<a class='l d2' name=333 href="#333">333</a>   <span class='c'>// nsIDOMGlobalPropertyInitializer implementation</span>
<a class='l d2' name=334 href="#334">334</a> <span class='c'></span>  <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=init">init</a>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aWindow">aWindow</a>) {
<a class='l d2' name=335 href="#335">335</a>     <span class='a'>const</span> <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=prefs">prefs</a> = <span class='v'>new </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Preferences">Preferences</a>();
<a class='l d2' name=336 href="#336">336</a> 
<a class='l d2' name=337 href="#337">337</a>     <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a> = <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aWindow">aWindow</a>;
<a class='l d2' name=338 href="#338">338</a>     <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=addEventListener">addEventListener</a>(<span class='s'>"pagehide"</span>, <span class='v'>this)</span>;
<a class='l d2' name=339 href="#339">339</a> 
<a class='l d2' name=340 href="#340">340</a>     <span class='v'>this.</span><span class='a'>initDOMRequestHelper</span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aWindow">aWindow</a>, [<span class='s'>"Webapps:Install:Return:OK"</span>,
<a class='l d2' name=341 href="#341">341</a>                                         <span class='s'>"Webapps:AdditionalLanguageChange"</span>]);
<a class='l d2' name=342 href="#342">342</a> 
<a class='l d2' name=343 href="#343">343</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=util">util</a> = <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=QueryInterface">QueryInterface</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Ci">Ci</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=nsIInterfaceRequestor">nsIInterfaceRequestor</a>)
<a class='l d2' name=344 href="#344">344</a>                            .<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=getInterface">getInterface</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Ci">Ci</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=nsIDOMWindowUtils">nsIDOMWindowUtils</a>);
<a class='l d2' name=345 href="#345">345</a>     <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_id">_id</a> = <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=util">util</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=outerWindowID">outerWindowID</a>;
<a class='l d2' name=346 href="#346">346</a> 
<a class='l d2' name=347 href="#347">347</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=topUtil">topUtil</a> = <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=top">top</a>
<a class='l d2' name=348 href="#348">348</a>                               .<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=QueryInterface">QueryInterface</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Ci">Ci</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=nsIInterfaceRequestor">nsIInterfaceRequestor</a>)
<a class='l d2' name=349 href="#349">349</a>                               .<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=getInterface">getInterface</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Ci">Ci</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=nsIDOMWindowUtils">nsIDOMWindowUtils</a>);
<a class='l d2' name=350 href="#350">350</a>     <span class='v'>this.</span><span class='a'>_topId</span> = <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=topUtil">topUtil</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=outerWindowID">outerWindowID</a>;
<a class='l d2' name=351 href="#351">351</a> 
<a class='l d2' name=352 href="#352">352</a>     <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=cpmm">cpmm</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=sendAsyncMessage">sendAsyncMessage</a>(<span class='s'>"Webapps:RegisterForMessages"</span>,
<a class='l d2' name=353 href="#353">353</a>                           { <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=messages">messages</a>: [<span class='s'>"Webapps:Install:Return:OK"</span>,
<a class='l d2' name=354 href="#354">354</a>                                        <span class='s'>"Webapps:AdditionalLanguageChange"</span>]});
<a class='l d2' name=355 href="#355">355</a> 
<a class='l d2' name=356 href="#356">356</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=principal">principal</a> = <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aWindow">aWindow</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=document">document</a>.<span class='a'>nodePrincipal</span>;
<a class='l d2' name=357 href="#357">357</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=appId">appId</a> = <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=principal">principal</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=appId">appId</a>;
<a class='l d2' name=358 href="#358">358</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=app">app</a> = <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=appId">appId</a> &amp;&amp; <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=appsService">appsService</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=getAppByLocalId">getAppByLocalId</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=appId">appId</a>);
<a class='l d2' name=359 href="#359">359</a> 
<a class='l d2' name=360 href="#360">360</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=isCurrentHomescreen">isCurrentHomescreen</a> = <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=app">app</a> &amp;&amp;
<a class='l d2' name=361 href="#361">361</a>       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=app">app</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a> == <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=prefs">prefs</a>.<span class='v'>get(</span><span class='s'>"dom.mozApps.homescreenURL"</span>) &amp;&amp;
<a class='l d2' name=362 href="#362">362</a>       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=app">app</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=appStatus">appStatus</a> != <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Ci">Ci</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=nsIPrincipal">nsIPrincipal</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=APP_STATUS_NOT_INSTALLED">APP_STATUS_NOT_INSTALLED</a>;
<a class='l d2' name=363 href="#363">363</a> 
<a class='l d2' name=364 href="#364">364</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=hasWebappsPermission">hasWebappsPermission</a> = <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Ci">Ci</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=nsIPermissionManager">nsIPermissionManager</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=ALLOW_ACTION">ALLOW_ACTION</a> ==
<a class='l d2' name=365 href="#365">365</a>       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Services">Services</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=perms">perms</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=testExactPermissionFromPrincipal">testExactPermissionFromPrincipal</a>(
<a class='l d2' name=366 href="#366">366</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=principal">principal</a>, <span class='s'>"webapps-manage"</span>);
<a class='l d2' name=367 href="#367">367</a> 
<a class='l d2' name=368 href="#368">368</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=hasHomescreenPermission">hasHomescreenPermission</a> = <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Ci">Ci</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=nsIPermissionManager">nsIPermissionManager</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=ALLOW_ACTION">ALLOW_ACTION</a> ==
<a class='l d2' name=369 href="#369">369</a>       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Services">Services</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=perms">perms</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=testExactPermissionFromPrincipal">testExactPermissionFromPrincipal</a>(
<a class='l d2' name=370 href="#370">370</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=principal">principal</a>, <span class='s'>"homescreen-webapps-manage"</span>);
<a class='l d2' name=371 href="#371">371</a> 
<a class='l d2' name=372 href="#372">372</a>     <span class='v'>this.</span><span class='a'>hasMgmtPrivilege</span> = <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=hasWebappsPermission">hasWebappsPermission</a> ||
<a class='l d2' name=373 href="#373">373</a>          (<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=isCurrentHomescreen">isCurrentHomescreen</a> &amp;&amp; <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=hasHomescreenPermission">hasHomescreenPermission</a>);
<a class='l d2' name=374 href="#374">374</a>     <span class='v'>this.</span><span class='a'>hasFullMgmtPrivilege</span> = <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=hasWebappsPermission">hasWebappsPermission</a>;
<a class='l d2' name=375 href="#375">375</a>   },
<a class='l d2' name=376 href="#376">376</a> 
<a class='l d2' name=377 href="#377">377</a>   <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=handleEvent">handleEvent</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=event">event</a>) {
<a class='l d2' name=378 href="#378">378</a>     <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=event">event</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=type">type</a> == <span class='s'>"pagehide"</span> &amp;&amp;
<a class='l d2' name=379 href="#379">379</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=event">event</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=target">target</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=defaultView">defaultView</a> == <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>) {
<a class='l d2' name=380 href="#380">380</a>       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=cpmm">cpmm</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=sendAsyncMessage">sendAsyncMessage</a>(<span class='s'>"Webapps:LocationChange"</span>, {
<a class='l d2' name=381 href="#381">381</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=oid">oid</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_id">_id</a>,
<a class='l d2' name=382 href="#382">382</a>       });
<a class='l d2' name=383 href="#383">383</a>     }
<a class='l d2' name=384 href="#384">384</a>   },
<a class='l d2' name=385 href="#385">385</a> 
<a class='l d2' name=386 href="#386">386</a>   <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=classID">classID</a>: <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Components">Components</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=ID">ID</a>(<span class='s'>"{fff440b3-fae2-45c1-bf03-3b5a2e432270}"</span>),
<a class='l d2' name=387 href="#387">387</a> 
<a class='l d2' name=388 href="#388">388</a>   <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=QueryInterface">QueryInterface</a>: <span class='a'>XPCOMUtils</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=generateQI">generateQI</a>([<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Ci">Ci</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=nsISupportsWeakReference">nsISupportsWeakReference</a>,
<a class='l d2' name=389 href="#389">389</a>                                          <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Ci">Ci</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=nsISupports">nsISupports</a>,
<a class='l d2' name=390 href="#390">390</a>                                          <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Ci">Ci</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=nsIObserver">nsIObserver</a>,
<a class='l d2' name=391 href="#391">391</a>                                          <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Ci">Ci</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=nsIDOMGlobalPropertyInitializer">nsIDOMGlobalPropertyInitializer</a>])
<a class='l d2' name=392 href="#392">392</a> }
<a class='l d2' name=393 href="#393">393</a> 
<a class='l d2' name=394 href="#394">394</a> <span class='c'>/**</span>
<a class='l d2' name=395 href="#395">395</a> <span class='c'>  * DOMApplication object</span>
<a class='l d2' name=396 href="#396">396</a> <span class='c'>  */</span>
<a class='l d2' name=397 href="#397">397</a> 
<a class='l d2' name=398 href="#398">398</a> <span class='v'>function </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=createApplicationObject">createApplicationObject</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aWindow">aWindow</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aApp">aApp</a>) {
<a class='l d2' name=399 href="#399">399</a>   <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=app">app</a> = <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Cc">Cc</a>[<span class='s'>"@mozilla.org/webapps/application;1"</span>]
<a class='l d2' name=400 href="#400">400</a>               .<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=createInstance">createInstance</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Ci">Ci</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=nsISupports">nsISupports</a>);
<a class='l d2' name=401 href="#401">401</a>   <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=app">app</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=wrappedJSObject">wrappedJSObject</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=init">init</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aWindow">aWindow</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aApp">aApp</a>);
<a class='l d2' name=402 href="#402">402</a>   <span class='v'>return </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=app">app</a>;
<a class='l d2' name=403 href="#403">403</a> }
<a class='l d2' name=404 href="#404">404</a> 
<a class='l d2' name=405 href="#405">405</a> <span class='v'>function </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=createContentApplicationObject">createContentApplicationObject</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aWindow">aWindow</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aApp">aApp</a>) {
<a class='l d2' name=406 href="#406">406</a>   <span class='v'>return </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=createApplicationObject">createApplicationObject</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aWindow">aWindow</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aApp">aApp</a>).<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=wrappedJSObject">wrappedJSObject</a>
<a class='l d2' name=407 href="#407">407</a>          .<span class='a'>_prepareForContent</span>();
<a class='l d2' name=408 href="#408">408</a> }
<a class='l d2' name=409 href="#409">409</a> 
<a class='l d2' name=410 href="#410">410</a> <span class='v'>function </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=WebappsApplication">WebappsApplication</a>() {
<a class='l d2' name=411 href="#411">411</a>   <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=wrappedJSObject">wrappedJSObject</a> = <span class='v'>this;</span>
<a class='l d2' name=412 href="#412">412</a> }
<a class='l d2' name=413 href="#413">413</a> 
<a class='l d2' name=414 href="#414">414</a> <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=WebappsApplication">WebappsApplication</a>.<span class='v'>prototype </span>= {
<a class='l d2' name=415 href="#415">415</a>   <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=__proto__">__proto__</a>: <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=DOMRequestIpcHelper">DOMRequestIpcHelper</a>.<span class='v'>prototype,</span>
<a class='l d2' name=416 href="#416">416</a> 
<a class='l d2' name=417 href="#417">417</a>   <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=init">init</a>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aWindow">aWindow</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aApp">aApp</a>) {
<a class='l d2' name=418 href="#418">418</a>     <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a> = <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aWindow">aWindow</a>;
<a class='l d2' name=419 href="#419">419</a> 
<a class='l d2' name=420 href="#420">420</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=proxyHandler">proxyHandler</a> = <span class='a'>DOMApplicationRegistry</span>.<span class='a'>addDOMApp</span>(<span class='v'>this,</span>
<a class='l d2' name=421 href="#421">421</a>                                                         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aApp">aApp</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>,
<a class='l d2' name=422 href="#422">422</a>                                                         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aApp">aApp</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=id">id</a>);
<a class='l d2' name=423 href="#423">423</a>     <span class='v'>this.</span><span class='a'>_proxy</span> = <span class='v'>new </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Proxy">Proxy</a>(<span class='v'>this,</span> <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=proxyHandler">proxyHandler</a>);
<a class='l d2' name=424 href="#424">424</a> 
<a class='l d2' name=425 href="#425">425</a>     <span class='v'>this.</span><span class='a'>initDOMRequestHelper</span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aWindow">aWindow</a>);
<a class='l d2' name=426 href="#426">426</a>   },
<a class='l d2' name=427 href="#427">427</a> 
<a class='l d2' name=428 href="#428">428</a>   <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_appStatus">_appStatus</a>() {
<a class='l d2' name=429 href="#429">429</a>     <span class='v'>return </span><span class='v'>this.</span><span class='a'>_proxy</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=appStatus">appStatus</a>;
<a class='l d2' name=430 href="#430">430</a>   },
<a class='l d2' name=431 href="#431">431</a> 
<a class='l d2' name=432 href="#432">432</a>   <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=downloadAvailable">downloadAvailable</a>() {
<a class='l d2' name=433 href="#433">433</a>     <span class='v'>return </span><span class='v'>this.</span><span class='a'>_proxy</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=downloadAvailable">downloadAvailable</a>;
<a class='l d2' name=434 href="#434">434</a>   },
<a class='l d2' name=435 href="#435">435</a> 
<a class='l d2' name=436 href="#436">436</a>   <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=downloading">downloading</a>() {
<a class='l d2' name=437 href="#437">437</a>     <span class='v'>return </span><span class='v'>this.</span><span class='a'>_proxy</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=downloading">downloading</a>;
<a class='l d2' name=438 href="#438">438</a>   },
<a class='l d2' name=439 href="#439">439</a> 
<a class='l d2' name=440 href="#440">440</a>   <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=downloadSize">downloadSize</a>() {
<a class='l d2' name=441 href="#441">441</a>     <span class='v'>return </span><span class='v'>this.</span><span class='a'>_proxy</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=downloadSize">downloadSize</a>;
<a class='l d2' name=442 href="#442">442</a>   },
<a class='l d2' name=443 href="#443">443</a> 
<a class='l d2' name=444 href="#444">444</a>   <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=installOrigin">installOrigin</a>() {
<a class='l d2' name=445 href="#445">445</a>     <span class='v'>return </span><span class='v'>this.</span><span class='a'>_proxy</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=installOrigin">installOrigin</a>;
<a class='l d2' name=446 href="#446">446</a>   },
<a class='l d2' name=447 href="#447">447</a> 
<a class='l d2' name=448 href="#448">448</a>   <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=installState">installState</a>() {
<a class='l d2' name=449 href="#449">449</a>     <span class='v'>return </span><span class='v'>this.</span><span class='a'>_proxy</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=installState">installState</a>;
<a class='l d2' name=450 href="#450">450</a>   },
<a class='l d2' name=451 href="#451">451</a> 
<a class='l d2' name=452 href="#452">452</a>   <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=installTime">installTime</a>() {
<a class='l d2' name=453 href="#453">453</a>     <span class='v'>return </span><span class='v'>this.</span><span class='a'>_proxy</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=installTime">installTime</a>;
<a class='l d2' name=454 href="#454">454</a>   },
<a class='l d2' name=455 href="#455">455</a> 
<a class='l d2' name=456 href="#456">456</a>   <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=lastUpdateCheck">lastUpdateCheck</a>() {
<a class='l d2' name=457 href="#457">457</a>     <span class='v'>return </span><span class='v'>this.</span><span class='a'>_proxy</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=lastUpdateCheck">lastUpdateCheck</a>;
<a class='l d2' name=458 href="#458">458</a>   },
<a class='l d2' name=459 href="#459">459</a> 
<a class='l d2' name=460 href="#460">460</a>   <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>() {
<a class='l d2' name=461 href="#461">461</a>     <span class='v'>return </span><span class='v'>this.</span><span class='a'>_proxy</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>;
<a class='l d2' name=462 href="#462">462</a>   },
<a class='l d2' name=463 href="#463">463</a> 
<a class='l d2' name=464 href="#464">464</a>   <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=origin">origin</a>() {
<a class='l d2' name=465 href="#465">465</a>     <span class='v'>return </span><span class='v'>this.</span><span class='a'>_proxy</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=origin">origin</a>;
<a class='l d2' name=466 href="#466">466</a>   },
<a class='l d2' name=467 href="#467">467</a> 
<a class='l d2' name=468 href="#468">468</a>   <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=progress">progress</a>() {
<a class='l d2' name=469 href="#469">469</a>     <span class='v'>return </span><span class='v'>this.</span><span class='a'>_proxy</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=progress">progress</a>;
<a class='l d2' name=470 href="#470">470</a>   },
<a class='l d2' name=471 href="#471">471</a> 
<a class='l d2' name=472 href="#472">472</a>   <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=readyToApplyDownload">readyToApplyDownload</a>() {
<a class='l d2' name=473 href="#473">473</a>     <span class='v'>return </span><span class='v'>this.</span><span class='a'>_proxy</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=readyToApplyDownload">readyToApplyDownload</a>;
<a class='l d2' name=474 href="#474">474</a>   },
<a class='l d2' name=475 href="#475">475</a> 
<a class='l d2' name=476 href="#476">476</a>   <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=removable">removable</a>() {
<a class='l d2' name=477 href="#477">477</a>     <span class='v'>return </span><span class='v'>this.</span><span class='a'>_proxy</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=removable">removable</a>;
<a class='l d2' name=478 href="#478">478</a>   },
<a class='l d2' name=479 href="#479">479</a> 
<a class='l d2' name=480 href="#480">480</a>   <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=updateTime">updateTime</a>() {
<a class='l d2' name=481 href="#481">481</a>     <span class='v'>return </span><span class='v'>this.</span><span class='a'>_proxy</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=updateTime">updateTime</a>;
<a class='l d2' name=482 href="#482">482</a>   },
<a class='l d2' name=483 href="#483">483</a> 
<a class='l d2' name=484 href="#484">484</a>   <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifest">manifest</a>() {
<a class='l d2' name=485 href="#485">485</a>     <span class='v'>return </span><span class='a'>WrappedManifestCache</span>.<span class='v'>get(</span><span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>,
<a class='l d2' name=486 href="#486">486</a>                                     <span class='v'>this.</span><span class='a'>_proxy</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifest">manifest</a>,
<a class='l d2' name=487 href="#487">487</a>                                     <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>,
<a class='l d2' name=488 href="#488">488</a>                                     <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=innerWindowID">innerWindowID</a>);
<a class='l d2' name=489 href="#489">489</a>   },
<a class='l d2' name=490 href="#490">490</a> 
<a class='l d2' name=491 href="#491">491</a>   <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=updateManifest">updateManifest</a>() {
<a class='l d2' name=492 href="#492">492</a>     <span class='v'>return </span><span class='v'>this.</span><span class='a'>_proxy</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=updateManifest">updateManifest</a> ?
<a class='l d2' name=493 href="#493">493</a>       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Cu">Cu</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=cloneInto">cloneInto</a>(<span class='v'>this.</span><span class='a'>_proxy</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=updateManifest">updateManifest</a>, <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>) : <span class='v'>null;
<a class='l d2' name=494 href="#494">494</a> </span>  },
<a class='l d2' name=495 href="#495">495</a> 
<a class='l d2' name=496 href="#496">496</a>   <span class='v'>set </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=onprogress">onprogress</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aCallback">aCallback</a>) {
<a class='l d2' name=497 href="#497">497</a>     <span class='v'>this.</span><span class='a'>__DOM_IMPL__</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=setEventHandler">setEventHandler</a>(<span class='s'>"onprogress"</span>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aCallback">aCallback</a>);
<a class='l d2' name=498 href="#498">498</a>   },
<a class='l d2' name=499 href="#499">499</a> 
<a class='l d2' name=500 href="#500">500</a>   <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=onprogress">onprogress</a>() {
<a class='l d2' name=501 href="#501">501</a>     <span class='v'>return </span><span class='v'>this.</span><span class='a'>__DOM_IMPL__</span>.<span class='a'>getEventHandler</span>(<span class='s'>"onprogress"</span>);
<a class='l d2' name=502 href="#502">502</a>   },
<a class='l d2' name=503 href="#503">503</a> 
<a class='l d2' name=504 href="#504">504</a>   <span class='v'>set </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=ondownloadsuccess">ondownloadsuccess</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aCallback">aCallback</a>) {
<a class='l d2' name=505 href="#505">505</a>     <span class='v'>this.</span><span class='a'>__DOM_IMPL__</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=setEventHandler">setEventHandler</a>(<span class='s'>"ondownloadsuccess"</span>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aCallback">aCallback</a>);
<a class='l d2' name=506 href="#506">506</a>   },
<a class='l d2' name=507 href="#507">507</a> 
<a class='l d2' name=508 href="#508">508</a>   <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=ondownloadsuccess">ondownloadsuccess</a>() {
<a class='l d2' name=509 href="#509">509</a>     <span class='v'>return </span><span class='v'>this.</span><span class='a'>__DOM_IMPL__</span>.<span class='a'>getEventHandler</span>(<span class='s'>"ondownloadsuccess"</span>);
<a class='l d2' name=510 href="#510">510</a>   },
<a class='l d2' name=511 href="#511">511</a> 
<a class='l d2' name=512 href="#512">512</a>   <span class='v'>set </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=ondownloaderror">ondownloaderror</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aCallback">aCallback</a>) {
<a class='l d2' name=513 href="#513">513</a>     <span class='v'>this.</span><span class='a'>__DOM_IMPL__</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=setEventHandler">setEventHandler</a>(<span class='s'>"ondownloaderror"</span>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aCallback">aCallback</a>);
<a class='l d2' name=514 href="#514">514</a>   },
<a class='l d2' name=515 href="#515">515</a> 
<a class='l d2' name=516 href="#516">516</a>   <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=ondownloaderror">ondownloaderror</a>() {
<a class='l d2' name=517 href="#517">517</a>     <span class='v'>return </span><span class='v'>this.</span><span class='a'>__DOM_IMPL__</span>.<span class='a'>getEventHandler</span>(<span class='s'>"ondownloaderror"</span>);
<a class='l d2' name=518 href="#518">518</a>   },
<a class='l d2' name=519 href="#519">519</a> 
<a class='l d2' name=520 href="#520">520</a>   <span class='v'>set </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=ondownloadavailable">ondownloadavailable</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aCallback">aCallback</a>) {
<a class='l d2' name=521 href="#521">521</a>     <span class='v'>this.</span><span class='a'>__DOM_IMPL__</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=setEventHandler">setEventHandler</a>(<span class='s'>"ondownloadavailable"</span>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aCallback">aCallback</a>);
<a class='l d2' name=522 href="#522">522</a>   },
<a class='l d2' name=523 href="#523">523</a> 
<a class='l d2' name=524 href="#524">524</a>   <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=ondownloadavailable">ondownloadavailable</a>() {
<a class='l d2' name=525 href="#525">525</a>     <span class='v'>return </span><span class='v'>this.</span><span class='a'>__DOM_IMPL__</span>.<span class='a'>getEventHandler</span>(<span class='s'>"ondownloadavailable"</span>);
<a class='l d2' name=526 href="#526">526</a>   },
<a class='l d2' name=527 href="#527">527</a> 
<a class='l d2' name=528 href="#528">528</a>   <span class='v'>set </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=ondownloadapplied">ondownloadapplied</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aCallback">aCallback</a>) {
<a class='l d2' name=529 href="#529">529</a>     <span class='v'>this.</span><span class='a'>__DOM_IMPL__</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=setEventHandler">setEventHandler</a>(<span class='s'>"ondownloadapplied"</span>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aCallback">aCallback</a>);
<a class='l d2' name=530 href="#530">530</a>   },
<a class='l d2' name=531 href="#531">531</a> 
<a class='l d2' name=532 href="#532">532</a>   <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=ondownloadapplied">ondownloadapplied</a>() {
<a class='l d2' name=533 href="#533">533</a>     <span class='v'>return </span><span class='v'>this.</span><span class='a'>__DOM_IMPL__</span>.<span class='a'>getEventHandler</span>(<span class='s'>"ondownloadapplied"</span>);
<a class='l d2' name=534 href="#534">534</a>   },
<a class='l d2' name=535 href="#535">535</a> 
<a class='l d2' name=536 href="#536">536</a>   <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=receipts">receipts</a>() {
<a class='l d2' name=537 href="#537">537</a>     <span class='v'>return </span><span class='v'>this.</span><span class='a'>_proxy</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=receipts">receipts</a> || [];
<a class='l d2' name=538 href="#538">538</a>   },
<a class='l d2' name=539 href="#539">539</a> 
<a class='l d2' name=540 href="#540">540</a>   <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=downloadError">downloadError</a>() {
<a class='l d2' name=541 href="#541">541</a>     <span class='c'>// Only return DOMError when we have an error.</span>
<a class='l d2' name=542 href="#542">542</a> <span class='c'></span>    <span class='v'>if </span>(!<span class='v'>this.</span><span class='a'>_proxy</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=downloadError">downloadError</a>) {
<a class='l d2' name=543 href="#543">543</a>       <span class='v'>return </span><span class='v'>null;
<a class='l d2' name=544 href="#544">544</a> </span>    }
<a class='l d2' name=545 href="#545">545</a>     <span class='v'>return </span><span class='v'>new </span><span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=DOMError">DOMError</a>(<span class='v'>this.</span><span class='a'>_proxy</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=downloadError">downloadError</a>);
<a class='l d2' name=546 href="#546">546</a>   },
<a class='l d2' name=547 href="#547">547</a> 
<a class='l d2' name=548 href="#548">548</a>   <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=enabled">enabled</a>() {
<a class='l d2' name=549 href="#549">549</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=value">value</a> = <span class='v'>this.</span><span class='a'>_proxy</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=enabled">enabled</a>;
<a class='l d2' name=550 href="#550">550</a>     <span class='v'>return </span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=value">value</a> === <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=undefined">undefined</a> ? <span class='v'>true </span>: <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=value">value</a>);
<a class='l d2' name=551 href="#551">551</a>   },
<a class='l d2' name=552 href="#552">552</a> 
<a class='l d2' name=553 href="#553">553</a>   <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=download">download</a>: <span class='v'>function(</span>) {
<a class='l d2' name=554 href="#554">554</a>     <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=cpmm">cpmm</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=sendAsyncMessage">sendAsyncMessage</a>(<span class='s'>"Webapps:Download"</span>,
<a class='l d2' name=555 href="#555">555</a>                           { <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a> });
<a class='l d2' name=556 href="#556">556</a>   },
<a class='l d2' name=557 href="#557">557</a> 
<a class='l d2' name=558 href="#558">558</a>   <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=cancelDownload">cancelDownload</a>: <span class='v'>function(</span>) {
<a class='l d2' name=559 href="#559">559</a>     <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=cpmm">cpmm</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=sendAsyncMessage">sendAsyncMessage</a>(<span class='s'>"Webapps:CancelDownload"</span>,
<a class='l d2' name=560 href="#560">560</a>                           { <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a> });
<a class='l d2' name=561 href="#561">561</a>   },
<a class='l d2' name=562 href="#562">562</a> 
<a class='l d2' name=563 href="#563">563</a>   <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=checkForUpdate">checkForUpdate</a>: <span class='v'>function(</span>) {
<a class='l d2' name=564 href="#564">564</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a> = <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=createRequest">createRequest</a>();
<a class='l d2' name=565 href="#565">565</a> 
<a class='l d2' name=566 href="#566">566</a>     <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=cpmm">cpmm</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=sendAsyncMessage">sendAsyncMessage</a>(<span class='s'>"Webapps:CheckForUpdate"</span>,
<a class='l d2' name=567 href="#567">567</a>                           { <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>,
<a class='l d2' name=568 href="#568">568</a>                             <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=oid">oid</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_id">_id</a>,
<a class='l d2' name=569 href="#569">569</a>                             <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=topId">topId</a>: <span class='v'>this.</span><span class='a'>_topId</span>,
<a class='l d2' name=570 href="#570">570</a>                             <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=requestID">requestID</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=getRequestId">getRequestId</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a>) });
<a class='l d2' name=571 href="#571">571</a>     <span class='v'>return </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a>;
<a class='l d2' name=572 href="#572">572</a>   },
<a class='l d2' name=573 href="#573">573</a> 
<a class='l d2' name=574 href="#574">574</a>   <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=launch">launch</a>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aStartPoint">aStartPoint</a>) {
<a class='l d2' name=575 href="#575">575</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a> = <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=createRequest">createRequest</a>();
<a class='l d2' name=576 href="#576">576</a>     <span class='v'>this.</span><span class='a'>addMessageListeners</span>([<span class='s'>"Webapps:Launch:Return:OK"</span>,
<a class='l d2' name=577 href="#577">577</a>                               <span class='s'>"Webapps:Launch:Return:KO"</span>]);
<a class='l d2' name=578 href="#578">578</a>     <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=cpmm">cpmm</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=sendAsyncMessage">sendAsyncMessage</a>(<span class='s'>"Webapps:Launch"</span>, { <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=origin">origin</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=origin">origin</a>,
<a class='l d2' name=579 href="#579">579</a>                                               <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>,
<a class='l d2' name=580 href="#580">580</a>                                               <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=startPoint">startPoint</a>: <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aStartPoint">aStartPoint</a> || <span class='s'>""</span>,
<a class='l d2' name=581 href="#581">581</a>                                               <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=oid">oid</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_id">_id</a>,
<a class='l d2' name=582 href="#582">582</a>                                               <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=topId">topId</a>: <span class='v'>this.</span><span class='a'>_topId</span>,
<a class='l d2' name=583 href="#583">583</a>                                               <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=timestamp">timestamp</a>: <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Date">Date</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=now">now</a>(),
<a class='l d2' name=584 href="#584">584</a>                                               <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=requestID">requestID</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=getRequestId">getRequestId</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a>) });
<a class='l d2' name=585 href="#585">585</a>     <span class='v'>return </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a>;
<a class='l d2' name=586 href="#586">586</a>   },
<a class='l d2' name=587 href="#587">587</a> 
<a class='l d2' name=588 href="#588">588</a>   <span class='a'>clearBrowserData</span>: <span class='v'>function(</span>) {
<a class='l d2' name=589 href="#589">589</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a> = <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=createRequest">createRequest</a>();
<a class='l d2' name=590 href="#590">590</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=browserChild">browserChild</a> =
<a class='l d2' name=591 href="#591">591</a>       <span class='a'>BrowserElementPromptService</span>.<span class='a'>getBrowserElementChildForWindow</span>(<span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>);
<a class='l d2' name=592 href="#592">592</a>     <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=browserChild">browserChild</a>) {
<a class='l d2' name=593 href="#593">593</a>       <span class='v'>this.</span><span class='a'>addMessageListeners</span>(<span class='s'>"Webapps:ClearBrowserData:Return"</span>);
<a class='l d2' name=594 href="#594">594</a>       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=browserChild">browserChild</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=messageManager">messageManager</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=sendAsyncMessage">sendAsyncMessage</a>(<span class='s'>"Webapps:ClearBrowserData"</span>, {
<a class='l d2' name=595 href="#595">595</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>,
<a class='l d2' name=596 href="#596">596</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=oid">oid</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_id">_id</a>,
<a class='l d2' name=597 href="#597">597</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=topId">topId</a>: <span class='v'>this.</span><span class='a'>_topId</span>,
<a class='l d2' name=598 href="#598">598</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=requestID">requestID</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=getRequestId">getRequestId</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a>)
<a class='l d2' name=599 href="#599">599</a>       });
<a class='l d2' name=600 href="#600">600</a>     } <span class='v'>else </span>{
<a class='l d2' name=601 href="#601">601</a>       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Services">Services</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=DOMRequest">DOMRequest</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=fireErrorAsync">fireErrorAsync</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a>, <span class='s'>"NO_CLEARABLE_BROWSER"</span>);
<a class='l d2' name=602 href="#602">602</a>     }
<a class='l d2' name=603 href="#603">603</a>     <span class='v'>return </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a>;
<a class='l d2' name=604 href="#604">604</a>   },
<a class='l d2' name=605 href="#605">605</a> 
<a class='l d2' name=606 href="#606">606</a>   <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=connect">connect</a>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aKeyword">aKeyword</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aRules">aRules</a>) {
<a class='l d2' name=607 href="#607">607</a>     <span class='v'>this.</span><span class='a'>addMessageListeners</span>([<span class='s'>"Webapps:Connect:Return:OK"</span>,
<a class='l d2' name=608 href="#608">608</a>                               <span class='s'>"Webapps:Connect:Return:KO"</span>]);
<a class='l d2' name=609 href="#609">609</a>     <span class='v'>return </span><span class='v'>this.</span><span class='a'>createPromiseWithId</span>((<span class='a'>aResolverId</span>) =&gt; {
<a class='l d2' name=610 href="#610">610</a>       <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=from">from</a> = <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=location">location</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=origin">origin</a> + <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=location">location</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=pathname">pathname</a>;
<a class='l d2' name=611 href="#611">611</a>       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=cpmm">cpmm</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=sendAsyncMessage">sendAsyncMessage</a>(<span class='s'>"Webapps:Connect"</span>, {
<a class='l d2' name=612 href="#612">612</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=keyword">keyword</a>: <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aKeyword">aKeyword</a>,
<a class='l d2' name=613 href="#613">613</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=rules">rules</a>: <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aRules">aRules</a>,
<a class='l d2' name=614 href="#614">614</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>,
<a class='l d2' name=615 href="#615">615</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=pubPageURL">pubPageURL</a>: <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=from">from</a>,
<a class='l d2' name=616 href="#616">616</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=outerWindowID">outerWindowID</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_id">_id</a>,
<a class='l d2' name=617 href="#617">617</a>         <span class='a'>topWindowID</span>: <span class='v'>this.</span><span class='a'>_topId</span>,
<a class='l d2' name=618 href="#618">618</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=requestID">requestID</a>: <span class='a'>aResolverId</span>
<a class='l d2' name=619 href="#619">619</a>       });
<a class='l d2' name=620 href="#620">620</a>     });
<a class='l d2' name=621 href="#621">621</a>   },
<a class='l d2' name=622 href="#622">622</a> 
<a class='l d2' name=623 href="#623">623</a>   <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=getConnections">getConnections</a>: <span class='v'>function(</span>) {
<a class='l d2' name=624 href="#624">624</a>     <span class='v'>this.</span><span class='a'>addMessageListeners</span>(<span class='s'>"Webapps:GetConnections:Return:OK"</span>);
<a class='l d2' name=625 href="#625">625</a>     <span class='v'>return </span><span class='v'>this.</span><span class='a'>createPromiseWithId</span>((<span class='a'>aResolverId</span>) =&gt; {
<a class='l d2' name=626 href="#626">626</a>       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=cpmm">cpmm</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=sendAsyncMessage">sendAsyncMessage</a>(<span class='s'>"Webapps:GetConnections"</span>, {
<a class='l d2' name=627 href="#627">627</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>,
<a class='l d2' name=628 href="#628">628</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=outerWindowID">outerWindowID</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_id">_id</a>,
<a class='l d2' name=629 href="#629">629</a>         <span class='a'>topWindowID</span>: <span class='v'>this.</span><span class='a'>_topId</span>,
<a class='l d2' name=630 href="#630">630</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=requestID">requestID</a>: <span class='a'>aResolverId</span>
<a class='l d2' name=631 href="#631">631</a>       });
<a class='l d2' name=632 href="#632">632</a>     });
<a class='l d2' name=633 href="#633">633</a>   },
<a class='l d2' name=634 href="#634">634</a> 
<a class='l d2' name=635 href="#635">635</a>   <span class='a'>addReceipt</span>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=receipt">receipt</a>) {
<a class='l d2' name=636 href="#636">636</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a> = <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=createRequest">createRequest</a>();
<a class='l d2' name=637 href="#637">637</a> 
<a class='l d2' name=638 href="#638">638</a>     <span class='v'>this.</span><span class='a'>addMessageListeners</span>([<span class='s'>"Webapps:AddReceipt:Return:OK"</span>,
<a class='l d2' name=639 href="#639">639</a>                               <span class='s'>"Webapps:AddReceipt:Return:KO"</span>]);
<a class='l d2' name=640 href="#640">640</a> 
<a class='l d2' name=641 href="#641">641</a>     <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=cpmm">cpmm</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=sendAsyncMessage">sendAsyncMessage</a>(<span class='s'>"Webapps:AddReceipt"</span>, { <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>,
<a class='l d2' name=642 href="#642">642</a>                                                   <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=receipt">receipt</a>: <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=receipt">receipt</a>,
<a class='l d2' name=643 href="#643">643</a>                                                   <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=oid">oid</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_id">_id</a>,
<a class='l d2' name=644 href="#644">644</a>                                                   <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=topId">topId</a>: <span class='v'>this.</span><span class='a'>_topId</span>,
<a class='l d2' name=645 href="#645">645</a>                                                   <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=requestID">requestID</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=getRequestId">getRequestId</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a>) });
<a class='l d2' name=646 href="#646">646</a> 
<a class='l d2' name=647 href="#647">647</a>     <span class='v'>return </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a>;
<a class='l d2' name=648 href="#648">648</a>   },
<a class='l d2' name=649 href="#649">649</a> 
<a class='l d2' name=650 href="#650">650</a>   <span class='a'>removeReceipt</span>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=receipt">receipt</a>) {
<a class='l d2' name=651 href="#651">651</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a> = <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=createRequest">createRequest</a>();
<a class='l d2' name=652 href="#652">652</a> 
<a class='l d2' name=653 href="#653">653</a>     <span class='v'>this.</span><span class='a'>addMessageListeners</span>([<span class='s'>"Webapps:RemoveReceipt:Return:OK"</span>,
<a class='l d2' name=654 href="#654">654</a>                               <span class='s'>"Webapps:RemoveReceipt:Return:KO"</span>]);
<a class='l d2' name=655 href="#655">655</a> 
<a class='l d2' name=656 href="#656">656</a>     <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=cpmm">cpmm</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=sendAsyncMessage">sendAsyncMessage</a>(<span class='s'>"Webapps:RemoveReceipt"</span>, { <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>,
<a class='l d2' name=657 href="#657">657</a>                                                      <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=receipt">receipt</a>: <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=receipt">receipt</a>,
<a class='l d2' name=658 href="#658">658</a>                                                      <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=oid">oid</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_id">_id</a>,
<a class='l d2' name=659 href="#659">659</a>                                                      <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=topId">topId</a>: <span class='v'>this.</span><span class='a'>_topId</span>,
<a class='l d2' name=660 href="#660">660</a>                                                      <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=requestID">requestID</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=getRequestId">getRequestId</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a>) });
<a class='l d2' name=661 href="#661">661</a> 
<a class='l d2' name=662 href="#662">662</a>     <span class='v'>return </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a>;
<a class='l d2' name=663 href="#663">663</a>   },
<a class='l d2' name=664 href="#664">664</a> 
<a class='l d2' name=665 href="#665">665</a>   <span class='a'>replaceReceipt</span>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=oldReceipt">oldReceipt</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=newReceipt">newReceipt</a>) {
<a class='l d2' name=666 href="#666">666</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a> = <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=createRequest">createRequest</a>();
<a class='l d2' name=667 href="#667">667</a> 
<a class='l d2' name=668 href="#668">668</a>     <span class='v'>this.</span><span class='a'>addMessageListeners</span>([<span class='s'>"Webapps:ReplaceReceipt:Return:OK"</span>,
<a class='l d2' name=669 href="#669">669</a>                               <span class='s'>"Webapps:ReplaceReceipt:Return:KO"</span>]);
<a class='l d2' name=670 href="#670">670</a> 
<a class='l d2' name=671 href="#671">671</a>     <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=cpmm">cpmm</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=sendAsyncMessage">sendAsyncMessage</a>(<span class='s'>"Webapps:ReplaceReceipt"</span>, { <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>,
<a class='l d2' name=672 href="#672">672</a>                                                       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=newReceipt">newReceipt</a>: <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=newReceipt">newReceipt</a>,
<a class='l d2' name=673 href="#673">673</a>                                                       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=oldReceipt">oldReceipt</a>: <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=oldReceipt">oldReceipt</a>,
<a class='l d2' name=674 href="#674">674</a>                                                       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=oid">oid</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_id">_id</a>,
<a class='l d2' name=675 href="#675">675</a>                                                       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=topId">topId</a>: <span class='v'>this.</span><span class='a'>_topId</span>,
<a class='l d2' name=676 href="#676">676</a>                                                       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=requestID">requestID</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=getRequestId">getRequestId</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a>) });
<a class='l d2' name=677 href="#677">677</a> 
<a class='l d2' name=678 href="#678">678</a>     <span class='v'>return </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a>;
<a class='l d2' name=679 href="#679">679</a>   },
<a class='l d2' name=680 href="#680">680</a> 
<a class='l d2' name=681 href="#681">681</a>   <span class='a'>export</span>: <span class='v'>function(</span>) {
<a class='l d2' name=682 href="#682">682</a>     <span class='v'>this.</span><span class='a'>addMessageListeners</span>([<span class='s'>"Webapps:Export:Return"</span>]);
<a class='l d2' name=683 href="#683">683</a>     <span class='v'>return </span><span class='v'>this.</span><span class='a'>createPromiseWithId</span>((<span class='a'>aResolverId</span>) =&gt; {
<a class='l d2' name=684 href="#684">684</a>       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=cpmm">cpmm</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=sendAsyncMessage">sendAsyncMessage</a>(<span class='s'>"Webapps:Export"</span>,
<a class='l d2' name=685 href="#685">685</a>         { <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>,
<a class='l d2' name=686 href="#686">686</a>           <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=oid">oid</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_id">_id</a>,
<a class='l d2' name=687 href="#687">687</a>           <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=topId">topId</a>: <span class='v'>this.</span><span class='a'>_topId</span>,
<a class='l d2' name=688 href="#688">688</a>           <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=requestID">requestID</a>: <span class='a'>aResolverId</span>
<a class='l d2' name=689 href="#689">689</a>         });
<a class='l d2' name=690 href="#690">690</a>     });
<a class='l d2' name=691 href="#691">691</a>   },
<a class='l d2' name=692 href="#692">692</a> 
<a class='l d2' name=693 href="#693">693</a>   <span class='a'>getLocalizedValue</span>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aProperty">aProperty</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aLang">aLang</a>, <span class='a'>aEntryPoint</span>) {
<a class='l d2' name=694 href="#694">694</a>     <span class='v'>this.</span><span class='a'>addMessageListeners</span>([<span class='s'>"Webapps:GetLocalizedValue:Return"</span>]);
<a class='l d2' name=695 href="#695">695</a>     <span class='v'>return </span><span class='v'>this.</span><span class='a'>createPromiseWithId</span>((<span class='a'>aResolverId</span>) =&gt; {
<a class='l d2' name=696 href="#696">696</a>       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=cpmm">cpmm</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=sendAsyncMessage">sendAsyncMessage</a>(<span class='s'>"Webapps:GetLocalizedValue"</span>,
<a class='l d2' name=697 href="#697">697</a>         { <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>,
<a class='l d2' name=698 href="#698">698</a>           <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=oid">oid</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_id">_id</a>,
<a class='l d2' name=699 href="#699">699</a>           <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=topId">topId</a>: <span class='v'>this.</span><span class='a'>_topId</span>,
<a class='l d2' name=700 href="#700">700</a>           <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=property">property</a>: <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aProperty">aProperty</a>,
<a class='l d2' name=701 href="#701">701</a>           <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=lang">lang</a>: <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aLang">aLang</a>,
<a class='l d2' name=702 href="#702">702</a>           <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=entryPoint">entryPoint</a>: <span class='a'>aEntryPoint</span>,
<a class='l d2' name=703 href="#703">703</a>           <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=requestID">requestID</a>: <span class='a'>aResolverId</span>
<a class='l d2' name=704 href="#704">704</a>         });
<a class='l d2' name=705 href="#705">705</a>     });
<a class='l d2' name=706 href="#706">706</a>   },
<a class='l d2' name=707 href="#707">707</a> 
<a class='l d2' name=708 href="#708">708</a>   <span class='a'>_prepareForContent</span>: <span class='v'>function(</span>) {
<a class='l d2' name=709 href="#709">709</a>     <span class='v'>if </span>(<span class='v'>this.</span><span class='a'>__DOM_IMPL__</span>) {
<a class='l d2' name=710 href="#710">710</a>       <span class='v'>return </span><span class='v'>this.</span><span class='a'>__DOM_IMPL__</span>;
<a class='l d2' name=711 href="#711">711</a>     }
<a class='l d2' name=712 href="#712">712</a>     <span class='v'>return </span><span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<span class='a'>DOMApplication</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_create">_create</a>(<span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>, <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=wrappedJSObject">wrappedJSObject</a>);
<a class='l d2' name=713 href="#713">713</a>   },
<a class='l d2' name=714 href="#714">714</a> 
<a class='l d2' name=715 href="#715">715</a>   <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=uninit">uninit</a>: <span class='v'>function(</span>) {
<a class='l d2' name=716 href="#716">716</a>     <span class='a'>WrappedManifestCache</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=evict">evict</a>(<span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>, <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=innerWindowID">innerWindowID</a>);
<a class='l d2' name=717 href="#717">717</a>   },
<a class='l d2' name=718 href="#718">718</a> 
<a class='l d2' name=719 href="#719">719</a>   <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_fireEvent">_fireEvent</a>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aName">aName</a>) {
<a class='l d2' name=720 href="#720">720</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=obj">obj</a> = <span class='v'>this.</span><span class='a'>_prepareForContent</span>();
<a class='l d2' name=721 href="#721">721</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=event">event</a> = <span class='v'>new </span><span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<span class='a'>MozApplicationEvent</span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aName">aName</a>, {
<a class='l d2' name=722 href="#722">722</a>       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=application">application</a>: <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=obj">obj</a>
<a class='l d2' name=723 href="#723">723</a>     });
<a class='l d2' name=724 href="#724">724</a>     <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=obj">obj</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=dispatchEvent">dispatchEvent</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=event">event</a>);
<a class='l d2' name=725 href="#725">725</a>   },
<a class='l d2' name=726 href="#726">726</a> 
<a class='l d2' name=727 href="#727">727</a>   <span class='a'>_fireRequestResult</span>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aMessage">aMessage</a>, <span class='a'>aIsError</span>) {
<a class='l d2' name=728 href="#728">728</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>;
<a class='l d2' name=729 href="#729">729</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a> = <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aMessage">aMessage</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=data">data</a>;
<a class='l d2' name=730 href="#730">730</a>     <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a> = <span class='v'>this.</span><span class='a'>takeRequest</span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=requestID">requestID</a>);
<a class='l d2' name=731 href="#731">731</a>     <span class='v'>if </span>(!<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>) {
<a class='l d2' name=732 href="#732">732</a>       <span class='v'>return;</span>
<a class='l d2' name=733 href="#733">733</a>     }
<a class='l d2' name=734 href="#734">734</a> 
<a class='l d2' name=735 href="#735">735</a>     <span class='a'>aIsError</span> ? <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Services">Services</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=DOMRequest">DOMRequest</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=fireError">fireError</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=error">error</a>)
<a class='l d2' name=736 href="#736">736</a>              : <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Services">Services</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=DOMRequest">DOMRequest</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=fireSuccess">fireSuccess</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=result">result</a>);
<a class='l d2' name=737 href="#737">737</a>   },
<a class='l d2' name=738 href="#738">738</a> 
<a class='l d2' name=739 href="#739">739</a>   <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=receiveMessage">receiveMessage</a>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aMessage">aMessage</a>) {
<a class='l d2' name=740 href="#740">740</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a> = <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aMessage">aMessage</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=json">json</a>;
<a class='l d2' name=741 href="#741">741</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>;
<a class='l d2' name=742 href="#742">742</a>     <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aMessage">aMessage</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=name">name</a> == <span class='s'>"Webapps:Connect:Return:OK"</span> ||
<a class='l d2' name=743 href="#743">743</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aMessage">aMessage</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=name">name</a> == <span class='s'>"Webapps:Connect:Return:KO"</span> ||
<a class='l d2' name=744 href="#744">744</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aMessage">aMessage</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=name">name</a> == <span class='s'>"Webapps:GetConnections:Return:OK"</span> ||
<a class='l d2' name=745 href="#745">745</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aMessage">aMessage</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=name">name</a> == <span class='s'>"Webapps:Export:Return"</span> ||
<a class='l d2' name=746 href="#746">746</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aMessage">aMessage</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=name">name</a> == <span class='s'>"Webapps:GetLocalizedValue:Return"</span>) {
<a class='l d2' name=747 href="#747">747</a>       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a> = <span class='v'>this.</span><span class='a'>takePromiseResolver</span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=requestID">requestID</a>);
<a class='l d2' name=748 href="#748">748</a>     } <span class='v'>else </span>{
<a class='l d2' name=749 href="#749">749</a>       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a> = <span class='v'>this.</span><span class='a'>takeRequest</span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=requestID">requestID</a>);
<a class='l d2' name=750 href="#750">750</a>     }
<a class='l d2' name=751 href="#751">751</a> 
<a class='l d2' name=752 href="#752">752</a>     <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=oid">oid</a> !== <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_id">_id</a> || !<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>) {
<a class='l d2' name=753 href="#753">753</a>       <span class='v'>return;</span>
<a class='l d2' name=754 href="#754">754</a>     }
<a class='l d2' name=755 href="#755">755</a> 
<a class='l d2' name=756 href="#756">756</a>     <span class='v'>switch </span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aMessage">aMessage</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=name">name</a>) {
<a class='l d2' name=757 href="#757">757</a>       <span class='v'>case </span><span class='s'>"Webapps:Launch:Return:KO"</span>:
<a class='l d2' name=758 href="#758">758</a>         <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=removeMessageListeners">removeMessageListeners</a>([<span class='s'>"Webapps:Launch:Return:OK"</span>,
<a class='l d2' name=759 href="#759">759</a>                                      <span class='s'>"Webapps:Launch:Return:KO"</span>]);
<a class='l d2' name=760 href="#760">760</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Services">Services</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=DOMRequest">DOMRequest</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=fireError">fireError</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=error">error</a>);
<a class='l d2' name=761 href="#761">761</a>         <span class='v'>break;
<a class='l d2' name=762 href="#762">762</a> </span>      <span class='v'>case </span><span class='s'>"Webapps:Launch:Return:OK"</span>:
<a class='l d2' name=763 href="#763">763</a>         <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=removeMessageListeners">removeMessageListeners</a>([<span class='s'>"Webapps:Launch:Return:OK"</span>,
<a class='l d2' name=764 href="#764">764</a>                                      <span class='s'>"Webapps:Launch:Return:KO"</span>]);
<a class='l d2' name=765 href="#765">765</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Services">Services</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=DOMRequest">DOMRequest</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=fireSuccess">fireSuccess</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>, <span class='v'>null)</span>;
<a class='l d2' name=766 href="#766">766</a>         <span class='v'>break;
<a class='l d2' name=767 href="#767">767</a> </span>      <span class='v'>case </span><span class='s'>"Webapps:ClearBrowserData:Return"</span>:
<a class='l d2' name=768 href="#768">768</a>         <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=removeMessageListeners">removeMessageListeners</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aMessage">aMessage</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=name">name</a>);
<a class='l d2' name=769 href="#769">769</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Services">Services</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=DOMRequest">DOMRequest</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=fireSuccess">fireSuccess</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>, <span class='v'>null)</span>;
<a class='l d2' name=770 href="#770">770</a>         <span class='v'>break;
<a class='l d2' name=771 href="#771">771</a> </span>      <span class='v'>case </span><span class='s'>"Webapps:Connect:Return:OK"</span>:
<a class='l d2' name=772 href="#772">772</a>         <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=removeMessageListeners">removeMessageListeners</a>([<span class='s'>"Webapps:Connect:Return:OK"</span>,
<a class='l d2' name=773 href="#773">773</a>                                      <span class='s'>"Webapps:Connect:Return:KO"</span>]);
<a class='l d2' name=774 href="#774">774</a>         <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=messagePorts">messagePorts</a> = <span class='v'>new </span><span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Array">Array</a>();
<a class='l d2' name=775 href="#775">775</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=messagePortIDs">messagePortIDs</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=forEach">forEach</a>((<span class='a'>aPortID</span>) =&gt; {
<a class='l d2' name=776 href="#776">776</a>           <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=port">port</a> = <span class='v'>new </span><span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<span class='a'>MozInterAppMessagePort</span>(<span class='a'>aPortID</span>);
<a class='l d2' name=777 href="#777">777</a>           <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=messagePorts">messagePorts</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=push">push</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=port">port</a>);
<a class='l d2' name=778 href="#778">778</a>         });
<a class='l d2' name=779 href="#779">779</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=resolve">resolve</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=messagePorts">messagePorts</a>);
<a class='l d2' name=780 href="#780">780</a>         <span class='v'>break;
<a class='l d2' name=781 href="#781">781</a> </span>      <span class='v'>case </span><span class='s'>"Webapps:Connect:Return:KO"</span>:
<a class='l d2' name=782 href="#782">782</a>         <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=removeMessageListeners">removeMessageListeners</a>([<span class='s'>"Webapps:Connect:Return:OK"</span>,
<a class='l d2' name=783 href="#783">783</a>                                      <span class='s'>"Webapps:Connect:Return:KO"</span>]);
<a class='l d2' name=784 href="#784">784</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=reject">reject</a>(<span class='s'>"No connections registered"</span>);
<a class='l d2' name=785 href="#785">785</a>         <span class='v'>break;
<a class='l d2' name=786 href="#786">786</a> </span>      <span class='v'>case </span><span class='s'>"Webapps:GetConnections:Return:OK"</span>:
<a class='l d2' name=787 href="#787">787</a>         <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=removeMessageListeners">removeMessageListeners</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aMessage">aMessage</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=name">name</a>);
<a class='l d2' name=788 href="#788">788</a>         <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=connections">connections</a> = <span class='v'>new </span><span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Array">Array</a>();
<a class='l d2' name=789 href="#789">789</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=connections">connections</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=forEach">forEach</a>((<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aConnection">aConnection</a>) =&gt; {
<a class='l d2' name=790 href="#790">790</a>           <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=connection">connection</a> =
<a class='l d2' name=791 href="#791">791</a>             <span class='v'>new </span><span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<span class='a'>MozInterAppConnection</span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aConnection">aConnection</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=keyword">keyword</a>,
<a class='l d2' name=792 href="#792">792</a>                                                    <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aConnection">aConnection</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=pubAppManifestURL">pubAppManifestURL</a>,
<a class='l d2' name=793 href="#793">793</a>                                                    <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aConnection">aConnection</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=subAppManifestURL">subAppManifestURL</a>);
<a class='l d2' name=794 href="#794">794</a>           <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=connections">connections</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=push">push</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=connection">connection</a>);
<a class='l d2' name=795 href="#795">795</a>         });
<a class='l d2' name=796 href="#796">796</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=resolve">resolve</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=connections">connections</a>);
<a class='l d2' name=797 href="#797">797</a>         <span class='v'>break;
<a class='l d2' name=798 href="#798">798</a> </span>      <span class='v'>case </span><span class='s'>"Webapps:AddReceipt:Return:OK"</span>:
<a class='l d2' name=799 href="#799">799</a>         <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=removeMessageListeners">removeMessageListeners</a>([<span class='s'>"Webapps:AddReceipt:Return:OK"</span>,
<a class='l d2' name=800 href="#800">800</a>                                      <span class='s'>"Webapps:AddReceipt:Return:KO"</span>]);
<a class='l d2' name=801 href="#801">801</a>         <span class='v'>this.</span><span class='a'>__DOM_IMPL__</span>.<span class='a'>_clearCachedReceiptsValue</span>();
<a class='l d2' name=802 href="#802">802</a>         <span class='v'>this.</span><span class='a'>_proxy</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=receipts">receipts</a> = <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=receipts">receipts</a>;
<a class='l d2' name=803 href="#803">803</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Services">Services</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=DOMRequest">DOMRequest</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=fireSuccess">fireSuccess</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>, <span class='v'>null)</span>;
<a class='l d2' name=804 href="#804">804</a>         <span class='v'>break;
<a class='l d2' name=805 href="#805">805</a> </span>      <span class='v'>case </span><span class='s'>"Webapps:AddReceipt:Return:KO"</span>:
<a class='l d2' name=806 href="#806">806</a>         <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=removeMessageListeners">removeMessageListeners</a>([<span class='s'>"Webapps:AddReceipt:Return:OK"</span>,
<a class='l d2' name=807 href="#807">807</a>                                      <span class='s'>"Webapps:AddReceipt:Return:KO"</span>]);
<a class='l d2' name=808 href="#808">808</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Services">Services</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=DOMRequest">DOMRequest</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=fireError">fireError</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=error">error</a>);
<a class='l d2' name=809 href="#809">809</a>         <span class='v'>break;
<a class='l d2' name=810 href="#810">810</a> </span>      <span class='v'>case </span><span class='s'>"Webapps:RemoveReceipt:Return:OK"</span>:
<a class='l d2' name=811 href="#811">811</a>         <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=removeMessageListeners">removeMessageListeners</a>([<span class='s'>"Webapps:RemoveReceipt:Return:OK"</span>,
<a class='l d2' name=812 href="#812">812</a>                                      <span class='s'>"Webapps:RemoveReceipt:Return:KO"</span>]);
<a class='l d2' name=813 href="#813">813</a>         <span class='v'>this.</span><span class='a'>__DOM_IMPL__</span>.<span class='a'>_clearCachedReceiptsValue</span>();
<a class='l d2' name=814 href="#814">814</a>         <span class='v'>this.</span><span class='a'>_proxy</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=receipts">receipts</a> = <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=receipts">receipts</a>;
<a class='l d2' name=815 href="#815">815</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Services">Services</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=DOMRequest">DOMRequest</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=fireSuccess">fireSuccess</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>, <span class='v'>null)</span>;
<a class='l d2' name=816 href="#816">816</a>         <span class='v'>break;
<a class='l d2' name=817 href="#817">817</a> </span>      <span class='v'>case </span><span class='s'>"Webapps:RemoveReceipt:Return:KO"</span>:
<a class='l d2' name=818 href="#818">818</a>         <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=removeMessageListeners">removeMessageListeners</a>([<span class='s'>"Webapps:RemoveReceipt:Return:OK"</span>,
<a class='l d2' name=819 href="#819">819</a>                                      <span class='s'>"Webapps:RemoveReceipt:Return:KO"</span>]);
<a class='l d2' name=820 href="#820">820</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Services">Services</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=DOMRequest">DOMRequest</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=fireError">fireError</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=error">error</a>);
<a class='l d2' name=821 href="#821">821</a>         <span class='v'>break;
<a class='l d2' name=822 href="#822">822</a> </span>      <span class='v'>case </span><span class='s'>"Webapps:ReplaceReceipt:Return:OK"</span>:
<a class='l d2' name=823 href="#823">823</a>         <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=removeMessageListeners">removeMessageListeners</a>([<span class='s'>"Webapps:ReplaceReceipt:Return:OK"</span>,
<a class='l d2' name=824 href="#824">824</a>                                      <span class='s'>"Webapps:ReplaceReceipt:Return:KO"</span>]);
<a class='l d2' name=825 href="#825">825</a>         <span class='v'>this.</span><span class='a'>__DOM_IMPL__</span>.<span class='a'>_clearCachedReceiptsValue</span>();
<a class='l d2' name=826 href="#826">826</a>         <span class='v'>this.</span><span class='a'>_proxy</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=receipts">receipts</a> = <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=receipts">receipts</a>;
<a class='l d2' name=827 href="#827">827</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Services">Services</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=DOMRequest">DOMRequest</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=fireSuccess">fireSuccess</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>, <span class='v'>null)</span>;
<a class='l d2' name=828 href="#828">828</a>         <span class='v'>break;
<a class='l d2' name=829 href="#829">829</a> </span>      <span class='v'>case </span><span class='s'>"Webapps:ReplaceReceipt:Return:KO"</span>:
<a class='l d2' name=830 href="#830">830</a>         <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=removeMessageListeners">removeMessageListeners</a>([<span class='s'>"Webapps:ReplaceReceipt:Return:OK"</span>,
<a class='l d2' name=831 href="#831">831</a>                                      <span class='s'>"Webapps:ReplaceReceipt:Return:KO"</span>]);
<a class='l d2' name=832 href="#832">832</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Services">Services</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=DOMRequest">DOMRequest</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=fireError">fireError</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=error">error</a>);
<a class='l d2' name=833 href="#833">833</a>         <span class='v'>break;
<a class='l d2' name=834 href="#834">834</a> </span>      <span class='v'>case </span><span class='s'>"Webapps:Export:Return"</span>:
<a class='l d2' name=835 href="#835">835</a>         <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=removeMessageListeners">removeMessageListeners</a>([<span class='s'>"Webapps:Export:Return"</span>]);
<a class='l d2' name=836 href="#836">836</a>         <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=success">success</a>) {
<a class='l d2' name=837 href="#837">837</a>           <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=resolve">resolve</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Cu">Cu</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=cloneInto">cloneInto</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=blob">blob</a>, <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>));
<a class='l d2' name=838 href="#838">838</a>         } <span class='v'>else </span>{
<a class='l d2' name=839 href="#839">839</a>           <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=reject">reject</a>(<span class='v'>new </span><span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=DOMError">DOMError</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=error">error</a> || <span class='s'>""</span>));
<a class='l d2' name=840 href="#840">840</a>         }
<a class='l d2' name=841 href="#841">841</a>         <span class='v'>break;
<a class='l d2' name=842 href="#842">842</a> </span>      <span class='v'>case </span><span class='s'>"Webapps:GetLocalizedValue:Return"</span>:
<a class='l d2' name=843 href="#843">843</a>         <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=removeMessageListeners">removeMessageListeners</a>([<span class='s'>"Webapps:GetLocalizedValue:Return"</span>]);
<a class='l d2' name=844 href="#844">844</a>         <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=success">success</a>) {
<a class='l d2' name=845 href="#845">845</a>           <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=resolve">resolve</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=value">value</a>);
<a class='l d2' name=846 href="#846">846</a>         } <span class='v'>else </span>{
<a class='l d2' name=847 href="#847">847</a>           <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=reject">reject</a>(<span class='v'>new </span><span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=DOMError">DOMError</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=error">error</a> || <span class='s'>""</span>));
<a class='l d2' name=848 href="#848">848</a>         }
<a class='l d2' name=849 href="#849">849</a>         <span class='v'>break;
<a class='l d2' name=850 href="#850">850</a> </span>    }
<a class='l d2' name=851 href="#851">851</a>   },
<a class='l d2' name=852 href="#852">852</a> 
<a class='l d2' name=853 href="#853">853</a>   <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=classID">classID</a>: <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Components">Components</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=ID">ID</a>(<span class='s'>"{723ed303-7757-4fb0-b261-4f78b1f6bd22}"</span>),
<a class='l d2' name=854 href="#854">854</a> 
<a class='l d2' name=855 href="#855">855</a>   <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=QueryInterface">QueryInterface</a>: <span class='a'>XPCOMUtils</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=generateQI">generateQI</a>([<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Ci">Ci</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=nsISupports">nsISupports</a>,
<a class='l d2' name=856 href="#856">856</a>                                          <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Ci">Ci</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=nsIObserver">nsIObserver</a>,
<a class='l d2' name=857 href="#857">857</a>                                          <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Ci">Ci</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=nsISupportsWeakReference">nsISupportsWeakReference</a>])
<a class='l d2' name=858 href="#858">858</a> }
<a class='l d2' name=859 href="#859">859</a> 
<a class='l d2' name=860 href="#860">860</a> <span class='c'>/**</span>
<a class='l d2' name=861 href="#861">861</a> <span class='c'>  * DOMApplicationsManager object</span>
<a class='l d2' name=862 href="#862">862</a> <span class='c'>  */</span>
<a class='l d2' name=863 href="#863">863</a> <span class='v'>function </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=WebappsApplicationMgmt">WebappsApplicationMgmt</a>() {
<a class='l d2' name=864 href="#864">864</a>   <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=wrappedJSObject">wrappedJSObject</a> = <span class='v'>this;</span>
<a class='l d2' name=865 href="#865">865</a> }
<a class='l d2' name=866 href="#866">866</a> 
<a class='l d2' name=867 href="#867">867</a> <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=WebappsApplicationMgmt">WebappsApplicationMgmt</a>.<span class='v'>prototype </span>= {
<a class='l d2' name=868 href="#868">868</a>   <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=__proto__">__proto__</a>: <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=DOMRequestIpcHelper">DOMRequestIpcHelper</a>.<span class='v'>prototype,</span>
<a class='l d2' name=869 href="#869">869</a> 
<a class='l d2' name=870 href="#870">870</a>   <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=init">init</a>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aWindow">aWindow</a>, <span class='a'>aHasFullMgmtPrivilege</span>) {
<a class='l d2' name=871 href="#871">871</a>     <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a> = <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aWindow">aWindow</a>;
<a class='l d2' name=872 href="#872">872</a> 
<a class='l d2' name=873 href="#873">873</a>     <span class='v'>this.</span><span class='a'>initDOMRequestHelper</span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aWindow">aWindow</a>, [<span class='s'>"Webapps:Uninstall:Return:OK"</span>,
<a class='l d2' name=874 href="#874">874</a>                                         <span class='s'>"Webapps:Uninstall:Broadcast:Return:OK"</span>,
<a class='l d2' name=875 href="#875">875</a>                                         <span class='s'>"Webapps:Uninstall:Return:KO"</span>,
<a class='l d2' name=876 href="#876">876</a>                                         <span class='s'>"Webapps:Install:Return:OK"</span>,
<a class='l d2' name=877 href="#877">877</a>                                         <span class='s'>"Webapps:GetNotInstalled:Return:OK"</span>,
<a class='l d2' name=878 href="#878">878</a>                                         <span class='s'>"Webapps:GetIcon:Return"</span>,
<a class='l d2' name=879 href="#879">879</a>                                         <span class='s'>"Webapps:Import:Return"</span>,
<a class='l d2' name=880 href="#880">880</a>                                         <span class='s'>"Webapps:ExtractManifest:Return"</span>,
<a class='l d2' name=881 href="#881">881</a>                                         <span class='s'>"Webapps:SetEnabled:Return"</span>]);
<a class='l d2' name=882 href="#882">882</a>     <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=cpmm">cpmm</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=sendAsyncMessage">sendAsyncMessage</a>(<span class='s'>"Webapps:RegisterForMessages"</span>,
<a class='l d2' name=883 href="#883">883</a>                           {
<a class='l d2' name=884 href="#884">884</a>                             <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=messages">messages</a>: [<span class='s'>"Webapps:Install:Return:OK"</span>,
<a class='l d2' name=885 href="#885">885</a>                                        <span class='s'>"Webapps:Uninstall:Return:OK"</span>,
<a class='l d2' name=886 href="#886">886</a>                                        <span class='s'>"Webapps:Uninstall:Broadcast:Return:OK"</span>,
<a class='l d2' name=887 href="#887">887</a>                                        <span class='s'>"Webapps:SetEnabled:Return"</span>]
<a class='l d2' name=888 href="#888">888</a>                           }
<a class='l d2' name=889 href="#889">889</a>                          );
<a class='l d2' name=890 href="#890">890</a> 
<a class='l d2' name=891 href="#891">891</a>     <span class='v'>if </span>(!<span class='a'>aHasFullMgmtPrivilege</span>) {
<a class='l d2' name=892 href="#892">892</a>       <span class='v'>this.</span><span class='a'>getNotInstalled</span> = <span class='v'>null;
<a class='l d2' name=893 href="#893">893</a> </span>      <span class='v'>this.</span><span class='a'>applyDownload</span> = <span class='v'>null;
<a class='l d2' name=894 href="#894">894</a> </span>    }
<a class='l d2' name=895 href="#895">895</a>   },
<a class='l d2' name=896 href="#896">896</a> 
<a class='l d2' name=897 href="#897">897</a>   <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=uninit">uninit</a>: <span class='v'>function(</span>) {
<a class='l d2' name=898 href="#898">898</a>     <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=cpmm">cpmm</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=sendAsyncMessage">sendAsyncMessage</a>(<span class='s'>"Webapps:UnregisterForMessages"</span>,
<a class='l d2' name=899 href="#899">899</a>                           [<span class='s'>"Webapps:Install:Return:OK"</span>,
<a class='l d2' name=900 href="#900">900</a>                            <span class='s'>"Webapps:Uninstall:Return:OK"</span>,
<a class='l d2' name=901 href="#901">901</a>                            <span class='s'>"Webapps:Uninstall:Broadcast:Return:OK"</span>,
<a class='l d2' name=902 href="#902">902</a>                            <span class='s'>"Webapps:SetEnabled:Return"</span>]);
<a class='l d2' name=903 href="#903">903</a>   },
<a class='l d2' name=904 href="#904">904</a> 
<a class='l d2' name=905 href="#905">905</a>   <span class='a'>applyDownload</span>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aApp">aApp</a>) {
<a class='l d2' name=906 href="#906">906</a>     <span class='v'>if </span>(!<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aApp">aApp</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=readyToApplyDownload">readyToApplyDownload</a>) {
<a class='l d2' name=907 href="#907">907</a>       <span class='v'>return;</span>
<a class='l d2' name=908 href="#908">908</a>     }
<a class='l d2' name=909 href="#909">909</a> 
<a class='l d2' name=910 href="#910">910</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=principal">principal</a> = <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=document">document</a>.<span class='a'>nodePrincipal</span>;
<a class='l d2' name=911 href="#911">911</a> 
<a class='l d2' name=912 href="#912">912</a>     <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=cpmm">cpmm</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=sendAsyncMessage">sendAsyncMessage</a>(<span class='s'>"Webapps:ApplyDownload"</span>,
<a class='l d2' name=913 href="#913">913</a>                           { <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>: <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aApp">aApp</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a> },
<a class='l d2' name=914 href="#914">914</a>                           <span class='v'>null,</span> <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=principal">principal</a>);
<a class='l d2' name=915 href="#915">915</a>   },
<a class='l d2' name=916 href="#916">916</a> 
<a class='l d2' name=917 href="#917">917</a>   <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=uninstall">uninstall</a>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aApp">aApp</a>) {
<a class='l d2' name=918 href="#918">918</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a> = <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=createRequest">createRequest</a>();
<a class='l d2' name=919 href="#919">919</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=principal">principal</a> = <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=document">document</a>.<span class='a'>nodePrincipal</span>;
<a class='l d2' name=920 href="#920">920</a> 
<a class='l d2' name=921 href="#921">921</a>     <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=cpmm">cpmm</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=sendAsyncMessage">sendAsyncMessage</a>(<span class='s'>"Webapps:Uninstall"</span>, {
<a class='l d2' name=922 href="#922">922</a>       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=origin">origin</a>: <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aApp">aApp</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=origin">origin</a>,
<a class='l d2' name=923 href="#923">923</a>       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>: <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aApp">aApp</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>,
<a class='l d2' name=924 href="#924">924</a>       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=oid">oid</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_id">_id</a>,
<a class='l d2' name=925 href="#925">925</a>       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=topId">topId</a>: <span class='v'>this.</span><span class='a'>_topId</span>,
<a class='l d2' name=926 href="#926">926</a>       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=from">from</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=location">location</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=href">href</a>,
<a class='l d2' name=927 href="#927">927</a>       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=windowId">windowId</a>: <span class='v'>this.</span><span class='a'>_windowId</span>,
<a class='l d2' name=928 href="#928">928</a>       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=requestID">requestID</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=getRequestId">getRequestId</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a>)
<a class='l d2' name=929 href="#929">929</a>     }, <span class='v'>null,</span> <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=principal">principal</a>);
<a class='l d2' name=930 href="#930">930</a> 
<a class='l d2' name=931 href="#931">931</a>     <span class='v'>return </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a>;
<a class='l d2' name=932 href="#932">932</a>   },
<a class='l d2' name=933 href="#933">933</a> 
<a class='l d2' name=934 href="#934">934</a>   <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=getAll">getAll</a>: <span class='v'>function(</span>) {
<a class='l d2' name=935 href="#935">935</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a> = <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=createRequest">createRequest</a>();
<a class='l d2' name=936 href="#936">936</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=window">window</a> = <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>;
<a class='l d2' name=937 href="#937">937</a>     <span class='a'>DOMApplicationRegistry</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=getAll">getAll</a>((<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aApps">aApps</a>) =&gt; {
<a class='l d2' name=938 href="#938">938</a>       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Services">Services</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=DOMRequest">DOMRequest</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=fireSuccessAsync">fireSuccessAsync</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a>,
<a class='l d2' name=939 href="#939">939</a>                                            <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=convertAppsArray">convertAppsArray</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aApps">aApps</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=window">window</a>));
<a class='l d2' name=940 href="#940">940</a>     });
<a class='l d2' name=941 href="#941">941</a> 
<a class='l d2' name=942 href="#942">942</a>     <span class='v'>return </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a>;
<a class='l d2' name=943 href="#943">943</a>   },
<a class='l d2' name=944 href="#944">944</a> 
<a class='l d2' name=945 href="#945">945</a>   <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=getIcon">getIcon</a>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aApp">aApp</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aIconID">aIconID</a>, <span class='a'>aEntryPoint</span>) {
<a class='l d2' name=946 href="#946">946</a>     <span class='v'>return </span><span class='v'>this.</span><span class='a'>createPromiseWithId</span>((<span class='a'>aResolverId</span>) =&gt; {
<a class='l d2' name=947 href="#947">947</a>       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=cpmm">cpmm</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=sendAsyncMessage">sendAsyncMessage</a>(<span class='s'>"Webapps:GetIcon"</span>, {
<a class='l d2' name=948 href="#948">948</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=oid">oid</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_id">_id</a>,
<a class='l d2' name=949 href="#949">949</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=topId">topId</a>: <span class='v'>this.</span><span class='a'>_topId</span>,
<a class='l d2' name=950 href="#950">950</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>: <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aApp">aApp</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>,
<a class='l d2' name=951 href="#951">951</a>         <span class='a'>iconID</span>: <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aIconID">aIconID</a>,
<a class='l d2' name=952 href="#952">952</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=entryPoint">entryPoint</a>: <span class='a'>aEntryPoint</span>,
<a class='l d2' name=953 href="#953">953</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=requestID">requestID</a>: <span class='a'>aResolverId</span>
<a class='l d2' name=954 href="#954">954</a>       });
<a class='l d2' name=955 href="#955">955</a>     });
<a class='l d2' name=956 href="#956">956</a>   },
<a class='l d2' name=957 href="#957">957</a> 
<a class='l d2' name=958 href="#958">958</a>   <span class='a'>getNotInstalled</span>: <span class='v'>function(</span>) {
<a class='l d2' name=959 href="#959">959</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a> = <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=createRequest">createRequest</a>();
<a class='l d2' name=960 href="#960">960</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=principal">principal</a> = <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=document">document</a>.<span class='a'>nodePrincipal</span>;
<a class='l d2' name=961 href="#961">961</a> 
<a class='l d2' name=962 href="#962">962</a>     <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=cpmm">cpmm</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=sendAsyncMessage">sendAsyncMessage</a>(<span class='s'>"Webapps:GetNotInstalled"</span>, {
<a class='l d2' name=963 href="#963">963</a>       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=oid">oid</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_id">_id</a>,
<a class='l d2' name=964 href="#964">964</a>       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=topId">topId</a>: <span class='v'>this.</span><span class='a'>_topId</span>,
<a class='l d2' name=965 href="#965">965</a>       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=requestID">requestID</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=getRequestId">getRequestId</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a>)
<a class='l d2' name=966 href="#966">966</a>     }, <span class='v'>null,</span> <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=principal">principal</a>);
<a class='l d2' name=967 href="#967">967</a> 
<a class='l d2' name=968 href="#968">968</a>     <span class='v'>return </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=request">request</a>;
<a class='l d2' name=969 href="#969">969</a>   },
<a class='l d2' name=970 href="#970">970</a> 
<a class='l d2' name=971 href="#971">971</a>   <span class='v'>import: </span><span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aBlob">aBlob</a>) {
<a class='l d2' name=972 href="#972">972</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=principal">principal</a> = <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=document">document</a>.<span class='a'>nodePrincipal</span>;
<a class='l d2' name=973 href="#973">973</a>     <span class='v'>return </span><span class='v'>this.</span><span class='a'>createPromiseWithId</span>((<span class='a'>aResolverId</span>) =&gt; {
<a class='l d2' name=974 href="#974">974</a>       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=cpmm">cpmm</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=sendAsyncMessage">sendAsyncMessage</a>(<span class='s'>"Webapps:Import"</span>,
<a class='l d2' name=975 href="#975">975</a>         { <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=blob">blob</a>: <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aBlob">aBlob</a>,
<a class='l d2' name=976 href="#976">976</a>           <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=oid">oid</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_id">_id</a>,
<a class='l d2' name=977 href="#977">977</a>           <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=topId">topId</a>: <span class='v'>this.</span><span class='a'>_topId</span>,
<a class='l d2' name=978 href="#978">978</a>           <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=requestID">requestID</a>: <span class='a'>aResolverId</span>
<a class='l d2' name=979 href="#979">979</a>         }, <span class='v'>null,</span> <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=principal">principal</a>);
<a class='l d2' name=980 href="#980">980</a>     });
<a class='l d2' name=981 href="#981">981</a>   },
<a class='l d2' name=982 href="#982">982</a> 
<a class='l d2' name=983 href="#983">983</a>   <span class='a'>extractManifest</span>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aBlob">aBlob</a>) {
<a class='l d2' name=984 href="#984">984</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=principal">principal</a> = <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=document">document</a>.<span class='a'>nodePrincipal</span>;
<a class='l d2' name=985 href="#985">985</a>     <span class='v'>return </span><span class='v'>this.</span><span class='a'>createPromiseWithId</span>((<span class='a'>aResolverId</span>) =&gt; {
<a class='l d2' name=986 href="#986">986</a>       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=cpmm">cpmm</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=sendAsyncMessage">sendAsyncMessage</a>(<span class='s'>"Webapps:ExtractManifest"</span>,
<a class='l d2' name=987 href="#987">987</a>         { <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=blob">blob</a>: <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aBlob">aBlob</a>,
<a class='l d2' name=988 href="#988">988</a>           <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=oid">oid</a>: <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_id">_id</a>,
<a class='l d2' name=989 href="#989">989</a>           <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=topId">topId</a>: <span class='v'>this.</span><span class='a'>_topId</span>,
<a class='l d2' name=990 href="#990">990</a>           <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=requestID">requestID</a>: <span class='a'>aResolverId</span>
<a class='l d2' name=991 href="#991">991</a>         }, <span class='v'>null,</span> <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=principal">principal</a>);
<a class='l d2' name=992 href="#992">992</a>     });
<a class='l d2' name=993 href="#993">993</a>   },
<a class='l d2' name=994 href="#994">994</a> 
<a class='l d2' name=995 href="#995">995</a>   <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=setEnabled">setEnabled</a>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aApp">aApp</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aValue">aValue</a>) {
<a class='l d2' name=996 href="#996">996</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=principal">principal</a> = <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=document">document</a>.<span class='a'>nodePrincipal</span>;
<a class='l d2' name=997 href="#997">997</a> 
<a class='l d2' name=998 href="#998">998</a>     <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=cpmm">cpmm</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=sendAsyncMessage">sendAsyncMessage</a>(<span class='s'>"Webapps:SetEnabled"</span>,
<a class='l d2' name=999 href="#999">999</a>                           { <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>: <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aApp">aApp</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>,
<a class='l d3' name=1000 href="#1000">1000</a>                             <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=enabled">enabled</a>: <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aValue">aValue</a> }, <span class='v'>null,</span> <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=principal">principal</a>);
<a class='l d3' name=1001 href="#1001">1001</a>   },
<a class='l d3' name=1002 href="#1002">1002</a> 
<a class='l d3' name=1003 href="#1003">1003</a>   <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=oninstall">oninstall</a>() {
<a class='l d3' name=1004 href="#1004">1004</a>     <span class='v'>return </span><span class='v'>this.</span><span class='a'>__DOM_IMPL__</span>.<span class='a'>getEventHandler</span>(<span class='s'>"oninstall"</span>);
<a class='l d3' name=1005 href="#1005">1005</a>   },
<a class='l d3' name=1006 href="#1006">1006</a> 
<a class='l d3' name=1007 href="#1007">1007</a>   <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=onuninstall">onuninstall</a>() {
<a class='l d3' name=1008 href="#1008">1008</a>     <span class='v'>return </span><span class='v'>this.</span><span class='a'>__DOM_IMPL__</span>.<span class='a'>getEventHandler</span>(<span class='s'>"onuninstall"</span>);
<a class='l d3' name=1009 href="#1009">1009</a>   },
<a class='l d3' name=1010 href="#1010">1010</a> 
<a class='l d3' name=1011 href="#1011">1011</a>   <span class='v'>get </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=onenabledstatechange">onenabledstatechange</a>() {
<a class='l d3' name=1012 href="#1012">1012</a>     <span class='v'>return </span><span class='v'>this.</span><span class='a'>__DOM_IMPL__</span>.<span class='a'>getEventHandler</span>(<span class='s'>"onenabledstatechange"</span>);
<a class='l d3' name=1013 href="#1013">1013</a>   },
<a class='l d3' name=1014 href="#1014">1014</a> 
<a class='l d3' name=1015 href="#1015">1015</a>   <span class='v'>set </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=oninstall">oninstall</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aCallback">aCallback</a>) {
<a class='l d3' name=1016 href="#1016">1016</a>     <span class='v'>this.</span><span class='a'>__DOM_IMPL__</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=setEventHandler">setEventHandler</a>(<span class='s'>"oninstall"</span>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aCallback">aCallback</a>);
<a class='l d3' name=1017 href="#1017">1017</a>   },
<a class='l d3' name=1018 href="#1018">1018</a> 
<a class='l d3' name=1019 href="#1019">1019</a>   <span class='v'>set </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=onuninstall">onuninstall</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aCallback">aCallback</a>) {
<a class='l d3' name=1020 href="#1020">1020</a>     <span class='v'>this.</span><span class='a'>__DOM_IMPL__</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=setEventHandler">setEventHandler</a>(<span class='s'>"onuninstall"</span>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aCallback">aCallback</a>);
<a class='l d3' name=1021 href="#1021">1021</a>   },
<a class='l d3' name=1022 href="#1022">1022</a> 
<a class='l d3' name=1023 href="#1023">1023</a>   <span class='v'>set </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=onenabledstatechange">onenabledstatechange</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aCallback">aCallback</a>) {
<a class='l d3' name=1024 href="#1024">1024</a>     <span class='v'>this.</span><span class='a'>__DOM_IMPL__</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=setEventHandler">setEventHandler</a>(<span class='s'>"onenabledstatechange"</span>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aCallback">aCallback</a>);
<a class='l d3' name=1025 href="#1025">1025</a>   },
<a class='l d3' name=1026 href="#1026">1026</a> 
<a class='l d3' name=1027 href="#1027">1027</a>   <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=receiveMessage">receiveMessage</a>: <span class='v'>function(</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aMessage">aMessage</a>) {
<a class='l d3' name=1028 href="#1028">1028</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a> = <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aMessage">aMessage</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=data">data</a>;
<a class='l d3' name=1029 href="#1029">1029</a>     <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>;
<a class='l d3' name=1030 href="#1030">1030</a> 
<a class='l d3' name=1031 href="#1031">1031</a>     <span class='v'>if </span>([<span class='s'>"Webapps:GetIcon:Return"</span>,
<a class='l d3' name=1032 href="#1032">1032</a>          <span class='s'>"Webapps:Import:Return"</span>,
<a class='l d3' name=1033 href="#1033">1033</a>          <span class='s'>"Webapps:ExtractManifest:Return"</span>]
<a class='l d3' name=1034 href="#1034">1034</a>          .<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=indexOf">indexOf</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aMessage">aMessage</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=name">name</a>) != -1) {
<a class='l d3' name=1035 href="#1035">1035</a>       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a> = <span class='v'>this.</span><span class='a'>takePromiseResolver</span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=requestID">requestID</a>);
<a class='l d3' name=1036 href="#1036">1036</a>     } <span class='v'>else </span>{
<a class='l d3' name=1037 href="#1037">1037</a>       <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a> = <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=getRequest">getRequest</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=requestID">requestID</a>);
<a class='l d3' name=1038 href="#1038">1038</a>     }
<a class='l d3' name=1039 href="#1039">1039</a> 
<a class='l d3' name=1040 href="#1040">1040</a>     <span class='c'>// We want Webapps:Install:Return:OK, Webapps:Uninstall:Broadcast:Return:OK</span>
<a class='l d3' name=1041 href="#1041">1041</a> <span class='c'></span>    <span class='c'>// and Webapps:SetEnabled:Return</span>
<a class='l d3' name=1042 href="#1042">1042</a> <span class='c'></span>    <span class='c'>// to be broadcasted to all instances of mozApps.mgmt.</span>
<a class='l d3' name=1043 href="#1043">1043</a> <span class='c'></span>    <span class='v'>if </span>(!((<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=oid">oid</a> == <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_id">_id</a> &amp;&amp; <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>) ||
<a class='l d3' name=1044 href="#1044">1044</a>           <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aMessage">aMessage</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=name">name</a> == <span class='s'>"Webapps:Install:Return:OK"</span> ||
<a class='l d3' name=1045 href="#1045">1045</a>           <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aMessage">aMessage</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=name">name</a> == <span class='s'>"Webapps:Uninstall:Broadcast:Return:OK"</span> ||
<a class='l d3' name=1046 href="#1046">1046</a>           <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aMessage">aMessage</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=name">name</a> == <span class='s'>"Webapps:SetEnabled:Return"</span>)) {
<a class='l d3' name=1047 href="#1047">1047</a>       <span class='v'>return;</span>
<a class='l d3' name=1048 href="#1048">1048</a>     }
<a class='l d3' name=1049 href="#1049">1049</a> 
<a class='l d3' name=1050 href="#1050">1050</a>     <span class='v'>switch </span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aMessage">aMessage</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=name">name</a>) {
<a class='l d3' name=1051 href="#1051">1051</a>       <span class='v'>case </span><span class='s'>"Webapps:GetNotInstalled:Return:OK"</span>:
<a class='l d3' name=1052 href="#1052">1052</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Services">Services</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=DOMRequest">DOMRequest</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=fireSuccess">fireSuccess</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=convertAppsArray">convertAppsArray</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=apps">apps</a>, <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>));
<a class='l d3' name=1053 href="#1053">1053</a>         <span class='v'>break;
<a class='l d3' name=1054 href="#1054">1054</a> </span>      <span class='v'>case </span><span class='s'>"Webapps:Install:Return:OK"</span>:
<a class='l d3' name=1055 href="#1055">1055</a>         {
<a class='l d3' name=1056 href="#1056">1056</a>           <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=app">app</a> = <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=createContentApplicationObject">createContentApplicationObject</a>(<span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=app">app</a>);
<a class='l d3' name=1057 href="#1057">1057</a>           <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=event">event</a> =
<a class='l d3' name=1058 href="#1058">1058</a>             <span class='v'>new </span><span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<span class='a'>MozApplicationEvent</span>(<span class='s'>"install"</span>, { <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=application">application</a>: <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=app">app</a> });
<a class='l d3' name=1059 href="#1059">1059</a>           <span class='v'>this.</span><span class='a'>__DOM_IMPL__</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=dispatchEvent">dispatchEvent</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=event">event</a>);
<a class='l d3' name=1060 href="#1060">1060</a>         }
<a class='l d3' name=1061 href="#1061">1061</a>         <span class='v'>break;
<a class='l d3' name=1062 href="#1062">1062</a> </span>      <span class='v'>case </span><span class='s'>"Webapps:Uninstall:Broadcast:Return:OK"</span>:
<a class='l d3' name=1063 href="#1063">1063</a>         {
<a class='l d3' name=1064 href="#1064">1064</a>           <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=app">app</a> = <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=createContentApplicationObject">createContentApplicationObject</a>(<span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>);
<a class='l d3' name=1065 href="#1065">1065</a>           <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=event">event</a> =
<a class='l d3' name=1066 href="#1066">1066</a>             <span class='v'>new </span><span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<span class='a'>MozApplicationEvent</span>(<span class='s'>"uninstall"</span>, { <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=application">application</a> : <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=app">app</a> });
<a class='l d3' name=1067 href="#1067">1067</a>           <span class='v'>this.</span><span class='a'>__DOM_IMPL__</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=dispatchEvent">dispatchEvent</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=event">event</a>);
<a class='l d3' name=1068 href="#1068">1068</a>         }
<a class='l d3' name=1069 href="#1069">1069</a>         <span class='v'>break;
<a class='l d3' name=1070 href="#1070">1070</a> </span>      <span class='v'>case </span><span class='s'>"Webapps:Uninstall:Return:OK"</span>:
<a class='l d3' name=1071 href="#1071">1071</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Services">Services</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=DOMRequest">DOMRequest</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=fireSuccess">fireSuccess</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifestURL">manifestURL</a>);
<a class='l d3' name=1072 href="#1072">1072</a>         <span class='v'>break;
<a class='l d3' name=1073 href="#1073">1073</a> </span>      <span class='v'>case </span><span class='s'>"Webapps:Uninstall:Return:KO"</span>:
<a class='l d3' name=1074 href="#1074">1074</a>         <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Services">Services</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=DOMRequest">DOMRequest</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=fireError">fireError</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>, <span class='s'>"NOT_INSTALLED"</span>);
<a class='l d3' name=1075 href="#1075">1075</a>         <span class='v'>break;
<a class='l d3' name=1076 href="#1076">1076</a> </span>      <span class='v'>case </span><span class='s'>"Webapps:Import:Return"</span>:
<a class='l d3' name=1077 href="#1077">1077</a>         <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=success">success</a>) {
<a class='l d3' name=1078 href="#1078">1078</a>           <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=resolve">resolve</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=createContentApplicationObject">createContentApplicationObject</a>(<span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=app">app</a>));
<a class='l d3' name=1079 href="#1079">1079</a>         } <span class='v'>else </span>{
<a class='l d3' name=1080 href="#1080">1080</a>           <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=reject">reject</a>(<span class='v'>new </span><span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=DOMError">DOMError</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=error">error</a> || <span class='s'>""</span>));
<a class='l d3' name=1081 href="#1081">1081</a>         }
<a class='l d3' name=1082 href="#1082">1082</a>         <span class='v'>break;
<a class='l d3' name=1083 href="#1083">1083</a> </span>      <span class='v'>case </span><span class='s'>"Webapps:ExtractManifest:Return"</span>:
<a class='l d3' name=1084 href="#1084">1084</a>         <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=success">success</a>) {
<a class='l d3' name=1085 href="#1085">1085</a>           <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=resolve">resolve</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Cu">Cu</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=cloneInto">cloneInto</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=manifest">manifest</a>, <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>));
<a class='l d3' name=1086 href="#1086">1086</a>         } <span class='v'>else </span>{
<a class='l d3' name=1087 href="#1087">1087</a>           <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=reject">reject</a>(<span class='v'>new </span><span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=DOMError">DOMError</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=error">error</a> || <span class='s'>""</span>));
<a class='l d3' name=1088 href="#1088">1088</a>         }
<a class='l d3' name=1089 href="#1089">1089</a>         <span class='v'>break;
<a class='l d3' name=1090 href="#1090">1090</a> </span>      <span class='v'>case </span><span class='s'>"Webapps:SetEnabled:Return"</span>:
<a class='l d3' name=1091 href="#1091">1091</a>         {
<a class='l d3' name=1092 href="#1092">1092</a>           <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=app">app</a> = <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=createContentApplicationObject">createContentApplicationObject</a>(<span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>, <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>);
<a class='l d3' name=1093 href="#1093">1093</a>           <span class='v'>let </span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=event">event</a> =
<a class='l d3' name=1094 href="#1094">1094</a>             <span class='v'>new </span><span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<span class='a'>MozApplicationEvent</span>(<span class='s'>"enabledstatechange"</span>, { <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=application">application</a> : <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=app">app</a> });
<a class='l d3' name=1095 href="#1095">1095</a>           <span class='v'>this.</span><span class='a'>__DOM_IMPL__</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=dispatchEvent">dispatchEvent</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=event">event</a>);
<a class='l d3' name=1096 href="#1096">1096</a>         }
<a class='l d3' name=1097 href="#1097">1097</a>         <span class='v'>break;
<a class='l d3' name=1098 href="#1098">1098</a> </span>      <span class='v'>case </span><span class='s'>"Webapps:GetIcon:Return"</span>:
<a class='l d3' name=1099 href="#1099">1099</a>         <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=blob">blob</a>) {
<a class='l d3' name=1100 href="#1100">1100</a>           <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=resolve">resolve</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Cu">Cu</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=cloneInto">cloneInto</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=blob">blob</a>, <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>));
<a class='l d3' name=1101 href="#1101">1101</a>         } <span class='v'>else </span><span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=error">error</a> &amp;&amp; <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=error">error</a> == <span class='s'>"NETWORK_ERROR"</span>
<a class='l d3' name=1102 href="#1102">1102</a>                              &amp;&amp; !<span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=navigator">navigator</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=onLine">onLine</a>) {
<a class='l d3' name=1103 href="#1103">1103</a>           <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=reject">reject</a>(<span class='v'>new </span><span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=DOMError">DOMError</a>(<span class='s'>"NETWORK_OFFLINE"</span>));
<a class='l d3' name=1104 href="#1104">1104</a>         } <span class='v'>else </span>{
<a class='l d3' name=1105 href="#1105">1105</a>           <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=req">req</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=reject">reject</a>(<span class='v'>new </span><span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=_window">_window</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=DOMError">DOMError</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=error">error</a> || <span class='s'>""</span>));
<a class='l d3' name=1106 href="#1106">1106</a>         }
<a class='l d3' name=1107 href="#1107">1107</a>         <span class='v'>break;
<a class='l d3' name=1108 href="#1108">1108</a> </span>    }
<a class='l d3' name=1109 href="#1109">1109</a> 
<a class='l d3' name=1110 href="#1110">1110</a>     <span class='v'>if </span>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=aMessage">aMessage</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=name">name</a> !== <span class='s'>"Webapps:Uninstall:Broadcast:Return:OK"</span>) {
<a class='l d3' name=1111 href="#1111">1111</a>       <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=removeRequest">removeRequest</a>(<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=msg">msg</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=requestID">requestID</a>);
<a class='l d3' name=1112 href="#1112">1112</a>     }
<a class='l d3' name=1113 href="#1113">1113</a>   },
<a class='l d3' name=1114 href="#1114">1114</a> 
<a class='l d3' name=1115 href="#1115">1115</a>   <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=classID">classID</a>: <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Components">Components</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=ID">ID</a>(<span class='s'>"{8c1bca96-266f-493a-8d57-ec7a95098c15}"</span>),
<a class='l d3' name=1116 href="#1116">1116</a> 
<a class='l d3' name=1117 href="#1117">1117</a>   <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=QueryInterface">QueryInterface</a>: <span class='a'>XPCOMUtils</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=generateQI">generateQI</a>([<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Ci">Ci</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=nsISupports">nsISupports</a>,
<a class='l d3' name=1118 href="#1118">1118</a>                                          <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Ci">Ci</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=nsIObserver">nsIObserver</a>,
<a class='l d3' name=1119 href="#1119">1119</a>                                          <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=Ci">Ci</a>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=nsISupportsWeakReference">nsISupportsWeakReference</a>])
<a class='l d3' name=1120 href="#1120">1120</a> }
<a class='l d3' name=1121 href="#1121">1121</a> 
<a class='l d3' name=1122 href="#1122">1122</a> <span class='v'>this.</span><a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=NSGetFactory">NSGetFactory</a> = <span class='a'>XPCOMUtils</span>.<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=generateNSGetFactory">generateNSGetFactory</a>([<a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=WebappsRegistry">WebappsRegistry</a>,
<a class='l d3' name=1123 href="#1123">1123</a>                                                      <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=WebappsApplicationMgmt">WebappsApplicationMgmt</a>,
<a class='l d3' name=1124 href="#1124">1124</a>                                                      <a class="d" href="http://mxr.mozilla.org/mozilla-central/ident?i=WebappsApplication">WebappsApplication</a>]);
<a class='l d3' name=1125 href="#1125">1125</a> </span></pre><form name='revs' id='revs' class='aftercontent'
>view http://hg.mozilla.org/mozilla-central/rev/
<select name='rev' id='rev' onchange='changerev()'>
<option value="0f5421c28b14">0f5421c28b14 (2015-08-19 14:53 -0700) Nick Robson</option>
<option value="77123d898d4c">77123d898d4c (2015-08-08 15:26 -0400) Marco Castelluccio</option>
<option value="932a80206f57">932a80206f57 (2015-07-05 08:45 -0400) Carmen Jimenez</option>
<option value="b29b0dfd8ac6">b29b0dfd8ac6 (2015-05-20 23:06 -0700) Fabrice Desr?</option>
<option value="79821bfa9616">79821bfa9616 (2015-03-05 22:43 -0800) Fabrice Desr?</option>
<option value="9fbebdeeeedb">9fbebdeeeedb (2015-02-10 13:18 -0500) Mike Conley</option>
<option value="860e858f8c7f">860e858f8c7f (2015-02-11 12:03 -0500) Mike Conley</option>
<option value="bfa7ca09a3c7">bfa7ca09a3c7 (2014-12-18 17:40 -0500) Ted Clancy</option>
<option value="04ee44a2ae09">04ee44a2ae09 (2015-01-10 15:00 -0800) Fabrice Desr?</option>
<option value="4583ade26b7e">4583ade26b7e (2015-01-12 09:02 +0100) Carsten &quot;Tomcat&quot; Book</option>
<option value="df960e299bcd">df960e299bcd (2015-01-10 15:00 -0800) Fabrice Desr?</option>
<option value="84b9872f54c7">84b9872f54c7 (2014-12-19 10:47 +0100) Carsten &quot;Tomcat&quot; Book</option>
<option value="45940d63b0c7">45940d63b0c7 (2014-12-18 17:40 -0500) Ted Clancy</option>
<option value="32b0ce626ec8">32b0ce626ec8 (2014-11-02 14:04 -0500) Ted Clancy</option>
<option value="feafedc5b6ef">feafedc5b6ef (2014-10-23 16:40 -0700) Fabrice Desr?</option>
<option value="3eb727d509f4">3eb727d509f4 (2014-10-23 18:21 -0700) Wes Kocher</option>
<option value="556dc4f97e08">556dc4f97e08 (2014-10-23 16:40 -0700) Fabrice Desr?</option>
<option value="e1ed7edd0166">e1ed7edd0166 (2014-10-14 22:55 -0700) Fabrice Desr?</option>
<option value="00ab79c7e6e0">00ab79c7e6e0 (2014-10-03 10:05 +0200) Bobby Holley</option>
<option value="2ebb9767d726">2ebb9767d726 (2014-09-05 16:55 -0700) Fabrice Desr?</option>
<option value="931256fc7ad6">931256fc7ad6 (2014-09-07 20:04 -0700) Fabrice Desr?</option>
<option value="84ac3d72395f">84ac3d72395f (2014-09-05 16:55 -0700) Fabrice Desr?</option>
<option value="27c608247d1d">27c608247d1d (2014-08-27 10:12 -0700) Birunthan Mohanathas</option>

</select>/dom/apps/Webapps.js
</form>
</p>


<!-- Mirrored from mxr.mozilla.org/mozilla-central/source/dom/apps/Webapps.js by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 01 Oct 2015 18:59:24 GMT -->
</html>
