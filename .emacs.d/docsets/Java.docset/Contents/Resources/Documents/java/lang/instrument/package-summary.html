<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_60) on Tue Aug 04 12:27:16 PDT 2015 -->
<title>java.lang.instrument</title>
<meta name="date" content="2015-08-04">
<meta name="keywords" content="java.lang.instrument package">
<link rel="stylesheet" type="text/css" href="../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="java.lang.instrument";
        }
    }
    catch(err) {
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li class="navBarCell1Rev">Package</li>
<li>Class</li>
<li><a href="package-use.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-files/index-1.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
<div class="aboutLanguage"><strong>Java&trade;&nbsp;Platform<br>Standard&nbsp;Ed.&nbsp;8</strong></div>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../java/lang/annotation/package-summary.html">Prev&nbsp;Package</a></li>
<li><a href="../../../java/lang/invoke/package-summary.html">Next&nbsp;Package</a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?java/lang/instrument/package-summary.html" target="_top">Frames</a></li>
<li><a href="package-summary.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<div class="header">
<h1 title="Package" class="title">Package&nbsp;java.lang.instrument</h1>
<div class="docSummary">
<div class="block">Provides services that allow Java programming language agents to instrument programs running on the JVM.</div>
</div>
<p>See:&nbsp;<a href="#package.description">Description</a></p>
</div>
<div class="contentContainer">
<ul class="blockList">
<li class="blockList">
<table class="typeSummary" border="0" cellpadding="3" cellspacing="0" summary="Interface Summary table, listing interfaces, and an explanation">
<caption><span>Interface Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Interface</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../../../java/lang/instrument/ClassFileTransformer.html" title="interface in java.lang.instrument">ClassFileTransformer</a></td>
<td class="colLast">
<div class="block">An agent provides an implementation of this interface in order
 to transform class files.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../java/lang/instrument/Instrumentation.html" title="interface in java.lang.instrument">Instrumentation</a></td>
<td class="colLast">
<div class="block">This class provides services needed to instrument Java
 programming language code.</div>
</td>
</tr>
</tbody>
</table>
</li>
<li class="blockList">
<table class="typeSummary" border="0" cellpadding="3" cellspacing="0" summary="Class Summary table, listing classes, and an explanation">
<caption><span>Class Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Class</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../../../java/lang/instrument/ClassDefinition.html" title="class in java.lang.instrument">ClassDefinition</a></td>
<td class="colLast">
<div class="block">This class serves as a parameter block to the <code>Instrumentation.redefineClasses</code> method.</div>
</td>
</tr>
</tbody>
</table>
</li>
<li class="blockList">
<table class="typeSummary" border="0" cellpadding="3" cellspacing="0" summary="Exception Summary table, listing exceptions, and an explanation">
<caption><span>Exception Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Exception</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../../../java/lang/instrument/IllegalClassFormatException.html" title="class in java.lang.instrument">IllegalClassFormatException</a></td>
<td class="colLast">
<div class="block">Thrown by an implementation of
 <a href="../../../java/lang/instrument/ClassFileTransformer.html#transform-java.lang.ClassLoader-java.lang.String-java.lang.Class-java.security.ProtectionDomain-byte:A-"><code>ClassFileTransformer.transform</code></a>
 when its input parameters are invalid.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../java/lang/instrument/UnmodifiableClassException.html" title="class in java.lang.instrument">UnmodifiableClassException</a></td>
<td class="colLast">
<div class="block">Thrown by an implementation of
 <a href="../../../java/lang/instrument/Instrumentation.html#redefineClasses-java.lang.instrument.ClassDefinition...-"><code>Instrumentation.redefineClasses</code></a>
 when one of the specified classes cannot be modified.</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
<a name="package.description">
<!--   -->
</a>
<h2 title="Package java.lang.instrument Description">Package java.lang.instrument Description</h2>
<div class="block">Provides services that allow Java programming language agents to instrument programs running on the JVM. 
The mechanism for instrumentation is modification of the byte-codes of methods.

<h2>Package Specification</h2>

<P> 
An agent is deployed as a JAR file. An attribute in the JAR file manifest specifies the
agent class which will be loaded to start the agent. For implementations that support a command-line 
interface, an agent is started by specifying an option on the command-line.  
Implementations may also support a mechanism to start agents some time after the VM has
started. For example, an implementation may provide a mechanism that allows a tool to 
<i>attach</i> to a running application, and initiate the loading of the tool's agent into
the running application. The details as to how the load is initiated, is implementation
dependent.

<h3>Command-Line Interface</h3>

<P> 
An implementation is not required to provide a way to start agents from the
command-line interface. On implementations that do provide a way to start agents
from the command-line interface, an agent is started by adding this option to
the command-line:
<blockquote>
<code><b>-javaagent:</b></code><i>jarpath[</i><code><b>=</b></code><i>options]</i>
</blockquote>
<i>jarpath</i> is the path to the agent JAR file.
<i>options</i> is the agent options.
This switch may be used multiple times on the same command-line, 
thus creating multiple agents.
More than one agent may use the same <i>jarpath</i>.
An agent JAR file must conform to the JAR file specification.

<P>
The manifest of the agent JAR file must contain the attribute <code>Premain-Class</code>. The
value of this attribute is the name of the <i>agent class</i>. The agent class must implement a 
public static <code>premain</code> method similar in principle to the <code>main</code> application 
entry point.  After the Java Virtual Machine (JVM) has initialized, each <code>premain</code> method 
will be called in the order the agents were specified, then the real application
<code>main</code> method will be called. 
Each <code>premain</code> method must return in order for the startup sequence to proceed.

<P>
The <code>premain</code> method has one of two possible signatures. The JVM first attempts to
invoke the following method on the agent class:

<blockquote>
<code>public static void
premain(String agentArgs, Instrumentation inst);
</code>
</blockquote>

<P>
If the agent class does not implement this method then the JVM will attempt to invoke:

<blockquote>
<code>public static void
premain(String agentArgs);
</code>
</blockquote>

<P>
The agent class may also have an <code>agentmain</code> method for use when the agent is started 
after VM startup. When the agent is started using a command-line option, the <code>agentmain</code>
method is not invoked.


<P>
The agent class will be loaded by the system class loader
(see <a href="../../../java/lang/ClassLoader.html#getSystemClassLoader--"><code>ClassLoader.getSystemClassLoader</code></a>). This is
the class loader which typically loads the class containing the application <code>main</code> method.
The <code>premain</code> methods will be run under the same security and classloader 
rules as the application <code>main</code> method.
There are no modeling restrictions on what the agent <code>premain</code> method may do.
Anything application <code>main</code> can do, including creating threads, is legal from <code>premain</code>.

<P>
Each agent is passed its agent options via the <code>agentArgs</code> parameter.
The agent options are passed as a single string,
any additional parsing should be performed by the agent itself.

<P>
If the agent cannot be resolved 
(for example, because the agent class cannot be loaded,
or because the agent class does not have an appropriate <code>premain</code> method), the JVM will abort.
If a <code>premain</code> method throws an uncaught exception, the JVM will abort.



<h3>Starting Agents After VM Startup</h3>

<p>
An implementation may provide a mechanism to start agents sometime after the
the VM has started. The details as to how this is initiated are implementation 
specific but typically the application has already started and its <code>
main</code> method has already been invoked. In cases where an implementation
supports the starting of agents after the VM has started the following applies:

<ol>
  <li><p>The manifest of the agent JAR must contain the attribute <code>Agent-Class</code>. 
      The value of this attribute is the name of the <i>agent class</i>. </p></li> 
      
  <li><p>The agent class must implement a public static <code>agentmain</code> method. </p></li>

  <li><p>The system class loader (
      <a href="../../../java/lang/ClassLoader.html#getSystemClassLoader--"><code>ClassLoader.getSystemClassLoader</code></a>) must
      support a mechanism to add an agent JAR file to the system class path. <p></li>
</ol>  

<P>
The agent JAR is appended to the system class path. This is the class loader that typically loads 
the class containing the application <code>main</code> method. The agent class is loaded and the
JVM attempts to invoke the <code>agentmain</code> method. The JVM first attempts to invoke 
the following method on the agent class:

<blockquote>
<code>public static void
agentmain(String agentArgs, Instrumentation inst);
</code>
</blockquote>

<P>
If the agent class does not implement this method then the JVM will attempt to invoke:

<blockquote>
<code>public static void
agentmain(String agentArgs);
</code>
</blockquote>

<P>
The agent class may also have an <code>premain</code> method for use when the agent is started
using a command-line option. When the agent is started after VM startup the <code>premain</code>
method is not invoked.


<P>
The agent is passed its agent options via the <code>agentArgs</code> parameter.
The agent options are passed as a single string,
any additional parsing should be performed by the agent itself. 

<P>
The <code>agentmain</code> method should do any necessary initialization 
required to start the agent. When startup is complete the method should 
return. If the agent cannot be started
(for example, because the agent class cannot be loaded,
or because the agent class does not have a conformant <code>agentmain</code> method), the JVM will
not abort. If the <code>agentmain</code> method throws an uncaught exception it will be ignored.



<h3>Manifest Attributes</h3>
The following manifest attributes are defined for an agent JAR file:
<blockquote>
<dl>
<dt><code>Premain-Class</code></dt>
<dd>
                        When an agent is specified at JVM launch time this attribute
                        specifies the agent class.
                        That is, the class containing the <code>premain</code> method.
                        When an agent is specified at JVM launch time this attribute
                        is required. If the attribute is not present the JVM will abort.
                        Note: this is a class name, not a file name or path.                                                    
</dd>

<dt><code>Agent-Class</code></dt>
<dd>
                        If an implementation supports a mechanism to start agents 
                        sometime after the VM has started then this attribute specifies
                        the agent class.
                        That is, the class containing the <code>agentmain</code> method.
                        This attribute is required, if it is not present the agent
                        will not be started.
                        Note: this is a class name, not a file name or path.
</dd>                   

<dt><code>Boot-Class-Path</code></dt>
<dd>
                        A list of paths to be searched by the bootstrap class
                        loader. Paths represent directories or libraries
                        (commonly referred to as JAR or zip libraries on
                        many platforms).                        
                        These paths are searched by the
                        bootstrap class loader after the platform specific
                        mechanisms of locating a class have failed.
                        Paths are searched in the order listed.
                        Paths in the list are separated by one or more spaces.
                        A path takes the syntax of the path component of a
                        hierarchical URI. The path is
                        absolute if it begins with a slash character ('/'),
                        otherwise it is relative. A relative path is resolved
                        against the absolute path of the agent JAR file.
                        Malformed and non-existent paths are ignored.   
                        When an agent is started sometime after the VM has
                        started then paths that do not represent a JAR file
                        are ignored.
                        This attribute is optional.
</dd>
<dt><code>Can-Redefine-Classes</code></dt>
<dd>
                        Boolean (<code>true</code> or <code>false</code>, case irrelevant).
                        Is the ability to redefine classes
                        needed by this agent.
                        Values other than <code>true</code> are considered <code>false</code>.
                        This attribute is optional, the default is <code>false</code>.
</dd>
<dt><code>Can-Retransform-Classes</code></dt>
<dd>
                        Boolean (<code>true</code> or <code>false</code>, case irrelevant).
                        Is the ability to retransform classes
                        needed by this agent.
                        Values other than <code>true</code> are considered <code>false</code>.
                        This attribute is optional, the default is <code>false</code>.
</dd>
<dt><code>Can-Set-Native-Method-Prefix</code></dt>
<dd>
                        Boolean (<code>true</code> or <code>false</code>, case irrelevant).
                        Is the ability to set native method prefix needed by this agent.
                        Values other than <code>true</code> are considered <code>false</code>.
                        This attribute is optional, the default is <code>false</code>.
</dd>
</dl>
</blockquote>

<p> 
An agent JAR file may have both the <code>Premain-Class</code> and <code>Agent-Class</code>
attributes present in the manifest. When the agent is started on the command-line using
the <code>-javaagent</code> option then the <code>Premain-Class</code> attribute
specifies the name of the agent class and the <code>Agent-Class</code> attribute is
ignored. Similarly, if the agent is started sometime after the VM has started, then
the <code>Agent-Class</code> attribute specifies the name of the agent class
(the value of <code>Premain-Class</code> attribute is ignored).

<h2>Related Documentation</h2>

For tool documentation, please see:
<ul>
  <li><a href="../../../../technotes/tools/index.html">JDK Tools and Utilities</a>
</ul></div>
<dl>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>JDK1.5</dd>
</dl>
</div>
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li class="navBarCell1Rev">Package</li>
<li>Class</li>
<li><a href="package-use.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-files/index-1.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
<div class="aboutLanguage"><strong>Java&trade;&nbsp;Platform<br>Standard&nbsp;Ed.&nbsp;8</strong></div>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../java/lang/annotation/package-summary.html">Prev&nbsp;Package</a></li>
<li><a href="../../../java/lang/invoke/package-summary.html">Next&nbsp;Package</a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?java/lang/instrument/package-summary.html" target="_top">Frames</a></li>
<li><a href="package-summary.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small><font size="-1"> <a href="http://bugreport.sun.com/bugreport/">Submit a bug or feature</a> <br>For further API reference and developer documentation, see <a href="https://docs.oracle.com/javase/8/docs/index.html" target="_blank">Java SE Documentation</a>. That documentation contains more detailed, developer-targeted descriptions, with conceptual overviews, definitions of terms, workarounds, and working code examples.<br> <a href="../../../../legal/cpyr.html">Copyright</a> &#x00a9; 1993, 2015, Oracle and/or its affiliates.  All rights reserved. </font></small></p>
</body>
</html>
